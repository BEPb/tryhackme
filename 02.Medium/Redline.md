[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Redline](https://tryhackme.com/r/room/btredlinejoxr3d) 

Всего 8 заданий:
## Задание 1
Многие инструменты могут помочь аналитику безопасности или специалисту по реагированию на инциденты в выполнении 
анализа памяти на потенциально скомпрометированной конечной точке. Одним из самых популярных инструментов является  
Volatility, который позволит аналитику глубоко зарыться в сорняки при изучении артефактов памяти с конечной точки. 
Но этот процесс может занять время. Часто, когда аналитик проводит сортировку, время имеет существенное значение, и 
аналитику необходимо выполнить быструю оценку, чтобы определить характер события безопасности.

Вот тут-то и пригодится инструмент FireEye  Redline. Redline по сути предоставит аналитику обзор на 30 000 футов 
(10 километров в высоту) конечной точки Windows, Linux или macOS. Используя Redline, вы можете проанализировать 
потенциально скомпрометированную конечную точку через дамп памяти, включая различные файловые структуры. С приятным 
на вид графическим пользовательским интерфейсом ( GUI ) вы можете легко обнаружить признаки вредоносной активности.



Вот что вы можете сделать с помощью Redline:
- Собрать данные реестра (только для хостов Windows)
- Собрать запущенные процессы
- Собирайте образы памяти (до Windows 10)
- Собирать историю браузера
- Ищите подозрительные строки
И многое другое!

Установка Redline на локальном компьютере проста. Запустите файл MSI и следуйте процессу установки.

Redline установлен на виртуальной машине, подключенной к этой комнате. 

Запустите присоединенную виртуальную машину. Если вы хотите получить доступ к виртуальной машине через удаленный рабочий стол, используйте учетные данные ниже. 

IP-адрес машины : MACHINE_IP
Пользователь : administrator
Пароль : letmein123!



Примите сертификат при появлении соответствующего запроса, и вы должны войти в удаленную систему.

Примечание : загрузка виртуальной машины может занять до 3 минут.

### Ответьте на вопросы ниже
Кто создал Redline?
```commandline
FireEye
```

## Задание 2
Теперь, когда у вас есть общее представление о Redline, давайте перейдем к этапу сбора данных.

Существует три способа или варианта сбора данных с помощью Redline: 
- Стандартный сборщик — этот метод настраивает скрипт на сбор минимального количества данных для анализа. Это будет  
наш предпочтительный метод сбора данных в этой комнате. Это также обычно самый быстрый метод сбора необходимых вам 
  данных. Это займет всего несколько минут.
- Comprehensive Collector - этот метод настраивает скрипт на сбор наибольшего количества данных с вашего хоста для 
  дальнейшего анализа. Этот метод занимает до часа или больше. Вы выберете этот метод, если предпочитаете полный 
  анализ системы.
- IOC Search Collector (только для Windows) — этот метод собирает данные, которые соответствуют индикаторам 
  компрометации (IOC), созданным вами с помощью IOC Editor. Вы выберете этот метод, если хотите запустить сбор 
  данных по известным IOC, которые вы собрали либо с помощью разведки угроз (канал данных или повествовательный 
  отчет), реагирования на инциденты или анализа вредоносного ПО. Вы импортировали их в IOC Editor. Мы рассмотрим 
  IOC Editor немного подробнее в следующей задаче.
Прежде чем продолжить, запустите Redline. Значок удобно расположен на панели задач. 

В этом задании мы будем использовать метод стандартного сборщика.

В Redline нажмите «Создать стандартный сборщик».
У вас будет возможность выбрать целевую платформу. В нашем случае мы выберем Windows.


В разделе Review Script Configuration нажмите «Edit your script», это один из важнейших шагов, поскольку вам будет 
представлен набор данных для выбора, которые нужно собрать с хоста. Будет пять вкладок, в том числе  Memory, Disk, 
System, Network и Other.
Давайте углубимся в некоторые детали:

Память:

Вы можете настроить скрипт для сбора данных памяти, таких как списки процессов, перечисление драйверов (только для 
хостов Windows) и обнаружение перехватов (версии до Windows 10).

Примечание: для этого упражнения снимите флажок «Обнаружение крючков» и убедитесь, что флажок «Получить образ 
памяти» также снят.

Обязательно внесите необходимые изменения в настройки на каждой вкладке, чтобы они соответствовали настройкам, 
проиллюстрированным в содержании задачи.

Диск: 

Здесь вы можете собрать данные о разделах дисков и томах, а также перечень файлов.

Система:

Система предоставит вам информацию о машине:

- Информация о машине и операционной системе ( ОС )
- Анализ точек восстановления системы (только для версий Windows до 10)
- Перечислить кусты реестра (только для Windows)
- Получить учетные записи пользователей (только для Windows и OS  X)
- Получить группы ( только OS  X)
- Получить кэш предварительной выборки (только для Windows) 


Сеть:

Network Options поддерживает платформы Windows, OS X и Linux . Вы можете настроить скрипт для сбора сетевой 
информации и истории браузера, что необходимо при расследовании действий браузера, включая вредоносные загрузки 
файлов и входящие/исходящие соединения.



Другой:

С помощью этой опции вы можете собирать данные о различных службах и задачах, запущенных в системе, включая хэши.

Теперь мы готовы перейти к следующему важному шагу. После выбора параметров данных нажмите OK. А затем нажмите 
«Обзор»  под  «Сохранить ваш коллектор в» . Почему это важный шаг? Потому что вам нужно будет создать папку, в 
которой будет сохранен ваш файл анализа, и сценарий для сбора необходимых вам данных. В нашем случае мы сохраняем 
его в  папку Analysis.


Примечание : Вы можете выбрать любую папку, которую хотите, но убедитесь, что папка ПУСТАЯ. Завершите этот диалог, 
нажав кнопку ОК.

После того, как вы решите сохранить коллектор в папке, вы увидите инструкции для коллектора.


Если вы зайдете в папку, то увидите bat-файл под названием  "RunRedlineAudit" . Это исполняемый скрипт для сбора 
данных с хоста. Скрипт необходимо запустить  от имени администратора,  чтобы иметь возможность собирать необходимые 
нам данные.


Запуск скрипта откроет окно командной строки; это означает, что скрипт успешно запущен. Он автоматически закроется, 
когда процесс сбора данных завершится.


Примечание : этот процесс может занять от 15 до 20 минут.

После завершения скрипта вы увидите новый созданный файл -  AnalysisSession1  (в папке Sessions ) с расширением  .
mans  . Этот файл нам нужен для импорта в Redline для расследования. Просто дважды щелкните по файлу, чтобы 
импортировать данные аудита.


Совет : если вы запустите скрипт несколько раз, соглашение об именовании файла анализа увеличится на 1. Например, если вы запустите скрипт два раза, вы увидите AnalysisSession1 и AnalysisSession2 . 

Поздравляем! Теперь у вас есть необходимые данные, и вы готовы погрузиться в процесс расследования в следующих задачах. 

### Ответьте на вопросы ниже
Какой метод сбора данных занимает меньше всего времени?
```commandline
Standard Collector
```
Вы читаете исследовательскую работу о новом штамме вируса-вымогателя. Вы хотите запустить сбор данных на своем компьютере на основе предоставленных шаблонов, таких как домены, хэши, IP-адреса, имена файлов и т. д. Какой метод вы бы выбрали для запуска гранулярного сбора данных по известным индикаторам?
```commandline
IOC Search Collector
```
Какой скрипт вы бы запустили, чтобы инициировать процесс сбора данных? Пожалуйста, укажите расширение файла. 
```commandline
RunRedlineAudit.bat
```
Если вы хотите собрать данные о дисках и томах, в каком разделе вы можете их найти? 
```commandline
Disk Enumeration
```
Какой кэш использует Windows для сохранения предпочтений относительно недавно выполненного кода? 
```commandline
Prefetch
```

## Задание 3
Давайте рассмотрим интерфейс Redline.

У вас должен быть первый файл анализа. Дважды щелкните файл  AnalysisSession1.mans, и данные будут автоматически 
импортированы в Redline. Пожалуйста, подождите до 10 минут, чтобы импортировать данные.

После импорта данных вам будет представлено следующее представление:

На левой панели вы увидите различные типы  аналитических данных;  именно здесь вы будете выполнять сбор информации и 
процесс исследования.

- Информация о системе:  здесь вы увидите информацию о машине, BIOS (только Windows), операционной системе и 
информацию о пользователе.
- Процессы:  процессы будут содержать различные атрибуты, такие как имя процесса, PID , путь, аргументы, родительский 
  процесс, имя пользователя и т. д. При раскрытии вкладки «Процессы» будут четыре раздела: «Дескрипторы», «Разделы памяти», «Строки» и «Порты».

**Дескриптор**  — это соединение процесса с объектом или ресурсом в операционной системе Windows. Операционные 
системы используют дескрипторы для ссылки на внутренние объекты, такие как файлы, ключи реестра, ресурсы и т. д.

Разделы памяти  позволят вам исследовать неподписанные разделы памяти, используемые некоторыми процессами. Многие 
процессы обычно используют легитимные библиотеки динамической компоновки (DLL), которые будут подписаны. Это 
особенно интересно, потому что если вы увидите какие-либо неподписанные DLL, то стоит присмотреться повнимательнее.   

Строки - вы увидите информацию о захваченных строках.

Порты — это один из критических разделов, на который следует обратить внимание. Большинство вредоносных программ 
часто инициируют исходящие или входящие соединения для связи со своим сервером управления и контроля (C2) для 
выполнения некоторых вредоносных действий, таких как эксфильтрация данных или захват полезной нагрузки на машину. В 
этой ситуации вы можете просмотреть подозрительные соединения с портов и IP-адресов. Обратите внимание также на 
системные процессы. Субъекты угроз любят избегать обнаружения, скрываясь под системными процессами. Например, 
explorer.exe или notepad.exe не должны быть в списке процессов с исходящими соединениями.

Вот некоторые другие важные разделы, на которые вам следует обратить внимание:

- Файловая система (не включена в этот сеанс анализа)
- Реестр
- Службы Windows
- Задачи (злоумышленники любят создавать запланированные задачи для обеспечения настойчивости)
- Журналы событий (это еще одно отличное место для поиска подозрительных событий Windows PowerShell, а также событий 
  входа/выхода из системы, создания пользователей и других)
- Записи ARP и маршрута ( не включены в этот сеанс анализа )
- История URL-адресов браузера ( не включена в этот сеанс анализа )
- История загрузки файлов


Временная шкала поможет вам лучше понять, когда произошел взлом и какие шаги предпринял злоумышленник для эскалации 
атаки. Временная шкала также запишет каждое действие с файлом, если он был создан, изменен, модифицирован, к нему 
был получен доступ.


Если вы знаете, когда произошел взлом хоста или подозрительная активность, вы можете использовать TimeWrinkles™, 
чтобы отфильтровать временную шкалу, оставив только события, произошедшие примерно в это время.


TimeCrunches™  помогает сократить избыточный объем данных, которые не имеют значения в табличном представлении. 
TimeCrunch скроет те же типы событий, которые произошли в течение той же минуты, которую вы указали.


Дополнительную информацию о каждом типе анализа данных можно найти в Руководстве пользователя Redline:  
https://fireeye.market/assets/apps/211364/documents/877936_en.pdf .

Теперь вы узнали некоторые основы различных типов данных, которые помогут вам в процессе расследования. Давайте 
отправимся на охоту и посмотрим, сможете ли вы ответить на некоторые вопросы в следующем задании.

### Ответьте на вопросы ниже
Где в интерфейсе Redline можно просмотреть информацию о вошедшем в систему пользователе?

```commandline
System Information
```

## Задание 4
Теперь вы должны быть знакомы с некоторыми терминами и методами сбора данных, как показано в предыдущем задании. 
Вооружившись этими знаниями, сможете ли вы найти то, что злоумышленник подбросил вам на компьютер?

Примечание: вам нужно будет проанализировать файл .mans, импортированный из предыдущего задания, чтобы ответить на 
вопросы ниже.

### Ответьте на вопросы ниже
Укажите операционную систему, обнаруженную на рабочей станции.
```commandline
Windows Server 2019 Standard 17763
```
Обязательно проверьте остальную часть раздела «Информация о системе» на предмет других полезных данных.
```commandline
Ответ не нужен
```
Какая подозрительная запланированная задача была создана на компьютере жертвы? 
```commandline
MSOfficeUpdateFa.ke
```
Найдите в задании сообщение, которое злоумышленник оставил для вас.
```commandline
THM-p3R5IStENCe-m3Chani$m
```
Злоумышленник создал новый идентификатор системного события с  именем источника "THM-Redline-User" и  типом "ERROR". Найдите идентификатор события #.
```commandline
546
```
Укажите сообщение для идентификатора события.
```commandline
Someone cracked my password. Now I need to rename my puppy-++-
```
Похоже, злоумышленник загрузил файл, содержащий флаг для вопроса 8. Укажите полный URL-адрес веб-сайта.
```commandline
https://wormhole.app/download-stream/gI9vQtChjyYAmZ8Ody0AuA
```
Укажите полный путь к месту загрузки файла, включая имя файла.
```commandline
C:\Program Files (x86)\Windows Mail\SomeMailFolder\flag.txt
```
Предоставьте сообщение, которое злоумышленник оставил для вас в файле.
```commandline
THM{600D-C@7cH-My-FR1EnD}
```

## Задание 5
Мы кратко обсудили использование IOC Search Collector в задаче сбора данных.
Давайте подробнее рассмотрим возможности этого типа коллектора. Но сначала давайте вспомним, что такое IOC. 
IOC означает «индикаторы компрометации »; это артефакты потенциальной компрометации и вторжения на хост в системе 
или сети, которые вам нужно искать при проведении поиска угроз или реагировании на инциденты. IOC могут быть хэшами 
MD5, SHA1, SHA256, IP-адресом, доменом C2 , размером файла, именем файла, путем к файлу, ключом реестра и т. д.

Одним из замечательных инструментов, которые вы можете использовать, является  IOC Editor,  созданный FireEye, для 
создания IOC- файлов. Вы можете перейти по этой ссылке, чтобы узнать, как использовать IOC Editor:  https://fireeye.market/assets/apps/S7cWpi9W//9cb9857f/ug-ioc-editor.pdf .  

Примечание : Согласно странице загрузки IOC Editor, Windows 7 — последняя официально поддерживаемая операционная 
система. Это та же версия, что установлена в подключенной виртуальной машине. Есть еще один инструмент под 
названием OpenIOC Editor от FireEye, который поддерживает Windows 10 и на который стоит обратить внимание.

Совет : прежде чем продолжить, вы можете закрыть Redline, чтобы освободить некоторые системные ресурсы при 
использовании IOC Editor.

Вы можете создать текстовый файл, содержащий IOC, изменить его и поделиться им с другими людьми в отрасли 
информационной безопасности.

В этом примере мы рассмотрим IOC кейлоггера, созданного с помощью IOC Editor. 

Примечание : Ниже вы можете следовать скриншотам и не обязаны создавать файл IOC в этой задаче. Вы создадите файл 
IOC с помощью редактора IOC и выполните поиск IOC в следующей задаче.

Откройте редактор IOC, который удобно расположен на панели задач рядом с Redline. 

Примечание: запуск приложения может занять около 60 секунд. 

Прежде чем продолжить, создайте каталог, в котором будет храниться файл IOC ( Каталог IOC ). 

Далее создайте файл IOC .



Индикаторы кейлоггера в редакторе IOC :



Краткое пояснение к изображению выше:

Имя файла IOC — Keylogger , Keylogger .ioc . (это поле можно редактировать)
Автор — RussianPanda. (это поле вы можете редактировать)
 Поля  GUID ,  Created и  Modified НЕ подлежат  редактированию, а редактор IOC заполняет эту информацию.
В разделе  «Описание» можно добавить краткое описание назначения файла IOC .
Фактические МОК будут добавлены, как вы уже догадались, в разделе «Добавить» . 

Вот значения с изображения выше:

Строки файла -psylog.exe
Строки файла -RIDEV_INPUTSINK
Файл MD5 -791ca706b285b9ae3192a33128e4ecbb
Размер файла -35400
Посмотрите на gif-изображение ниже, чтобы получить представление о добавлении определенных IOC в файл IOC .



После выбора товара вы можете напрямую ввести его стоимость. 



Вы также можете добавить его в разделе «Свойства» . 



Все поля доступны только для чтения, за исключением Content и Comment . Чтобы добавить значение к элементу, введите его в поле Content . 



После ввода значения нажмите «Сохранить», чтобы сохранить его.



Примечание : Вы можете щелкнуть правой кнопкой мыши по элементу для дополнительных опций. См. ниже.



Мы предоставим вам возможность исследовать это самостоятельно. 

Теперь, когда мы создали и сохранили файл IOC, давайте продолжим и вернемся к коллектору поиска IOC в инструменте Redline .

Примечание : Если вы закрыли Redline, сейчас самое время перезапустить приложение. Вы можете снова закрыть IOC Editor, чтобы освободить системные ресурсы. 

IOC Search Collector будет игнорировать данные, которые не соответствуют собранному вами IOC. Хотя вы всегда можете выбрать сбор дополнительных данных. Как указано в руководстве пользователя Redline, качество анализа IOC будет зависеть от данных, которые у вас есть в доступном сеансе анализа.



Чтобы создать IOC Search Collector, нажмите «Обзор...» и выберите местоположение файла .ioc. Redline автоматически обнаружит файл .ioc и поместит его в раздел «Индикаторы», как показано ниже.

Коллектор поиска МОК :



Неподдерживаемые поисковые термины: эти термины не будут отображаться в результатах поиска в Redline, что означает, что Redline не распознает определенные поисковые термины. 

Поддерживаемые поисковые термины: термины, которые Redline будет распознавать и искать.

После того, как вы закончите просмотр настроенных IOC, нажмите «Далее». Теперь нажмите «Изменить свой сценарий», чтобы настроить, какие данные будут собираться для анализа. Для этого примера, Keylogger file IOC Search, были выбраны следующие параметры. 



Примечание : при настройке собственного поиска IOC вы выберете другие настройки для своего скрипта по сравнению с настройками, указанными выше. 

Закончив редактирование скрипта, нажмите «ОК». 

В разделе «Сохранить коллектор в» нажмите «Обзор» и выберите пустую папку, в которой будет сохранен файл анализа вместе с  файлом RunRedlineAudit.bat . 

После выполнения .bat-файла таким же образом, как и раньше, давайте дождемся окончания анализа.


После завершения анализа вы увидите файл .mans (AnalysisSession1 в нашем примере). Дважды щелкните файл, чтобы открыть его в Redline. 



Если Redline не удается автоматически сгенерировать отчет IOC, вы можете сгенерировать его вручную, нажав «Создать новый отчет IOC» и импортировав файл .ioc.

Когда генерация отчета завершится, вы должны увидеть «Hits». Вы можете развернуть список, нажав на записи в каждой строке.


На скриншоте видно, что было одно попадание на "chrome.dll", это ложное срабатывание. Давайте рассмотрим  подробности ниже. 



Как вы видите, файл DLL совпал со строкой "RIDEV_INPUTSINK", которая была в нашем файле .ioc. Важно собрать гранулированные и точные артефакты для добавления в ваш файл IOC , чтобы избежать ложных срабатываний. 

На снимке экрана ниже показан файл с наибольшим количеством «попаданий», что означает, что это, скорее всего, тот файл, который мы ищем. 



Вы должны быть готовы ответить на вопросы ниже, используя скриншоты, предоставленные в задании, и выполнить эти аналогичные действия в следующем задании!
### Ответьте на вопросы ниже
Каково фактическое имя файла кейлоггера? 
```commandline
psylog.exe
```
Под каким именем маскируется файл? 
```commandline
THM1768.exe
```
Кто является владельцем файла? 
```commandline
WIN-2DET5DP0NPT\charles
```
Каков размер файла в байтах? 
```commandline
35400
```
Укажите полный путь к месту размещения файла .ioc после анализа Redline, а также имя файла .ioc.
```commandline
C:\Users\charles\Desktop\Keylogger-IOCSearch\IOCs\keylogger.ioc
```

## Задание 6
Сценарий : Вам поручено выполнить задание по поиску угроз в компании Osinski Inc. Они полагают, что произошло 
вторжение, и злоумышленник использовал инструмент для выполнения атаки с боковым перемещением, возможно, атаки 
«передачи хэша».

Задача : Можете ли вы найти файл, размещенный на компьютере жертвы, с помощью IOC Editor и Redline IOC Search Collector? 
На данный момент вам известны только следующие артефакты файла: 

Строки файла: 

```
20210513173819Z0w0=
<?<Л<Т<г=
Размер файла (байты): 

834936
```
Примечание : Откройте предыдущий анализ и используйте существующий сеанс Redline, найденный в 
`C:\Users\Administrator\Documents\Analysis\Sessions\AnalysisSession1`. 

### Ответьте на вопросы ниже
Укажите путь к файлу, который соответствует всем артефактам, а также имя файла.
```commandline
C:\Users\Administrator\AppData\Local\Temp\8eJv8w2id6IqN85dfC.exe
```
Укажите путь к файлу, не включая имя файла.
```commandline
C:\Users\Administrator\AppData\Local\Temp\
```
Кто является владельцем файла?
```commandline
BUILTIN\Administrators
```
Укажите подсистему для файла.
```commandline
Windows_CUI
```
Укажите путь к устройству, где расположен файл.
```commandline
\Device\HarddiskVolume2
```
Укажите хэш (SHA-256) для файла.
```commandline
57492d33b7c0755bb411b22d2dfdfdf088cbbfcd010e30dd8d425d5fe66adff4
```
Атакующему удалось замаскировать настоящее имя файла. Сможете ли вы найти его, имея в арсенале хэш? 
```commandline
PsExec.exe
```
## Задание 7
Сценарий : Старший бухгалтер Чарльз жалуется, что не может получить доступ к таблицам и другим файлам, над которыми 
он работал. Он также упомянул, что его обои сменились, сказав, что его файлы зашифрованы. Это нехорошие новости!

Вы готовы выполнить анализ памяти скомпрометированного хоста? У вас есть все необходимые данные для проведения 
расследования на машине жертвы. Пошли на охоту!

Задача :

- Перейдите в папку на рабочем столе под названием Endpoint Investigation.
- Дважды щелкните по  файлу AnalysisSession1.mans  . Данные будут автоматически импортированы в Redline.
- Проанализируйте файл, чтобы ответить  на вопросы ниже.
- Примечание: на импорт всех данных может потребоваться до 10 минут. 

### Ответьте на вопросы ниже
Можете ли вы определить наименование машины?
```commandline
Windows 7 Home Basic
```
Можете ли вы найти название записки, оставленной на рабочем столе для «Чарльза»?
```commandline
_R_E_A_D___T_H_I_S___AJYG1O_.txt
```
Найдите службу Защитника Windows. Как называется ее DLL-библиотека? 
```commandline
MpSvc.dll
```
Пользователь вручную загрузил zip-файл из сети. Можете ли вы найти имя файла? 
```commandline
eb5489216d4361f9e3650e6a6332f7ee21b0bc9f3f3a4018c69733949be1d481.zip
```
Укажите имя файла вредоносного исполняемого файла, попавшего на рабочий стол пользователя.
```commandline
Endermanch@Cerber5.exe
```
Укажите хэш MD5 для вредоносного исполняемого файла.
```commandline
fe1bc60a95b2c2d77cd5d232296a7fa4
```
Как называется вирус-вымогатель? 
```commandline
Cerber
```
## Задание 8
Как вы увидели, Redline — это мощный инструмент, который может провести вас через анализ скомпрометированного хоста. Вам также нужно учитывать, что точность анализа будет зависеть от того, какие данные вы хотите собрать. 

Помните, Redline собирает различные данные для анализа, включая запущенные процессы, службы, файлы, структуры реестра, журналы событий и т. д. 

При решении задач комнаты вы могли заметить, что временная шкала может быть полезна при поиске определенных ключевых слов. Временная шкала может дать вам представление о том, когда началась атака и какие последующие действия предпринял злоумышленник. 

Вот список литературы, если вы его пропустили в предыдущих заданиях:

- Руководство пользователя Redline:  https://fireeye.market/assets/apps/211364/documents/877936_en.pdf
- Руководство пользователя редактора IOC:  https://fireeye.market/assets/apps/S7cWpi9W//9cb9857f/ug-ioc-editor.pdf
Поздравляем! Теперь вы освоили новый инструмент. Если вы хотите бросить себе вызов, мы рекомендуем вам комнату  REvil Corp.

Удачной охоты!

### Ответьте на вопросы ниже
Прочитайте вышеизложенное.
```commandline
Ответ не нужен
```
[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)