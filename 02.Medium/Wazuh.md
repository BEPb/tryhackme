[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Wazuh](https://tryhackme.com/r/room/wazuhct) 

Всего 12 заданий:
## Задание 1
Добро пожаловать в комнату, демонстрирующую возможности программного решения Wazuh EDR. В этой комнате вы можете 
узнать следующее:
- Что такое EDR и почему они являются полезными решениями
- Где используется EDR, например Wazuh
- Доступ к Wazuh
- Навигация по Wazuh
- Изучение правил и предупреждений Wazuh
- Анализ журналов для просмотра определенных событий на устройствах, включая Linux и Windows
- Как можно расширить Wazuh с помощью плагинов и его API

Во-первых, давайте разберемся, что такое решения EDR.  Endpoint detection and response ( EDR ) — это ряд 
инструментов и приложений, которые отслеживают устройства на предмет активности, которая может указывать на угрозу 
или нарушение безопасности. Эти инструменты и приложения обладают следующими функциями:

- Проверка устройства на наличие распространенных уязвимостей
- Проактивный мониторинг устройства на предмет подозрительной активности, такой как несанкционированный вход в 
  систему, атаки методом подбора или повышение привилегий.
- Визуализация сложных данных и событий в аккуратные и модные графики
- Запись нормального рабочего поведения устройства для выявления аномалий

Wazuh, созданный в 2015 году, является открытым исходным кодом, свободно доступным и обширным решением EDR. Его 
можно использовать в средах любого масштаба. Wazuh работает на модуле управления и агента. Проще говоря, устройство, 
предназначенное для запуска Wazuh, называется менеджером, где Wazuh работает на модели управления и агента, где 
менеджер отвечает  за управление агентами, установленными на устройствах, которые вы хотите отслеживать.  Давайте 
рассмотрим эту модель на схеме ниже:

Мы видим логи от трех агентов, отправляемые на сервер Wazuh.

### Ответьте на вопросы ниже
Когда был выпущен Wazuh?
```commandline
2015
```
Как Wazuh называет устройство, которое отслеживается на предмет подозрительной активности и потенциальных угроз безопасности? 
```commandline
Agent
```
Наконец, как называется устройство, отвечающее за управление этими устройствами?
```commandline
Manager
```

## Задание 2
Подключитесь к сети TryHackMe и разверните сервер управления Wazuh, подключенный к этой задаче, и  подождите не 
менее пяти минут, прежде чем посещать сервер Wazuh по HTTP ://MACHINE_IP .

Если вы загрузите сервер управления Wazuh слишком рано, появится сообщение «Сервер Kibana еще не готов». Подождите 
еще несколько минут, прежде чем обновить страницу и повторить попытку.

После запуска войдите в систему, используя следующие учетные данные:

Имя пользователя: wazuh ( убедитесь, что оно написано строчными буквами! )

Пароль:  eYa0M1-hG0e7rjGi-lRB2qGYVoonsG1K

После успешного входа в систему выберите « Глобальный арендатор ». Если у вас возникли затруднения, обратитесь к 
анимированному gif-изображению процесса ниже. 

Примечание: вопросы в задачах этой комнаты будут предполагать, что данные хранятся на этом сервере управления Wazuh ,
поэтому крайне важно, чтобы вы могли подключиться к этому серверу, прежде чем продолжить.   

Сервер управления Wazuh в этой комнате будет показывать, что агенты отключены —  это ожидаемо. 

### Ответьте на вопросы ниже
Войдите на сервер управления Wazuh по адресу  HTTP://MACHINE_IP прежде чем приступить к выполнению задач в этой комнате.
```commandline
Ответ не нужен
```

## Задание 3
Устройства, которые регистрируют события и процессы системы, называются агентами. Агенты отслеживают процессы и 
события, происходящие на устройстве, такие как  аутентификация и управление пользователями. Агенты будут выгружать 
эти журналы в назначенный  сборщик для обработки, например Wazuh.

Для того, чтобы Wazuh был заполнен, агенты должны быть установлены на устройствах для регистрации таких событий.  
Wazuh может провести вас через процесс развертывания агента, если вы заполните  некоторые предварительные условия, 
такие как: 
- Операционная система
- Адрес сервера Wazuh, на который агент должен отправлять логи (это может быть запись DNS или IP-адрес)
- В какую группу будет входить агент — вы можете сортировать агентов по группам в Wazuh, если хотите.
Этот мастер можно запустить, перейдя в следующее место на сервере Wazuh: Wazuh -> Агенты -> Развернуть нового 
  агента, как показано на снимке экрана ниже:

После перехода к этому дисплею вам будет доступен интуитивно понятный мастер. Я поделился скриншотами использования 
мастера для установки агента Wazhur на Windows и Debian/Ubuntu. На этапе 4 вам дается команда для копирования и 
вставки в буфер обмена, которая установит и настроит агента на устройстве, с которого вы хотите собирать журналы.

Установка агента Wazuh на Windows:

Установка агента Wazuh на Debian/Ubuntu: 

### Ответьте на вопросы ниже
Убедитесь, что вы вошли на сервер управления Wazuh по  адресу HTTPS://MACHINE_IP.
```commandline
Ответ не нужен
```
Перейдите на вкладку «Агенты», нажав Wazuh -> Агенты.
```commandline
Ответ не нужен
```
Сколько агентов обслуживает этот сервер управления Wazuh?
```commandline
2
```
Каков статус агентов, управляемых этим сервером управления Wazuh?
```commandline
Disconnected
```

## Задание 4
Модуль оценки уязвимостей Wazuh — это мощный инструмент, который можно использовать для  периодического сканирования 
операционной системы агента на предмет установленных приложений и  номеров их версий.

После сбора этой информации она отправляется обратно на сервер Wazuh и сравнивается с базой данных CVE для 
обнаружения потенциальных уязвимостей.  Например, агент на снимке экрана ниже имеет версию Vim, которая уязвима для  
CVE -2019-12735.

Модуль сканера уязвимостей выполнит полное сканирование, когда агент Wazuh впервые установлен на устройстве, и  
должен  быть настроен на запуск с заданным интервалом, а затем спустя (по умолчанию при включении он установлен на 
5-минутные интервалы) следующим образом: 

Настройка сервера управления Wazuh для частого аудита агентов на предмет уязвимостей (/var/ossec/etc/ossec.conf)

Wazuh способен тестировать конфигурацию агента на соответствие определенным наборам правил. Однако, из коробки, он, 
возможно, чувствителен. Возьмем, к примеру, этот хост Linux , на котором работает агент Wazuh . Всего было 
зарегистрировано 769 событий, которые система выполняет в рамках своего ежедневного обслуживания

Эти частые действия, такие как удаление файлов, часто определяются как событие безопасности. Эти события и связанные 
с ними уровни серьезности определяются наборами правил Wazuh, и мы рассмотрим их корректировку в другой задаче.

Мы можем анализировать эти события по отдельности, выбрав раскрывающийся список событий. Вы можете сортировать 
события на основе различных факторов, таких как временная метка, тактика или описание.

### Ответьте на вопросы ниже
Убедитесь, что вы вошли на сервер управления Wazuh по адресу  HTTP://MACHINE_IP
```commandline
Ответ не нужен
```
Перейдите на вкладку «Агенты», нажав Wazuh -> «Агенты »
```commandline
Ответ не нужен
```
Выберите агента с именем « АГЕНТ-001 ».
```commandline
Ответ не нужен
```
Сколько оповещений о «событиях безопасности» было сгенерировано агентом «АГЕНТ-001»?

Примечание : Вам необходимо убедиться, что ваш временной диапазон включает 11 марта 2022 года.
```commandline
196
```

## Задание 5
Wazuh способен проводить аудит и мониторинг конфигурации агента, одновременно проактивно записывая журналы событий. 
Когда установлен агент Wazuh, выполняется аудит, в котором метрика задается с использованием нескольких фреймворков 
и законодательных актов, таких как NIST , MITRE и GDPR.

Например, посмотрите, как этот агент DC-01 оценивается по MITRE, NIST и SCA :

Если вы хотите узнать о них больше, эти фреймворки описаны в разделе «Основы пентестинга».

Wazuh представляет общую иллюстрацию журналов. Мы можем использовать визуализации, чтобы разбить эти данные и 
исследовать их дальше. Давайте сделаем это с тем же агентом.  Например, посмотрите на бенчмарк для этого контроллера 
домена, работающего на сервере Windows:

### Ответьте на вопросы ниже
Убедитесь, что вы вошли на сервер управления Wazuh по адресу MACHINE_IP.
```commandline
Ответ не нужен
```
Перейдите на вкладку «Модули», нажав Wazuh -> Модули, и откройте модуль «Управление политиками» следующим образом:
```commandline
Ответ не нужен
```

## Задание 6
Монитор событий безопасности Wazuh способен активно регистрировать как успешные, так и неудачные попытки 
аутентификации. Правило с идентификатором 5710 обнаруживает попытки подключения, которые не увенчались успехом для 
протокола SSH. Давайте рассмотрим в качестве примера эту анимированную картинку ниже.

Оповещение было создано, потому что кто-то попытался войти в агент " ip-10-10-73-118 " с пользователем " cmnatic ", 
который не существует.  Я обобщил это оповещение в таблице ниже:

Для справки, это оповещение хранится в определенном файле на сервере управления Wazuh :  
/var/ossec/logs/alerts/alerts.log.  Мы можем использовать команду, например grep или nano, для ручного поиска по 
этому файлу на сервере управления.

Глядя на анимированный gif ниже, мы видим, как Wazuh создал оповещение об успешном входе на сервер Windows, на 
котором запущен агент Wazuh . Поскольку эта попытка была успешной, серьезность оповещения считается меньшей, чем при 
неудачном входе. Конечно, это можно настроить под вашу среду.  Например, если в систему вошел нечасто используемый 
пользователь, вы можете настроить Wazuh так, чтобы это оповещение отображалось с более высокой серьезностью.   

Анимированный gif-файл ниже показывает количество событий/оповещений агента Windows, срабатывающих для отображения 
того, сколько раз пользователь входил в систему. В этом случае общее количество событий входа сокращается с 285 до 79.


### Ответьте на вопросы ниже
Убедитесь, что вы вошли на сервер управления Wazuh по адресу  HTTP://MACHINE_IP
```commandline
Ответ не нужен
```
Перейдите на вкладку «Управление», нажав  Wazuh  -> Управление  , и откройте модуль «Правила» следующим образом:
```commandline
Ответ не нужен
```

## Задание 7
Все виды действий и событий фиксируются и записываются в операционной системе Windows. Это включает попытки 
аутентификации, сетевые подключения, файлы, к которым был получен доступ, а также поведение приложений и служб. Эта 
информация сохраняется в журнале событий Windows с помощью инструмента Sysmon.

Мы можем использовать агент Wazuh для объединения этих событий, записанных Sysmon, для обработки в менеджере Wazuh. 
Теперь нам нужно будет настроить как агент Wazuh, так и приложение Sysmon. Sysmon использует правила, созданные в 
формате XML, для срабатывания. Например, в приведенном ниже фрагменте XML мы говорим Sysmon отслеживать событие 
запуска процесса powershell.exe.

А Сисмон файл конфигурации для мониторинга процесса Powershell
```commandline
Sysmon schemaversion="3.30" 
         HashAlgorithms md5 /HashAlgorithms 
  EventFiltering 
  !--SYSMON EVENT ID 1 : PROCESS CREATION-- 
  ProcessCreate onmatch="include" 
  Image condition="contains" powershell.exe /Image 
  /ProcessCreate 
  !--SYSMON EVENT ID 2 : FILE CREATION TIME RETROACTIVELY CHANGED IN THE FILESYSTEM-- 
  FileCreateTime onmatch="include"  /FileCreateTime 
  !--SYSMON EVENT ID 3 : NETWORK CONNECTION INITIATED-- 
  NetworkConnect onmatch="include"  /NetworkConnect 
  !--SYSMON EVENT ID 4 : RESERVED FOR SYSMON STATUS MESSAGES, THIS LINE IS INCLUDED FOR DOCUMENTATION PURPOSES ONLY-- 
  !--SYSMON EVENT ID 5 : PROCESS ENDED-- 
  ProcessTerminate onmatch="include"  /ProcessTerminate 
  !--SYSMON EVENT ID 6 : DRIVER LOADED INTO KERNEL-- 
  DriverLoad onmatch="include"  /DriverLoad  
  !--SYSMON EVENT ID 7 : DLL (IMAGE) LOADED BY PROCESS-- 
  ImageLoad onmatch="include"  /ImageLoad 
  !--SYSMON EVENT ID 8 : REMOTE THREAD CREATED-- 
  CreateRemoteThread onmatch="include"  /CreateRemoteThread 
  !--SYSMON EVENT ID 9 : RAW DISK ACCESS-- 
  RawAccessRead onmatch="include"  /RawAccessRead  
  !--SYSMON EVENT ID 10 : INTER-PROCESS ACCESS-- 
  ProcessAccess onmatch="include"  /ProcessAccess 
  !--SYSMON EVENT ID 11 : FILE CREATED-- 
  FileCreate onmatch="include"  /FileCreate 
  !--SYSMON EVENT ID 12 & 13 & 14 : REGISTRY MODIFICATION-- 
  RegistryEvent onmatch="include"  /RegistryEvent 
  !--SYSMON EVENT ID 15 : ALTERNATE DATA STREAM CREATED-- 
  FileCreateStreamHash onmatch="include"  /FileCreateStreamHash  
  PipeEvent onmatch="include"  /PipeEvent 
  /EventFiltering 
 /Sysmon 
```
 Чтобы дать команду Sysmon , нам нужно запустить приложение Sysmon и предоставить вышеупомянутый файл конфигурации 
 следующим образом:`Sysmon64.exe -accepteula -i detect_powershell.xml` 

Мы можем убедиться, что Sysmon принял наш файл конфигурации, перейдя в средство просмотра событий и выполнив поиск 
модуля « Sysmon » следующим образом:
Давайте запустим приглашение powershell на Windows Server и вернемся к нашему Event Viewer.  Теперь мы можем видеть 
запись об открытии этого приглашения powershell, сохраненную в Event Viewer.

Теперь нам нужно настроить агент Wazuh на этом сервере Windows, чтобы поручить ему отправлять эти события на сервер 
управления Wazuh . Для этого нам нужно открыть файл агента Wazuh , расположенный по адресу:`C:\Program Files (x86)\ossec-agent\ossec.conf` 

Чтобы включить следующий фрагмент:

Настройка конфигурации Wazuh Agent
```commandline
<localfile>
<location>Microsoft-Windows-Sysmon/Operational</location>
<log_format>eventchannel</log_format>
</localfile>
```

Выглядит примерно так:


Теперь нам нужно перезапустить агент Wazuh. В этом случае я перезапускаю операционную систему, чтобы убедиться, что 
эти изменения произошли. 


После этого нам нужно указать серверу управления Wazuh добавить Sysmon в качестве правила для визуализации этих 
событий. Это можно сделать, добавив XML- файл в локальные правила, расположенные в`/var/ossec/etc/rules/local_rules.xml` 

Настройка Вазух Сервер для входа событий Ssymon
```commandline
<group name="sysmon,">
 <rule id="255000" level="12">
 <if_group>sysmon_event1</if_group>
 <field name="sysmon.image">\\powershell.exe||\\.ps1||\\.ps2</field>
 <description>Sysmon - Event 1: Bad exe: $(sysmon.image)</description>
 <group>sysmon_event1,powershell_execution,</group>
 </rule>
</group>
```

 Вам нужно будет перезапустить сервер Wazuh Management, чтобы это вступило в силу. После этого мы можем вернуться к 
 нашему серверу Wazuh Management и заметить, что данные были получены от агента.

### Ответьте на вопросы ниже
Как называется инструмент, который можно использовать для мониторинга системных событий?
```commandline
Sysmon
```
В каком стандартном приложении Windows регистрируются эти системные события?
```commandline
Event Viewer
```

## Задание 8
Захват журналов с агента Linux — это простой процесс, похожий на захват событий с агента Windows. Мы будем 
использовать службу сбора журналов Wazuh для создания записи на агенте, чтобы указать, какие журналы следует 
отправлять на сервер управления Wazuh.

Например, в этой задаче мы будем отслеживать логи веб-сервера Apache2. Для начала настроим службу сбора логов на 
сервере Linux , на котором запущен агент Wazuh.

Wazuh поставляется со многими правилами, которые позволяют Wazuh анализировать файлы журналов, и их можно найти в  
`/var/ossec/ruleset/rules`. Некоторые распространенные приложения включают в себя:

- Докер
- ФТП
- Вордпресс
- SQL- сервер
- MongoDB
- Firewalld
- И многие, многие другие (примерно 900).
Однако вы всегда можете создать свои собственные правила. В этой задаче Wazuh будет переваривать логи Apache2, 
  используя 0250-apache_rules.xml набор правил.

Этот набор правил может анализировать журналы apache2 на предмет предупреждений и сообщений об ошибках, например: 
Нам нужно будет вставить это в агент Wazuh , который отправляет журналы в файл конфигурации серверов управления 
`Wazuh/var/ossec/etc/ossec.conf` , расположенный в :

Анализ журнала Apache2
```commandline
  <!-- Apache2 Log Analysis -->
  <localfile>
    <location>/var/log/example.log</location>
    <log_format>syslog</log_format>
  </localfile>
```
Теперь нам нужно перезапустить агент Linux , на котором запущена служба Apache2.
### Ответьте на вопросы ниже
Каков полный путь к файлу правил, расположенному на сервере управления Wazuh?

```commandline
/var/ossec/ruleset/rules
```

## Задание 9
Wazuh использует auditd пакет, который может быть установлен на агентах Wazuh, работающих в операционных системах 
Debian/Ubuntu и CentOS. В этой задаче мы будем использовать auditd в системе Ubuntu. Auditd отслеживает систему на 
наличие определенных действий и событий и записывает их в файл журнала.

Затем мы можем использовать модуль сбора журналов на агенте Wazuh , чтобы прочитать этот файл журнала и отправить 
его на сервер управления Wazuh для обработки.

Сначала нам нужно установить auditd пакет и auditd плагин. Возможно, он уже установлен в вашей системе; однако 
давайте установим его, чтобы убедиться. Давайте запустим команду sudo apt-get install auditd audispd-pluginsи 
включим эту службу для работы в данный момент, а также при загрузке. sudo systemctl enable auditd.service &sudo 
systemctl start auditd.service

Нам нужно будет настроить, auditd чтобы создать правило для команд и событий, которые мы хотим, чтобы он отслеживал. 
В этой задаче мы укажем auditd отслеживать любые команды, выполняемые как root.

Вы можете расширить это свойство, чтобы отслеживать такие команды, как tcpdump, netcat или отслеживать файлы, такие 
как  /etc/passwd, которые являются признаками нарушения.

Auditd правила находятся в следующем каталоге:  /etc/audit/rules.d/audit.rules. Мы будем добавлять наши правила вручную.

Для этой задачи нам нужно будет открыть этот файл аудита.правила и добавить наше правило самостоятельно. Сначала 
давайте отредактируем файл с помощью `sudo nano /etc/audit/rules.d/audit.rules` и добавим
`-a exit,always -F arch=64 -F euid=0 -S execve -k audit-wazuh-c  `

Мониторинг команд, выполняемых от имени пользователя root
```commandline
## First rule - delete all
-D

## Increase the buffers to survive stress events.
## Make this bigger for busy systems
-b 8192

## This determine how long to wait in burst of events
--backlog_wait_time 0

## Set failure mode to syslog
-f 1

-a exit,always -F arch=b64 -F euid=0 -S execve -k  audit-wazuh-c
```

Теперь нам нужно будет сообщить об этом новом правиле аудиторам, поэтому давайте выполним эту команду, `sudo auditctl -R /etc/audit/rules.d/audit.rules`чтобы прочитать новый файл audit.rules , который мы добавили в предыдущей задаче.

Теперь давайте настроим систему, на которой запущен агент Wazuh, на которой мы хотим отслеживать эти события. В этом 
случае мы будем отслеживать хост Linux , поэтому, как и в наших предыдущих задачах, нам нужно будет настроить агент 
Wazuh для обнаружения этого нового файла журнала, который генерируется auditd таким образом, sudo nano 
`/var/ossec/etc/ossec.conf`и добавить auditd журнал таким образом: 

Настройка Вазух агент для добавления журнала аудита в качестве файла журнала для отправки в Вазух сервер управления
```commandline
<localfile>
    <location>/var/log/audit/audit.log</location>
    <log_format>audit</log_format>
</localfile>
```

### Ответьте на вопросы ниже
Какое приложение мы используем в Linux для мониторинга таких событий, как выполнение команд?
```commandline
auditd
```
Каков полный путь и имя файла, в котором вышеупомянутое приложение хранит правила?
```commandline
/etc/audit/rules.d/audit.rules
```

## Задание 10
Использование нашего собственного клиента

Сервер управления Wazuh имеет богатый и обширный API , позволяющий взаимодействовать с сервером управления Wazuh с 
помощью командной строки. Поскольку сервер управления Wazuh требует аутентификации, мы должны сначала 
аутентифицировать нашего клиента.  

В этой задаче мы будем использовать машину Linux с установленным инструментом для взаимодействия с APIcurl сервера 
управления Wazuh . Во-первых, нам нужно будет аутентифицировать себя, предоставив действительный набор учетных 
данных для конечной точки аутентификации.  

После аутентификации сервер управления Wazuh выдаст нам токен (похожий на сеанс), который нам нужно будет 
предоставить для дальнейшего взаимодействия. Мы можем сохранить этот токен как переменную среды на нашей машине 
Linux , как показано в следующем фрагменте:  

(заменив WAZUH_MANAGEMENT_SERVER_IP на IP-адрес сервера управления Wazuh (т.е. MACHINE_IP):

`TOKEN=$(curl -u : -k -X GET "https://WAZUH_MANAGEMENT_SERVER_IP:55000/security/user/authenticate?raw=true")`

Давайте подтвердим, что мы успешно прошли аутентификацию и получили токен от сервера управления Wazuh :

`curl -k -X GET "https://MACHINE_IP:55000/" -H "Authorization: Bearer $TOKEN"`

Вазух API Проверить аутентификацию
```commandline
{
    "data": {
        "title": "Wazuh API",
        "api_version": "4.0.0",
        "revision": 4000,
        "license_name": "GPL 2.0",
        "license_url": "https://github.com/wazuh/wazuh/blob/master/LICENSE",
        "hostname": "wazuh-master",
        "timestamp": "2021-10-25T07:05:00+0000"
    },
    "error": 0
}
```
Мы можем использовать стандартные методы HTTP- запросов, например, GET/POST/PUT/DELETEуказав соответствующую опцию после -Xie-X GET
`curl -k -X GET "https://MACHINE_IP:55000/manager/status?pretty=true" -H "Authorization: Bearer $TOKEN"`

Например, давайте воспользуемся API Wazuh, чтобы вывести некоторую статистику и важную информацию о сервере 
управления Wazuh, включая отслеживаемые службы и некоторые общие настройки сервера управления Wazuh:

`curl -k -X GET "https://MACHINE_IP:55000/manager/configuration?pretty=true§ion=global" -H "Authorization: Bearer $TOKEN"`



Получение информации о
Вазух
менеджер
```commandline
{
  "data": {
    "affected_items": [
      {
        "wazuh-agentlessd": "running",
        "wazuh-analysisd": "running",
        "wazuh-authd": "running",
        "wazuh-csyslogd": "running",
        "wazuh-dbd": "stopped",
        "wazuh-monitord": "running",
        "wazuh-execd": "running",
        "wazuh-integratord": "running",
        "wazuh-logcollector": "running",
        "wazuh-maild": "running",
        "wazuh-remoted": "running",
        "wazuh-reportd": "stopped",
        "wazuh-syscheckd": "running",
        "wazuh-clusterd": "running",
        "wazuh-modulesd": "running",
        "wazuh-db": "running",
        "wazuh-apid": "stopped"
      }
    ],
    "total_affected_items": 1,
    "total_failed_items": 0,
    "failed_items": []
  },
  "message": "Processes status were successfully read in specified node",
  "error": 0
}
```
Или, возможно, мы можем использовать API сервера управления Wazuh для взаимодействия с агентом:
curl -k -X GET "https://MACHINE_IP:55000/agents?pretty=true&offset=1&limit=2&select=status%2Cid%2Cmanager%2Cname%2Cnode_name%2Cversion&status=active" -H "Authorization: Bearer $TOKEN"

Использование сервера управления Wazuh API взаимодействовать с агентом
```commandline
{
  "data": {
    "affected_items": [
      {
        "node_name": "worker2",
        "status": "active",
        "manager": "wazuh-worker2",
        "version": "Wazuh v3.13.1",
        "id": "001",
        "name": "wazuh-agent1"
      }
],
    "total_affected_items": 9,
    "total_failed_items": 0,
    "failed_items": []
  },
  "message": "All selected agents information was returned",
  "error": 0
}
```
Использование API- консоли Wazuh
Wazuh имеет мощную, интегрированную консоль API на веб-сайте Wazuh для запросов к серверам управления и агентам. 
Хотя это не так обширно, как использование вашей собственной среды (где вы можете создавать и запускать скрипты с 
помощью python, например), это удобно.

Чтобы найти эту консоль API, нам нужно открыть категорию «Инструменты» в заголовке Wazuh вверху:

Вас встретят с несколькими примерами запросов, которые вы можете запустить. Просто выберите строку и нажмите зеленую 
стрелку запуска, чтобы запустить запрос, как показано ниже: 


Напоминание: синтаксис для выполнения запросов использует те же веб-методы (т. е. GET/PUT/POST) и конечные точки (т. 
е. /manager/info), которые вы бы использовали с curl. Вы можете просмотреть некоторые дополнительные параметры 
конечных точек API, следуя подробной документации API Wazuh здесь  

### Ответьте на вопросы ниже
Как называется стандартный инструмент Linux, который мы можем использовать для отправки запросов на сервер управления Wazuh?
```commandline
curl
```
Какой HTTP-метод мы будем использовать для получения информации для API сервера управления Wazuh?
```commandline
GET
```
Какой HTTP-метод мы будем использовать для выполнения действия на API сервера управления Wazuh?
```commandline
PUT
```
Перейдите в API-консоль Wazuh.
```commandline
Ответ не нужен
```
Используйте API-консоль, чтобы узнать версию сервера Wazuh.

Примечание: Вам нужно будет добавить префикс " v " к числу для этого ответа. Например,  v 1.2.3
```commandline
v4.2.5
```
## Задание 11
Wazuh имеет модуль отчетности, который позволяет просматривать обобщенную разбивку событий, произошедших с агентом. 

Сначала нам нужно будет выбрать представление для генерации отчетов. В этом примере я хочу создать отчет о событиях 
безопасности за последние 24 часа. Для этого мне нужно будет открыть представление: 1. Модули -> 2. События 
безопасности  

Теперь, если в течение последних 24 часов были оповещения, я могу сгенерировать такой отчет: 

Примечание:  Если эта кнопка неактивна, данные отчета отсутствуют, поэтому вам необходимо либо изменить запрос, либо 
расширить диапазон дат. 

Генерация отчета может занять от пары секунд до нескольких минут (в зависимости от объема данных, которые необходимо 
обработать). Подождав некоторое время, мы перейдем к панели обзора отчета в Wazuh.

Сначала нажмите на заголовок « Wazuh » в верхней части экрана и выберите « Управление », а затем нажмите на текст « 
Отчетность », расположенный под подзаголовком « Состояние и отчеты »:

Панель обзора отчетов содержит список всех сгенерированных отчетов. Чтобы загрузить отчет, нажмите значок сохранения 
справа от отчета, расположенный под заголовком « Действия ».

Который загрузит отчет в формате PDF на ваш компьютер. Сгенерированный отчет о событиях безопасности выглядит так:

### Ответьте на вопросы ниже
Используйте функцию «Отчет» Wazuh для создания отчета об агенте.
```commandline
Ответ не нужен
```
Перейдите на  панель инструментов Wazuh «Отчет».
```commandline
Ответ не нужен
```
Проанализируйте отчет. Как называется агент, который сгенерировал больше всего оповещений?
```commandline
agent-001
```

## Задание 12
Сервер управления Wazuh поставляется с образцами данных, которые входят в комплект установки и могут быть загружены 
по вашему усмотрению. Я не включил это по умолчанию, чтобы улучшить производительность сервера. Однако, если вы 
хотите импортировать гораздо больше данных, чтобы продемонстрировать расширяемость Wazuh , выполните следующие 
действия. Перейдите к модулю, чтобы загрузить образцы данных:

- Откройте вкладку « Wazuh»  в заголовке.
- Выделите « Настройки» .
- Выберите заголовок « Пример данных» .
- Нажмите кнопку « Добавить данные » на соответствующих трех картах, чтобы импортировать данные.

Обратите внимание, что это может занять до минуты для каждого. Например, см. анимированную картинку ниже. Данные 
будут успешно импортированы, когда кнопка на карте скажет «Удалить данные»


Вернитесь на панель управления Wazuh, чтобы увидеть недавно импортированные данные. Например, теперь мы видим, что 
модуль «События безопасности» содержит гораздо больше данных для изучения.

Обратите внимание, что вам нужно будет поиграть с диапазоном дат.  Абсолютный минимум, требуемый для отображения 
выборки, должен быть Последние 7 дней+ и обновить панель управления, чтобы это применимо. 

### Ответьте на вопросы ниже
Я импортировал образцы данных!
```commandline
Ответ не нужен
```
Я поэкспериментировал с образцами данных.
```commandline
Ответ не нужен
```


[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)