

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Linux Privilege Escalation]() 

Всего 12 заданий:
## Задание 1
Повышение привилегий — это путешествие. Нет серебряных пуль, и многое зависит от конкретной конфигурации целевой 
системы. Версия ядра, установленные приложения, поддерживаемые языки программирования, пароли других пользователей — 
вот несколько ключевых элементов, которые повлияют на ваш путь к оболочке root.

Эта комната была разработана, чтобы охватить основные векторы повышения привилегий и дать вам лучшее понимание 
процесса. Этот новый навык станет неотъемлемой частью вашего арсенала, независимо от того, участвуете ли вы в CTF, 
сдаете ли сертификационные экзамены или работаете тестером на проникновение.

### Ответьте на вопросы ниже
Прочитайте вышеизложенное.
```commandline
Ответ не нужен
```

## Задание 2
Что означает «повышение привилегий»?

По своей сути, повышение привилегий обычно подразумевает переход от учетной записи с более низкими правами доступа к 
учетной записи с более высокими правами доступа. Более технически, это эксплуатация уязвимости, недостатка дизайна 
или упущения конфигурации в операционной системе или приложении для получения несанкционированного доступа к 
ресурсам, которые обычно ограничены для пользователей.

Почему это важно?

При выполнении реального теста на проникновение редко удается закрепиться (начальный доступ), который дает вам 
прямой административный доступ. Повышение привилегий имеет решающее значение, поскольку оно позволяет вам получить 
уровни доступа системного администратора, что позволяет вам выполнять такие действия, как: 
- Сброс паролей
- Обход контроля доступа с целью компрометации защищенных данных
- Редактирование конфигураций программного обеспечения
- Обеспечение настойчивости
- Изменение привилегий существующих (или новых) пользователей
- Выполнить любую административную команду
### Ответьте на вопросы ниже
Прочитайте вышеизложенное.
```commandline
Ответ не нужен
```

## Задание 3
Примечание: для продолжения запустите целевую машину, подключенную к этой задаче.
Вы можете запустить целевую машину и получить к ней доступ прямо из браузера.
Кроме того, вы можете получить к нему доступ по SSH, используя указанные ниже учетные данные пользователя с низкими 
привилегиями: 

Имя пользователя: Карен
Пароль: Пароль1

Перечисление — это первый шаг, который вам нужно предпринять, получив доступ к любой системе. Вы могли получить 
доступ к системе, используя критическую уязвимость, которая привела к доступу на уровне root, или просто нашли 
способ отправлять команды с использованием учетной записи с низкими привилегиями. В отличие от машин CTF, задания по 
тестированию на проникновение не заканчиваются после получения доступа к определенной системе или уровню привилегий 
пользователя. Как вы увидите, перечисление так же важно на этапе после компрометации, как и до этого. 

#### hostname
Команда hostname вернет имя хоста целевой машины. Хотя это значение можно легко изменить или оно может иметь 
относительно бессмысленную строку (например, Ubuntu-3487340239), в некоторых случаях оно может предоставить 
информацию о роли целевой системы в корпоративной сети (например, SQL -PROD-01 для производственного сервера SQL ).


#### uname -a
Выведет системную информацию, дающую нам дополнительные сведения о ядре, используемом системой. Это будет полезно 
при поиске любых потенциальных уязвимостей ядра, которые могут привести к повышению привилегий. 


#### /proc/version
Файловая система proc (procfs) предоставляет информацию о процессах целевой системы. Вы найдете proc во многих 
различных вариантах Linux, что делает ее необходимым инструментом в вашем арсенале.

Просмотр /proc/version может предоставить вам информацию о версии ядра и дополнительные данные, например, установлен 
ли компилятор (например, GCC).

#### /etc/issue
Системы также можно идентифицировать, посмотрев на /etc/issue файл. Этот файл обычно содержит некоторую информацию 
об операционной системе, но его можно легко настроить или изменить. Кстати, любой файл, содержащий системную 
информацию, можно настроить или изменить. Для более четкого понимания системы всегда полезно просмотреть все это.



#### ps команда
Команда ps является эффективным способом просмотра запущенных процессов в системе Linux . Ввод ps на терминале 
покажет процессы для текущей оболочки. 

Вывод ps (Состояние процесса) покажет следующее;
- PID : идентификатор процесса (уникальный для процесса)
- TTY: Тип терминала, используемый пользователем
- Время: количество процессорного времени, использованного процессом (это НЕ время, в течение которого этот процесс 
  выполнялся)
- CMD: запущенная команда или исполняемый файл (НЕ будут отображаться параметры командной строки)
Команда «ps» предоставляет несколько полезных опций.

- ps -A: Просмотреть все запущенные процессы
- ps axjf: Просмотр дерева процессов (см. формирование дерева до ps axjf запуска ниже)
- ps aux: Эта aux опция покажет процессы для всех пользователей (a), отобразит пользователя, запустившего процесс (u)
  , и покажет процессы, которые не прикреплены к терминалу (x). Рассматривая вывод команды ps aux, мы можем лучше 
  понять систему и потенциальные уязвимости.  

#### env
Команда env покажет переменные среды.

Переменная PATH может содержать компилятор или язык сценариев (например, Python), которые можно использовать для 
запуска кода в целевой системе или использовать для повышения привилегий.

#### sudo -l
Целевая система может быть настроена так, чтобы пользователи могли запускать некоторые (или все) команды с 
привилегиями root. Команда sudo -l может использоваться для перечисления всех команд, которые ваш пользователь может 
запускать с помощью sudo.

#### ls
Вероятно, одной из распространенных команд, используемых в Linux  является ls.

При поиске потенциальных векторов повышения привилегий не забывайте всегда использовать команду ls с -la параметром. 
В примере ниже показано, как файл «secret.txt» можно легко пропустить, используя команды ls или ls -l .

#### id
Команда id предоставит общий обзор уровня привилегий пользователя и его членства в группах.

Стоит помнить, что эту id команду можно использовать и для получения той же информации для другого пользователя, как 
показано ниже. 

#### /etc/passwd
Чтение /etc/passwd файла может быть простым способом обнаружения пользователей в системе.

Хотя вывод может быть длинным и немного пугающим, его можно легко сократить и преобразовать в полезный список для 
атак методом перебора.

Помните, что это вернет всех пользователей, некоторые из которых являются системными или сервисными пользователями, 
которые не будут очень полезны. Другой подход может заключаться в grep для «home», поскольку реальные пользователи, 
скорее всего, будут иметь свои папки в каталоге «home».

#### history
Просмотр более ранних команд с помощью  history команды может дать нам некоторое представление о целевой 
системе и, хотя и редко, сохранить такую информацию, как пароли или имена пользователей.


#### ifconfig
Целевая система может быть точкой поворота к другой сети. ifconfig Команда предоставит нам информацию о сетевых 
интерфейсах системы. В примере ниже показано, что целевая система имеет три интерфейса (eth0, tun0 и tun1). Наша 
атакующая машина может достичь интерфейса eth0, но не может напрямую получить доступ к двум другим сетям.

Это можно подтвердить с помощью ip route команды, которая позволяет увидеть, какие сетевые маршруты существуют.

#### netstat
После первоначальной проверки существующих интерфейсов и сетевых маршрутов стоит изучить существующие коммуникации. 
Команда netstatможет использоваться с несколькими различными опциями для сбора информации о существующих соединениях. 
- netstat -a: показывает все прослушиваемые порты и установленные соединения.
- netstat -at или netstat -au также может использоваться для перечисления протоколов TCP или UDP соответственно.
- netstat -l: список портов в режиме «прослушивания». Эти порты открыты и готовы принимать входящие соединения. Это 
  можно использовать с опцией «t», чтобы вывести только порты, которые прослушиваются с использованием протокола TCP 
  (ниже) 
- netstat -s: вывод статистики использования сети по протоколу (ниже) Это также можно использовать с параметрами -t 
или -u для ограничения вывода определенным протоколом. 

`netstat -tp`: список подключений с указанием имени службы и PID.

Эту функцию также можно использовать с -l опцией составления списка портов прослушивания (ниже).

Мы видим, что столбец « PID /Имя программы» пуст, поскольку этот процесс принадлежит другому пользователю.

Ниже приведена та же команда, запущенная с привилегиями root и отображающая эту информацию как 2641/nc (netcat)

`netstat -i`: Показывает статистику интерфейса. Ниже мы видим, что «eth0» и «tun0» более активны, чем «tun1».

Наиболее частое использование netstat, которое вы, вероятно, увидите в сообщениях блогов, статьях и курсах, netstat 
-ano можно разделить следующим образом: 
- -a: Показать все розетки
- -n: Не разрешать имена
- -o: Отображение таймеров

#### find
Поиск важной информации и потенциальных векторов эскалации привилегий в целевой системе может быть плодотворным. 
Встроенная команда «find» полезна и заслуживает того, чтобы ее иметь в своем арсенале. 

Ниже приведены несколько полезных примеров использования команды «найти».

Найти файлы:

`find . -name flag1.txt`: найти файл с именем «flag1.txt» в текущем каталоге
`find /home -name flag1.txt`: найдите имена файлов «flag1.txt» в каталоге /home
`find / -type d -name config`: найдите каталог с именем config в «/»
`find / -type f -perm 0777`: найти файлы с правами доступа 777 (файлы, доступные для чтения, записи и выполнения 
всем пользователям) 
`find / -perm a=x`: найти исполняемые файлы
`find /home -user frank`: найти все файлы пользователя «frank» в «/home»
`find / -mtime 10`: найти файлы, которые были изменены за последние 10 дней
`find / -atime 10`: найти файлы, к которым был доступ за последние 10 дней
`find / -cmin -60`: найти файлы, измененные за последний час (60 минут)
`find / -amin -60`: найти доступы к файлам за последний час (60 минут)
`find / -size 50M`: найти файлы размером 50 МБ
Эту команду также можно использовать со знаками (+) и (-), чтобы указать файл, который больше или меньше указанного 
размера. 



В примере выше возвращаются файлы размером более 100 МБ. Важно отметить, что команда «find» имеет тенденцию 
генерировать ошибки, что иногда затрудняет чтение вывода. Вот почему было бы разумно использовать команду «find» с 
«`-type f 2>/dev/null`», чтобы перенаправить ошибки в «`/dev/null`» и получить более чистый вывод (ниже).  

Папки и файлы, в которые можно записывать данные или из которых можно выполнять данные:

`find / -writable -type d 2>/dev/null`: Найти папки, доступные для записи всем пользователям
`find / -perm -222 -type d 2>/dev/null`: Найти папки, доступные для записи всем пользователям
`find / -perm -o w -type d 2>/dev/null`: Найти папки, доступные для записи всем пользователям

Причина, по которой мы видим три разные команды «find», которые потенциально могут привести к одному и тому же 
результату, указана в документе руководства. Как вы можете видеть ниже, параметр perm влияет на то, как работает «find». 


`find / -perm -o x -type d 2>/dev/null` : Найти папки с исполняемыми файлами world-executable
Найдите инструменты разработки и поддерживаемые языки:
```commandline
find / -name perl*
find / -name python*
find / -name gcc*
```

Найдите определенные разрешения для файлов:

Ниже приведен краткий пример, используемый для поиска файлов, у которых установлен бит SUID. Бит SUID позволяет 
файлу запускаться с уровнем привилегий учетной записи, которой он принадлежит, а не учетной записи, которая его 
запускает. Это позволяет использовать интересный путь повышения привилегий, который мы рассмотрим более подробно в 
задаче 6. Пример ниже приведен для завершения темы по команде «find».

`find / -perm -u=s -type f 2>/dev/null`: Поиск файлов с битом SUID, который позволяет запустить файл с более высоким 
уровнем привилегий, чем у текущего пользователя. 

#### Общие команды Linux
Поскольку мы находимся в сфере Linux, знакомство с командами Linux в целом будет очень полезным. Пожалуйста, 
потратьте некоторое время на освоение таких команд, как find, locate, grep, cut, sort, и т. д.

### Ответьте на вопросы ниже
Каково имя хоста целевой системы?
```commandline
wade7363
```

Какова версия ядра Linux целевой системы?
```commandline
3.13.0-24-generic
```

Что это за Linux?
```commandline
Ubuntu 14.04 LTS
```

Какая версия языка Python установлена в системе?
```commandline
2.7.6
```

Какая уязвимость, по-видимому, затрагивает ядро целевой системы? (Введите номер CVE)
```commandline
CVE-2015-1328
```

## Задание 4
Несколько инструментов могут помочь вам сэкономить время в процессе перечисления. Эти инструменты следует 
использовать только для экономии времени, зная, что они могут пропустить некоторые векторы повышения привилегий. 
Ниже приведен список популярных инструментов перечисления Linux со ссылками на соответствующие репозитории Github.

Среда целевой системы будет влиять на инструмент, который вы сможете использовать. Например, вы не сможете запустить 
инструмент, написанный на Python, если он не установлен на целевой системе. Вот почему лучше быть знакомым с 
несколькими, а не иметь один универсальный инструмент.

LinPeas : https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS
LinEnum: https://github.com/rebootuser/LinEnum
LES ( рекомендация по использованию эксплойтов для Linux ): https://github.com/mzet-/linux-exploit-suggester
Умное перечисление Linux : https://github.com/diego-treitos/linux-smart-enumeration
Проверка конфиденциальности Linux : https://github.com/linted/linuxprivchecker
#### Ответьте на вопросы ниже
Установите и попробуйте несколько автоматизированных инструментов подсчета в вашем локальном дистрибутиве Linux.

```commandline
Ответ не нужен
```

## Задание 5

```commandline
Ответ не нужен
```

## Задание 6

```commandline
Ответ не нужен
```

## Задание 7

```commandline
Ответ не нужен
```

## Задание 8

```commandline
Ответ не нужен
```

## Задание 9

```commandline
Ответ не нужен
```

## Задание 10

```commandline
Ответ не нужен
```
## Задание 11

```commandline
Ответ не нужен
```

## Задание 12

```commandline
Ответ не нужен
```


[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)