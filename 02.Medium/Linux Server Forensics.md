[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Linux Server Forensics](https://tryhackme.com/r/room/linuxserverforensics) 

Всего 11 заданий:
## Задание 1
Вас наняли для расследования утечки данных в ACME web design. Войдите в целевую машину с помощью SSH со следующими учетными данными:
МАШИНА_IP
Имя пользователя - 'fred'
Пароль - «FredRules!»
### Ответьте на вопросы ниже
Q1 Разверните машину и войдите в виртуальную машину, используя предоставленные учетные данные.
```commandline
Ответ не нужен
```

## Задание 2
Наиболее значимой поверхностью атаки на сервере, вероятно, является веб-сервис; к счастью, журнал доступа Apache 
хранит историю всех запросов, отправленных на веб-сервер, и включает в себя:
1. исходный адрес
2. код ответа и длина
3. пользовательский агент

Каждый запрос от современного браузера должен содержать строку user-agent, которая может быть использована для его 
приблизительной идентификации. Содержимое строки user-agent затем используется для изменения опыта путем отображения 
мобильной версии сайта или отключения функций, не поддерживаемых в старых браузерах.

Мы также можем использовать эту строку для идентификации трафика от потенциально вредоносных инструментов, поскольку 
такие инструменты сканирования, как Nmap, SQLmap, DirBuster и Nikto, раскрывают свои идентификационные данные через 
строки user-agent по умолчанию.

### Ответьте на вопросы ниже
Перейдите в /var/log/apache2
```commandline
Ответ не нужен
```
Сколько различных инструментов отправили запросы на сервер?
```commandline
2
```
Назовите путь, запрошенный Nmap.
```commandline
/nmaplowercheck1618912425
```

## Задание 3
Веб-сканеры практически постоянно запускаются на серверах, так что этот трафик не является чем-то необычным. 
Осмотрите сайт на предмет потенциальных векторов атак.

### Ответьте на вопросы ниже
Какая страница позволяет пользователям загружать файлы?
```commandline
contact.php
```
С какого IP загружены файлы на сервер?
```commandline
192.168.56.24
```
Кто оставил на сервере открытое уведомление о безопасности?
```commandline
Fred
```

## Задание 4
Похоже, наш злоумышленник проник через Remote File Inclusion (RFI). Лучше всего сейчас осмотреть саму систему на 
предмет наличия механизмов сохранения, которые могли бы привести к полезной нагрузке. Существует несколько способов 
сохранения сохранения в большинстве дистрибутивов Linux, включая, но не ограничиваясь:

1. хрон
2. Службы/systemd
3. bashrc
4. Модули ядра
5. SSH- ключи

**Cron** — одна из наиболее распространенных методологий, поэтому, вероятно, лучше всего начать с нее.

### Ответьте на вопросы ниже
Какую команду и опцию использовал злоумышленник для создания бэкдора?
```commandline
sh -i
```

## Задание 5
Похоже, команда из предыдущей задачи была настроена на запуск под учетной записью root2. Эта учетная запись не имеет 
никакого смысла, поскольку должна быть только одна учетная запись root. Интересно, как она туда попала?

В дистрибутивах Linux есть несколько мест, где хранится информация об учетных записях, в том числе:
- /etc/passwd - содержит имена большинства учетных записей в системе. Должен иметь открытые права на чтение и не должен содержать хэшей паролей. 
- /etc/shadow - содержит имена, но также должен содержать хэши паролей. Должен иметь строгие разрешения.
### Ответьте на вопросы ниже
Какой пароль у второй учетной записи root?
```commandline
mrcake
```
## Задание 6
Ого, похоже, их снова взломали! Лучше еще раз взглянуть; учетные данные те же, что и в прошлый раз:

МАШИНА_IP
'Фред'
«ФредРулс!»
Ответьте на вопросы ниже
 Разверните вторую машину и войдите в виртуальную машину, используя предоставленные учетные данные.
```commandline
Ответ не нужен
```

## Задание 7
Файл журнала на этот раз намного меньше, так что, похоже, наш злоумышленник был немного более скрытным. Также больше 
не видно явных пользовательских агентов. К счастью, есть несколько других способов идентификации трафика, исходящего 
от сканеров. Время между каждым запросом является хорошей метрикой для большинства инструментов. Вы также можете 
идентифицировать отдельные инструменты по сигнатурам, оставленным в запросах; например, Nmap будет отправлять HTTP- 
запросы случайным нестандартным методом при выполнении определенных задач перечисления. Более агрессивные 
инструменты также можно идентифицировать просто по количеству запросов, отправленных во время любой конкретной атаки;
инструменты подбора каталогов являются прекрасным примером этого и, скорее всего, не будут соответствовать системам 
бана, таким как fail2ban.

Плохо спроектированный сайт может также свободно предоставлять ценную информацию без необходимости использования 
агрессивных инструментов. В этом случае сайт использует последовательные идентификаторы для всех продуктов, 
производящих. Он легко очищает каждый отдельный продукт или находит общий размер базы данных продуктов, просто 
увеличивая идентификатор продукта до тех пор, пока не возникнет ошибка 404.

### Ответьте на вопросы ниже
Назовите один из нестандартных HTTP-запросов.
```commandline
GXWR
```
В какое время было выполнено сканирование Nmap? (формат: ЧЧ:ММ:СС)
```commandline
13:30:15
```

## Задание 8
В этот раз противник был немного умнее. Если и существует какой-либо бэкдор, то он, скорее всего, будет более 
скрытным. SSH -ключи — еще один отличный способ сохранения доступа, поэтому, возможно, стоит поискать дополнения к 
файлу authorized_keys.

### Ответьте на вопросы ниже
Какую комбинацию имени пользователя и имени хоста можно найти в одном из файлов authorized_keys? (формат: имя 
пользователя@имя хоста) 
```commandline
kali@kali
```

## Задание 9
Конечно, добавление открытого ключа в author_keys root требует привилегий уровня root, поэтому, возможно, лучше 
поискать больше доказательств повышения привилегий. В целом, Linux хранит крошечный объем истории выполнения 
программ по сравнению с Windows, но все же есть несколько ценных источников, включая:

- bash_history — Содержит историю команд, выполненных в bash; этот файл хорошо известен, легко редактируется и иногда 
отключается по умолчанию.
- auth.log — содержит историю всех команд, выполненных с использованием sudo.
- history.log (apt) — содержит историю всех задач, выполненных с помощью apt — полезен для отслеживания установки и 
  удаления программ.

Службы systemd также ведут журналы в системе journald; эти журналы хранятся в двоичном формате и должны читаться 
  утилитой вроде journalctl. Этот двоичный формат имеет некоторые преимущества; однако каждый журнал способен 
  проверять себя и его сложнее изменять.

### Ответьте на вопросы ниже
Какая команда первая в файле bash_history пользователя root?
```commandline
nano /etc/passwd
```

## Задание 10
Это уже начинает немного раздражать. Учетные данные все те же:

МАШИНА_IP
'Фред'
«ФредРулс!»
### Ответьте на вопросы ниже
Разверните последнюю машину и войдите в виртуальную машину, используя предоставленные учетные данные.
```commandline
Ответ не нужен
```
## Задание 11
Вредоносное ПО также может поддерживать устойчивость с помощью systemd, поскольку скрипты, запущенные под systemd, 
могут работать в фоновом режиме и перезапускаться при загрузке системы или при сбое скрипта. Также относительно 
легко скрыть вредоносные скрипты, поскольку они могут смешиваться с другими службами. Службы systemd определяются в 
файлах .service, которые могут содержать:

- Команда, которая выполняется при каждом запуске службы
- Пользователь, от имени которого работает служба
- Необязательное описание 
В этом случае вредоносное ПО довольно очевидно, поскольку оно, кажется, выводит ошибки на экран, поэтому нет никаких 
  шансов, что оно бездействует. Запуск systemctlвыведет список всех служб, загруженных в систему. И, как и в Windows,
  их обычно много. Возможно, стоит добавить его к команде, поскольку это сократит список до запущенных служб. Как 
  только имя подозрительной службы будет найдено, можно будет извлечь больше информации, запустив  .  
`--type=service --state=activesystemctl status <service name> `

### Ответьте на вопросы ниже
Выясните, что происходит, и найдите флаг.

```commandline
[gh0st_1n_the_machine]
```


[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)