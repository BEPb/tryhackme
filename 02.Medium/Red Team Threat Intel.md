[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Red Team Threat Intel](https://tryhackme.com/r/room/redteamthreatintel) 

Всего 8 заданий:
## Задание 1
Threat Intelligence (TI)  или  Cyber Threat Intelligence ( CTI )  — это информация или TTP ( Tactics ,  T echniques, 
and  P rocedures), приписываемая противнику, обычно используемая защитниками для помощи в мерах обнаружения. Красная 
ячейка может использовать CTI с наступательной точки зрения для помощи в эмуляции противника.

Цели обучения

- Изучите основы анализа угроз и способы их применения в операциях «красной команды».
- Узнайте, как создать кампанию на основе разведданных об угрозах.
- Используйте фреймворки для понимания концепций и использования данных об угрозах.
### Ответьте на вопросы ниже
Прочитайте вышеизложенное и перейдите к следующему заданию.
```commandline
Ответ не нужен
```

## Задание 2
Расширяя задачу 1, CTI может быть использована (для принятия мер на основе данных) путем сбора IOC (индикаторов 
компрометации) и TTP,  которые обычно распространяются и поддерживаются ISAC (анализом обмена информацией и 
обмена данными). Платформы и структуры разведки также помогают в использовании CTI, в первую очередь фокусируясь 
на общей временной шкале всех действий.

Примечание: Термин ISAC широко используется в сфере разведки угроз и часто относится к платформе разведки угроз.

Традиционно защитники используют разведку угроз для предоставления контекста постоянно меняющемуся ландшафту угроз и 
количественной оценки результатов. IOC количественно определяются по следам, оставленным злоумышленниками, таким как 
домены, IP-адреса, файлы, строки и т. д. Синяя команда может использовать различные IOC для создания обнаружений и 
анализа поведения. С точки зрения красной команды, вы можете рассматривать разведку угроз как анализ красной 
командой способности синей команды правильно использовать CTI для обнаружений.

В этой комнате мы сосредоточимся на деятельности APT (Advanced Persistent Threat) и на том, как использовать их 
задокументированные TTP. Следующая задача будет подробно описывать специфику разведки угроз и ее значение для 
красной команды.

### Ответьте на вопросы ниже
Прочитайте вышеизложенное и перейдите к следующему заданию.
```commandline
Ответ не нужен
```

## Задание 3
Как упоминалось ранее, красная команда будет использовать CTI для помощи в эмуляции противника и получения 
доказательств его поведения. 

Для облегчения использования CTI и сбора TTP красные команды часто используют платформы и фреймворки для анализа 
угроз, такие как  MITRE ATT&CK ,  TIBER-EU и  OST Map.


Эти киберструктуры будут собирать известные TTP и классифицировать их на основе различных характеристик, таких как:
- Группа угроз
- Фаза цепочки убийств
- Тактика
- Цель/Задача
После выбора целевого противника, цель состоит в том, чтобы идентифицировать все TTP, классифицированные с этим 
  выбранным противником, и сопоставить их с известной цепочкой киберубийств. Эта концепция рассматривается далее в 
  следующей задаче.  

Использование TTP используется как метод планирования, а не как то, на чем команда будет фокусироваться во время 
выполнения задания. В зависимости от размера команды, команда CTI или оператор разведки угроз могут быть 
задействованы для сбора TTP для красной команды. Во время выполнения задания красная команда будет использовать 
разведку угроз для создания инструментов, изменения трафика и поведения и имитации целевого противника. Эта 
концепция рассматривается далее в задаче 5.

В целом красная команда использует разведданные об угрозах для анализа и имитации поведения противников с помощью 
собранных TTP и IOC. 

### Ответьте на вопросы ниже
Прочитайте вышеизложенное и перейдите к следующему заданию.
```commandline
Ответ не нужен
```

## Задание 4
TIBER-EU  ( Thret Intelligence  - based Ethical  Red Teaming ) — это общая структура,  разработанная Европейским 
центральным банком, которая сосредоточена на использовании разведданных об угрозах. 

Из  белой книги ЕЦБ TIBER-EU : «Структура этического взаимодействия на основе анализа угроз (TIBER-EU) позволяет 
европейским и национальным органам власти работать с финансовыми инфраструктурами и учреждениями (далее совместно 
именуемыми «субъектами») для внедрения программы по тестированию и повышению их устойчивости к сложным кибератакам».

Главное отличие этой структуры от других — это фаза «Тестирование», которая требует наличия разведданных об 
угрозах для обеспечения тестирования красной команды.

Эта структура охватывает передовую практику, а не что-то выполнимое с точки зрения красной команды.

Если вам интересно узнать больше об этой структуре, есть несколько публичных официальных документов и статей.

https://www.ecb.europa.eu/pub/pdf/other/ecb.tiber_eu_framework.en.pdf
https://www.crest-approved.org/membership/tiber-eu/
### Ответьте на вопросы ниже
Прочитайте вышеизложенное и перейдите к следующему заданию.
```commandline
Ответ не нужен
```

## Задание 5
TTP Mapping  используется красной ячейкой для сопоставления собранных противником TTP со стандартной киберцепочкой 
убийств. Сопоставление TTP с цепью убийств помогает красной команде в планировании боя для имитации противника.

Чтобы начать процесс картирования TTP, необходимо выбрать противника в качестве цели. Противник может быть выбран на 
основе,

- Целевая отрасль
- Используемые векторы атак
- Страна происхождения
- Другие факторы

В качестве примера для этой задачи мы решили использовать  APT 39 — группу кибершпионажа, которой руководит иранское 
министерство и которая известна своими атаками на самые разные отрасли.

Мы будем использовать цепочку кибератак Lockheed Martin в качестве стандартной цепочки кибератак для составления 
карты ТТП. 

Первая киберструктура, из которой мы будем собирать TTP, — это  MITRE ATT&CK . Если вы не знакомы с MITRE ATT&CK, он 
предоставляет идентификаторы и описания категоризированных TTP. Для получения дополнительной информации о MITRE и о 
том, как использовать ATT&CK, посетите  комнату MITRE.

ATT&CK предоставляет базовую сводку собранных TTP группы. Мы можем использовать  ATT&CK Navigator, чтобы 
визуализировать каждый TTP и классифицировать его место в цепочке убийств. Navigator визуализирует цепочку ATT&CK с 
выделенными TTP противников в соответствующем подразделе.

Чтобы использовать навигатор ATT&CK: перейдите на страницу сводки групп, рядом с  «Используемые методы»  перейдите к 
«Слоям навигатора ATT&CK», из раскрывающегося списка перейдите к  «Просмотр».  Должен открыться слой навигатора 
ATT&CK с выделенными на новой вкладке TTP выбранной группы.

Проходя через слой Navigator, мы можем назначить различные TTP, которые мы хотим использовать во время боя. Ниже 
приведена скомпилированная цепочка убийств с сопоставленными TTP для APT39.

MITRE ATT&CK выполнит большую часть необходимой работы, но мы также можем дополнить информацию об угрозах другими 
платформами и фреймворками. Другим примером фреймворка TTP является OST Map. 

Карта OST предоставляет визуальную карту, связывающую несколько субъектов угроз и их ТТП.

Другие платформы с открытым исходным кодом и корпоративные платформы анализа угроз могут помочь Red Team в эмуляции 
противников и картировании TTP, например:

- Преимущество Мандианта
- Онтический
- CrowdStrike Сокол
### Ответьте на вопросы ниже
Прочитайте вышеизложенное и используйте MITRE ATT&CK Navigator, чтобы ответить на вопросы ниже, используя слой Carbanak.
```commandline
Ответ не нужен
```
Сколько методов управления и контроля использует Carbanak?
```commandline
2
```
Какой двоичный код со знаком использовал Карбанак для обхода защиты?
```commandline
Rundll32
```
Какую технику начального доступа использует Carbanak? 
```commandline
Valid Accounts
```
## Задание 6
CTI также может использоваться во время выполнения задания, имитируя поведенческие характеристики противника, такие как

C2 Трафик
- Пользовательские агенты
- Порты, протоколы
- Профили слушателей


Вредоносное ПО и инструменты
- МОК
- Поведение


Первое поведенческое применение CTI, которое мы продемонстрируем, — это манипуляция трафиком C2 ( Command &  Control)
. Красная команда может использовать CTI для идентификации трафика противников и изменять свой трафик C2, 
чтобы эмулировать его.

Примером изменения трафика C2 красной командой на основе собранных CTI являются  гибкие профили. Гибкий профиль 
позволяет оператору красной команды контролировать несколько аспектов трафика слушателя C2. 

Информация, которая будет реализована в профиле, может быть собрана из ISAC и собранных IOC или захватов пакетов, 
включая: 

- Заголовки хоста
- POST URI
- Ответы и заголовки сервера

Собранный трафик может помочь красной команде сделать свой трафик похожим на трафик целевого противника, чтобы 
приблизиться к цели эмуляции противника.

Второе поведенческое применение CTI — анализ поведения и действий вредоносного ПО и инструментов злоумышленников для 
разработки ваших наступательных инструментов, которые имитируют похожее поведение или имеют похожие важные показатели.

Примером этого может быть противник, использующий пользовательский дроппер. Красная команда может эмулировать дроппер,

- Идентификация трафика
- Наблюдение за системными вызовами и вызовами API
- Определение общего поведения и цели капельницы
- Подделка сигнатур файлов и IOC
Данные и инструменты, полученные в ходе поведенческой разведки угроз, могут помочь красной команде подготовить 
  конкретные инструменты, которые она будет использовать для реализации запланированных ТТП.

### Ответьте на вопросы ниже
Прочитайте вышеизложенное и перейдите к следующему заданию.

```commandline
Ответ не нужен
```

## Задание 7
Кампания, основанная на разведданных об угрозах, будет использовать все ранее изученные знания и темы и объединить 
их для создания хорошо спланированной и исследованной кампании.

Поток задач в этой комнате логически следует тому же пути, который вы бы выбрали, будучи красной командой, чтобы 
начать планирование кампании. 

- Определите структуру и общую цепочку уничтожения
- Определить целевого противника
- Определите TTP и IOC противника
- Сопоставьте собранные данные об угрозах с цепочкой или структурой уничтожения
- Составлять и вести необходимую документацию по взаимодействию
- Определите и используйте необходимые ресурсы взаимодействия (инструменты, модификация C2, домены и т. д.)

В этом задании мы рассмотрим мыслительный процесс красной команды от начала до конца планирования кампании, 
  основанной на разведданных об угрозах. 

Самая сложная часть планирования кампании, основанной на разведданных об угрозах, может заключаться в сопоставлении 
двух различных киберструктур. Чтобы упростить этот процесс, мы привели базовую таблицу, сравнивающую Lockheed Martin 
Cyber Kill Chain и MITRE ATT&CK.  

Чтобы приступить к работе над этой задачей, загрузите необходимые ресурсы и запустите статический сайт, 
прикрепленный к этой задаче. 

Ваша команда уже приняла решение использовать цепочку кибератак Lockheed Martin для имитации  APT 41  как противника,
который наилучшим образом соответствует целям и масштабам деятельности клиента. 

### Ответьте на вопросы ниже
Откройте предоставленный слой ATT&CK Navigator и определите соответствующие TTP для cyber kill chain. После того, 
как TTP будут идентифицированы, сопоставьте их с cyber kill chain на статическом сайте.

Чтобы выполнить задание, вам необходимо указать одно название техники для каждого раздела цепочки убийств.

Как только цепочка будет завершена и вы получите флаг, отправьте его ниже.
```commandline
THM{7HR347_1N73L_12 _4w35om3}
```
Ответьте на вопросы ниже, касающиеся необходимых ресурсов для взаимодействия.

Какой веб-шелл использует APT 41? 
```commandline
ASPXSpy
```
Какой инструмент LOLBAS ( Living Off The L and Binaries and Scripts ) использует APT 41 для помощи в передаче файлов  ?
```commandline
certutil
```
Какой инструмент использует APT 41 для майнинга и мониторинга SMS-трафика? 
```commandline
MESSAGETAP
```

## Задание 8
При планировании боя важно учитывать важность имитации противника и то, как разведданные об угрозах могут помочь вам 
в выявлении противников и их поведения. 

У каждой красной команды будет своя методология сбора и обработки информации об угрозах в реальном мире. В этой 
комнате были рассмотрены базовые знания на уровне земли различных концепций, обычно применяемых к сценарию красной 
команды.  

Планируя операцию, помните, что крайне важно рассматривать сценарии со всех точек зрения: наступательной, 
оборонительной и точки зрения противника. 

Разведка угроз позволяет нам, красной команде, глубже изучить поведение противника, используя методологию синей 
команды в наших интересах.

### Ответьте на вопросы ниже
Прочитайте вышеизложенное и продолжайте обучение!
```commandline
Ответ не нужен
```
[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)