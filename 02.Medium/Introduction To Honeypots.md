[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Introduction To Honeypots](https://tryhackme.com/r/room/introductiontohoneypots) 

Всего 9 заданий:
## Задание 1
Что такое приманки?

Honeypot — это преднамеренно уязвимый инструмент безопасности, разработанный для привлечения злоумышленников и 
регистрации действий злоумышленников. Honeypots могут использоваться в оборонительной роли для оповещения 
администраторов о потенциальных нарушениях и для отвлечения злоумышленников от реальной инфраструктуры. Honeypots 
также используются для сбора данных об инструментах и методах злоумышленников и помогают в создании эффективных 
защитных мер.

В этом зале будет продемонстрирована ловушка Cowrie honeypot с точки зрения противника и исследователя безопасности. 
В этом зале также будут освещены данные, собранные при развертывании ловушки Cowrie honeypot, некоторые 
аналитические методики и то, что собранные данные говорят нам о типичной активности ботнета.

### Ответьте на вопросы ниже
Разверните демонстрационную машину
```commandline
Ответ не нужен
```

## Задание 2
Интерактивность и классификация Honeypot

Существует большое разнообразие приманок, поэтому полезно классифицировать их по уровню интерактивности, 
предоставляемой злоумышленникам, при этом большинство приманок попадают в одну из следующих категорий:
- Honeypots с низким уровнем взаимодействия предлагают мало интерактивности для противника и способны только 
  имитировать функции, необходимые для имитации сервиса и захвата атак против него. Злоумышленники не могут 
  выполнять какие-либо действия после эксплуатации против этих honeypots, поскольку они не могут полностью 
  эксплуатировать имитируемый сервис. Примерами honeypots с низким уровнем взаимодействия являются  mailoney и dionaea.
- Honeypots среднего уровня взаимодействия  собирают данные, эмулируя как уязвимые службы, так и базовую ОС, оболочку 
  и файловые системы. Это позволяет злоумышленникам завершать начальные эксплойты и выполнять действия после 
  эксплуатации. Обратите внимание, что в отличие от honeypots высокого уровня взаимодействия (см. ниже), система, 
  представленная злоумышленникам, является симуляцией. В результате злоумышленники обычно не могут завершить весь 
  спектр действий после эксплуатации, поскольку симуляция не сможет функционировать полностью или точно. В этой 
  демонстрации мы рассмотрим SSH-ханипот среднего уровня взаимодействия, Cowrie.
- Honeypots с высоким уровнем взаимодействия — это полностью завершенные системы, которые обычно являются 
  виртуальными машинами, включающими преднамеренные уязвимости. Злоумышленники должны иметь возможность (но не 
  обязательно иметь разрешение) выполнять любые действия против honeypot, поскольку это завершенная система. Важно, 
  чтобы honeypots с высоким уровнем взаимодействия тщательно управлялись, в противном случае существует риск того, 
  что злоумышленник может использовать honeypot в качестве плацдарма для атаки на другие ресурсы. Cowrie также может 
  работать как SSH- прокси и система управления для honeypots с высоким уровнем взаимодействия.

#### Место развертывания
После развертывания приманки можно дополнительно классифицировать по точному месту их развертывания:

- Внутренние honeypots развертываются внутри локальной сети. Этот тип может использоваться для мониторинга сети на 
предмет угроз, исходящих изнутри, например, атак, исходящих от доверенного персонала, или атак, которые обходят 
  брандмауэры, например фишинговых атак. В идеале эти honeypots никогда не должны быть скомпрометированы, поскольку 
  это будет означать значительное нарушение.
- Внешние honeypots развертываются в открытом интернете и используются для мониторинга атак из-за пределов локальной 
  сети. Эти honeypots способны собирать гораздо больше данных об атаках, поскольку они фактически гарантированно 
  подвергаются атаке в любое время.
### Ответьте на вопросы ниже
Прочитайте и поймите вышеизложенное.
```commandline
Ответ не нужен
```

## Задание 3
Cowrie SSH Honeypot

Honeypot Cowrie может работать как SSH- прокси или как симулированная оболочка. На демонстрационной машине запущена 
симулированная оболочка. Вы можете войти, используя следующие учетные данные:

IP - МАШИНА_IP
Пользователь - root
Пароль - <ЛЮБОЙ>
Как вы видите, эмулированная оболочка довольно убедительна и может застать неподготовленного противника врасплох. 
Большинство команд работают так, как и ожидалось, а содержимое файловой системы соответствует тому, что будет 
присутствовать в пустой установке Ubuntu 18.04. Однако есть способы идентифицировать этот тип развертывания Cowrie. 
Например, невозможно выполнить скрипты bash, поскольку это ограничение honeypots с низким и средним уровнем 
взаимодействия. Также возможно идентифицировать установку по умолчанию, поскольку она будет зеркалом установки 
Debian 5 и будет содержать учетную запись пользователя с именем Phil. Файловая система по умолчанию также ссылается 
на устаревший CPU.

### Ответьте на вопросы ниже
Попробуйте выполнить несколько команд в honeypot
```commandline
Ответ не нужен
```
Создайте файл и войдите снова. Файл все еще там? (Ура/Нет)
```commandline
Nay
```

## Задание 4
Регистрация событий Cowrie

Honeypot не был бы полезен без возможности собирать данные об атаках, которым он подвергается. К счастью, Cowrie 
использует обширную систему регистрации, которая отслеживает каждое соединение и команду, обрабатываемую системой. 
Вы можете получить доступ к реальному порту SSH для этой демонстрационной машины, используя следующие параметры:

IP - МАШИНА_IP
Порт - 1400
Пользователь - демо
Пароль - демо


Cowrie может вести журнал в различных локальных форматах и наборах для разбора журналов. В этом случае установка 
использует только журналы JSON и текстовые журналы. Я установил парсер JSONjq на демонстрационную машину, чтобы 
упростить разбор журналов.



Примечание:  Возможно, вам придется удалить идентификатор демонстрационной машины из, .ssh/known_hosts поскольку он 
будет отличаться от того, который используется в honeypot. Вам также нужно будет указать порт, добавляемый -p 1400 в 
команду SSH. Журналы также будут находиться по адресу `/home/cowrie/honeypot/var/log/cowrie`



#### Агрегация журналов

Объем данных, собираемых honeypots, особенно внешними развертываниями, может быстро превысить точку, где их уже 
непрактично анализировать вручную. В результате часто стоит развертывать honeypots вместе с платформой ведения 
журналов, такой как стек ELK. Платформы агрегации журналов также могут предоставлять возможности мониторинга в 
реальном времени и оповещения. Это особенно полезно при развертывании honeypots с намерением реагировать на атаки, а 
не собирать данные.

### Ответьте на вопросы ниже
Просмотрите журналы и посмотрите, как система зафиксировала активность последней задачи.
```commandline
Ответ не нужен
```

## Задание 5
#### SSH и атаки методом подбора

По умолчанию Cowrie будет раскрывать только SSH . Это означает, что злоумышленники смогут скомпрометировать honeypot,
только атаковав службу SSH . Поверхность атаки, представленная типичной установкой SSH , ограничена, поэтому 
большинство атак на службу будут принимать форму атак методом подбора. Защита от этих атак в большинстве случаев 
относительно проста, поскольку их можно победить, разрешив только аутентификацию с открытым ключом или используя 
надежные пароли. Эти атаки не следует полностью игнорировать, поскольку их просто так много, что вы практически 
гарантированно подвергнетесь атаке в какой-то момент.

Коллекция из 200 наиболее распространенных учетных данных, используемых против старых развертываний Cowrie, была 
оставлена на демонстрационной машине и может быть использована для ответа на вопросы ниже. Как вы можете видеть, 
большинство паролей чрезвычайно слабы. Известные записи включают учетные данные по умолчанию, используемые для 
некоторых устройств, таких как Raspberry PI и Volumio Jukebox. Различные комбинации «1234» и рядов ключей также 
являются обычным явлением.
### Ответьте на вопросы ниже
Сколько паролей содержат слово «password» или его вариацию, например, «p@ssw0rd»?
```commandline
15
```
Какой инструмент для взлома SSH является, пожалуй, наиболее распространённым?
```commandline
hydra
```
Какая программная среда предотвращения вторжений обычно используется для противодействия атакам методом подбора 
паролей по протоколу SSH?
```commandline
Fail2Ban
```

## Задание 6
Типичная деятельность после эксплуатации

Большинство атак против типичных развертываний SSH автоматизированы в той или иной степени. В результате большая 
часть постэксплуатационной активности, которая происходит после того, как бот получает начальный доступ к honeypot, 
будет следовать общей схеме. В целом, большинство ботов будут выполнять комбинацию из следующих действий:

- Проведите разведку с помощью команд uname или nproc, либо прочитав содержимое файлов типа /etc/issue и /proc/cpuinfo. 
Можно изменить содержимое всех этих файлов, чтобы honeypot мог выдавать себя за сервер или даже тостер IoT.
- Установить вредоносное ПО, передав удаленный скрипт оболочки в bash. Часто это делается с помощью wget или curl хотя, 
  боты иногда используют FTP. Cowrie загрузит каждое уникальное вхождение файла, но предотвратит выполнение 
  скриптов. Большинство скриптов, как правило, ссылаются на майнинг криптовалюты тем или иным образом.
- Более ограниченное число ботов затем выполнит некоторые антикриминалистические задачи, удалив различные журналы и 
  отключив историю bash. Это не повлияет на Cowrie, поскольку все действия регистрируются внешне.
- Боты не ограничены этими действиями никоим образом, и все еще есть некоторые различия в методах и целях ботов. 
  Пройдитесь по вопросам ниже, чтобы лучше понять, как злоумышленники обычно проводят разведку против систем Linux .

### Ответьте на вопросы ниже
Какой процессор «использует» Honeypot?
```commandline
Intel(R) Core(TM) i9-11900KB CPU @ 3.30GHz
```
Возвращает ли honeypot правильные значения при uname -aзапуске? (Да/Нет)
```commandline
Nay
```
Какой флаг необходимо установить для передачи wgetвывода в bash?
```commandline
-O
```
Как отключить историю bash с помощью unset?
```commandline
unset HISTFILE
```

## Задание 7
Идентификация бота

Данные, записанные Коури, можно использовать для идентификации отдельных ботов. Факторы, которые могут 
идентифицировать трафик из отдельных ботнетов, не всегда одинаковы. Однако некоторые артефакты, как правило, 
совпадают между ботами, включая IP-адреса, запрашиваемые ботами, и определенный порядок команд. Идентифицируемые 
сообщения также могут присутствовать в скриптах или командах, хотя это необычно. Некоторые боты также могут 
использовать легко идентифицируемые публичные ключи SSH для поддержания устойчивости.

Также можно идентифицировать ботов по скриптам, загружаемым Honeypot, используя те же методы, которые используются 
для идентификации других образцов вредоносного ПО.

Ознакомьтесь с образцами, прилагаемыми к демонстрационной машине, и ответьте на приведенные ниже вопросы.

Примечание: Не запускайте ни одну из команд, найденных в примерах, так как вы можете поставить под угрозу 
безопасность машины, на которой они будут запущены!

### Ответьте на вопросы ниже
Какую марку устройства ищет бот в первом примере? (BotCommands/Sample1.txt)
```commandline
Mikrotik
```
Какие команды меняются во втором примере? (BotCommands/Sample2.txt)
```commandline
root password
```
Как называется группа, которая управляет ботнетом в третьем образце?  (BotCommands/Sample3.txt)
```commandline
Outlaw
```

## Задание 8
Атаки, выполняемые с использованием SSH -туннелирования

Некоторые боты не будут выполнять никаких действий напрямую против honeypot, а вместо этого будут использовать 
скомпрометированное развертывание SSH. Это достигается с помощью туннелей SSH. Короче говоря, туннели SSH пересылают 
сетевой трафик между узлами через зашифрованный туннель. Затем туннели SSH могут добавить дополнительный уровень 
секретности при атаке на другие цели, поскольку третьи лица не могут видеть содержимое пакетов, которые пересылаются 
через туннель. Пересылка через туннели SSH также позволяет злоумышленнику скрыть свой настоящий публичный IP-адрес 
почти так же, как это делает VPN.

Затем обфускация IP может использоваться для упрощения схем, требующих использования нескольких различных публичных 
IP-адресов, например, SEO-бустинга и спама. Туннелирование SSH также может использоваться для анализа инструментов 
ограничения скорости на основе IP-адресов, таких как Fail2Ban, поскольку злоумышленник может перейти на другой 
IP-адрес после блокировки.

Данные туннелирования SSH в Коури

По умолчанию Cowrie будет записывать все запросы SSH-туннелирования, полученные honeypot, но не будет пересылать их 
по назначению. Эти данные имеют особое значение, поскольку они позволяют отслеживать и обнаруживать веб-атаки, 
которые могли не быть обнаружены другим honeypot. Я включил несколько примеров данных, которые могут быть записаны 
из туннелей SSH.

Примечание: некоторые элементы образцов были удалены для защиты уязвимых серверов.

### Ответьте на вопросы ниже
Какое приложение является целевым в первом образце? (Tunnelling/Sample1.txt)
```commandline
WordPress
```
Является ли URL-адрес во втором образце вредоносным? (Tunnelling/Sample2.txt) (Да/Нет)
```commandline
Nay
```

## Задание 9
Резюме

Надеюсь, эта комната продемонстрировала, насколько интересными могут быть ханипоты и как собранные с их помощью 
данные можно использовать для получения информации о деятельности ботнетов и других злоумышленников.

Дополнительные ресурсы

Ниже я привел несколько дополнительных ресурсов, которые помогут вам узнать больше о приманках:
- Awesome Honeypots — тщательно подобранный список приманок
- Cowrie —  SSH- приманка, используемая в демонстрации
- Отправка выходных данных Cowrie в ELK — хороший пример реализации мониторинга журнала в реальном времени
Я бы также рекомендовал вам развернуть honeypot самостоятельно, так как это отличный способ обучения. Развертывание 
  honeypot также является отличным способом понять, как работать с поставщиками облачных услуг, поскольку внешние 
  honeypot лучше всего разворачивать в облаке. Развертывание и управление несколькими приманками также является 
  интересной задачей и хорошим способом получить практический опыт работы с такими инструментами, как Ansible.

### Ответьте на вопросы ниже
Прочитайте и поймите вышеизложенное.
```commandline
Ответ не нужен
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)