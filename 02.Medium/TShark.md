[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [TShark](https://tryhackme.com/r/room/tshark) 

Всего 3 задания:
## Задание 1
Почему TShark?

Вам скучно извлекать пакеты вручную? Нужно получить информацию из файла pcap, который не так-то просто извлечь из 
Wireshark? Графические интерфейсы — для неудачников, но теперь вы поняли, что не можете открыть Wireshark? Что ж, 
мой друг, TShark — это решение всех ваших проблем.

#### Установка

Прежде чем начать, нам нужно убедиться, что tshark на нашем хосте установлен tshark. Если вы используете AttackBox, 
то можете пропустить этот шаг, так как там уже установлен tshark.

Обычно tshark устанавливается вместе с Wireshark. Но давайте все равно проверим, установлен ли он. Выполните команду 
ниже, чтобы определить, установлен он или нет.
`apt list tshark`
В моем выводе выше мы видим, что он установлен. Если он не установлен, `sudo apt install tshark` то это сработает. 
Программа `tshark` также доступна в установочном tshark.exe каталоге Windows, как и Wireshark.

Попробуйте запустить его tshark -h, чтобы получить справочную информацию и убедиться, что мы можем правильно 
получить доступ к программе.

### Ответьте на вопросы ниже
Отметить как завершенное после установки/проверки
```commandline
Ответ не нужен
```

## Задание 2
Эта задача использует файл захвата dns.cap на вики-странице Wireshark SampleCaptures.
Для чтения файла с помощью TShark мы будем использовать -r переключатель. Это отобразит итоговую строку каждого 
пакета, похожую на tcpdump вывод, и будет полезно для идентификации высокоуровневой информации о захвате.
`
tshark -r dns.cap
`
В сочетании с wc -l мы можем быстро определить, сколько пакетов находится в захвате.
`
tshark -r dns.cap | wc -l
`
Мы можем использовать фильтры отображения Wireshark (которые ОТЛИЧАЮТСЯ от синтаксиса bpf) , чтобы сузить круг 
отображаемых пакетов. Если нас интересуют только записи DNS A, мы можем использовать dns.qry.type == 1 фильтр 
отображения, чтобы сузить круг наших пакетов. Фильтры отображения добавляются с помощью -Y переключателя. Наша 
команда ниже покажет все записи A в нашем захвате, включая ответы.

`
tshark -r dns.cap -Y "dns.qry.type == 1"
`
Мощь TShark заключается в объединении традиционных фильтров Wireshark с извлечением. Мы можем извлекать конкретные 
значения полей непосредственно из pcap, что позволяет нам возвращать только интересующие нас поля. Один из способов 
извлечения данных — использование переключателей `-T fields и -e [fieldname]`. Чтобы извлечь записи A в pcap, мы бы 
использовали -T fields -e dns.qry.nameв конце нашей предыдущей команды tshark. Это делает нашу команду следующей:
`tshark -r dns.cap -Y "dns.qry.type == 1" -T fields -e dns.qry.name`

ПРИМЕЧАНИЕ: Самый простой способ определить имена полей в Wireshark — перейти к сведениям о пакете в захваченном 
файле, выделить интересующее поле, а затем просмотреть нижний левый угол.

### Ответьте на вопросы ниже
Сколько пакетов в файле dns.cap?
```commandline
38
```
Сколько записей A содержится в захвате? (Включая ответы)
```commandline
6
```
Какая запись А была представлена чаще всего?
```commandline
GRIMM.utelsystems.local
```

## Задание 3
Мы получили уведомление о том, что хост в нашей сети занимается кражей данных через DNS. Можете ли вы его найти?

Используйте прикрепленный файл для анализа в Wireshark и TShark, чтобы найти извлеченные данные. Когда вы 
идентифицируете подозрительные элементы в Wireshark, переходите к TShark, чтобы извлечь соответствующую информацию.

Помните, что мы можем отфильтровывать ненужные пакеты с помощью -Y коммутатора, используя фильтры отображения.

### Ответьте на вопросы ниже
Сколько пакетов содержится в этом захвате?
```commandline
125
```
Сколько DNS-запросов в этом pcap? (Не ответов!)
```commandline
56
```
Каков идентификатор транзакции DNS подозрительных запросов (в шестнадцатеричном формате)?
```commandline
0xbeef
```
Какая строка извлекается из DNS-запросов?
```commandline
MZWGCZ33ORUDC427NFZV65BQOVTWQX3XNF2GQMDVG5PXI43IGRZGWIL5
```
Что такое флаг?
```commandline
flag{th1s_is_t0ugh_with0u7_tsh4rk!}
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)