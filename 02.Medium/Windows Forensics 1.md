[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Windows Forensics 1](https://tryhackme.com/r/room/windowsforensics1) 

Всего 1 заданий:
## Задание 1
Введение в компьютерную криминалистику для Windows:

Компьютерная криминалистика — это важная область кибербезопасности, которая включает сбор доказательств действий, 
выполняемых на компьютерах . Это часть более широкой области цифровой криминалистики, которая занимается 
криминалистическим анализом всех типов цифровых устройств, включая восстановление, изучение и анализ данных, 
обнаруженных на цифровых устройствах. Применение цифровой и компьютерной криминалистики широко: от юридической сферы,
где она используется для подтверждения или опровержения гипотезы в гражданском или уголовном деле, до частной сферы, 
где она помогает во внутренних корпоративных расследованиях и анализе инцидентов и вторжений.

Идеальным примером раскрытия уголовного дела с помощью цифровой криминалистики является дело серийного убийцы BTK . 
Это дело заглохло более чем на десятилетие, когда убийца начал дразнить полицию, отправляя письма. Дело приняло 
серьезный оборот, когда он отправил дискету на местную новостную станцию, которая позже была принята полицией в 
качестве доказательства. Полиции удалось восстановить удаленный текстовый документ на диске, и с помощью метаданных 
и некоторых других доказательств они вычислили и арестовали его. 

Microsoft Windows в настоящее время является наиболее используемой операционной системой для настольных компьютеров. 
Частные пользователи и предприятия предпочитают ее , и в настоящее время она занимает около 80% доли рынка 
настольных компьютеров. Это означает, что важно знать, как проводить криминалистический анализ в Microsoft Windows 
для тех, кто интересуется цифровой криминалистикой. В этом модуле мы узнаем о различных способах сбора 
криминалистических данных из реестра Windows и сделаем выводы о действиях, выполняемых в системе Windows, на основе 
этих данных.

Криминалистические артефакты:

При проведении судебно-медицинской экспертизы вы часто услышите слово «артефакт». Судебно-медицинские артефакты — 
это важные фрагменты информации, которые предоставляют доказательства человеческой деятельности. Например, во время 
исследования места преступления отпечатки пальцев, сломанная пуговица рубашки или пальто, инструменты, 
использованные для совершения преступления, считаются судебно-медицинскими артефактами. Все эти артефакты 
объединяются, чтобы воссоздать историю того, как было совершено преступление.

В компьютерной криминалистике артефакты криминалистики могут быть небольшими следами активности, оставленными в 
компьютерной системе. В системе Windows действия человека можно отследить довольно точно с помощью компьютерной 
криминалистики из-за различных артефактов, которые система Windows создает для данной активности. Эти артефакты 
часто находятся в местах, куда «обычные» пользователи обычно не заходят. Для наших целей эти артефакты можно 
проанализировать, чтобы предоставить образец активности для расследования.

Так мой компьютер шпионит за мной?

Что вы думаете?

Система Windows отслеживает множество действий, выполняемых пользователем. Но является ли все это отслеживание 
вредоносным или для этого есть другая причина? Как мы увидим в этой комнате, компоненты файловой системы, которые 
эксперты-криминалисты считают артефактами, в первую очередь возникли в результате усилий Microsoft по улучшению 
пользовательского опыта.

Если предположить, что в системе установлена одна и та же сборка Windows, за исключением действий, выполняемых во 
время установки, то исходный опыт будет одинаковым для всех пользователей. Однако со временем каждый пользователь 
персонализирует свой компьютер в соответствии со своими предпочтениями. Эти предпочтения включают в себя макет и 
значки рабочего стола, закладки в интернет-браузере, имя пользователя, установку различных приложений и вход в 
различные учетные записи для каждого из этих приложений и других учетных записей с помощью интернет-браузера. 

Windows сохраняет эти настройки, чтобы сделать ваш компьютер более персонализированным. Однако судебные следователи 
используют эти настройки как артефакты для идентификации действий, выполняемых в системе. Поэтому, хотя ваш 
компьютер может шпионить за вами, это не является явной причиной шпионажа, а делается для того, чтобы вам было 
приятнее пользоваться компьютером в соответствии с вашими вкусами. Но эта же информация используется судебными 
следователями для проведения судебного анализа. По мере продвижения по этой комнате мы увидим, что Windows хранит 
эти артефакты в разных местах по всей файловой системе, например, в реестре, каталоге профиля пользователя, в файлах,
специфичных для приложений и т. д.

В следующем задании мы узнаем о реестре Windows и о том, как он может помочь нам в криминалистическом анализе 
системы Windows.

### Ответьте на вопросы ниже
Какая операционная система для настольных компьютеров сейчас является наиболее используемой?
```commandline
Microsoft Windows
```

## Задание 2
Реестр Windows:

Реестр Windows — это набор баз данных, содержащих данные конфигурации системы. Эти данные конфигурации могут быть об 
оборудовании, программном обеспечении или информации пользователя. Они также включают данные о недавно 
использованных файлах, используемых программах или устройствах, подключенных к системе. Как вы можете понять, эти 
данные полезны с точки зрения криминалистики. В этой комнате мы изучим способы чтения этих данных для определения 
необходимой информации о системе. Вы можете просмотреть реестр с помощью regedit.exe, встроенной утилиты Windows для 
просмотра и редактирования реестра. Мы рассмотрим другие инструменты, чтобы узнать о реестре в следующих задачах.

Реестр Windows состоит из ключей и значений. Когда вы открываете утилиту regedit.exe для просмотра реестра, папки, 
которые вы видите, являются ключами реестра. Значения реестра — это данные, хранящиеся в этих ключах реестра. Куст 
реестра — это группа ключей, подразделов и значений, хранящихся в одном файле на диске.

Структура Реестра:

Реестр любой системы Windows содержит следующие пять корневых ключей:
- HKEY_CURRENT_USER
- HKEY_USERS
- HKEY_LOCAL_MACHINE
- HKEY_CLASSES_ROOT
- HKEY_CURRENT_CONFIG
Вы можете просмотреть эти ключи, когда откроете regedit.exe утилиту. Чтобы открыть редактор реестра, нажмите 
  одновременно клавиши Windows и R. Откроется run приглашение, которое выглядит следующим образом:

В этом приглашении введите regedit.exe, и вас встретит окно редактора реестра. Оно будет выглядеть примерно так:



Здесь вы можете увидеть корневые ключи в левой панели в виде дерева, которое показывает включенные ключи реестра, а 
значения в выбранном ключе показаны в правой панели. Вы можете щелкнуть правой кнопкой мыши значение, показанное в 
правой панели, и выбрать свойства, чтобы просмотреть свойства этого значения.

Вот как Microsoft определяет каждый из этих корневых ключей. Для получения более подробной информации о следующих 
ключах реестра Windows посетите  документацию Microsoft. 


- HKEY_CURRENT_USER	Содержит корень информации о конфигурации для пользователя, который в данный момент вошел в 
  систему. Здесь хранятся папки пользователя, цвета экрана и настройки панели управления. Эта информация связана с 
  профилем пользователя. Этот ключ иногда сокращается до HKCU. 
- HKEY_USERS	Содержит все активно загруженные профили пользователей на компьютере. HKEY_CURRENT_USER — это подраздел 
  HKEY_USERS. HKEY_USERS иногда сокращается до HKU.
- HKEY_LOCAL_MACHINE	Содержит информацию о конфигурации, относящуюся к конкретному компьютеру (для любого 
  пользователя). Этот ключ иногда сокращенно обозначается как HKLM.
- HKEY_CLASSES_ROOT	Является подразделом HKEY_LOCAL_MACHINE\Software. Информация, которая хранится здесь, 
  гарантирует, что при открытии файла с помощью проводника Windows открывается правильная программа. Этот раздел 
  иногда сокращается до HKCR.  

Начиная с Windows 2000, эта информация хранится в ключах HKEY_LOCAL_MACHINE и HKEY_CURRENT_USER. 
HKEY_LOCAL_MACHINE\Software\Classes Ключ содержит настройки по умолчанию, которые могут применяться ко всем 
пользователям локального компьютера.  Ключ HKEY_CURRENT_USER\Software\Classes содержит настройки, которые 
переопределяют настройки по умолчанию и применяются только к интерактивному пользователю.   

Ключ HKEY_CLASSES_ROOT обеспечивает представление реестра, объединяющее информацию из этих двух источников. 
HKEY_CLASSES_ROOT также обеспечивает это объединенное представление для программ, разработанных для более ранних 
версий Windows. Чтобы изменить настройки для интерактивного пользователя, изменения должны быть сделаны в разделе, 
HKEY_CURRENT_USER\Software\Classesа не в разделе HKEY_CLASSES_ROOT.

Чтобы изменить настройки по умолчанию, изменения необходимо внести в HKEY_LOCAL_MACHINE\Software\Classes . Если вы 
записываете ключи в раздел HKEY_CLASSES_ROOT, система сохраняет информацию в HKEY_LOCAL_MACHINE\Software\Classes. 

Если вы записываете значения в ключ в разделе HKEY_CLASSES_ROOT, а ключ уже существует в разделе 
HKEY_CURRENT_USER\Software\Classes, система сохранит информацию там, а не в разделе HKEY_LOCAL_MACHINE\Software\Classes.

HKEY_CURRENT_CONFIG	Содержит информацию о профиле оборудования, используемом локальным компьютером при запуске системы.
### Ответьте на вопросы ниже
Какова краткая форма HKEY_LOCAL_MACHINE?
```commandline
HKLM
```

## Задание 3
Если вы получаете доступ к работающей системе, вы сможете получить доступ к реестру с помощью regedit.exe, и вас 
встретят все стандартные корневые ключи, о которых мы узнали в предыдущей задаче. Однако, если у вас есть доступ 
только к образу диска, вы должны знать, где на диске находятся кусты реестра. Большинство этих кустов находятся в 
каталоге `C:\Windows\System32\Config` и являются:

- ПО УМОЛЧАНИЮ (установлено на `HKEY_USERS\DEFAULT`)
- ЗРК (установлен на `HKEY_LOCAL_MACHINE\SAM`)
- БЕЗОПАСНОСТЬ (установлена на `HKEY_LOCAL_MACHINE\Security`)
- ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ (установлено на `HKEY_LOCAL_MACHINE\Software`)
- СИСТЕМА (установлена на `HKEY_LOCAL_MACHINE\System`)


Ульи, содержащие информацию о пользователе:
Помимо этих ульев, в каталоге профиля пользователя можно найти еще два улья, содержащие информацию о пользователе. 
Для Windows 7 и выше каталог профиля пользователя находится в том `C:\Users\<username>\` месте, где находятся улья: 

- NTUSER.DAT (монтируется в HKEY_CURRENT_USER при входе пользователя в систему)
- USRCLASS.DAT (монтируется в HKEY_CURRENT_USER\Software\CLASSES)
Куст USRCLASS.DAT находится в каталоге C:\Users\<username>\AppData\Local\Microsoft\Windows. 

Куст NTUSER.DAT находится в каталоге  C:\Users\<username>\.

Помните, что NTUSER.DAT и USRCLASS.DAT — это скрытые файлы.

Улей Amcache:

Помимо этих файлов, есть еще один очень важный куст, называемый кустом AmCache. Этот куст находится в  
C:\Windows\AppCompat\Programs\Amcache.hve. Windows создает этот куст для сохранения информации о программах, которые 
недавно запускались в системе.  

Журналы транзакций и резервные копии:

Некоторые другие очень важные источники криминалистических данных — это журналы транзакций реестра и резервные копии.
Журналы транзакций можно рассматривать как журнал журнала изменений куста реестра. Windows часто использует журналы 
транзакций при записи данных в кусты реестра. Это означает, что журналы транзакций часто могут содержать последние 
изменения в реестре, которые не попали в сами кусты реестра. Журнал транзакций для каждого куста хранится в виде 
файла .LOG в том же каталоге, что и сам куст. Он имеет то же имя, что и куст реестра, но расширение — .LOG. Например,
журнал транзакций для куста SAM будет расположен в C:\Windows\System32\Config файле с именем SAM.LOG. Иногда также 
может быть несколько журналов транзакций. В этом случае они будут иметь расширение .LOG1, .LOG2 и т. д. При 
проведении криминалистики реестра разумно также просматривать журналы транзакций.

Резервные копии реестра являются противоположностью журналов транзакций. Это резервные копии кустов реестра, 
расположенных в каталоге  C:\Windows\System32\Config. Эти кусты копируются в каталог  
C:\Windows\System32\Config\RegBack каждые десять дней. Это может быть отличным местом для поиска, если вы 
подозреваете, что некоторые ключи реестра могли быть недавно удалены/изменены.   

### Ответьте на вопросы ниже
Каков путь к пяти основным разделам реестра: DEFAULT, SAM, SECURITY, SOFTWARE и SYSTEM?

```commandline
C:\Windows\System32\Config
```
Каков путь к улью AmCache?
```commandline
C:\Windows\AppCompat\Programs\Amcache.hve
```

## Задание 4
При проведении судебной экспертизы мы столкнемся либо с живой системой, либо с ее образом. Для точности 
рекомендуется сделать образ системы или копию требуемых данных и провести судебную экспертизу на ней. Этот процесс 
называется получением данных. Ниже мы рассмотрим различные способы получения данных реестра из живой системы или 
образа диска:

Хотя мы можем просматривать реестр через редактор реестра, криминалистически правильный метод — получить копию этих 
данных и выполнить анализ на ней. Однако, когда мы собираемся скопировать кусты реестра из %WINDIR%\System32\Config, 
мы не можем этого сделать, потому что это ограниченный файл. Итак, что же делать теперь?

Для получения этих файлов мы можем использовать один из следующих инструментов:

КАПЭ :

KAPE — это инструмент для сбора и анализа данных в реальном времени, который можно использовать для сбора данных 
реестра. Это в первую очередь инструмент командной строки, но также поставляется с графическим интерфейсом . На 
снимке экрана ниже показано, как выглядит графический интерфейс KAPE. На этом снимке экрана мы уже выбрали все 
настройки для извлечения данных реестра с помощью KAPE. Мы узнаем больше о сборе артефактов судебной экспертизы с 
помощью KAPE в специальной комнате KAPE.



Вскрытие:

Autopsy  дает вам возможность получать данные как из живых систем, так и из образа диска. После добавления источника 
данных перейдите к расположению файлов, которые вы хотите извлечь, затем щелкните правой кнопкой мыши и выберите 
опцию Extract File(s). Это будет выглядеть примерно так, как показано на снимке экрана ниже.  



FTK-имиджер:

FTK Imager  похож на Autopsy и позволяет извлекать файлы из образа диска или живой системы, монтируя указанный образ 
диска или привод в FTK Imager. Ниже вы можете увидеть опцию Экспортировать файлы, как показано на снимке экрана. 



Другой способ извлечения файлов реестра из FTK Imager — через опцию Obtain Protected Files. Эта опция доступна 
только для  работающих систем и  выделена на снимке экрана ниже. Эта опция позволяет извлечь все кусты реестра в 
выбранное вами место. Однако она не копирует файл Amcache.hve, что часто необходимо для исследования доказательств 
последних запущенных программ.   


В рамках этой комнаты мы не будем собирать данные самостоятельно, а вместо этого будем работать с подключенной 
виртуальной машиной, на которой уже есть данные. 

### Ответьте на вопросы ниже
Попробуйте собрать данные на своей системе или на подключенной виртуальной машине, используя один из вышеупомянутых 
инструментов. 
```commandline
Ответ не нужен
```

## Задание 5
После того, как мы извлекли кусты реестра, нам нужен инструмент для просмотра этих файлов, как в редакторе реестра. 
Поскольку редактор реестра работает только с живыми системами и не может загружать экспортированные кусты, мы можем 
использовать следующие инструменты:  

Просмотрщик реестра:

Как мы видим на скриншоте ниже, у AccessData's Registry Viewer  пользовательский интерфейс похож на Windows Registry 
Editor. Однако есть пара ограничений. Он загружает только один куст за раз и не может учитывать журналы транзакций. 



Проводник реестра Циммермана:

Эрик Циммерман разработал несколько инструментов , которые очень полезны для выполнения цифровой криминалистики и 
реагирования на инциденты. Одним из них является Registry Explorer. Он выглядит как на снимке экрана ниже. Он может 
загружать несколько ульев одновременно и добавлять данные из журналов транзакций в улей, чтобы сделать улей более 
«чистым» с более актуальными данными. Он также имеет удобную опцию «Закладки», содержащую важные с точки зрения 
криминалистики ключи реестра, которые часто ищут эксперты-криминалисты. Следователи могут перейти прямо к интересным 
ключам реестра и значениям с помощью пункта меню закладок. Мы рассмотрим их более подробно в следующих задачах.     



 Регриппер:

RegRipper — это утилита, которая берет куст реестра в качестве входных данных и выводит отчет, который извлекает 
данные из некоторых важных с точки зрения криминалистики ключей и значений в этом кусте. Выходной отчет находится в 
текстовом файле и показывает все результаты в последовательном порядке.

RegRipper доступен как в виде CLI, так и в виде графического интерфейса, что показано на снимке экрана ниже.


Один из недостатков RegRipper заключается в том, что он не учитывает журналы транзакций. Мы должны использовать 
Registry Explorer для объединения журналов транзакций с соответствующими кустами реестра перед отправкой вывода в 
RegRipper для более точного результата.

Хотя мы обсудили эти разные инструменты, для целей этой комнаты мы будем использовать только Registry Explorer и 
некоторые инструменты Эрика Циммермана. Другие упомянутые здесь инструменты будут рассмотрены в отдельных комнатах.

### Ответьте на вопросы ниже
Изучите приведенный выше материал, чтобы понять разницу между различными инструментами.
```commandline
Ответ не нужен
```
## Задание 6
Теперь, когда мы научились читать данные реестра, давайте выясним, где искать информацию в реестре, чтобы провести 
криминалистический анализ. 

Когда мы начинаем проводить криминалистический анализ, первым шагом является получение информации о системе. Эта 
задача будет охватывать сбор информации, связанной с информацией о системе и учетной записи машины. 

Версия ОС :

Если у нас есть только данные сортировки для проведения судебной экспертизы, мы можем определить версию ОС , из 
которой эти данные были извлечены через реестр. Чтобы найти версию ОС , мы можем использовать следующий ключ реестра: 

`SOFTWARE\Microsoft\Windows NT\CurrentVersion`

Вот как Registry Explorer показывает этот раздел реестра. Посмотрите и ответьте на вопрос № 1.

    

Текущий набор управления:

Ульи, содержащие данные конфигурации машины, используемые для управления запуском системы, называются Control Sets. 
Обычно мы видим два Control Sets, ControlSet001 и ControlSet002, в улье SYSTEM на машине. В большинстве случаев (но 
не всегда) ControlSet001 будет указывать на Control Set, с которым машина загрузилась, а ControlSet002 будет 
конфигурацией last known good . Их расположение будет следующим:   

`SYSTEM\ControlSet001`

`SYSTEM\ControlSet002`

Windows создает изменчивый Control Set, когда машина активна, называемый CurrentControlSet ( 
HKLM\SYSTEM\CurrentControlSet). Для получения наиболее точной информации о системе мы будем ссылаться на этот куст. 
Мы можем узнать, какой Control Set используется как CurrentControlSet, посмотрев на следующее значение реестра:  

`SYSTEM\Select\Current`

Аналогично last known goodконфигурацию можно найти с помощью следующего значения реестра:

`SYSTEM\Select\LastKnownGood`

Вот как это выглядит в Registry Explorer. Посмотрите и ответьте на вопрос № 2.



Крайне важно установить эту информацию, прежде чем двигаться дальше с анализом. Как мы увидим, многие 
криминалистические артефакты, которые мы собираем, будут собраны из контрольных наборов. 

Имя компьютера:

Крайне важно установить имя компьютера при проведении судебного анализа, чтобы убедиться, что мы работаем на той 
машине, на которой должны работать. Мы можем найти имя компьютера из следующего места: 

`SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName `

Registry Explorer показывает это так. Посмотрите и ответьте на вопрос № 3:



Информация о часовом поясе:

Для точности важно установить, в каком часовом поясе находится компьютер. Это поможет нам понять хронологию событий 
по мере их возникновения. Для поиска информации о часовом поясе мы можем посмотреть следующее местоположение: 

`SYSTEM\CurrentControlSet\Control\TimeZoneInformation`

Вот как это выглядит в Registry Explorer. Посмотрите и ответьте на вопрос № 4.



Информация о часовом поясе важна, поскольку некоторые данные в компьютере будут иметь временные метки в UTC /GMT, а 
другие — в местном часовом поясе. Знание местного часового пояса помогает установить временную шкалу при слиянии 
данных из всех источников.  

Сетевые интерфейсы и прошлые сети:

Следующий раздел реестра предоставит список сетевых интерфейсов на исследуемой нами машине:

`SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces`

Взгляните на этот раздел реестра, показанный в Registry Explorer, и ответьте на вопрос № 5.




Каждый интерфейс представлен уникальным идентификатором (GUID) подключом, который содержит значения, относящиеся к 
конфигурации TCP/IP интерфейса. Этот ключ предоставит нам такую информацию, как IP-адреса, DHCP IP-адрес и маска 
подсети, DNS- серверы и многое другое. Эта информация важна, поскольку она помогает вам убедиться, что вы проводите 
экспертизу на той машине, на которой вы должны ее проводить.

Предыдущие сети, к которым был подключен данный компьютер, можно найти в следующих местах:

`SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Unmanaged`

`SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Managed`



Эти ключи реестра содержат прошлые сети, а также время последнего подключения. Время последней записи ключа реестра указывает на время последнего подключения этих сетей.

Программы автозапуска (Autoruns):

Следующие разделы реестра содержат информацию о программах или командах, которые запускаются при входе пользователя в систему. 

`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run`

`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\RunOnce`

`SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce`

`SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run`

`SOFTWARE\Microsoft\Windows\CurrentVersion\Run`



Следующий раздел реестра содержит информацию о службах:

`SYSTEM\CurrentControlSet\Services`

Обратите внимание на значение клавиши «Пуск» на снимке экрана ниже.



Если в этом разделе реестра установлено значение 0x02, это означает, что данная служба будет запущена при загрузке 
системы.start  

Информация о кусте SAM и пользователе:

Куст SAM содержит информацию об учетной записи пользователя, информацию о входе в систему и информацию о группе. Эта 
информация в основном находится в следующем месте: 

`SAM\Domains\Account\Users`

Посмотрите на скриншот ниже и ответьте на вопрос № 6.

Содержащаяся здесь информация включает в себя относительный идентификатор (RID) пользователя, количество входов 
пользователя в систему, время последнего входа в систему, последнюю неудачную попытку входа в систему, последнюю 
смену пароля, срок действия пароля, политику паролей и подсказку для пароля, а также любые группы, в которые входит 
пользователь.

### Ответьте на вопросы ниже
Каков текущий номер сборки машины, данные которой исследуются?

```commandline
19044
```
Какой ControlSet содержит последнюю известную удачную конфигурацию?
```commandline
1
```
Каково имя компьютера?
```commandline
THM-4n6
```
Каково значение TimeZoneKeyName?
```commandline
Pakistan Standard Time
```
Что такое DHCP IP-адрес?
```commandline
192.168.100.58
```
Что такое RID учетной записи гостевого пользователя?
```commandline
501
```

## Задание 7
Последние файлы:
Windows ведет список недавно открытых файлов для каждого пользователя. Как мы могли видеть при использовании 
проводника Windows, он показывает нам список недавно использованных файлов.  Эта информация хранится в улье NTUSER и 
может быть найдена в следующем месте:  

`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs`

Registry Explorer позволяет нам быстро сортировать данные, содержащиеся в разделах реестра. Например, вкладка Recent 
documents размещает файл Most Recently Used (MRU) в верхней части списка. Registry Explorer также размещает их так, 
что файл Most Recently Used (MRU) отображается в верхней части списка, а более старые — ниже.

Еще одна интересная часть информации в этом разделе реестра заключается в том, что существуют различные разделы с 
расширениями файлов, такими как  , .pdfи  т. д. Эти разделы предоставляют нам информацию о последних использованных 
файлах определенного расширения файла. Поэтому, если мы ищем конкретно последние использованные файлы PDF, мы можем 
посмотреть на следующий раздел реестра:.jpg.docx

`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs\.pdf`

Registry Explorer также показывает время последнего открытия файлов. Ответьте на вопрос № 1, посмотрев на скриншот выше.

Последние файлы Office:
Подобно Recent Docs, поддерживаемым Windows Explorer, Microsoft Office также поддерживает список недавно открытых 
документов. Этот список также находится в кусте NTUSER. Его можно найти в следующем месте:

`NTUSER.DAT\Software\Microsoft\Office\VERSION`

Номер версии для каждого выпуска Microsoft Office отличается. Пример ключа реестра будет выглядеть следующим образом:

`NTUSER.DAT\Software\Microsoft\Office\15.0\Word`

Здесь 15.0 относится к Office 2013. Список различных выпусков Office и их номеров версий можно найти по этой ссылке.

Начиная с Office 365, Microsoft теперь привязывает местоположение к live ID пользователя . В таком случае последние 
файлы можно найти в следующем месте.  

`NTUSER.DAT\Software\Microsoft\Office\VERSION\UserMRU\LiveID_####\FileMRU`

В таком случае последние файлы можно найти в следующем месте. В этом месте также сохраняется полный путь к последним 
использованным файлам. 

ShellBags:
Когда любой пользователь открывает папку, она открывается в определенном макете. Пользователи могут изменять этот 
макет в соответствии со своими предпочтениями. Эти макеты могут быть разными для разных папок. Эта информация об 
«оболочке» Windows  хранится и может идентифицировать недавно использованные файлы и папки. Поскольку эта настройка 
различна для каждого пользователя, она находится в кустах пользователей. Мы можем найти эту информацию в следующих 
местах:    

`USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\Bags`

`USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\BagMRU`

`NTUSER.DAT\Software\Microsoft\Windows\Shell\BagMRU`

`NTUSER.DAT\Software\Microsoft\Windows\Shell\Bags`

Registry Explorer не дает нам много информации о ShellBags. Однако другой инструмент из инструментов Эрика 
Циммермана, ShellBag Explorer, показывает нам информацию в удобном для использования формате. Нам просто нужно 
указать на извлеченный нами файл куста, и он анализирует данные и показывает нам результаты. Пример показан ниже. 
Посмотрите и ответьте на вопрос № 2.



MRU диалогов «Открыть/сохранить» и «Последний посещенный»:
Когда мы открываем или сохраняем файл, появляется диалоговое окно с вопросом, откуда сохранить или открыть этот файл.
Можно заметить, что как только мы открываем/сохраняем файл в определенном месте, Windows запоминает это место. Это 
означает, что мы можем узнать о недавно использованных файлах, если получим эту информацию. Мы можем сделать это, 
изучив следующие ключи реестра

`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePIDlMRU`
`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMRU`

Вот как Registry Explorer показывает этот раздел реестра. Посмотрите, чтобы ответить на вопросы № 3 и 4.



Адресная/поисковая строка проводника Windows:
Другой способ определить недавнюю активность пользователя — просмотреть пути, введенные в адресной строке проводника 
Windows, или поисковые запросы, выполненные с использованием следующих разделов реестра соответственно. 

`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths`

`NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuery`

Вот как выглядит ключ TypedPaths в Registry Explorer:

### Ответьте на вопросы ниже
Когда был открыт EZtools?
```commandline
2021-12-01 13:00:34
```
В какое время последний раз выполнялось взаимодействие с «Моим компьютером»?
```commandline
2021-12-01 13:06:47
```
Каков абсолютный путь к файлу, открытому с помощью notepad.exe?
```commandline
C:\Program Files\Amazon\Ec2ConfigService\Settings
```
Когда был открыт этот файл?
```commandline
2021-11-30 10:56:19
```

## Задание 8
Помощь пользователю :

Windows отслеживает приложения, запущенные пользователем с помощью Windows Explorer, для статистических целей в 
разделах реестра User Assist. Эти разделы содержат информацию о запущенных программах, времени их запуска и 
количестве выполнений. Однако программы, запущенные с помощью командной строки, не могут быть найдены в разделах 
User Assist. Раздел User Assist присутствует в кусте NTUSER, сопоставленном с GUID каждого пользователя. Мы можем 
найти его в следующем месте:

`NTUSER.DAT\Software\Microsoft\Windows\Currentversion\Explorer\UserAssist\{GUID}\Count`

Взгляните на снимок экрана ниже из Registry Explorer и ответьте на вопрос №1.

ShimCache:

ShimCache — это механизм, используемый для отслеживания совместимости приложений с ОС и отслеживающий все приложения,
запущенные на машине. Его основная цель в Windows — обеспечение обратной совместимости приложений. Он также 
называется кэшем совместимости приложений (AppCompatCache). Он расположен в следующем месте в кусте SYSTEM:

`SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache`

ShimCache хранит имя файла, размер файла и время последнего изменения исполняемых файлов.

Наш инструмент goto, Registry Explorer, не анализирует данные ShimCache в удобном для восприятия человеком формате, 
поэтому мы переходим к другому инструменту, который называется AppCompatCache Parser, также входящему в набор 
инструментов Эрика Циммермана. Он принимает в качестве входных данных куст SYSTEM, анализирует данные и выводит 
CSV-файл, который выглядит следующим образом:

Для запуска утилиты AppCompatCache Parser можно использовать следующую команду:

`AppCompatCacheParser.exe --csv <path to save output> -f <path to SYSTEM hive for data parsing> -c <control set to parse>`

Результаты можно просмотреть с помощью EZviewer, еще одного инструмента Эрика Циммермана.

AmCache:

Куст AmCache — это артефакт, связанный с ShimCache. Он выполняет функцию, похожую на ShimCache, и хранит 
дополнительные данные, связанные с выполнением программ. Эти данные включают путь выполнения, время установки, 
выполнения и удаления, а также хэши SHA1 выполненных программ. Этот куст находится в файловой системе по адресу:  

`C:\Windows\appcompat\Programs\Amcache.hve`

Информацию о последних выполненных программах можно найти в следующем месте в улье:

`Amcache.hve\Root\File\{Volume GUID}\`

Вот как Registry Explorer анализирует куст AmCache:



БАМ/ДАМ:

Background Activity Monitor или BAM отслеживает активность фоновых приложений. Аналогичный Desktop Activity 
Moderator или DAM — это часть Microsoft Windows, которая оптимизирует энергопотребление устройства. Оба они являются 
частью системы Modern Standby в Microsoft Windows.  

В реестре Windows следующие места содержат информацию, связанную с BAM и DAM. Это место содержит информацию о 
последних запущенных программах, их полных путях и времени последнего выполнения. 

`SYSTEM\CurrentControlSet\Services\bam\UserSettings\{SID}`

`SYSTEM\CurrentControlSet\Services\dam\UserSettings\{SID}`

Ниже вы можете увидеть, как Registry Explorer анализирует данные из BAM:



### Ответьте на вопросы ниже
Сколько раз запускался Проводник?
```commandline
26
```
Как еще называется ShimCache?
```commandline
AppCompatCache
```
Какой из артефактов также сохраняет SHA1-хеши выполненных программ?
```commandline
AmCache
```
Какой из артефактов сохраняет полный путь выполненных программ?
```commandline
BAM/DAM
```

## Задание 9
При проведении судебной экспертизы машины часто возникает необходимость определить, были ли подключены к машине 
USB-накопители или съемные диски. Если да, то любая информация, связанная с этими устройствами, важна для судебного 
следователя. В этой задаче мы рассмотрим различные способы поиска информации о подключенных устройствах и дисках в 
системе с помощью реестра.

Идентификация устройства:

Следующие расположения отслеживают USB-ключи, подключенные к системе. Эти расположения хранят идентификатор 
поставщика, идентификатор продукта и версию подключенного USB-устройства и могут использоваться для идентификации 
уникальных устройств. Эти расположения также хранят время подключения устройств к системе.  

`SYSTEM\CurrentControlSet\Enum\USBSTOR`

`SYSTEM\CurrentControlSet\Enum\USB`

Registry Explorer показывает эту информацию в приятном и понятном виде. Посмотрите на это и ответьте на вопросы № 1 и 2.



Первый/Последний раз:

Аналогично следующий ключ реестра отслеживает первое подключение устройства, последнее подключение и последнее 
удаление устройства из системы. 

`SYSTEM\CurrentControlSet\Enum\USBSTOR\Ven_Prod_Version\USBSerial#\Properties\{83da6326-97a6-4088-9453-a19231573b29}\####`

В этом ключе знак #### можно заменить следующими цифрами для получения необходимой информации:

 
Хотя мы можем проверить это значение вручную, как мы видели выше, Registry Explorer уже анализирует эти данные и 
показывает нам, выбираем ли мы ключ USBSTOR. 

Имя тома USB-устройства:

Имя подключенного накопителя можно найти по следующему адресу:

`SOFTWARE\Microsoft\Windows Portable Devices\Devices`

Мы можем сравнить GUID, который мы видим здесь, в этом разделе реестра, и сравнить его с Disk ID, который мы видим в 
разделах, упомянутых в идентификации устройства, чтобы сопоставить имена с уникальными устройствами. Взгляните на 
эти два снимка экрана и ответьте на вопрос № 3.  

Объединив всю эту информацию, мы можем создать объективную картину всех USB-устройств, которые были подключены к 
исследуемому нами компьютеру.  

### Ответьте на вопросы ниже
Какой серийный номер устройства у производителя «Kingston»?
```commandline
1C6f654E59A3B0C179D366AE&0
```
Как называется это устройство?
```commandline
Kingston Data Traveler 2.0 USB Device
```
Как дружелюбно называется устройство от производителя «Kingston»?
```commandline
USB
```

## Задание 10
Итак, теперь, когда мы кое-чему научились, давайте применим это на практике. 

Запустите  виртуальную машину,  прикрепленную к задаче. В правой половине окна браузера должна появиться виртуальная 
машина Windows . Пожалуйста, подождите несколько минут, пока машина загрузится. Если вы не видите рабочий стол, 
нажмите кнопку «Показать разделенный экран» в правом верхнем углу страницы.

Установка:

При желании используйте следующие учетные данные для входа в систему:

Имя пользователя: THM -4n6
Пароль: 123

После входа в систему мы увидим на рабочем столе две папки с именами triageи EZtools. В triageпапке содержится 
коллекция сортировки, собранная через KAPE , которая имеет ту же структуру каталогов, что и родительская. Именно там 
будут располагаться наши артефакты. В EZtoolsпапке содержатся инструменты Эрика Циммермана, которые мы будем 
использовать для проведения нашего анализа. В той же папке вы также найдете RegistryExplorer, EZViewer и 
AppCompatCacheParser.exe.    

Задача:

Теперь, когда мы знаем, где находится требуемый набор инструментов, мы можем начать наше расследование. Нам придется 
использовать наши знания, чтобы определить, где находятся различные файлы для соответствующих кустов реестра, и 
загрузить их в инструменты по нашему выбору. Давайте ответим на вопросы ниже, используя наши знания в области 
судебной экспертизы реестра.   

Сценарий:

Подозревается, что один из рабочих столов в исследовательской лаборатории в организации X был несанкционированно 
получен кем-то. Хотя обычно у них есть только одна учетная запись пользователя на рабочий стол, в этой системе было 
замечено несколько учетных записей пользователей. Также подозревается, что система была подключена к какому-то 
сетевому диску, и к системе было подключено USB-устройство. Данные сортировки из системы были собраны и помещены на 
подключенную виртуальную машину . Можете ли вы помочь организации X найти ответы на следующие вопросы?    

Примечание: при загрузке кустов реестра в RegistryExplorer он предупредит нас, что кусты грязные. Этого не стоит 
бояться. Нам просто нужно запомнить небольшой урок о журналах транзакций и указать RegistryExplorer на файлы .LOG1 и 
.LOG2 с тем же именем, что и у куста реестра. Он автоматически интегрирует журналы транзакций и создаст «чистый» 
куст. Как только мы укажем RegistryExplorer, где сохранить чистый куст, мы сможем использовать его для нашего 
анализа, и нам больше не нужно будет загружать грязные кусты. RegistryExplorer проведет вас через этот процесс.      

### Ответьте на вопросы ниже
Сколько учетных записей, созданных пользователями, присутствует в системе? 
```commandline
3
```
Каково имя пользователя учетной записи, в которую никогда не входили?
```commandline
thm-user2
```
Какая подсказка к паролю для пользователя THM-4n6?
```commandline
count
```
Когда был осуществлен доступ к файлу «Changelog.txt»?
```commandline
2021-11-21 18:18:48
```
Каков полный путь, откуда был запущен установщик Python 3.8.2? 
```commandline
Z:\setups\python-3.8.2.exe
```
Когда в последний раз было подключено USB-устройство с понятным именем «USB»?
```commandline
2021-11-24 18:40:06
```
## Задание 11
Уф! Разве это не интересно! 

Мы научились собирать основную информацию о компьютере и его пользователях, определять, какие файлы они использовали,
какие программы запускали и какие внешние устройства подключали к системе.

Если вам было немного сложнее отслеживать все артефакты, скачайте шпаргалку по этому заданию.


Вы можете использовать ссылки, предоставленные в Задаче 3, чтобы узнать больше об инструментах, которые мы 
представили. Кроме того, если хотите, вы можете поиграть с KAPE, regripper и EZtools в виртуальной машине , 
прикрепленной к комнате.

Подробнее о криминалистике Windows можно узнать в нашей комнате «Криминалистика Windows 2» , где мы рассмотрим еще 
более интересные способы проведения криминалистической экспертизы на компьютерах с ОС Windows, а также в комнате 
KAPE , где вы узнаете, как проводить криминалистическую экспертизу быстро и эффективно.

### Ответьте на вопросы ниже
Ознакомьтесь с предоставленными ресурсами.

```commandline
Ответ не нужен
```


[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)