

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Snort](https://tryhackme.com/r/room/snort) 

Всего 11 заданий:
## Задание 1
В этом зале ожидается, что вы знакомы с основными функциями командной строки Linux , такими как общая навигация по 
системе и основы сети (порты, протоколы и данные трафика). Цель зала — побудить вас начать работать со Snort для 
анализа живого и захваченного трафика.  

Прежде чем присоединиться к этой комнате, мы предлагаем вам пройти  модуль «Основы сетей»  . Если у вас есть общие 
знания об основах сетей и основах Linux , вы будете готовы начать!  Если вы чувствуете, что вам нужна помощь в 
командной строке Linux , вы всегда можете  обратиться к нашим комнатам «Основы Linux»  (здесь  1 2 3 ) ;     

**SNORT** — это система обнаружения и предотвращения вторжений в сеть на основе правил с открытым исходным кодом ( 
NIDS / NIPS ) . Она была разработана и до сих пор поддерживается Мартином Решем, участниками проекта с открытым 
исходным кодом и командой Cisco Talos.   

Официальное описание : «Snort — это передовая система предотвращения вторжений (IPS) с открытым исходным кодом в 
мире. Snort IPS использует ряд правил, которые помогают определять вредоносную сетевую активность, и использует эти 
правила для поиска пакетов, которые им соответствуют, и генерации оповещений для пользователей».  
### Ответьте на вопросы ниже
Прочитайте задание выше.
```commandline
Ответ не нужен
```

## Задание 2
Интерактивный материал и настройка упражнений

Разверните машину, прикрепленную к этой задаче; она будет видна в  представлении с разделенным экраном,  как только 
будет готова.  Если вы не видите загрузку виртуальной машины, нажмите  кнопку Показать разделенный вид. 



После того, как машина полностью запустится, вы увидите папку с названием " Task-Exercises " на рабочем столе. 
Каждое упражнение имеет отдельную папку и файлы; используйте их в соответствии с вопросами. 

Все необходимое находится в папке « Задания-Упражнения ».
Доступны две подпапки;

- Config-Sample —  Примеры файлов конфигурации и правил. Эти файлы приведены для того, чтобы показать, как выглядят 
файлы конфигурации. Установленный экземпляр Snort их не использует, поэтому можете свободно практиковаться и 
изменять их. Исходные базовые файлы Snort находятся в  папке /etc/snort .  
- Exercise-Files -  Для каждого задания есть отдельные папки. Каждая папка содержит файлы pcap, log и rule, готовые к 
использованию. 

#### Генератор трафика

Машина находится в автономном режиме, но есть скрипт  ( traffic-generator.sh )  для генерации трафика на ваш 
интерфейс snort . Вы будете использовать этот скрипт для запуска трафика на интерфейс snort. После запуска скрипта 
он попросит вас выбрать тип упражнения, а затем автоматически откроет другой терминал, чтобы показать вам вывод 
выбранного действия.

Обратите внимание, что каждый трафик предназначен для определенного упражнения. Убедитесь, что вы запустили 
экземпляр snort и дождались окончания выполнения скрипта. Не останавливайте поток трафика, если только вы не выбрали 
неправильное упражнение.
- Запустите  файл «traffic generator.sh»,  выполнив его как sudo. 
- выполнение скрипта генератора трафика
`user@ubuntu$ sudo ./traffic-generator.sh`
Общий обзор рабочего стола. Скрипт генератора трафика в действии.

После выбора действия меню исчезает и открывается экземпляр терминала, в котором отображаются выходные данные действия.

### Ответьте на вопросы ниже
Перейдите в  папку Task-Exercises , выполните команду « ./.easy.sh » и запишите вывод.
```commandline
Too Easy!
```

## Задание 3
Прежде чем погрузиться в Snort и анализировать трафик, давайте сделаем краткий обзор того, что такое  система 
обнаружения вторжений ( IDS ) и  система предотвращения вторжений ( IPS )  . Можно настроить сетевую инфраструктуру 
и использовать обе из них, но прежде чем начать использовать любую из них, давайте изучим различия.

#### Система обнаружения вторжений ( IDS )

IDS — это пассивное решение для мониторинга, позволяющее обнаружить возможные вредоносные действия/шаблоны, 
аномальные инциденты и нарушения политики. Оно отвечает за генерацию оповещений для каждого подозрительного события.

Существует два основных типа систем обнаружения вторжений (IDS) ;
- Система обнаружения вторжений в сеть ( NIDS ) —  NIDS отслеживает поток трафика из различных областей сети. Цель — исследовать трафик во всей подсети. Если сигнатура идентифицирована,  создается оповещение.
- Host-based Intrusion Detection System ( HIDS ) —  HIDS отслеживает поток трафика с одного конечного устройства.  Цель — исследовать трафик на определенном устройстве. Если сигнатура идентифицирована,  создается оповещение.

#### Система предотвращения вторжений ( IPS )
IPS — это активное защитное решение для предотвращения возможных вредоносных действий/шаблонов, аномальных 
инцидентов и нарушений политики. Оно отвечает за остановку/предотвращение/прекращение подозрительного события сразу 
после его обнаружения.  

 Существует четыре основных типа систем IPS :
- Система предотвращения вторжений в сеть ( NIPS ) —  NIPS отслеживает поток трафика из различных областей сети. Цель — защитить трафик во всей подсети. Если сигнатура идентифицирована,  соединение разрывается .
- Система предотвращения вторжений на основе поведения (анализ поведения сети - NBA ) -  Системы на основе поведения 
  отслеживают поток трафика из различных областей сети. Целью является защита трафика во всей подсети. Если сигнатура идентифицирована,  соединение разрывается.
- Система анализа поведения сети работает аналогично NIPS. Разница между NIPS и Behaviour-based заключается в 
  следующем: системам на основе поведения требуется период обучения (также известный как «базовый анализ») для изучения обычного трафика и дифференциации вредоносного трафика и угроз. Эта модель обеспечивает более эффективные результаты против новых угроз.
- Система обучена распознавать «нормальное» для обнаружения «ненормального». Период обучения имеет решающее значение 
  для избежания ложных срабатываний. В случае любого нарушения безопасности в течение периода обучения результаты будут весьма проблематичными. Другим критическим моментом является обеспечение того, чтобы система была хорошо обучена распознавать безвредные действия. 
- Система предотвращения вторжений в беспроводную сеть ( WIPS ) —  WIPS отслеживает поток трафика из беспроводной 
  сети. Цель — защитить беспроводной трафик и остановить возможные атаки, запущенные оттуда. Если сигнатура идентифицирована,  соединение разрывается .
- Host-based Intrusion Prevention System ( HIPS ) —  HIPS активно защищает поток трафика с одного конечного 
  устройства. Цель — исследовать трафик на определенном устройстве. Если сигнатура идентифицирована,  соединение прерывается.
Механизм работы HIPS похож на HIDS . Разница между ними в том, что  в то время как HIDS создает оповещения об угрозах, HIPS останавливает угрозы, разрывая соединение.


#### Методы обнаружения/профилактики

В решениях IDS и IPS используются три основных метода обнаружения и предотвращения :

- На основе подписи - Эта техника основана на правилах, которые идентифицируют конкретные шаблоны известного 
  вредоносного поведения. Эта модель помогает обнаруживать известные угрозы.  
- Основанный на поведении - Эта техника идентифицирует новые угрозы с новыми шаблонами, которые проходят через 
  сигнатуры. Модель сравнивает известное/нормальное поведение с неизвестным/ненормальным. Эта модель помогает 
  обнаружить ранее неизвестные или новые угрозы.  
- Основанный на политике	- Эта техника сравнивает обнаруженные действия с конфигурацией системы и политиками 
  безопасности. Эта модель помогает обнаруживать нарушения политики.

#### Краткое содержание
Уф! Это была долгая поездка и много информации. Давайте кратко обобщим общие функции IDS и IPS .

Системы обнаружения вторжений способны выявлять угрозы, но для их предотвращения требуется помощь пользователя.
IPS может выявлять и блокировать угрозы с минимальным участием пользователя в момент обнаружения.

Теперь поговорим о Snort.  Вот остальная часть официального описания snort;

" Snort можно также развернуть в качестве встроенного средства для остановки этих пакетов. Snort имеет три основных 
применения: как анализатор пакетов, такой как tcpdump, как регистратор пакетов, что полезно для отладки сетевого 
трафика, или его можно использовать как полноценную систему предотвращения сетевых вторжений. Snort можно загрузить 
и настроить как для личного, так и для делового использования. "

SNORT — это   система обнаружения и предотвращения вторжений в сеть  на основе правил с открытым исходным кодом ( 
NIDS / NIPS ) . Она была разработана и до сих пор поддерживается Мартином Решем ,  участниками проекта с открытым 
исходным кодом и командой Cisco Talos.

Возможности Snort;
- Анализ трафика в реальном времени
- Обнаружение атак и зондов
- Регистрация пакетов
- Анализ протокола
- Оповещения в реальном времени
- Модули и плагины
- Препроцессоры
- Кроссплатформенная поддержка! ( Linux  и Windows)

У Snort есть три основные модели использования:
- Режим сниффера —  считывание IP-пакетов и отображение их в консольном приложении.
- Режим регистрации пакетов —  регистрация всех IP-пакетов (входящих и исходящих), проходящих через сеть.
- Режимы  NIDS ( система обнаружения сетевых вторжений ) и NIPS ( система предотвращения сетевых вторжений )  — 
регистрируют/отбрасывают пакеты, которые считаются  вредоносными  в соответствии с заданными пользователем правилами. 
### Ответьте на вопросы ниже
Какой режим snort поможет вам остановить угрозы на локальном компьютере?
```commandline
HIPS
```
Какой режим snort поможет вам обнаружить угрозы в локальной сети?
```commandline
NIDS
```
Какой режим snort поможет вам обнаружить угрозы на локальном компьютере?
```commandline
HIDS
```
Какой режим snort поможет вам остановить угрозы в локальной сети?
```commandline
NIPS
```
Какой режим вдыхания воздуха работает аналогично режиму NIPS?
```commandline
NBA
```
Согласно официальному описанию снорка, какой тип НПВС это?
```commandline
full-blown
```
Период тренировок в НБА также известен как ...
```commandline
baselining
```

## Задание 4
Первое взаимодействие с Snort

Сначала давайте проверим, установлен ли snort.  Следующая команда покажет вам версию экземпляра.

проверка версии
```commandline
user@ubuntu$ snort -V

   ,,_     -*> Snort! <*-
  o"  )~   Version 2.9.7.0 GRE (Build XXXXXX) 
   ''''    By Martin Roesch & The Snort Team: http://www.snort.org/contact#team
           Copyright (C) 2014 Cisco and/or its affiliates. All rights reserved.
           Copyright (C) 1998-2013 Sourcefire, Inc., et al.
           Using libpcap version 1.9.1 (with TPACKET_V3)
           Using PCRE version: 8.39 2016-06-14
           Using ZLIB version: 1.2.11
```

Прежде чем пачкать руки, нам следует убедиться, что наш файл конфигурации действителен.

Здесь "-T" используется для тестирования конфигурации, а "-c" идентифицирует файл конфигурации (snort.conf) .
Обратите внимание, что можно использовать дополнительный файл конфигурации, указав его с помощью "-c" . 

проверка конфигурации
```commandline
user@ubuntu$ sudo snort -c /etc/snort/snort.conf -T 

        --== Initializing Snort ==--
Initializing Output Plugins!
Initializing Preprocessors!
Initializing Plug-ins!
... [Output truncated]
        --== Initialization Complete ==--

   ,,_     -*> Snort! <*-
  o"  )~   Version 2.9.7.0 GRE (Build XXXX) 
   ''''    By Martin Roesch & The Snort Team: http://www.snort.org/contact#team
           Copyright (C) 2014 Cisco and/or its affiliates. All rights reserved.
           Copyright (C) 1998-2013 Sourcefire, Inc., et al.
           Using libpcap version 1.9.1 (with TPACKET_V3)
           Using PCRE version: 8.39 2016-06-14
           Using ZLIB version: 1.2.11

           Rules Engine: SF_SNORT_DETECTION_ENGINE  Version 2.4  
           Preprocessor Object: SF_GTP  Version 1.1  
           Preprocessor Object: SF_SIP  Version 1.1  
           Preprocessor Object: SF_SSH  Version 1.1  
           Preprocessor Object: SF_SMTP  Version 1.1  
           Preprocessor Object: SF_POP  Version 1.0  
           Preprocessor Object: SF_DCERPC2  Version 1.0  
           Preprocessor Object: SF_IMAP  Version 1.0  
           Preprocessor Object: SF_DNP3  Version 1.1  
           Preprocessor Object: SF_SSLPP  Version 1.1  
           Preprocessor Object: SF_MODBUS  Version 1.1  
           Preprocessor Object: SF_SDF  Version 1.1  
           Preprocessor Object: SF_REPUTATION  Version 1.1  
           Preprocessor Object: SF_DNS  Version 1.1  
           Preprocessor Object: SF_FTPTELNET  Version 1.2  
... [Output truncated]
Snort successfully validated the configuration!
Snort exiting
```

Как только мы используем файл конфигурации, snort становится намного мощнее! Файл конфигурации — это файл управления 
snort «все в одном». Здесь определяются правила, плагины, механизмы обнаружения, действия по умолчанию и настройки 
вывода. Возможно иметь несколько файлов конфигурации для разных целей и случаев,  но можно использовать только один 
во время выполнения.
Обратите внимание, что  каждый раз при запуске Snort он автоматически отображает баннер по умолчанию и начальную 
информацию о вашей настройке. Вы можете предотвратить это, используя параметр " -q"  . 
- -V / --версия	Этот параметр предоставляет информацию о версии вашего экземпляра.
- -с	Определение файла конфигурации
- -Т	Параметр самотестирования Snort, с помощью которого вы можете проверить свою настройку.
- q	Тихий режим не позволяет snort отображать баннер по умолчанию и начальную информацию о вашей настройке.
Это было легко; давайте продолжим изучать режимы вдыхания!

### Ответьте на вопросы ниже
Запустите экземпляр Snort и проверьте номер сборки.
```commandline
149
```
Протестируйте текущий экземпляр с помощью файла «/etc/snort/snort.conf» и проверьте, сколько правил загружено в 
текущей сборке. 
```commandline
4151
```
Протестируйте текущий экземпляр с помощью файла «/etc/snort/snortv2.conf» и проверьте, сколько правил загружено в 
текущей сборке. 
```commandline
1
```

## Задание 5
Давайте запустим Snort в режиме сниффера.

Как и tcpdump, Snort имеет различные флаги, позволяющие просматривать различные данные о принимаемом пакете.

Параметры режима сниффера поясняются в таблице ниже;
- -v	Подробный. Отобразить вывод TCP /IP в консоли.
- -d	Отобразить пакетные данные (полезную нагрузку).
- -е	Отображение заголовков канального уровня (TCP/IP/ UDP /ICMP). 
- -Х	Отобразить полную информацию о пакете в шестнадцатеричном формате.
- -i	Этот параметр помогает определить конкретный сетевой интерфейс для прослушивания/сниффинга. Если у вас есть 
  несколько интерфейсов, вы можете выбрать конкретный интерфейс для сниффинга.  

Давайте начнем использовать каждый параметр и посмотрим на разницу между ними. Snort нуждается в активном трафике на 
вашем интерфейсе, поэтому нам нужно сгенерировать трафик, чтобы увидеть Snort в действии. 
Для этого воспользуйтесь скриптом traffic-generator (найдите его в папке Task-Exercise)


#### Сниффинг с параметром "-i"
Запустите экземпляр Snort в подробном режиме (-v) и используйте интерфейс (-i) «eth0»;`sudo snort -v -i eth0`

Если у вас только один интерфейс, Snort использует его по умолчанию. Приведенный выше пример демонстрирует сниффинг 
на интерфейсе с именем "eth0".  После имитации параметра -v вы заметите, что он автоматически будет использовать 
интерфейс "eth0" и запрашивать его.  


#### Сниффинг с параметром "-v"
Запустить экземпляр Snort в подробном режиме (-v) ;`sudo snort -v`

Теперь запустите  скрипт traffic-generator как sudo и  запустите ICMP/ HTTP- трафик .  После того, как трафик будет 
сгенерирован, snort начнет показывать пакеты в режиме детализации следующим образом; 

прослушивание с -v
```commandline
user@ubuntu$ sudo snort -v
                             
Running in packet dump mode

        --== Initializing Snort ==--
...
Commencing packet processing (pid=64)
12/01-20:10:13.846653 192.168.175.129:34316 -> 192.168.175.2:53
UDP TTL:64 TOS:0x0 ID:23826 IpLen:20 DgmLen:64 DF
Len: 36
=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+

12/01-20:10:13.846794 192.168.175.129:38655 -> 192.168.175.2:53
UDP TTL:64 TOS:0x0 ID:23827 IpLen:20 DgmLen:64 DF
Len: 36
===============================================================================
Snort exiting
```
Как вы можете видеть в приведенном выводе, режим verbosity предоставляет информацию, похожую на tcpdump. Как только 
мы прерываем сниффинг с помощью CTRL+C, он останавливается и суммирует сниффинговые пакеты. 


#### Сниффинг с параметром "-d"
Запустить экземпляр Snort в режиме дампа пакетных данных (-d) ;`sudo snort -d`

Теперь запустите  скрипт traffic-generator  как sudo  и  запустите  ICMP/ HTTP- трафик .  После того, как трафик 
будет сгенерирован, snort начнет показывать пакеты в режиме детализации следующим образом; 

сниффинг с -d
```commandline
user@ubuntu$ sudo snort -d
                             
Running in packet dump mode

        --== Initializing Snort ==--
...
Commencing packet processing (pid=67)

12/01-20:45:42.068675 192.168.175.129:37820 -> 192.168.175.2:53
UDP TTL:64 TOS:0x0 ID:53099 IpLen:20 DgmLen:56 DF
Len: 28
99 A5 01 00 00 01 00 00 00 00 00 00 06 67 6F 6F  .............goo
67 6C 65 03 63 6F 6D 00 00 1C 00 01              gle.com.....

=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+

WARNING: No preprocessors configured for policy 0.
12/01-20:45:42.070742 192.168.175.2:53 -> 192.168.175.129:44947
UDP TTL:128 TOS:0x0 ID:63307 IpLen:20 DgmLen:72
Len: 44
FE 64 81 80 00 01 00 01 00 00 00 00 06 67 6F 6F  .d...........goo
67 6C 65 03 63 6F 6D 00 00 01 00 01 C0 0C 00 01  gle.com.........
00 01 00 00 00 05 00 04 D8 3A CE CE              .........:..

=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
```


Как видно из приведенных выходных данных, режим полезной нагрузки пакетных данных охватывает подробный режим и 
предоставляет больше данных. 


#### Сниффинг с параметром "-de"
Запустите экземпляр Snort в режиме дампа (-d) и захвата заголовков канального уровня (-e) ;snort -d -e

Теперь запустите  скрипт traffic-generator  как sudo  и  запустите  ICMP/ HTTP- трафик .  После того, как трафик 
будет сгенерирован, snort начнет показывать пакеты в режиме детализации следующим образом; 

нюхать с -de
```commandline
user@ubuntu$ sudo snort -de
                             
Running in packet dump mode

        --== Initializing Snort ==--
...
Commencing packet processing (pid=70)
12/01-20:55:26.958773 00:0C:29:A5:B7:A2 -> 00:50:56:E1:9B:9D type:0x800 len:0x46
192.168.175.129:47395 -> 192.168.175.2:53 UDP TTL:64 TOS:0x0 ID:64294 IpLen:20 DgmLen:56 DF
Len: 28
6D 9C 01 00 00 01 00 00 00 00 00 00 06 67 6F 6F  m............goo
67 6C 65 03 63 6F 6D 00 00 01 00 01              gle.com.....

=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+

WARNING: No preprocessors configured for policy 0.
12/01-20:55:26.965226 00:50:56:E1:9B:9D -> 00:0C:29:A5:B7:A2 type:0x800 len:0x56
192.168.175.2:53 -> 192.168.175.129:47395 UDP TTL:128 TOS:0x0 ID:63346 IpLen:20 DgmLen:72
Len: 44
6D 9C 81 80 00 01 00 01 00 00 00 00 06 67 6F 6F  m............goo
67 6C 65 03 63 6F 6D 00 00 01 00 01 C0 0C 00 01  gle.com.........
00 01 00 00 00 05 00 04 D8 3A D6 8E              .........:..
```


Сниффинг с параметром "-X"
Запустить экземпляр Snort в режиме полного дампа пакетов (-X) ;sudo snort -X

Теперь запустите  скрипт traffic-generator  как sudo  и  запустите  ICMP/ HTTP- трафик .  После того, как трафик 
будет сгенерирован, snort начнет показывать пакеты в режиме детализации следующим образом; 

сниффинг с -X
```commandline
user@ubuntu$ sudo snort -X
                             
Running in packet dump mode

        --== Initializing Snort ==--
...
Commencing packet processing (pid=76)
WARNING: No preprocessors configured for policy 0.
12/01-21:07:56.806121 192.168.175.1:58626 -> 239.255.255.250:1900
UDP TTL:1 TOS:0x0 ID:48861 IpLen:20 DgmLen:196
Len: 168
0x0000: 01 00 5E 7F FF FA 00 50 56 C0 00 08 08 00 45 00  ..^....PV.....E.
0x0010: 00 C4 BE DD 00 00 01 11 9A A7 C0 A8 AF 01 EF FF  ................
0x0020: FF FA E5 02 07 6C 00 B0 85 AE 4D 2D 53 45 41 52  .....l....M-SEAR
0x0030: 43 48 20 2A 20 48 54 54 50 2F 31 2E 31 0D 0A 48  CH * HTTP/1.1..H
0x0040: 4F 53 54 3A 20 32 33 39 2E 32 35 35 2E 32 35 35  OST: 239.255.255
0x0050: 2E 32 35 30 3A 31 39 30 30 0D 0A 4D 41 4E 3A 20  .250:1900..MAN: 
0x0060: 22 73 73 64 70 3A 64 69 73 63 6F 76 65 72 22 0D  "ssdp:discover".
0x0070: 0A 4D 58 3A 20 31 0D 0A 53 54 3A 20 75 72 6E 3A  .MX: 1..ST: urn:
0x0080: 64 69 61 6C 2D 6D 75 6C 74 69 73 63 72 65 65 6E  dial-multiscreen
0x0090: 2D 6F 72 67 3A 73 65 72 76 69 63 65 3A 64 69 61  -org:service:dia
0x00A0: 6C 3A 31 0D 0A 55 53 45 52 2D 41 47 45 4E 54 3A  l:1..USER-AGENT:
0x00B0: 20 43 68 72 6F 6D 69 75 6D 2F 39 35 2E 30 2E 34   Chromium/95.0.4
0x00C0: 36 33 38 2E 36 39 20 57 69 6E 64 6F 77 73 0D 0A  638.69 Windows..
0x00D0: 0D 0A                                            ..

=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+

WARNING: No preprocessors configured for policy 0.
12/01-21:07:57.624205 216.58.214.142 -> 192.168.175.129
ICMP TTL:128 TOS:0x0 ID:63394 IpLen:20 DgmLen:84
Type:0  Code:0  ID:15  Seq:1  ECHO REPLY
0x0000: 00 0C 29 A5 B7 A2 00 50 56 E1 9B 9D 08 00 45 00  ..)....PV.....E.
0x0010: 00 54 F7 A2 00 00 80 01 24 13 D8 3A D6 8E C0 A8  .T......$..:....
0x0020: AF 81 00 00 BE B6 00 0F 00 01 2D E4 A7 61 00 00  ..........-..a..
0x0030: 00 00 A4 20 09 00 00 00 00 00 10 11 12 13 14 15  ... ............
0x0040: 16 17 18 19 1A 1B 1C 1D 1E 1F 20 21 22 23 24 25  .......... !"#$%
0x0050: 26 27 28 29 2A 2B 2C 2D 2E 2F 30 31 32 33 34 35  &'()*+,-./012345
0x0060: 36 37                                            67

=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
```


Обратите внимание, что вы можете использовать параметры как в объединенной, так и в раздельной форме 
Убедитесь, что вы понимаете и практикуете каждый параметр с различными типами трафика, и найдите свою любимую комбинацию.

#### Ответьте на вопросы ниже
Вы можете попрактиковаться в комбинациях параметров, используя скрипт-генератор трафика.
```commandline
Ответ не нужен
```

## Задание 6
Давайте запустим Snort в режиме Logger Mode.
Вы можете использовать Snort как сниффер и регистрировать перехваченные пакеты через режим регистратора. Вам нужно 
только использовать параметры режима регистратора пакетов, а Snort сделает все остальное, чтобы достичь этого.

Параметры регистратора пакетов поясняются в таблице ниже;

- -l - Режим логгера, целевой журнал и каталог вывода оповещений. Папка вывода по умолчанию /var/log/snort Действие по умолчанию — выгрузка в формате tcpdump в /var/log/snort
- -К - ASCII	Протоколирование пакетов в формате ASCII.
- -r	Опция чтения, чтение сброшенных логов в Snort.
- -n	Укажите количество пакетов, которые будут обработаны/прочитаны. Snort остановится после прочтения указанного 
  количества пакетов.
Давайте начнем использовать каждый параметр и посмотрим на разницу между ними. Snort нуждается в активном трафике на 
  вашем интерфейсе, поэтому нам нужно сгенерировать трафик, чтобы увидеть Snort в действии. 

#### Право собственности на файл журнала
Перед созданием журналов и их исследованием мы должны помнить о владельце и разрешениях файлов Linux . Нет 
необходимости глубоко погружаться в типы пользователей и разрешения. Фундаментальное правило владения файлами:  тот, 
кто создает файл, становится владельцем соответствующего файла.
Snort нужны права суперпользователя (root) для прослушивания трафика, поэтому после запуска snort с помощью команды 
"sudo" учетная запись "root" будет владеть сгенерированными файлами журнала. Поэтому вам понадобятся права "root" 
для исследования файлов журнала. Существует два разных подхода к исследованию сгенерированных файлов журнала;


Повышение привилегий -  Вы можете повысить свои привилегии для проверки файлов. Вы можете использовать команду 
"sudo" для выполнения вашей команды как суперпользователь с помощью следующей команды sudo command. Вы также можете 
повысить привилегии сеанса и переключиться на учетную запись суперпользователя для проверки сгенерированных файлов 
журнала с помощью следующей команды:`sudo su`
Изменение владельца файлов/каталогов. Вы также можете изменить владельца файла/папки, чтобы читать его от имени 
своего пользователя: `sudo chown username file` или `sudo chown username -R directory` Параметр «-R» помогает рекурсивно 
обрабатывать файлы и каталоги.  

Ведение журнала с параметром "-l"
Сначала запустите экземпляр Snort в режиме регистратора пакетов; `sudo snort -dev -l` .

Теперь запустите трафик ICMP/ HTTP с помощью скрипта-генератора трафика.

После генерации трафика Snort начнет показывать пакеты и регистрировать их в целевом каталоге. Вы можете настроить 
выходной каталог по умолчанию в файле snort.config. Однако вы можете использовать параметр "-l" для установки 
целевого каталога. Определение каталога журнала по умолчанию полезно для непрерывных операций мониторинга, а 
параметр "-l" гораздо полезнее для целей тестирования.

Часть -l . команды создает журналы в текущем каталоге. Вам нужно будет использовать эту опцию, чтобы журналы для 
каждого упражнения были в их папке.


ведение журнала с -l
user@ubuntu$ `sudo snort -dev -l` .
```commandline
Running in packet logging mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Log directory = /var/log/snort
pcap DAQ configured to passive.
Acquiring network traffic from "ens33".
Decoding Ethernet

        --== Initialization Complete ==--
...
Commencing packet processing (pid=2679)
WARNING: No preprocessors configured for policy 0.
WARNING: No preprocessors configured for policy 0.
```
Теперь давайте проверим сгенерированный файл журнала.  Обратите внимание, что имена файлов журнала в вашем случае будут другими.

проверка файла журнала
```commandline
user@ubuntu$ ls .
                             
snort.log.1638459842
```

Как вы видите, это единый файл журнала «все в одном». Это журнал в формате binary/tcpdump.  Вот как он выглядит в представлении папки.



Ведение журнала с параметром "-K ASCII"
Запустите экземпляр Snort в режиме регистратора пакетов;`sudo snort -dev -K ASCII`

Теперь запустите  скрипт traffic-generator как sudo и  запустите  ICMP/ HTTP- трафик .  После того, как трафик будет 
сгенерирован, Snort начнет показывать пакеты в режиме детализации следующим образом;

ведение журнала с -K ASCII
```commandline
user@ubuntu$ sudo snort -dev -K ASCII -l .
                             
Running in packet logging mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Log directory = /var/log/snort
pcap DAQ configured to passive.
Acquiring network traffic from "ens33".
Decoding Ethernet

        --== Initialization Complete ==--
...
Commencing packet processing (pid=2679)
WARNING: No preprocessors configured for policy 0.
WARNING: No preprocessors configured for policy 0.
```
Теперь давайте проверим сгенерированный файл журнала.

Проверка файла журнала
```commandline
user@ubuntu$ ls .
                             
142.250.187.110  192.168.175.129  snort.log.1638459842
```
Вот как это выглядит в представлении папки.


Логи, созданные с параметром "-K ASCII", совершенно другие. Есть две папки с именами IP-адресов. Давайте рассмотрим их.

проверка файла журнала
```commandline
user@ubuntu$ ls ./192.168.175.129/
                             
ICMP_ECHO  UDP:36648-53  UDP:40757-53  UDP:47404-53  UDP:50624-123
```
Если присмотреться к созданным папкам, то можно увидеть, что журналы находятся в  формате ASCII и отсортированы по 
категориям, поэтому их можно прочитать без использования экземпляра Snort.
Вот как это выглядит в представлении папки.

В двух словах, режим ASCII предоставляет несколько файлов в формате, удобном для чтения человеком, поэтому можно 
легко читать логи с помощью текстового редактора. В отличие от формата ASCII, двоичный формат неудобочитаем и 
требует анализа с помощью Snort или приложения вроде tcpdump.

Давайте сравним формат ASCII с двоичным форматом, открыв их оба в текстовом редакторе.  Разница между двоичным 
файлом журнала и файлом журнала ASCII показана ниже.  (Слева: двоичный формат. Справа: формат ASCII).




Чтение сгенерированных логов с параметром "-r"
Запустите экземпляр Snort в режиме считывателя пакетов;`sudo snort -r`

чтение файлов журнала с -r

```commandline
user@ubuntu$ sudo snort -r snort.log.1638459842
                             
Running in packet dump mode

        --== Initializing Snort ==--
Initializing Output Plugins!
pcap DAQ configured to read-file.
Acquiring network traffic from "snort.log.1638459842".

        --== Initialization Complete ==--
...
Commencing packet processing (pid=3012)
WARNING: No preprocessors configured for policy 0.
12/02-07:44:03.123225 192.168.175.129 -> 142.250.187.110
ICMP TTL:64 TOS:0x0 ID:41900 IpLen:20 DgmLen:84 DF
Type:8  Code:0  ID:1   Seq:49  ECHO
=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
WARNING: No preprocessors configured for policy 0.
12/02-07:44:26.169620 192.168.175.129 -> 142.250.187.110
ICMP TTL:64 TOS:0x0 ID:44765 IpLen:20 DgmLen:84 DF
Type:8  Code:0  ID:1   Seq:72  ECHO
===============================================================================
Packet I/O Totals:
   Received:           51
   Analyzed:           51 (100.000%)
    Dropped:            0 (  0.000%)
   Filtered:            0 (  0.000%)
Outstanding:            0 (  0.000%)
   Injected:            0
===============================================================================
Breakdown by protocol (includes rebuilt packets):
...
      Total:           51
===============================================================================
Snort exiting
```

Обратите внимание, что  Snort может читать и обрабатывать двоичный вывод (tcpdump и Wireshark также могут обрабатывать этот формат журнала). Однако, если вы создаете журналы с параметром "-K ASCII", Snort не будет их читать.  Как вы можете видеть в приведенном выше выводе, Snort читал и отображал файл журнала так же, как в режиме сниффера.

Открытие файла журнала с помощью tcpdump.


Открытие файла журнала с помощью tcpdump
```commandline
user@ubuntu$ sudo tcpdump -r snort.log.1638459842 -ntc 10
                             
reading from file snort.log.1638459842, link-type EN10MB (Ethernet)
IP 192.168.175.129 > 142.250.187.110: ICMP echo request, id 1, seq 49, length 64
IP 142.250.187.110 > 192.168.175.129: ICMP echo reply, id 1, seq 49, length 64
IP 192.168.175.129 > 142.250.187.110: ICMP echo request, id 1, seq 50, length 64
IP 142.250.187.110 > 192.168.175.129: ICMP echo reply, id 1, seq 50, length 64
IP 192.168.175.129 > 142.250.187.110: ICMP echo request, id 1, seq 51, length 64
IP 142.250.187.110 > 192.168.175.129: ICMP echo reply, id 1, seq 51, length 64
IP 192.168.175.129 > 142.250.187.110: ICMP echo request, id 1, seq 52, length 64
IP 142.250.187.110 > 192.168.175.129: ICMP echo reply, id 1, seq 52, length 64
IP 192.168.175.1.63096 > 239.255.255.250.1900: UDP, length 173
IP 192.168.175.129 > 142.250.187.110: ICMP echo request, id 1, seq 53, length 64
```
Открытие файла журнала с помощью Wireshark.



Параметр "-r" также позволяет пользователям фильтровать двоичные файлы журнала.  Вы можете фильтровать обработанный журнал, чтобы увидеть определенные пакеты с помощью параметра "-r" и Berkeley Packet Filters ( BPF ). 
```commandline
sudo snort -r logname.log -X
sudo snort -r logname.log icmp
sudo snort -r logname.log tcp
sudo snort -r logname.log 'udp and port 53'
```

Вывод будет таким же, как и выше, но будут показаны только пакеты с выбранным протоколом.  Кроме того, вы можете указать количество процессов с помощью параметра "-n". Следующая команда обработает только первые 10 пакетов:

`snort -dvr logname.log -n 10`

Чтобы понять, как работает BPF и как его использовать, воспользуйтесь следующими ресурсами .

https://en.wikipedia.org/wiki/Berkeley_Packet_Filter
https://biot.com/capstats/bpf.html
https://www.tcpdump.org/manpages/tcpdump.1.html
Теперь используйте прикрепленную  виртуальную машину  и перейдите в  папку Task-Exercises/Exercise-Files/TASK-6, чтобы ответить на вопросы!

### Ответьте на вопросы ниже
Исследуйте трафик с помощью файла конфигурации по умолчанию  в режиме ASCII.

`sudo snort -dev -K ASCII -l .`

Запустите скрипт генератора трафика и выберите  "TASK-6 Exercise" . Подождите, пока трафик закончится, затем 
остановите экземпляр Snort. Теперь проанализируйте сводку выходных данных и ответьте на вопрос.
`sudo ./traffic-generator.sh`

Теперь у вас должны быть журналы в текущем каталоге. Перейдите в папку " 145.254.160.237 ". Какой исходный порт используется для подключения к порту 53?
```commandline
3009
```
Используйте  snort.log.1640048004 

Прочитайте файл snort.log с помощью Snort; каков IP-идентификатор 10-го пакета?

snort -r snort.log.1640048004 -n 10
```commandline
49313
```
Прочитайте файл « snort.log.1640048004»  с помощью Snort; каков реферер 4-го пакета?
```commandline
http://www.ethereal.com/development.html
```
Прочитайте файл « snort.log.1640048004»  с помощью Snort; каков номер подтверждения 8-го пакета?
```commandline
0x38AFFFF3
```
Прочитайте файл « snort.log.1640048004» с помощью Snort; каково количество пакетов «TCP port 80» ?
```commandline
41
```

## Задание 7
Snort в режиме IDS/ IPS

Возможности Snort не ограничиваются сниффингом и регистрацией трафика. Режим IDS/ IPS помогает управлять трафиком в 
соответствии с заданными пользователем правилами. 

Обратите внимание, что режим (N)IDS/ IPS зависит от правил и конфигурации.  TASK-10  суммирует основные пути, файлы 
и переменные. Кроме того, TASK-3 охватывает тестирование конфигурации. Здесь нам нужно сначала понять логику работы, 
а затем мы перейдем к правилам в TASK-9.

Давайте запустим Snort в режиме IDS/ IPS .
Параметры режима NIDS поясняются в таблице ниже;

- -с - Определение файла конфигурации.
- -Т -	Тестирование файла конфигурации.
- -N -	Отключить ведение журнала.
- -D -	Фоновый режим.
- -А -	Режимы оповещения;

full: Полный режим оповещения, предоставляющий всю возможную информацию об оповещении. Это также режим по умолчанию; как только вы используете -A и не указываете никакого режима, snort использует этот режим.
быстрый:  в быстром режиме отображается предупреждающее сообщение, временная метка, IP-адрес источника и назначения, а также номера портов.

Консоль: обеспечивает быстрые оповещения на экране консоли.

cmg: стиль CMG, основные сведения о заголовке с полезной нагрузкой в шестнадцатеричном и текстовом формате. 

none: Отключение оповещений.


Давайте начнем использовать каждый параметр и посмотрим на разницу между ними. Snort нуждается в активном трафике на 
вашем интерфейсе, поэтому нам нужно сгенерировать трафик, чтобы увидеть Snort в действии.  Для этого используйте   
скрипт  traffic-generator и проанализируйте трафик.

После запуска режима IDS/ IPS вам необходимо использовать правила. Как мы уже упоминали ранее, мы будем использовать 
предопределенное правило ICMP в качестве примера. Определенное правило будет генерировать оповещения только в любом 
направлении активности пакетов ICMP.

`alert icmp any any <> any any  (msg: "ICMP Packet Found"; sid: 100001; rev:1;)`


Это правило находится в  "/etc/snort/rules/local.rules" .

Помните, в этом модуле мы сосредоточимся только на режимах работы. Правила рассматриваются в задачах 9 и 10. Snort 
создаст файл «оповещения», если поток трафика вызовет оповещение.  Последнее замечание: как только вы начнете 
работать в режиме IPS / IDS , режим сниффинга и регистрации станет полупассивным. Однако вы можете активировать 
функции с помощью параметров, обсуждавшихся в предыдущих задачах. (-i, -v, -d, -e, -X, -l, -K ASCII)  Если вы не 
помните назначение этих команд,  пожалуйста, вернитесь к задаче 4 .    


#### Режим IDS/ IPS  с параметрами "-c и -T"
Запустите экземпляр Snort и протестируйте файл конфигурации.  sudo snort -c /etc/snort/snort.conf -T  Эта команда 
проверит ваш файл конфигурации и сообщит, есть ли какие-либо ошибки в текущей настройке.  Вы должны быть знакомы с 
этой командой, если вы рассмотрели TASK3. Если вы не помните вывод этой команды, пожалуйста, вернитесь к TASK4 .


#### Режим IDS/ IPS  с параметром "-N"

Запустите экземпляр Snort и отключите ведение журнала, выполнив следующую команду:`sudo snort -c /etc/snort/snort.conf -N`

Теперь запустите  скрипт traffic-generator  как sudo  и  запустите  ICMP/ HTTP- трафик .  Эта команда отключит режим ведения журнала. Остальные функции будут по-прежнему доступны (если активированы).

Вывод командной строки предоставит запрошенную информацию с параметрами. Таким образом, если вы активируете  детализацию (-v)  или  полный дамп пакетов (-X),  вы все равно получите вывод в консоли, но в папке журнала не будет журналов.

#### Режим IDS/ IPS  с параметром "-D"
Запустите экземпляр Snort в фоновом режиме с помощью следующей команды:sudo snort -c /etc/snort/snort.conf -D

Теперь запустите  скрипт traffic-generator  как sudo  и  запустите  ICMP/ HTTP- трафик .  После того, как трафик будет сгенерирован, snort начнет обрабатывать пакеты и выполнит заданную задачу с дополнительными параметрами.

работает в фоновом режиме
```commandline
user@ubuntu$ sudo snort -c /etc/snort/snort.conf -D

Spawning daemon child...
My daemon child 2898 lives...
Daemon parent exiting (0)
```
Вывод командной строки предоставит запрошенную информацию с параметрами. Таким образом, если вы активируете детализацию (-v) или полный дамп пакетов (-X) с режимом пакетного регистратора (-l), у вас все равно будут журналы в папке журналов, но в консоли не будет вывода.
После запуска фонового режима и необходимости проверить соответствующий процесс вы можете легко использовать команду «ps», как показано ниже;

работает в фоновом режиме
```commandline
user@ubuntu$ ps -ef | grep snort

root        2898    1706  0 05:53 ?        00:00:00 snort -c /etc/snort/snort.conf -D
```
Если вы хотите остановить демон, вы можете легко использовать команду «kill» для остановки процесса.

работает в фоновом режиме
`user@ubuntu$ sudo kill -9 2898`
Обратите внимание, что  режим демона в основном используется для автоматизации Snort. Этот параметр в основном используется в скриптах для запуска службы Snort в фоновом режиме. Не рекомендуется использовать этот режим, если у вас нет практических знаний Snort и стабильной конфигурации.

Режим IDS/ IPS  с параметром "-A"
Помните, что в snort доступно несколько режимов оповещений;

Консоль:  обеспечивает быстрые оповещения на экране консоли.
cmg:  Предоставляет основные сведения о заголовке с полезной нагрузкой в шестнадцатеричном и текстовом формате.
полный:  режим полного оповещения, предоставляющий всю возможную информацию о оповещении.
быстрый:  быстрый режим, отображает предупреждающее сообщение, временную метку, IP-адрес источника и назначения, а также номера портов.
none: Отключение оповещений.
В этом разделе только параметры "console" и "cmg" предоставляют информацию об оповещениях в консоли. Невозможно определить разницу между остальными режимами оповещения через терминал. Различия можно определить, просматривая сгенерированные журналы. 

В конце этого раздела  мы сравним режимы "full", "fast" и "none". Помните, что эти параметры не обеспечивают вывод на консоль, поэтому мы продолжим выявлять различия с помощью форматов журналов.


Режим IDS/ IPS  с параметром "-A console"

Консольный режим обеспечивает быстрые оповещения на экране консоли.  Запустите экземпляр Snort в консольном  режиме оповещения (-A console ) с помощью следующей командыsudo snort -c /etc/snort/snort.conf -A console

Теперь запустите  скрипт traffic-generator  как sudo  и  запустите  ICMP/ HTTP- трафик .  После того, как трафик будет сгенерирован, snort начнет генерировать оповещения в соответствии с предоставленным набором правил, определенным в файле конфигурации. 

работает в режиме оповещения консоли
```commandline
user@ubuntu$ sudo snort -c /etc/snort/snort.conf -A console
Running in IDS mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Initializing Preprocessors!
Initializing Plug-ins!
Parsing Rules file "/etc/snort/snort.conf"
...
Commencing packet processing (pid=3743)
12/12-02:08:27.577495  [**] [1:366:7] ICMP PING *NIX [**] [Classification: Misc activity] [Priority: 3] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-02:08:27.577495  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-02:08:27.577495  [**] [1:384:5] ICMP PING [**] [Classification: Misc activity] [Priority: 3] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-02:08:27.609719  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
^C*** Caught Int-Signal
12/12-02:08:29.595898  [**] [1:366:7] ICMP PING *NIX [**] [Classification: Misc activity] [Priority: 3] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-02:08:29.595898  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-02:08:29.595898  [**] [1:384:5] ICMP PING [**] [Classification: Misc activity] [Priority: 3] {ICMP} 192.168.175.129 -> 142.250.187.110
===============================================================================
Run time for packet processing was 26.25844 seconds
Snort processed 88 packets.
```


#### Режим IDS/ IPS  с параметром "-A cmg"

Режим Cmg предоставляет основные сведения о заголовке с полезной нагрузкой в ​​шестнадцатеричном и текстовом формате.  Запустите экземпляр Snort в  режиме оповещения cmg  (-A cmg ) с помощью следующей командыsudo snort -c /etc/snort/snort.conf -A cmg

Теперь запустите  скрипт traffic-generator  как sudo  и  запустите  ICMP/ HTTP- трафик .  После того, как трафик будет сгенерирован, snort начнет генерировать оповещения в соответствии с предоставленным набором правил, определенным в файле конфигурации. 

работает в режиме оповещения cmg
```commandline
user@ubuntu$ sudo snort -c /etc/snort/snort.conf -A cmg
Running in IDS mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Initializing Preprocessors!
Initializing Plug-ins!
Parsing Rules file "/etc/snort/snort.conf"
...
Commencing packet processing (pid=3743)
12/12-02:23:56.944351  [**] [1:366:7] ICMP PING *NIX [**] [Classification: Misc activity] [Priority: 3] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-02:23:56.944351 00:0C:29:A5:B7:A2 -> 00:50:56:E1:9B:9D type:0x800 len:0x62
192.168.175.129 -> 142.250.187.110 ICMP TTL:64 TOS:0x0 ID:10393 IpLen:20 DgmLen:84 DF
Type:8  Code:0  ID:4   Seq:1  ECHO
BC CD B5 61 00 00 00 00 CE 68 0E 00 00 00 00 00  ...a.....h......
10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F  ................
20 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F   !"#$%&'()*+,-./
30 31 32 33 34 35 36 37                          01234567

=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
```
Давайте сравним консольные и cmg-выходы, прежде чем перейти к другим типам сигналов тревоги. Как вы можете видеть в приведенных выше выходах, консольный режим предоставляет базовую информацию о заголовках и правилах. Cmg-режим предоставляет полную информацию о пакетах вместе с информацией о правилах. 


Режим IDS/ IPS  с параметром "-A быстрый"

Быстрый режим предоставляет предупреждающие сообщения, временные метки, а также исходные и конечные IP-адреса. Помните, что в этом режиме нет вывода на консоль.  Запустите экземпляр Snort в  режиме быстрого  оповещения (-A fast ) с помощью следующей команды sudo snort -c /etc/snort/snort.conf -A fast

Теперь запустите  скрипт traffic-generator  как sudo  и  запустите  ICMP/ HTTP- трафик .  После того, как трафик будет сгенерирован, snort начнет генерировать оповещения в соответствии с предоставленным набором правил, определенным в файле конфигурации. 

работает в режиме быстрого оповещения
```commandline
user@ubuntu$ sudo snort -c /etc/snort/snort.conf -A fast
Running in IDS mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Initializing Preprocessors!
Initializing Plug-ins!
Parsing Rules file "/etc/snort/snort.conf"
...
Commencing packet processing (pid=3743)
=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
```
Давайте проверим файл тревоги;



Как вы можете видеть на рисунке выше, оповещения быстрого стиля содержат сводную информацию о действии, такую как 
направление и заголовок оповещения.

#### Режим IDS/ IPS  с параметром "-A полный"

Полный режим оповещения предоставляет всю возможную информацию об оповещении.  Помните, что в этом режиме нет вывода на консоль.  Запустите экземпляр Snort в  режиме полного  оповещения (-A full ) с помощью следующей командыsudo snort -c /etc/snort/snort.conf -A full

Теперь запустите  скрипт traffic-generator  как sudo  и  запустите  ICMP/ HTTP- трафик .  После того, как трафик будет сгенерирован, snort начнет генерировать оповещения в соответствии с предоставленным набором правил, определенным в файле конфигурации. 

работает в режиме полной готовности
```commandline
user@ubuntu$ sudo snort -c /etc/snort/snort.conf -A full
Running in IDS mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Initializing Preprocessors!
Initializing Plug-ins!
Parsing Rules file "/etc/snort/snort.conf"
...
Commencing packet processing (pid=3744)
=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
```
Давайте проверим файл тревоги;



 Как вы можете видеть на рисунке выше, оповещения полного стиля содержат всю возможную информацию о действии.


#### Режим IDS/ IPS  с параметром "-A none"

Отключить оповещения. Этот  режим не создает файл оповещения. Однако он все равно регистрирует трафик и создает файл журнала в формате двоичного дампа.  Помните, что в этом режиме нет вывода на консоль.  Запустите экземпляр Snort в  режиме без  оповещений (-A none) с помощью следующей командыsudo snort -c /etc/snort/snort.conf -A none

Теперь запустите  скрипт traffic-generator  как sudo  и  запустите  ICMP/ HTTP- трафик .  После того, как трафик будет сгенерирован, snort начнет генерировать оповещения в соответствии с предоставленным набором правил, определенным в файле конфигурации. 

работает в режиме без оповещения
```commandline
user@ubuntu$ sudo snort -c /etc/snort/snort.conf -A none
Running in IDS mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Initializing Preprocessors!
Initializing Plug-ins!
Parsing Rules file "/etc/snort/snort.conf"
...
Commencing packet processing (pid=3745)
=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
```
Как вы можете видеть на рисунке ниже, файла оповещения нет. Snort только сгенерировал файл журнала.




#### Режим IDS/ IPS  : «Использование файла правил без файла конфигурации»

Можно запустить Snort только с правилами без файла конфигурации. Запуск Snort в этом режиме поможет вам протестировать созданные пользователем правила. Однако этот режим обеспечит меньшую производительность.

запуск без файла конфигурации
```commandline
user@ubuntu$ sudo snort -c /etc/snort/rules/local.rules -A console
Running in IDS mode

12/12-12:13:29.167955  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:29.200543  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:30.169785  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:30.201470  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:31.172101  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
^C*** Caught Int-Signal

```
#### Режим IPS  и отбрасывание пакетов

Режим Snort IPS активируется с  параметрами -Q --daq afpacket  . Вы также можете активировать этот режим, отредактировав файл snort.conf. Однако вам не нужно редактировать файл snort.conf в рамках этой комнаты. Ознакомьтесь с бонусным заданием или руководством snort для получения дополнительной информации о daq и расширенных настройках конфигурации: -Q --daq afpacket

Активируйте модули сбора данных ( DAQ ) и используйте модуль afpacket для использования snort в качестве IPS : -i eth0:eth1

Идентификация интерфейсов, обратите внимание, что Snort IPS требует как минимум два интерфейса для работы.  Теперь запустите  скрипт traffic-generator  как sudo  и  запустите  ICMP/ HTTP- трафик .

```commandline
user@ubuntu$ sudo snort -c /etc/snort/snort.conf -q -Q --daq afpacket -i eth0:eth1 -A console
Running in IPS mode

12/18-07:40:01.527100  [Drop] [**] [1:1000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.131 -> 192.168.175.2
12/18-07:40:01.552811  [Drop] [**] [1:1000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 172.217.169.142 -> 192.168.1.18
12/18-07:40:01.566232  [Drop] [**] [1:1000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.131 -> 192.168.175.2
12/18-07:40:02.517903  [Drop] [**] [1:1000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.1.18 -> 172.217.169.142
12/18-07:40:02.550844  [Drop] [**] [1:1000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 172.217.169.142 -> 192.168.1.18
^C*** Caught Int-Signal
```
Как вы можете видеть на картинке выше, на этот раз Snort заблокировал пакеты.  Мы использовали то же правило с другим действием (отбросить/отклонить). Помните, что в рамках этой задачи мы имеем в виду режим работы, а не правило.


### Ответьте на вопросы ниже
Исследуйте трафик с помощью файла конфигурации по умолчанию.

`sudo snort -c /etc/snort/snort.conf -A full -l .`

Запустите скрипт генератора трафика и выберите "TASK-7 Exercise" . Подождите, пока трафик остановится, затем остановите экземпляр Snort. Теперь проанализируйте сводку выходных данных и ответьте на вопрос.
`sudo ./traffic-generator.sh`

Каково количество обнаруженных методов HTTP GET?
```commandline
2
```
Остальные параметры вы можете попрактиковать, используя скрипт-генератор трафика.
```commandline
Ответ не требуется
```

## Задание 8
Давайте рассмотрим PCAP с помощью Snort

Возможности Snort не ограничиваются сниффингом, протоколированием и обнаружением/предотвращением угроз. Режим чтения/исследования PCAP помогает работать с файлами pcap.  После того, как у вас есть файл pcap и вы обработаете его с помощью Snort, вы получите статистику трафика по умолчанию с оповещениями в зависимости от вашего набора правил.

Чтение pcap без использования дополнительных параметров, которые мы обсуждали ранее, только просмотрит пакеты и предоставит статистику о файле. В большинстве случаев это не очень удобно. Мы исследуем pcap с помощью Snort, чтобы извлечь пользу из правил и ускорить процесс расследования, используя известные шаблоны угроз. 

Обратите внимание, что  мы довольно близки к тому, чтобы начать создавать правила. Поэтому вам нужно понять рабочий механизм Snort, изучить обсуждаемые параметры и начать комбинировать параметры для разных целей.

Параметры режима PCAP поясняются в таблице ниже;


- -r / --pcap-single=	Прочитать один pcap
- --pcap-list=""	Прочитайте pcaps, указанные в команде (через пробел).
- --pcap-показать	Показывать имя pcap на консоли во время обработки.

Исследование одного PCAP с параметром "-r"

В целях тестирования вы по-прежнему можете протестировать параметр чтения по умолчанию с помощью pcap, используя следующую команду:snort -r icmp-test.pcap

Давайте исследуем pcap с помощью нашего файла конфигурации и посмотрим, что произойдет. sudo snort -c /etc/snort/snort.conf -q -r icmp-test.pcap -A console -n 10

Если вы не помните назначение параметров в данной команде, пожалуйста, вернитесь к предыдущим задачам и вернитесь снова!

исследование одного файла pcap
```commandline
user@ubuntu$ sudo snort -c /etc/snort/snort.conf -q -r icmp-test.pcap -A console -n 10

12/12-12:13:29.167955  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:29.200543  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:30.169785  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:30.201470  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:31.172101  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:31.204104  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:32.174106  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:32.208683  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:33.176920  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:33.208359  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
```

Наше правило ICMP сработало!  Как вы можете видеть в приведенном выводе, snort идентифицировал трафик и выдал оповещения в соответствии с нашим набором правил.


Исследование нескольких PCAP с параметром "--pcap-list"
Давайте исследуем несколько pcap с помощью нашего файла конфигурации и посмотрим, что произойдет. sudo snort -c /etc/snort/snort.conf -q --pcap-list="icmp-test.pcap http2.pcap" -A console -n 10

исследование нескольких файлов pcap
```commandline
user@ubuntu$ sudo snort -c /etc/snort/snort.conf -q --pcap-list="icmp-test.pcap http2.pcap" -A console

12/12-12:13:29.167955  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:29.200543  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:30.169785  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:30.201470  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:31.172101  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
...
12/12-12:13:31.204104  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:32.174106  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:32.208683  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:33.176920  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:33.208359  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
```

Наше правило ICMP сработало!  Как вы можете видеть в приведенном выводе, snort идентифицировал трафик и выдал оповещения в соответствии с нашим набором правил.

Вот один момент, на который следует обратить внимание: мы обработали два pcap, и есть много оповещений, поэтому невозможно сопоставить оповещения с предоставленными pcap без помощи snort. Нам нужно разделить процесс pcap, чтобы определить источник оповещений.

Исследование нескольких PCAP с параметром "--pcap-show"
Давайте рассмотрим несколько pcap, выделим каждый из них и посмотрим, что произойдет. sudo snort -c /etc/snort/snort.conf -q --pcap-list="icmp-test.pcap http2.pcap" -A console --pcap-show

исследование нескольких pcap-файлов с pcap-информацией
```commandline
user@ubuntu$ sudo snort -c /etc/snort/snort.conf -q --pcap-list="icmp-test.pcap http2.pcap" -A console --pcap-show 

Reading network traffic from "icmp-test.pcap" with snaplen = 1514
12/12-12:13:29.167955  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:29.200543  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:30.169785  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
...

Reading network traffic from "http2.pcap" with snaplen = 1514
12/12-12:13:35.213176  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:36.182950  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:38.223470  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
...
```

Наше правило ICMP сработало!  Как вы можете видеть в приведенном выводе, snort идентифицировал трафик, выделил каждый файл pcap и выдал оповещения в соответствии с нашим набором правил.
Теперь используйте подключенную  виртуальную машину  и  перейдите в папку Task-Exercises/Exercise-Files/TASK-8, чтобы ответить на вопросы!

### Ответьте на вопросы ниже
Изучите файл mx-1.pcap с файлом конфигурации по умолчанию.

`sudo snort -c /etc/snort/snort.conf -A full -l . -r mx-1.pcap`

Каково количество сгенерированных оповещений?
```commandline
170
```
Продолжайте читать вывод.  Сколько сегментов TCP поставлено в очередь?
```commandline
18
```
Продолжайте читать вывод. Сколько «заголовков ответа HTTP» было извлечено?
```commandline
3
```
Исследуйте   файл mx-1.pcap со вторым файлом конфигурации.

`sudo snort -c /etc/snort/snortv2.conf -A full -l . -r mx-1.pcap`

Каково количество сгенерированных оповещений?
```commandline
68
```
Изучите файл mx-2.pcap с файлом конфигурации по умолчанию.

`sudo snort -c /etc/snort/snort.conf -A full -l . -r mx-2.pcap`

Каково количество сгенерированных оповещений?

```commandline
340
```
Продолжайте читать вывод.  Каково количество обнаруженных TCP-пакетов?


```commandline
82
```
Изучите  файлы mx-2.pcap и mx-3.pcap  с помощью файла конфигурации по умолчанию.

`sudo snort -c /etc/snort/snort.conf -A full -l . --pcap-list="mx-2.pcap mx-3.pcap"`

Каково количество сгенерированных оповещений?
```commandline
1020
```
## Задание 9
Давайте выучим правила фырканья!

Понимание формата правил Snort необходимо для любого участника команды Blue and Purple. Основная структура правила 
snort показана ниже; 

Каждое правило должно иметь тип действия, протокол, исходный и конечный IP, исходный и конечный порт и опцию. 
Помните, что Snort по умолчанию находится в пассивном режиме. Поэтому большую часть времени вы будете использовать 
Snort как IDS . Вам нужно будет запустить  «inline mode», чтобы включить режим IPS.  Но прежде чем вы начнете 
играть с inline mode, вы должны быть знакомы с функциями и правилами Snort.   
Структуру правил Snort легко понять, но сложно создать. Вы должны быть знакомы с параметрами правил и связанными с 
ними подробностями, чтобы создавать эффективные правила.  Рекомендуется практиковать правила Snort и подробности 
опций для различных вариантов использования.  

В этой комнате мы рассмотрим базовую структуру правил и поможем вам сделать шаг к правилам snort.  Вы всегда можете 
улучшить свои навыки создания правил с различными вариантами правил, практикуя различные варианты использования и 
подробно изучая детали вариантов правил. Мы сосредоточимся на двух действиях:  «оповещение»   для режима IDS и 
«отклонение» для режима IPS.

Правила не могут быть обработаны без заголовка. Параметры правил являются «необязательными» частями.  Однако 
практически невозможно обнаружить сложные атаки без использования параметров правил.

Действие
Есть несколько действий для правил. Убедитесь, что вы понимаете функционал и протестируйте его, прежде чем создавать 
правила для живых систем. Наиболее распространенные действия перечислены ниже.


Обратите внимание, что Snort2 поддерживает только четыре фильтра протоколов в правилах (IP, TCP, UDP и ICMP). Однако 
вы можете обнаружить потоки приложений, используя номера портов и опции. Например, если вы хотите обнаружить трафик 
FTP, вы не можете использовать ключевое слово FTP в поле протокола, а фильтруете трафик FTP, исследуя трафик TCP на 
порту 21.   


IP и номера портов

Эти параметры определяют исходные и целевые IP-адреса, а также соответствующие номера портов, отфильтрованные для правила.

Фильтрация IP-адресов	


Направление

Оператор направления указывает поток трафика, который будет фильтроваться Snort. Левая часть правила показывает источник, а правая часть — пункт назначения.

- -> Поток от источника к месту назначения.
- <> Двунаправленный поток
- Обратите внимание, что  в Snort нет оператора «<-».


В Snort есть три основных варианта правил;
- Параметры общих правил —  основные параметры правил для Snort. 
- Параметры правил полезной нагрузки -  Параметры правил, которые помогают исследовать данные полезной нагрузки. Эти 
  параметры полезны для обнаружения определенных шаблонов полезной нагрузки.
- Параметры правил Non-Payload —  параметры правил, которые фокусируются на данных non-payload. Эти параметры помогут 
  создать определенные шаблоны и определить проблемы сети.

Общие параметры правил

Сообщ.	Поле сообщения — это базовая подсказка и быстрый идентификатор правила. После срабатывания правила сообщение, указанное в поле, появится в консоли или журнале. Обычно часть сообщения представляет собой однострочный текст, который резюмирует событие.
Сид
Идентификаторы правил Snort (SID) поставляются с предопределенной областью действия, и каждое правило должно иметь SID в правильном формате. Ниже показаны три различных области действия для SID.

Ссылка
Каждое правило может иметь дополнительную информацию или ссылку для объяснения цели правила или шаблона угрозы. Это может быть идентификатор Common Vulnerabilities and Exposures ( CVE ) или внешняя информация. Наличие ссылок на правила всегда поможет аналитикам во время оповещения и расследования инцидента.
Преподобный
Правила Snort можно изменять и обновлять для решения проблем производительности и эффективности. Параметр Rev помогает аналитикам иметь информацию о ревизии каждого правила. Таким образом, будет легко понять улучшения правил. Каждое правило имеет свой уникальный номер ревизии, и в истории правил нет функции автоматического резервного копирования. Аналитики должны сами вести историю правил. Параметр Rev — это только индикатор того, сколько раз правило имело ревизии.

`alert icmp any any <> any any  (сообщение: "Найден пакет ICMP"; sid: 100001; ссылка:cve,CVE-XXXX;  rev:1 ;)`


Параметры правила обнаружения полезной нагрузки

Содержание
Данные полезной нагрузки. Он сопоставляет определенные данные полезной нагрузки с ASCII, HEX или обоими. Эту опцию можно использовать несколько раз в одном правиле. Однако чем больше вы создаете определенных функций сопоставления шаблонов, тем больше времени требуется для исследования пакета.

Следующие правила создадут оповещение для каждого HTTP-пакета, содержащего ключевое слово "GET". Эта опция правила чувствительна к регистру!

Режим ASCII - alert tcp any any <> any 80   (msg: "GET Request Found";  content:"GET";  sid: 100001; rev:1;)
Режим HEX - alert tcp any any <> any 80   (сообщение: "GET Request Found";  содержимое:"|47 45 54|" ;  sid: 100001; rev:1;)
Nocase
Отключение чувствительности к регистру. Используется для улучшения поиска контента.
alert tcp any any <> any 80 (msg: "GET Request Found"; content:"GET"; nocase; sid: 100001; rev:1;)
Fast_pattern
Установите приоритет поиска контента для ускорения операции поиска полезной нагрузки. По умолчанию Snort использует самый большой контент и оценивает его по правилам. Параметр "fast_pattern" помогает выбрать начальное соответствие пакета определенному значению для дальнейшего исследования. Этот параметр всегда работает без учета регистра и может использоваться один раз для каждого правила. Обратите внимание, что этот параметр требуется при использовании нескольких параметров "content". 

Следующее правило имеет два параметра содержимого, а параметр fast_pattern указывает snort использовать первый параметр содержимого (в данном случае «GET») для начального сопоставления пакетов.
alert tcp any any <> any 80 (msg: "GET Request Found"; content:"GET"; fast_pattern; content:"www"; sid:100001; rev:1;)



Параметры правила обнаружения неполезной нагрузки

Существуют параметры правил, которые фокусируются на данных, не относящихся к полезной нагрузке. Эти параметры помогут создать определенные шаблоны и определить проблемы сети.

ИДЕНТИФИКАТОР	
Фильтрация поля IP-идентификатора.
alert tcp любой любой <> любой любой (msg: "ID TEST"; id:123456; sid: 100001; rev:1;)
Флаги
Фильтрация флагов TCP .

alert tcp любой любой <> любой любой (сообщение: "FLAG TEST"; флаги:S; sid: 100001; rev:1;)

Dsize
Фильтрация размера полезной нагрузки пакета.

dsize:мин<>макс;
размер:>100
размер:<100
alert ip любой любой <> любой любой (msg: "SEQ TEST"; dsize:100<>300; sid: 100001; rev:1;)

Самейп
Фильтрация исходных и целевых IP-адресов на предмет дублирования.
alert ip любой любой <> любой любой (msg: "SAME-IP TEST"; sameip; sid: 100001; rev:1;)
Помните, что после создания правила оно становится локальным и должно быть в вашем файле "local.rules". Этот файл находится в "/etc/snort/rules/local.rules".  Ниже приведено краткое напоминание о том, как редактировать локальные правила.

изменение местных правил
user@ubuntu$ sudo gedit /etc/snort/rules/local.rules 

Это ваш файл " local.rules ".



Обратите внимание, что есть некоторые правила по умолчанию, активированные с экземпляром snort. Эти правила деактивируются для управления вашими правилами и улучшения вашего опыта упражнений. Для получения дополнительной информации, пожалуйста, обратитесь к руководству TASK-10 или Snort .
К этому моменту мы рассмотрели основную структуру правил Snort. Понимание и практика основ предлагается перед созданием расширенных правил и использованием дополнительных опций.

Ого! Мы рассмотрели основы правил Snort!    Теперь используйте подключенную виртуальную машину и перейдите в папку Task-Exercises/Exercise-Files/TASK-9, чтобы ответить на вопросы!  Обратите внимание, что вы можете использовать следующую команду для создания журналов в текущем каталоге:-l .

### Ответьте на вопросы ниже
Используйте « task9.pcap».

Напишите правило для фильтрации  IP ID "35369" и запустите его для указанного файла pcap.  Каково имя запроса обнаруженного пакета? snort -c local.rules -A full -l . -r task9.pcap


```commandline
TIMESTAMP REQUEST
```
Создайте правило для фильтрации  пакетов с флагом Syn  и запустите его для указанного файла pcap.  Каково количество обнаруженных пакетов?


```commandline
1
```
Очистите предыдущие файлы журнала и сигналов тревоги и деактивируйте /закомментируйте старое правило.

Напишите правило для фильтрации  пакетов с флагами Push-Ack  и запустите его для указанного файла pcap.  Каково количество обнаруженных пакетов?


```commandline
216
```
Очистите предыдущие файлы журнала и сигналов тревоги и деактивируйте /закомментируйте старое правило.

Создайте правило для фильтрации  пакетов с одинаковым исходным и конечным IP  и запустите его для указанного файла pcap.  Каково количество пакетов, которые показывают одинаковый исходный и конечный адрес?


```commandline
7
```
Пример случая -  Аналитик успешно изменил существующее правило.  Какую опцию правила аналитик должен изменить после внедрения?


```commandline
rev
```

## Задание 10
Что нужно помнить

Основные  компоненты Snort

- Декодер пакетов -  компонент-сборщик пакетов Snort. Собирает и подготавливает пакеты для предварительной обработки. 
- Препроцессоры —  компонент, который упорядочивает и изменяет пакеты для механизма обнаружения.
- Механизм обнаружения —  основной компонент, который обрабатывает, анализирует и разбирает пакеты, применяя правила. 
- Ведение журнала и оповещения —  компонент генерации журналов и оповещений.
- Выходные данные и плагины.  С помощью этого компонента реализована поддержка модулей интеграции выходных данных (т. 
  е. оповещений в syslog/mysql) и дополнительных плагинов (плагинов обнаружения управления правилами). 

#### Для snort доступны три типа правил

- Правила сообщества - Бесплатный набор правил под лицензией GPLv2. Доступно всем, регистрация не требуется.
- Зарегистрированные правила - Бесплатный набор правил (требуется регистрация). Этот набор правил содержит правила 
  подписчика с задержкой в 30 дней.
- Правила подписчика (платные) - Платный набор правил (требуется подписка). Этот набор правил является основным и 
  обновляется дважды в неделю (по вторникам и четвергам).
Вы можете скачать и прочитать более подробную информацию о правилах здесь.

Примечание: После установки Snort2 автоматически создает необходимые каталоги и файлы. Однако, если вы хотите использовать правила сообщества или платные правила, вам необходимо указать каждое правило в  файле snort.conf  .

Так как это длинный, все в одном файле конфигурации, редактирование его без неправильной конфигурации может быть 
проблематичным для некоторых пользователей.  Вот почему Snort имеет несколько модулей обновления правил и 
инструментов интеграции. Подводя итог, никогда не заменяйте настроенные файлы конфигурации Snort; вы должны 
редактировать файлы конфигурации вручную или обновлять правила с помощью дополнительных инструментов и модулей, 
чтобы не столкнуться с какими-либо сбоями/выходами или отсутствием функций.    

snort.conf:  Основной файл конфигурации.
local.rules:  Файл правил, созданный пользователем.
Начнем с обзора основного файла конфигурации (snort.conf). sudo gedit /etc/snort/snort.conf

Перейдите к разделу «Шаг № 1: Установка сетевых переменных».

В этом разделе управляется область обнаружения и пути правил.



Перейдите к разделу «Шаг №2: Настройка декодера».

В этом разделе вы управляете режимом IPS snort. Модель IPS с установкой на одном узле лучше всего работает с режимом "afpacket". Вы можете включить этот режим и запустить Snort в IPS .

ИМЯ ТЕГА	ИНФОРМАЦИЯ	ПРИМЕР
#config daq:	Выбор режима IPS .	афпакет
#config daq_mode:	Активация встроенного режима	в соответствии
#config logdir:	Жестко заданный путь к журналу по умолчанию.	/var/logs/фырканье
Модули сбора данных ( DAQ ) — это специальные библиотеки, используемые для пакетного ввода-вывода, обеспечивающие гибкость обработки пакетов. Можно выбрать тип и режим DAQ для различных целей.

В Snort доступно шесть модулей сбора данных ;

- Pcap: режим по умолчанию, известный как режим сниффера.
- Afpacket: встроенный режим, известный как режим IPS .
- Ipq: Inline режим на Linux с использованием Netfilter. Заменяет патч snort_inline.  
- Nfq: Встроенный режим в Linux .
- Ipfw: встроенный в OpenBSD и FreeBSD с использованием сокетов Divert с брандмауэрами pf и ipfw.
- Дамп: Тестовый режим инлайна и нормализации.
Наиболее популярными режимами являются режим по умолчанию (pcap) и inline/ IPS (Afpacket).

Перейдите к разделу «Шаг № 6: Настройка выходных плагинов».

Этот раздел управляет выходами действий IDS/ IPS , такими как детали формата ведения журнала и оповещения. Действие по умолчанию запрашивает все в консольном приложении, поэтому настройка этой части поможет вам использовать Snort более эффективно. 


### Ответьте на вопросы ниже
Прочитайте задание выше.
```commandline
Ответ не нужен
```
## Задание 11
В этой комнате мы рассмотрели Snort, что это такое, как он работает и как создавать и использовать правила для расследования угроз.

- Прежде чем создавать сложные правила и использовать дополнительные возможности, крайне важно понять и отработать 
основные принципы.
- Не создавайте сложные правила сразу; старайтесь добавлять параметры постепенно, чтобы легко заметить возможные 
  синтаксические ошибки или любые другие проблемы.
- Не изобретайте велосипед; используйте его или модифицируйте/улучшайте, если есть четкое правило.
- Перед внесением каких-либо изменений сделайте резервную копию файлов конфигурации.
- Никогда не удаляйте правило, которое работает правильно. Комментируйте, если оно вам не нужно.
- Протестируйте вновь созданные правила перед их переносом в рабочую среду.
Теперь мы приглашаем вас пройти комнату испытаний на фырканье:  Испытание фырканьем - Атаки в прямом эфире

Отличный способ быстро вспомнить правила и команды snort — загрузить и использовать шпаргалку TryHackMe snort.



### Ответьте на вопросы ниже
 Прочитайте задание выше.
```commandline
Ответ не нужен
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)