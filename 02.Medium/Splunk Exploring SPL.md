[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Splunk: Exploring SPL](https://tryhackme.com/r/room/splunkexploringspl) 

Всего 8 заданий:
## Задание 1
**Splunk** — это мощное решение SIEM, которое обеспечивает возможность поиска и исследования машинных данных. 
Search Processing Language (SPL)  используется для повышения эффективности поиска. Он включает в себя различные 
функции и команды, используемые вместе для формирования сложных, но эффективных поисковых запросов для получения 
оптимизированных результатов.

В этом зале будут подробно рассмотрены некоторые ключевые основы возможностей поиска, такие как объединение запросов 
SPL в цепочку для построения как простых, так и сложных запросов.

Цели обучения

В этом классе будут изучаться следующие темы:

- Что такое язык обработки поиска?
- Как применять фильтры для сужения результатов.
- Использование трансформационных команд.
- Изменение порядка результатов.
- Предварительные условия для комнаты

Эта комната основана на концепциях SIEM, описанных в комнатах Введение в SIEM  и Splunk : Базовые . Завершите эти 
комнаты и переходите к следующему заданию. 
### Ответьте на вопросы ниже
Рекомендуется завершить эти комнаты предварительных условий и перейти к следующему заданию.
```commandline
Ответ не нужен
```

## Задание 2
Машина для комнаты

Прежде чем двигаться дальше, разверните машину. Вы можете получить доступ к этой лаборатории в AttackBox или нажать 
https://LAB_WEB_URL.p.thmlabs.com /, чтобы запустить лабораторию в своем браузере, когда машина полностью запущена. 
Машине потребуется до 3-5 минут, чтобы запуститься.

Примечание: в этой комнате мы будем работать над индексом Windowslogs.

### Ответьте на вопросы ниже
Подключитесь к Лаборатории.
```commandline
Ответ не нужен
```
Каково имя хоста на вкладке «Сводка данных»?
```commandline
cyber-host
```

## Задание 3
Search & Reporting App — это интерфейс по умолчанию, используемый для поиска и анализа данных на домашней странице 
Splunk. Он имеет различные функции, которые помогают аналитикам улучшить опыт поиска.

Ниже описаны некоторые важные функции, представленные в поисковом приложении:
1) Search Head:
Search Head — это место, где мы используем запросы языка обработки поиска для поиска данных.

2) Продолжительность времени:
эта вкладка предоставляет несколько вариантов выбора продолжительности времени для поиска. All-time отобразит 
   события в реальном времени. Аналогично, последние 60 минут отобразят все события, зафиксированные за последний час.

3) История поиска:
эта вкладка сохраняет поисковые запросы, которые пользователь запускал в прошлом, а также время, когда они были 
   запущены. Она позволяет пользователю нажать на прошлые поиски и посмотреть результат. Опция фильтра используется 
   для поиска определенного запроса на основе термина.

4) Сводка данных:
эта вкладка содержит сводку типа данных, источника данных и хостов, которые сгенерировали события, как показано ниже.
   Эта вкладка является очень важной функцией, используемой для получения краткого представления о видимости сети.

5) Боковая панель полей:
Боковая панель полей находится на левой панели поиска Splunk. Эта боковая панель состоит из двух разделов, 
   показывающих выбранные поля и интересные поля. Она также предоставляет быстрые результаты, такие как верхние 
   значения и необработанные значения по каждому полю.

Ниже приведены некоторые важные моменты, которые следует понимать относительно боковой панели:

1- Выбранные поля	Splunk извлекает поля по умолчанию, такие как source, sourcetype и host, которые появляются в каждом событии, и помещает их в столбец выбранных полей. Мы можем выбрать другие поля, которые кажутся существенными, и добавить их в список.
2- Интересные области	Извлекает все интересные поля, которые находит, и отображает их на левой панели для дальнейшего изучения.
3- Буквенно-цифровые поля «α»	Этот альфа-символ показывает, что поле содержит текстовые значения.
4- Числовые поля '#'	Этот символ показывает, что данное поле содержит числовые значения.
5- Счет	Число напротив каждого поля показывает количество событий, зафиксированных за этот период времени.
### Ответьте на вопросы ниже
В истории поиска какой поисковый запрос находится на 7-м месте в списке? (исключая ваши поисковые запросы за сегодня)
```commandline
index=windowslogs | chart count(EventCode) by Image
```
На панели левого поля какой исходный IP-адрес зарегистрировал максимальное количество событий?
```commandline
172.90.12.11
```
Сколько событий возвращается, если применить фильтр времени для отображения событий 15.04.2022 и времени с 08:05 до 08:06?
```commandline
134
```

## Задание 4
Язык обработки поиска Splunk состоит из множества функций, операторов и команд, которые используются вместе для 
формирования простого или сложного поиска и получения желаемых результатов из принятых журналов. Основные компоненты 
SPL описаны ниже:

Операторы поля поиска

Операторы полей Splunk являются строительными блоками, используемыми для построения любого поискового запроса. Эти 
операторы полей используются для фильтрации, удаления и сужения результатов поиска на основе заданных критериев. 
Распространенные операторы полей — это операторы сравнения, подстановочные знаки и логические операторы.

Операторы сравнения

Эти операторы используются для сравнения значений с полями. Некоторые общие операторы сравнения указаны ниже:

Булевы операторы

Splunk поддерживает следующие логические операторы, которые могут быть очень полезны при поиске/фильтрации и сужении результатов.

Splunk поддерживает подстановочные знаки для сопоставления символов в строках.


В событиях сообщается о нескольких DestinationIP. Давайте используем подстановочный знак только для отображения DestinationIP, начиная с 172.*
Поисковый запрос: `index=windowslogs DestinationIp=172.*`

### Ответьте на вопросы ниже
Сколько событий возвращается при поиске по идентификатору события 1 и пользователю *Джеймс*?
```commandline
4
```
Сколько событий наблюдается с IP-адресом назначения 172.18.39.6 И портом назначения 135?
```commandline
4
```
Какой исходный IP-адрес имеет наибольшее количество возвращенных по этому поисковому запросу?
Поисковый запрос: index=windowslogs Hostname="Salena.Adam" DestinationIp="172.18.38.5"
```commandline
172.90.12.11
```
В индексе windowslogs найдите все события, содержащие термин cyber. Сколько событий было возвращено?
```commandline
0
```
Теперь выполните поиск по термину cyber* . Сколько событий будет возвращено?
```commandline
12256
```

## Задание 5
Наша сеть генерирует тысячи журналов каждую минуту, все они поступают в наше решение SIEM. Поиск любой аномалии без 
использования фильтров становится сложной задачей. SPL позволяет нам использовать фильтры, чтобы сузить результат и 
показывать только важные события, которые нас интересуют. Мы можем добавлять или удалять определенные данные из 
результата с помощью фильтров. Следующие команды полезны для применения фильтров к результатам поиска.
`|fields + HostName - EventID`
Давайте используем команду fields для отображения только полей host, User и SourceIP, используя следующий синтаксис.
Поисковый запрос: `index=windowslogs | fields + host + User + SourceIp`
Примечание: Нажмите на поле «Дополнительно», чтобы отобразить поля, если некоторые поля не видны.
`|search "Powershell"`
Используйте команду поиска, чтобы отобразить все события, содержащие термин Powershell. Это вернет все события, содержащие термин " Powershell ".
Поисковый запрос: `index=windowslogs | search Powershell`

#### Дедупликация
`| dedup <имя_поля>`
Пример
`|dedup EventID`
Мы можем использовать команду dedup, чтобы отобразить список уникальных идентификаторов событий для определенного имени хоста.
Поисковый запрос: `index=windowslogs | table EventID User Image Hostname | dedup EventID`

#### Переименовать
`|rename User as Employees`
Давайте переименуем поле «Пользователь» в «Сотрудники», используя следующий поисковый запрос.
Поисковый запрос : `index=windowslogs | fields + host + User + SourceIp | rename User as Employees`


### Ответьте на вопросы ниже
Какой третий EventID возвращается по этому поисковому запросу?

Поисковый запрос:`index=windowslogs | table _time EventID Hostname SourceName | reverse` 
```commandline
4103
```
Используйте команду dedup для поля Hostname перед командой reverse в запросе, упомянутом в вопросе 1. Какое первое 
имя пользователя возвращается в поле Hostname?
```commandline
Salena.Adam
```
## Задание 6
SPL предоставляет различные команды для придания структуры или порядка результатам поиска. Такие команды сортировки 
head, как tail, и sort могут быть очень полезны при исследовании журналов. Эти команды упорядочивания описаны ниже: 

#### table

Объяснение
Каждое событие имеет несколько полей, и не каждое поле важно для отображения. Команда Таблица позволяет нам создать 
таблицу с выборочными полями в качестве столбцов.
Синтаксис
`| таблица <имя_поля1> <имя_поля2>  `
Пример
`|table`
`| head 20`# вернет 20 первых событий из списка результатов.

Этот поисковый запрос создаст таблицу с тремя выбранными столбцами и проигнорирует все оставшиеся столбцы на дисплее.
Поисковый запрос: `index=windowslogs | table EventID Hostname SourceName`

### head
Объяснение
Команда head  возвращает первые 10 событий, если номер не указан.
Синтаксис
`| голова <номер>  ` 
Пример
`| head`   # вернет 10 первых событий из списка результатов
`| head 20 `   # вернет 20 первых событий из списка результатов
Следующий поисковый запрос покажет таблицу, содержащую указанные поля, и отобразит только 5 первых записей.
Поисковый запрос: `index=windowslogs |  table _time EventID Hostname SourceName | head 5`

### tail
Объяснение
Команда Tail возвращает последние 10 событий, если номер не указан.
Синтаксис
`| хвост номер<> `  
Пример
`| tail`# вернет последние 10 событий из списка результатов
`| tail 20`   # вернет последние 20 событий из списка результатов
Следующий поисковый запрос покажет таблицу, содержащую указанные поля, и отобразит только 5 записей из нижней части списка.
Поисковый запрос : `index=windowslogs |  table _time EventID Hostname SourceName | tail 5`

### sort
Объяснение
Команда «Сортировка» позволяет упорядочить поля в порядке возрастания или убывания.
Синтаксис
`| sort<имя_поля>  `
Пример
`| sort Hostname`# Это отсортирует результат по возрастанию.
Следующий поисковый запрос отсортирует результаты по полю «Имя хоста» .
Поисковый запрос: `index=windowslogs |  table _time EventID Hostname SourceName | sort Hostname`


### reverse
Объяснение
Обратная команда просто меняет порядок событий на обратный.
Синтаксис
`| reverse`
Пример
`<Search Query> | reverse    `                                                                                                                          
Поисковый запрос:`index=windowslogs | table _time EventID Hostname SourceName | reverse`


### Ответьте на вопросы ниже
Использование команды Reverse с поисковым запросом `index=windowslogs | table _time EventID Hostname SourceName` — 
какое HostName окажется наверху? 
```commandline
James.browne
```
Какой последний EventID возвращается при обновлении запроса в вопросе 1 с помощью команды tail ?
```commandline
4103
```
Отсортируйте приведенный выше запрос по SourceName. Какое верхнее SourceName возвращено?
```commandline
Microsoft-Windows-Directory-Services-SAM
```

## Задание 7
Трансформационные команды — это те команды, которые преобразуют результат в структуру данных из пар поле-значение. 
Эти команды просто преобразуют определенные значения для каждого события в числовые значения, которые можно легко 
использовать для статистических целей или превратить результаты в визуализации. Поиски, которые используют эти 
трансформирующие команды, называются трансформирующими поисками. Некоторые из наиболее используемых трансформирующих 
команд описаны ниже.

### Общие трансформационные команды

#### top
Эта команда возвращает частые значения для 10 основных событий.
Синтаксис
`| top <имя_поля>`
`| top limit=6 <имя_поля>`
Пример
`top limit=3 EventID`
Следующая команда отобразит первые 7 захваченных изображений (представляющих процессы).
Поисковый запрос: `index=windowslogs | top limit=7 Image`

#### rare
Эта команда делает противоположное команде top, поскольку возвращает наименее часто встречающиеся значения или 10 последних результатов.
Синтаксис
`| rare <имя_поля>`
`| rare limit=6 <имя_поля>`
Пример
`rare limit=3 EventID`
Следующая команда отобразит 7 редких захваченных изображений (процессов).
Поисковый запрос: `index=windowslogs | rare limit=7 Image`


#### highlight
Команда выделения показывает результаты в режиме необработанных событий с выделенными полями.
Синтаксис
`highlight <имя_поля1> <имя_поля2>`
Пример
`highlight User, host, EventID, Image`
Следующая команда выделит три упомянутых поля в необработанных журналах.
Поисковый запрос: `index=windowslogs | highlight User, host, EventID, Image`

Это очень важные типы команд преобразования, которые используются для представления данных в виде таблицы или визуализации. Большинство команд диаграмм используют различные команды статистики.

#### chart
Команда «Диаграмма» используется для преобразования данных в таблицы или визуализации.
Синтаксис
| диаграмма <функция>
Пример
`|chart count by User`

Поисковый запрос:`index=windowslogs | chart count by User`



#### timechart
Команда timechart возвращает диаграмму временного ряда, охватывающую поле, следующее за указанной функцией. Часто сочетается с командами STATS.
Синтаксис
| функция временной диаграммы <имя_поля>
Пример
`|timechart count by Image`

Следующий запрос отобразит диаграмму изображений на основе времени.

Поисковый запрос: `index=windowslogs | timechart count by Image`



### Ответьте на вопросы ниже
Перечислите 8 основных процессов образа с помощью команды top. Каково общее количество 6-го образа?
```commandline
196
```
Используя команду rare, определите пользователя с наименьшим количеством зафиксированных действий?
```commandline
James
```
Создайте круговую диаграмму с помощью команды chart — каково количество для процесса conhost.exe?
```commandline
70
```

## Задание 8
На этом мы завершаем комнату Splunk SPL .

Мы рассмотрели различные функции и команды, используемые вместе для формирования поисковых запросов для более 
эффективного поиска данных. Чтобы попрактиковаться, посмотрите следующие комнаты и задачи Splunk.

Обработка инцидентов с помощью Splunk
Расследование с помощью Splunk
Доброкачественный
PS Затмение

#### Ответьте на вопросы ниже
Завершите эту комнату.
```commandline
Ответ не нужен
```
[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)