[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Red Team OPSEC](https://tryhackme.com/r/room/opsec) 

Всего 8 заданий:
## Задание 1
Operations Security (OPSEC) — термин, введенный военными США. В области кибербезопасности начнем с определения, 
предоставленного NIST:

«Систематический и проверенный процесс, посредством которого потенциальным противникам может быть отказано в 
информации о возможностях и намерениях путем выявления, контроля и защиты, как правило, несекретных доказательств 
планирования и выполнения конфиденциальных мероприятий. Процесс включает пять шагов: выявление критически важной 
информации, анализ угроз, анализ уязвимостей, оценка рисков и применение соответствующих контрмер».

Давайте углубимся в определение с точки зрения красной команды. Как член красной команды, ваши потенциальные 
противники — это синяя команда и третьи лица. Синяя команда считается противником, поскольку мы атакуем системы, 
которые они наняты для мониторинга и защиты. Учения «красная против синей команды» являются обычным делом, чтобы 
помочь организации понять, какие угрозы существуют в данной среде, и лучше подготовить свою синюю команду, если 
произойдет реальная вредоносная атака. Как члены красной команды, даже если мы соблюдаем закон и уполномочены 
атаковать системы в определенных пределах, это не меняет того факта, что мы действуем против целей синей команды и 
пытаемся обойти их средства безопасности. Синяя команда хочет защитить свои системы, в то время как мы хотим 
проникнуть в них.

Лишение любого потенциального противника возможности собирать информацию о наших возможностях и намерениях имеет 
решающее значение для поддержания OPSEC . OPSEC — это процесс идентификации , контроля и защиты любой информации, 
связанной с планированием и выполнением наших действий. Такие фреймворки, как Cyber Kill Chain компании Lockheed 
Martin  и  MITRE ATT&CK,  помогают защитникам определить цели, которых пытается достичь противник. MITRE ATT&CK, 
возможно, находится на переднем крае отчетности и классификации тактик, методов и процедур противника (TTP) и 
предлагает общедоступную базу знаний в качестве общедоступной разведки угроз и отчетов об инцидентах в качестве 
своего основного источника данных.



Процесс OPSEC состоит из пяти этапов:
- Определите критическую информацию
- Анализ угроз
- Анализ уязвимостей
- Оценить риски
- Применить соответствующие контрмеры


Если противник обнаружит, что вы сканируете его сеть с помощью Nmap (синяя команда в нашем случае), он должен легко обнаружить используемый IP-адрес. Например, если вы используете этот же IP-адрес для размещения фишингового сайта, синей команде не составит большого труда связать два события и приписать их одному и тому же субъекту.

OPSEC — это не решение или набор правил; OPSEC — это пятишаговый процесс, призванный не допустить злоумышленников к доступу к любой критической информации (определенной в Задаче 2). Мы рассмотрим каждый шаг и посмотрим, как мы можем улучшить OPSEC в рамках наших операций Red Team.

### Ответьте на вопросы ниже
Постарайтесь запомнить пять шагов процесса OPSEC, поскольку мы объясним каждый из них в отдельном задании.

```commandline
Ответ не нужен
```

## Задание 2
То, что красная команда считает критически важной информацией, заслуживающей защиты, зависит от операции и 
используемых активов или инструментов. В этой обстановке критически важная информация включает в себя, помимо 
прочего, намерения, возможности, действия и ограничения красной команды. Критическая информация включает в себя 
любую информацию, которая, будучи полученной синей командой, может помешать или ухудшить миссию красной команды.



Чтобы определить критически важную информацию, красной команде необходимо использовать состязательный подход и 
спросить себя, какую информацию противник, в данном случае синяя команда, хотел бы знать о миссии. Если она будет 
получена, противник будет в прочном положении, чтобы помешать атакам красной команды. Таким образом, критически 
важная информация не обязательно является конфиденциальной информацией; однако это любая информация, которая может 
поставить под угрозу ваши планы, если попадет к противнику. Ниже приведены некоторые примеры:
- Информация о клиенте, которую узнала ваша команда. Неприемлемо делиться информацией о клиенте, такой как имена сотрудников, роли и инфраструктура, которую обнаружила ваша команда. Обмен такого рода информацией должен осуществляться на основе принципа служебной необходимости, поскольку это может поставить под угрозу целостность операции. Принцип наименьших привилегий (PoLP) гласит, что любой субъект (пользователь или процесс) должен иметь доступ только к той информации, которая необходима для выполнения его задачи. PoLP должен применяться на каждом этапе, предпринимаемом Red Team.
- Информация о красной команде, например, личности, действия, планы, возможности и ограничения. Противник может 
  использовать такую информацию, чтобы лучше подготовиться к отражению ваших атак.
- Тактика, приемы и процедуры ( TTP ), которые ваша команда использует для имитации атаки.
- ОС, провайдер облачного хостинга или фреймворк C2, используемый вашей командой. Предположим, что ваша команда 
  использует Pentoo для тестирования на проникновение, и защитник знает об этом. Следовательно, они могут следить за журналами, раскрывающими ОС как Pentoo. В зависимости от цели, есть вероятность, что другие злоумышленники также используют Pentoo для запуска своих атак; однако нет причин раскрывать вашу ОС , если вам это не нужно.
- Публичные IP-адреса, которые будет использовать ваша красная команда. Если синяя команда получит доступ к такого 
  рода информации, она может быстро смягчить атаку, заблокировав весь входящий и исходящий трафик на ваши IP-адреса, оставив вас разбираться, что произошло.
- Доменные имена, зарегистрированные вашей командой. Доменные имена играют важную роль в таких атаках, как фишинг. 
  Аналогично, если синяя команда вычислит доменные имена, которые вы будете использовать для запуска своих атак, они могут просто заблокировать или запереть ваши вредоносные домены, чтобы нейтрализовать вашу атаку.
- Размещенные веб-сайты, например фишинговые, для эмуляции злоумышленников.
### Ответьте на вопросы ниже
Нажмите «Просмотр сайта» и продолжайте, пока не получите флаг.

(Обратите внимание, что некоторые расширения браузера, такие как NoScript, могут помешать правильной загрузке сайта.)
```commandline
THM{OPSEC_CRITICAL_INFO}
```

## Задание 3
После того, как мы идентифицируем критическую информацию, нам нужно проанализировать угрозы. Анализ угроз относится 
к выявлению потенциальных противников, их намерений и возможностей . Адаптированный из Руководства по программе 
безопасности операций ( OPSEC ) Министерства обороны США , анализ угроз направлен на то, чтобы ответить на следующие 
вопросы:

- Кто противник?
- Каковы цели противника?
- Какую тактику, приемы и процедуры использует противник?
- Какую критическую информацию получил противник, если таковая имеется?


Задача красной команды — имитировать реальную атаку, чтобы синяя команда обнаружила свои недостатки, если таковые 
имеются, и стала лучше подготовленной к встрече с входящими угрозами. Основная цель синей команды — обеспечить 
безопасность сети и систем организации. Намерения синей команды ясны: они хотят не допустить красную команду в свою 
сеть. Следовательно, учитывая задачу красной команды, синяя команда считается нашим противником, поскольку у каждой 
команды есть противоречивые цели. Следует отметить, что возможности синей команды не всегда могут быть известны в 
начале.

Вредоносные сторонние игроки могут иметь разные намерения и возможности и в результате могут приостановить угрозу. 
Эта сторона может быть кем-то со скромными возможностями, сканирующим системы случайным образом в поисках легких 
путей, таких как неисправленный эксплуатируемый сервер, или это может быть способный противник, нацеленный на вашу 
компанию или ваши клиентские системы. Следовательно, намерения и возможности этой третьей стороны могут сделать ее 
также противником. 

Мы рассматриваем как угрозу любого противника, имеющего намерение и возможность предпринять действия, которые могут 
помешать нам завершить нашу операцию:

`threat = adversary + intent + capability`
Другими словами, противник, не имеющий намерений или возможностей, не представляет угрозы для наших целей.

### Ответьте на вопросы ниже
Попробуйте вспомнить хотя бы одного противника, который не представляет угрозы, и одного, который представляет угрозу.
```commandline
Ответ не нужен
```

## Задание 4
После определения критической информации и анализа угроз мы можем приступить к третьему шагу: анализу уязвимостей. Это не следует путать с уязвимостями, связанными с кибербезопасностью. Уязвимость OPSEC существует, когда противник может получить критическую информацию, проанализировать результаты и действовать таким образом, что это повлияет на ваши планы.



Чтобы лучше понять уязвимость OPSEC, связанную с red teaming, рассмотрим следующий сценарий. Вы используете Nmap для обнаружения активных хостов в целевой подсети и находите открытые порты на активных хостах. Более того, вы отправляете различные фишинговые письма, направляющие жертву на фишинговую веб-страницу, которую вы размещаете. Кроме того, вы используете фреймворк Metasploit, чтобы попытаться использовать определенные уязвимости программного обеспечения. Это три отдельных действия; однако, если вы используете один и тот же IP-адрес(а) для выполнения этих различных действий, это приведет к уязвимости OPSEC . Как только будет обнаружена какая-либо враждебная/вредоносная активность, ожидается, что синяя команда предпримет действия, такие как временная или постоянная блокировка исходного IP-адреса(ов). Следовательно, для того, чтобы все другие действия, использующие этот IP-адрес, потерпели неудачу, потребуется заблокировать один исходный IP-адрес. Другими словами, это заблокирует доступ к целевому IP-адресу, используемому для фишингового сервера, и исходному IP-адресу, используемому Nmap и Metasploit Framework.

Другим примером уязвимости OPSEC может быть незащищенная база данных, которая используется для хранения данных, полученных от жертв фишинга. Если база данных не защищена должным образом, это может привести к тому, что вредоносная третья сторона скомпрометирует операцию, и данные могут быть извлечены и использованы в атаке на сеть вашего клиента. В результате, вместо того, чтобы помочь вашему клиенту защитить его сеть, вы в конечном итоге поможете раскрыть имена входа и пароли.

Слабый OPSEC также может привести к менее сложным уязвимостям. Например, рассмотрим случай, когда один из членов вашей красной команды публикует в социальных сетях имя вашего клиента. Если синяя команда отслеживает такую ​​информацию, это побудит их узнать больше о вашей команде и ваших подходах, чтобы лучше подготовиться к ожидаемым попыткам проникновения.

### Ответьте на вопросы ниже
Ваша красная команда использует THC-Hydra для поиска пароля для определенной страницы входа. Более того, они используют фреймворк Metasploit на той же системе, что и THC-Hydra. Считаете ли вы это уязвимостью OPSEC? (Y/N)
Y
```commandline
Ответ не нужен
```
Один из членов красной команды каждый день публикует фото своего кота. Будет ли это считаться уязвимостью OPSEC? (Y/N)

N
```commandline
Ответ не нужен
```
Ваша красная команда пошла на ужин, сделала фото и отметила каждого члена команды на популярной платформе социальных сетей. Вы считаете это уязвимостью OPSEC? (Y/N)

Y
```commandline
Ответ не нужен
```
Ваша красная команда публикует на своем сайте список клиентов, с которыми вы регулярно проводите учения красной команды. Вы считаете это уязвимостью OPSEC? (Y/N)

Y
```commandline
Ответ не нужен
```
Один из членов вашей красной команды опубликовал фотографию своего утреннего кофе. Вы считаете это уязвимостью OPSEC? (Y/N)

N
```commandline
Ответ не нужен
```

## Задание 5
Мы закончили анализ уязвимостей, и теперь мы можем перейти к четвертому шагу: проведению оценки риска. NIST определяет оценку риска как «Процесс выявления рисков для организационных операций (включая миссию, функции, имидж, репутацию), организационных активов, отдельных лиц, других организаций и страны, возникающих в результате работы информационной системы». В OPSEC оценка риска требует изучения возможности события, а также ожидаемой стоимости этого события. Следовательно, это включает оценку способности противника использовать уязвимости.



После определения уровня риска можно рассмотреть контрмеры для его снижения. Нам необходимо рассмотреть следующие три фактора:
- Эффективность контрмеры в снижении риска
- Стоимость контрмеры по сравнению с воздействием эксплуатируемой уязвимости.
- Вероятность того, что контрмера может раскрыть информацию противнику
Давайте вернемся к двум примерам из предыдущей задачи. В первом примере мы рассмотрели уязвимость сканирования сети 
  с помощью Nmap, использования фреймворка Metasploit и размещения фишинговых страниц с использованием одного и того 
  же публичного IP-адреса. Мы проанализировали, что это уязвимость, поскольку она упрощает для злоумышленника 
  блокировку наших трех действий, просто обнаружив одно действие. Теперь давайте оценим этот риск. Чтобы оценить 
  риск, связанный с этой уязвимостью, нам нужно узнать возможность обнаружения одного или нескольких из этих 
  действий. Мы не можем ответить на этот вопрос, не получив некоторую информацию о возможностях злоумышленника. 
  Давайте рассмотрим случай, когда у клиента есть система управления информацией и событиями безопасности ( SIEM ). 
  SIEM — это система, которая позволяет в режиме реального времени отслеживать и анализировать события, связанные с 
  безопасностью, из разных источников по всей сети. Мы можем ожидать, что SIEM позволит достаточно просто обнаружить 
  подозрительную активность и связать три события. В результате мы оцениваем связанный риск как высокий. С другой 
  стороны, если мы знаем, что у злоумышленника минимальные ресурсы для обнаружения событий безопасности, мы можем 
  оценить риск, связанный с этой уязвимостью, как низкий.

Давайте рассмотрим второй пример незащищенной базы данных, используемой для хранения данных, полученных с фишинговой страницы. Основываясь на данных, собранных несколькими исследовательскими группами, использующими honeypots, мы можем ожидать, что различные вредоносные боты будут активно атаковать случайные IP-адреса в Интернете. Поэтому это лишь вопрос времени, когда система со слабой безопасностью будет обнаружена и использована.

### Ответьте на вопросы ниже
Ваша красная команда использует THC-Hydra для поиска пароля для определенной страницы входа. Более того, они используют фреймворк Metasploit на той же системе, что и THC-Hydra. Зная, что ваша цель использует правильно настроенную систему обнаружения вторжений (IDS), считаете ли вы эту уязвимость высокорисковой? (Y/N)

```commandline
Y
```
## Задание 6
Последний шаг — применение контрмер. В руководстве по программе безопасности операций ( OPSEC ) Министерства обороны США говорится: «Контрмеры предназначены для того, чтобы помешать противнику обнаружить критически важную информацию, предоставить альтернативную интерпретацию критически важной информации или индикаторов (обман) или воспрепятствовать системе сбора данных противника».



Давайте вернемся к двум примерам, представленным в задаче анализа уязвимостей. В первом примере мы рассмотрели уязвимость запуска Nmap , использования фреймворка Metasploit и размещения фишинговых страниц с использованием одного и того же публичного IP-адреса. Контрмера для этого кажется очевидной: используйте разные IP-адреса для каждого действия. Таким образом, вы можете гарантировать, что если одно действие было обнаружено, публичный IP-адрес будет заблокирован, а другие действия могут продолжаться без изменений.

Во втором примере мы рассмотрели уязвимость незащищенной базы данных, используемой для хранения данных, полученных с фишинговой страницы. С точки зрения оценки риска мы посчитали ее высокорисковой из-за потенциального поиска третьими лицами случайных легких целей. Контрмера в этом случае будет заключаться в обеспечении адекватной защиты базы данных, чтобы к данным мог получить доступ только уполномоченный персонал.

### Ответьте на вопросы ниже
Это завершает пятый элемент в процессе OPSEC. Давайте подготовимся, прежде чем применять все пять элементов к другим случаям критической информации.
```commandline
Ответ не нужен
```

## Задание 7
В этой задаче мы применяем пять элементов процесса OPSEC , поскольку мы фокусируемся на различных примерах критической информации, связанной с задачами красной команды. Мы выполним следующие шаги:

1. Определите критическую информацию
2. Анализ угроз
3. Анализ уязвимостей
4. Оценить риск
5. Применить соответствующие контрмеры
#### Программы/ ОС / ВМ , используемые красной командой
- Важная информация: мы говорим о программах, операционной системе ( ОС ) и виртуальной машине ( ВМ ) одновременно.
- Анализ угроз: Синяя команда ищет любую вредоносную или аномальную активность в сети. В зависимости от сервиса, к 
  которому мы подключаемся, возможно, что имя и версия используемой нами программы, а также версия ОС и имя хоста виртуальной машины могут быть зарегистрированы.
- Анализ уязвимости: Если ОС , выбранная для данной активности, слишком уникальна, это может облегчить связывание 
  активности с вашей операцией. То же самое относится к виртуальным машинам с именами хостов, которые выделяются. Например, в сети физических ноутбуков и настольных компьютеров, если новый хост присоединяется с именем хоста kali2021vm, его должно быть легко обнаружить синей командой. Аналогично, если вы используете различные сканеры безопасности или, например, не используете общий пользовательский агент для веб-активностей.
- Оценка риска: Риск в основном зависит от того, к каким сервисам мы подключаемся. Например, если мы запускаем VPN- 
  подключение, VPN- сервер будет регистрировать множество информации о нас. То же самое относится и к другим сервисам, к которым мы можем подключаться.
- Контрмеры: Если используемая нами ОС необычна, стоит приложить усилия и внести необходимые изменения, чтобы 
  замаскировать нашу ОС под другую. Для виртуальных машин и физических хостов стоит изменить имена хостов на что-то незаметное или соответствующее соглашению об именовании клиента, поскольку вы не хотите, чтобы имя хоста AttackBoxпоявлялось в журналах DHCP- сервера. Что касается программ и инструментов, стоит изучить сигнатуры, которые каждый инструмент оставляет в журналах сервера.

>Пример: На рисунке ниже показан User-Agent, который будет зарегистрирован удаленным веб-сервером при запуске 
> сканирования Nmap-sC с опцией, когда Nmap проверяет веб-сервер. Если HTTP-агент пользователя не установлен во 
> время запуска данного скрипта Nmap , журналы на целевой системе могут зарегистрировать пользовательский агент, 
> содержащий Nmap Scripting Engine. Это можно смягчить с помощью опции --script-args http.useragent="CUSTOM_AGENT".



### Ответьте на вопросы ниже
Нажмите «Просмотр сайта» и продолжайте, пока не получите флаг.
(Обратите внимание, что некоторые расширения браузера, такие как NoScript, могут помешать правильной загрузке сайта.)

```commandline
THM{OPSEC-RED-TEAM}
```

## Задание 8
В этой комнате мы рассмотрели, как процесс OPSEC может быть применен к операциям Red Team. Процесс OPSEC состоит из 
пяти элементов:
- Определите критическую информацию: «Критическая информация включает в себя, помимо прочего, намерения, возможности, действия и ограничения красной команды».
- Анализ угроз: Анализ угроз подразумевает выявление потенциальных противников, их намерений и возможностей.
- Анализ уязвимостей: уязвимость OPSEC возникает, когда злоумышленник может получить критически важную информацию, 
  проанализировать полученные данные и действовать таким образом, что это повлияет на ваши планы.
- Оцените риски: «Оценка риска требует изучения возможности наступления события, а также ожидаемых затрат на это 
  событие».
- Применяйте соответствующие контрмеры: контрмеры призваны помешать злоумышленнику обнаружить критически важную 
  информацию, предоставить альтернативную интерпретацию критически важной информации или индикаторов (обман) или воспрепятствовать работе системы сбора информации злоумышленника.

**OPSEC** — это процесс, который можно применять и за пределами армии. В этой комнате рассказывалось о том, как он применяется к операциям Red Team; кроме того, его несложно применять и в других областях, например, в маркетинге или промышленности. Этот процесс поможет помешать противнику собрать все воедино, тем самым не дав ему предпринять своевременные действия.

### Ответьте на вопросы ниже
Запомните пять элементов процесса OPSEC и научитесь применять их к различным аспектам вашей работы по обеспечению кибербезопасности.
```commandline
Ответ не нужен
```
[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)