[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Baron Samedit](https://tryhackme.com/r/room/sudovulnssamedit) 

Всего 2 задания:
## Задание 1
Нажмите зеленую кнопку «Развернуть», чтобы запустить экземпляр машины!

После загрузки к этой машине можно будет получить доступ в окне браузера в верхней части экрана. Если вы 
предпочитаете получить доступ к коробке вручную, то вы можете подключиться к ней через сеть TryHackMe, используя 
AttackBox или ваш файл конфигурации OpenVPN. Если вы не знаете, как это сделать, сначала быстро загляните в  комнату 
OpenVPN.   

(Обратите внимание, что полная загрузка виртуальных машин может занять несколько минут)

Автором заглавного изображения является замечательный @Vargnaar

### Ответить на вопросы ниже
Развернуто!
```commandline
Ответ не нужен
```

## Задание 2
В январе 2021 года компания Qualys опубликовала в блоге сообщение, в котором подробно описала ужасающую новую 
уязвимость в программе sudo в Unix.

В частности, это было переполнение буфера кучи, позволяющее любому пользователю повысить привилегии до root — не 
требуется никаких неправильных настроек. Этот эксплойт работает с настройками по умолчанию для любого пользователя, 
независимо от разрешений sudo, что делает его еще страшнее. Уязвимость была исправлена, но влияет на любую 
неисправленную версию программы sudo от 1.8.2-1.8.31p2 и 1.9.0-1.9.5p1, что означает, что она существует уже десять 
лет.

Программа была очень быстро исправлена (исправленные версии вскоре появились в репозиториях), поэтому этот эксплойт 
больше не будет работать на современных устройствах; однако он по-прежнему невероятно эффективен. 

Как и в случае с CVE-2019-18634 (которую мы видели во второй комнате sudovulns), эта уязвимость представляет собой 
переполнение буфера в программе sudo; однако на этот раз уязвимость представляет собой переполнение буфера кучи, в 
отличие от переполнения буфера стека, которое мы видели ранее. Стек — это строго регламентированный раздел памяти, 
в котором хранятся различные важные аспекты программы. С другой стороны, куча зарезервирована для динамического 
выделения памяти, что обеспечивает большую гибкость в том, как значения и конструкции создаются и используются 
программой. Как и в предыдущей комнате, мы не будем вдаваться в подробности того, как это работает, чтобы сделать 
контент понятным для новичков. Все, что нам действительно нужно понять, — это то, что эта уязвимость невероятно 
мощная и чрезвычайно широко распространенная.

Итак, для начала, что мы можем сделать, чтобы проверить систему на уязвимость?

К счастью, есть очень простой способ проверить это: просто введите эту команду в терминал:
```commandline
sudoedit -s '\' $(python3 -c 'print("A"*1000)')
```

Если система уязвима, то это приведет к перезаписи буфера кучи и аварийному завершению работы программы:

Этот PoC был получен от исследователя под ником lockedbyte, здесь.

Когда рекомендация впервые вышла, Qualys не предоставила полный код для эксплойта. Другим исследователям не 
потребовалось много времени, чтобы воспроизвести уязвимость; однако. Первая рабочая копия эксплойта, которая будет 
опубликована, была создана исследователем, известным как bl4sty. Их полный код эксплойта можно найти на Github, 
здесь. Это то, что мы будем использовать для эксплуатации машины, которую вы развернули в первой задаче.

Эта машина была настроена для легкой эксплуатации уязвимости. Таким образом, репозиторий Github, ссылка на который 
приведена выше, уже добавлен в цель.

В домашнем каталоге вы увидите папку под названием «Exploit»:





Войдите в этот каталог (cd Exploit) -- вы увидите файл с именем "Makefile". Это означает, что мы можем 
автоматически скомпилировать эксплойт, просто набрав "make" и нажав Enter: 




Проверив содержимое каталога еще раз, видим, что появился новый исполняемый файл:


При запуске этого файла нам будет предложено несколько вариантов:


Примечание: имя исполняемого файла здесь изменено, поскольку это ответ на вопрос 1.

В настоящее время есть три цели, против которых будет работать этот эксплойт. Машина, которую мы развернули, — это 
сервер Ubuntu 18.04.5, поэтому мы будем использовать цель 0.

При выполнении с указанием цели в качестве параметра мы получаем root-оболочку!

### Теперь твоя очередь!

Используйте машину в своем браузере или войдите через SSH, используя следующие учетные данные:

- Имя пользователя:tryhackme
- Пароль:tryhackme


Команда будет следующей:
```commandline
ssh tryhackme@MACHINE_IP
```

Примечание: если указанная выше команда не отображает IP-адрес, значит, вы не загрузили машину или не дали ей 
времени на загрузку. 
Следуйте инструкциям выше, чтобы получить root-доступ к цели!

### Ответить на вопросы ниже
Каково имя исполняемого файла, созданного после компиляции эксплойта (размыто на скриншотах выше)?
```commandline
sudo-hax-me-a-sandwich
```
Запустите эксплойт!
Теперь у вас должна быть оболочка root — какой флаг в ней /root/flag.txt?
```commandline
THM{NmU4OWYwMWJmMjkxMDdiYTU4MWIxNWVk}
```



[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)