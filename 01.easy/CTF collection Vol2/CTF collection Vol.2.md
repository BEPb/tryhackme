[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [CTF collection Vol.2](https://tryhackme.com/r/room/ctfcollectionvol2) 

Всего 2 задания:
## Задание 1
Добро пожаловать, добро пожаловать и добро пожаловать в очередную коллекцию CTF. Это вторая часть серии коллекций 
CTF. К вашему сведению, вторая серьезная часть фокусируется на веб-испытании. Всего в коробке можно найти 20 
пасхальных яиц, также известных как флаги. Давайте посмотрим, насколько хороши ваши навыки CTF.

Теперь запустите машину и соберите яйца!

Предупреждение: в задании есть изображения припадков и фон. Если вы чувствуете себя некомфортно, попробуйте удалить 
фон в теге <style>. 

Примечание: все флаги задач имеют формат, если не указано иное - `THM{flag}`

### Ответьте на вопросы ниже
Факт: Яйца содержат белок самого высокого качества, который вы можете купить.
```commandline
Ответ не нужен
```

## Задание 2
Отправьте все ваши пасхальные яйца прямо сюда. Найду все!

### Ответьте на вопросы ниже
#### Пасха 1
Давайте добавим IP-адрес цели в /etc/hosts и свяжем его с выбранным нами именем хоста « ctfvol2.thm ». Мы будем 
использовать его для обозначения целевой машины на протяжении всей статьи. 
```commandline
echo  "10.10.53.15 ctfvol2.thm" >> /etc/hosts
```
Далее нам необходимо выполнить стандартный перебор веб-каталогов ( брут-форс ), чтобы обнаружить интересующие нас веб-каталоги.

```commandline
$ gobuster dir -u http://ctfvol2.thm -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 

===============================================================
[+] Url:            http://ctfvol2.thm
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2024/04/04 12:06:33 Starting gobuster
===============================================================
/index (Status: 200)
/login (Status: 301)
/button (Status: 200)
/static (Status: 200)
/cat (Status: 200)
/small (Status: 200)
/who (Status: 200)
/robots (Status: 200)
/iphone (Status: 200)
/game1 (Status: 301)
/egg (Status: 200)
/dinner (Status: 200)
/ty (Status: 200)
/ready (Status: 301)
/saw (Status: 200)
/game2 (Status: 301)
/wel (Status: 200)
/free_sub (Status: 301)
/nicole (Status: 200)
/server-status (Status: 403)
===============================================================
2024/04/04 12:07:26 Finished
===============================================================
```
Довольно много интересных веб-папок. Давайте пока отложим это и вернемся к ним позже. Сейчас давайте начнем с robots.
txt веб-сайта. 

просмотрим http://ctfvol2.thm/robots.txt
```commandline
curl http://ctfvol2.thm/robots.txt
```
Получаем следующее закодированное сообщение:

```commandline
User-agent: * (I don't think this is entirely true, DesKel just wanna to play himself)
Disallow: /VlNCcElFSWdTQ0JKSUVZZ1dTQm5JR1VnYVNCQ0lGUWdTU0JFSUVrZ1p5QldJR2tnUWlCNklFa2dSaUJuSUdjZ1RTQjVJRUlnVHlCSklFY2dkeUJuSUZjZ1V5QkJJSG9nU1NCRklHOGdaeUJpSUVNZ1FpQnJJRWtnUlNCWklHY2dUeUJUSUVJZ2NDQkpJRVlnYXlCbklGY2dReUJDSUU4Z1NTQkhJSGNnUFElM0QlM0Q=


45 61 73 74 65 72 20 31 3a 20 54 48 4d 7b 34 75 37 30 62 30 37 5f 72 30 6c 6c 5f 30 75 37 7d
```

Вы ведь не думали, что сдержать флаг будет так просто, да? :)

Есть два закодированных сообщения. Начнем с нижнего сообщения:

`45 61 73 74 65 72 20 31 3а 20 54 48 4г 7б 34 75 37 30 62 30 37 5f 72 30 6c 6c 5f 30 75 37 7d`

Это Hex-кодирование. Мы воспользуемся рецептом CyberChef « From Hex » для декодирования:

Использование CyberChef для декодирования шестнадцатеричной строки в ASCII
Пасхальное яйцо 1: декодирование из Hex в ASCII
Бинго! Первая кровь :)
```commandline
THM{4u70b07_r0ll_0u7}
```

#### Пасха 2

Подсказка : декодируйте base64 несколько раз. Не забывайте, что что-то кодируется.
Продолжая работу с файлом robots.txt, давайте рассмотрим первое сообщение.

VlNCcElFSWdTQ0JKSUVZZ1dTQm5JR1VnYVNCQ0lGUWdTU0JFSUVrZ1p5QldJR2tnUWlCNklFa2dSaUJuSUdjZ1RTQjVJRUlnVHlCSklFY2dkeUJuSUZjZ1V5QkJJSG9nU1NCRklHOGdaeUJpSUVNZ1FpQnJJRWtnUlNCWklHY2dUeUJUSUVJZ2NDQkpJRVlnYXlCbklGY2dReUJDSUU4Z1NTQkhJSGNnUFElM0QlM0Q= 

Простой переход к « /VlNCcElFSWdTQ0JKSUVZZ …..» не загрузит скрытую страницу. Сначала нам придется ее декодировать. 
Вы, возможно, догадались, что это текст, закодированный в Base64. 

Первый раунд декодирования, похоже, дал еще один Base64. После нескольких раундов декодирования Base64 мы наконец 
получили декодированный текст. 

Декодирование base64 с помощью CyberChef
Пасхальное яйцо 2: декодирование base64 с помощью CyberChef
Декодировать из Base64:
DesKel_***************

Теперь, когда мы знаем имя скрытой папки, мы можем перейти к ней:

URL-адрес : http://ctfvol2.thm/DesKel_secret_base

Переход в скрытый веб-каталог
Ну, THM нас сейчас реально дразнит. На странице не видно ни одного флага.
Проверяем исходный код страницы. Бинго!
```commandline
THM{f4ll3n_b453}
```
#### Пасха 3
В данном случае это простой процесс запуска инструмента для взлома веб-каталогов GoBuster с предлагаемым словарем « common.txt ».
```commandline
gobuster dir -u http://ctfvol2.thm -w /usr/share/wordlists/dirb/common.txt
```
- /button : загружается только button.gif . Сохранено для последующего просмотра
- /cat : загружается только cat.gif . Сохранено для последующего просмотра
- /cgi-bin : ошибка. Нам нужно вызвать определенный скрипт. Давайте проигнорируем пока
- /iphone : содержит изображение iphone.jpeg. Сохранено для последующего просмотра
- /login : форма входа без регистрации. Выглядит очень интересно!
- /smal : small.png содержит пасхальное яйцо 19. Давайте сохраним его пока
- /static : загружает только изображение static.gif . Сохранено для последующего просмотра
- /who : содержит изображение who.gif . Сохранено для последующего просмотра

Учитывая, что намек не предполагал никакой стеганографии, я не сосредоточил свои усилия на анализе найденных 
изображений. Мы также уже исследовали главную страницу индекса и файл robots.txt. 

Мы можем спокойно игнорировать некоторые папки, такие как server-status. Это оставляет нас с /login как интересным 
исключением. Поэтому мы сосредоточились на этой форме. 
Сначала мы проверяем исходный код, чтобы найти какие-либо подсказки или комментарии. Это хорошее место, чтобы начать 
понимать код, стоящий за форумом входа. И вот, мы нашли наш флаг, спрятанный в исходном коде страницы.
```commandline
THM{y0u_c4n'7_533_m3}
```
#### Пасха 4


Для этого задания требуется поле ввода, скорее всего, форма входа, поле поиска или что-то подобное. Подсказка: 
посмотрите на результаты GoBuster из предыдущего задания, Easter Egg 3! Действительно, форма входа по адресу /login 
— наша цель.  

Самый быстрый способ получить этот флаг — использовать автоматизированный инструмент SQLi, такой как SQLmap , 
инструмент тестирования на проникновение с открытым исходным кодом для автоматизации SQL-инъекций и эксплуатации. 

Сначала нам нужно перехватить POST-запрос к форме входа и «скопировать» его в файл, например request.txt, с помощью 
вашего браузера или прокси-инструмента, такого как Burp. 

Следующие команды помогли мне перечислить базу данных:
```commandline
sqlmap -r request.txt --dbs --level 3 --risk 3 
sqlmap -r request.txt --level 3 --risk 3 -D THM_f0und_m3 --tables 
sqlmap -r request.txt --level 3 --risk 3 -D THM_f0und_m3 -T nothing_inside --columns 
sqlmap -r request.txt --level 3 --risk 3 -D THM_f0und_m3 -T nothing_inside --dump-all
```

```commandline
THM{1nj3c7_l1k3_4_b055} 
```
#### Пасха 5
Это пасхальное яйцо продолжает сеанс SQLMap, который мы начали ранее во время атаки Easter Egg 4. Если вам нужно 
перезапустить сеанс, см. предыдущую задачу. 

После того, как вы восстановите флаг для пасхального яйца 4, вам будет предложено продолжить атаку, взломав хэши, 
найденные в таблице « user ». Ответьте « Y » на этот вопрос. 

Использование словаря по умолчанию для SQLMap вполне допустимо и даст успешное совпадение с паролем: « cutie ».

Давайте воспользуемся учетными данными, которые мы нашли в MySQL на странице входа.
```commandline
Пользователь : DesKel
Пароль : cutie
```

После успешного входа в систему нас должен поприветствовать флаг!

```commandline
THM{wh47_d1d_17_c057_70_cr4ck_7h3_5ql}
```
#### Пасха 6
Эта задача требует от нас уделять пристальное внимание заголовкам Response . Это задача для нашего верного Burp 
Suite, который, я надеюсь, вы все еще запустили и отслеживаете трафик с веб-сайта на предмет любых интересных 
взаимодействий или потенциальных подсказок флагов.

Давайте снова перейдем на главную страницу и перезагрузим ее.

```commandline
THM{l37'5_p4r7y_h4rd}
```
#### Пасха 7
Задание 7 намекает на использование куки для раскрытия 7-го пасхального яйца. Для этого упражнения мы можем 
использовать Inspector или Burp. 

Нам нужно получить куки, которые содержат флаг. После быстрой проверки с помощью Inspector у меня не было ничего 
значимого или куки. 

Я проверил запрос GET, отправленный на сервер, и он содержал интересный параметр заголовка для « Cookie :»

Отправьте запрос GET на вкладку «Повторитель» для дальнейшей обработки и изменим это значение с « 0 » на « 1 ». Нам 
нравится получать приглашения, и « 1 » для нас выглядит хорошо! 
```commandline
Cookie: Invited=1
```
Давайте отправим этот запрос. Теперь мы должны получить флаг!
```commandline
THM{w3lc0m3!_4nd_w3lc0m3}
```
#### Пасха 8
Подсказка предполагает, что нам следует рассмотреть возможность использования другого User-Agent при просмотре 
веб-сайта, а также предоставляет нам User-Agent, который мы можем попробовать. 

Используя Burp, перехватите GET-запрос к главной странице (или /) и обратите внимание на текущее значение User-Agent.

Теперь давайте заменим его на User-Agent, указанный нам в подсказке.

Mozilla/5.0 (iPhone; ЦП iPhone OS 13_1_2, как Mac OS X) AppleWebKit/605.1.15 (KHTML, как Gecko) Версия/13.0.1 Мобильный/15E148 Safari/604.1

Вуаля! Флаг находится в ответе веб-сервера.

```commandline
THM{h3y_r1ch3r_wh3r3_15_my_k1dn3y}
```
#### Пасха 9
Для этой задачи мы возвращаемся к результатам перечисления веб-каталогов из инструмента GoBuster. Когда мы 
просматривали все найденные каталоги перед началом испытания (recon, recon, recon), мы нашли один каталог под 
названием " /ready”, куда страница перенаправлялась через несколько секунд.  

Это достаточно быстро, чтобы мы не могли поймать его, просматривая исходный код страницы. Однако, если отслеживать 
трафик с помощью инструмента Burp proxy, мы должны быть в состоянии обнаружить флаг в ответе сервера. 

Легко и просто!
```commandline
THM{60nn4_60_f457}
```
#### Пасха 10
Для этой задачи мы нашли соответствующую страницу, систематически просматривая результаты нашего предыдущего 
перечисления веб-каталогов с помощью GoBuster. 

Путь к этому испытанию был найден на /free_sub.

Давайте рассмотрим заголовок запроса и ответ сервера на него.
Как и предлагалось в подсказке, давайте добавим новый параметр заголовка HTTP-запроса с именем « Referer » со 
значением « tryhackme.com ». 
```commandline
Referer: tryhackme.com
```
Бинго! Мы получили флаг за успешную подделку нашего параметра заголовка « Referer ».

```commandline
THM{50rry_dud3}
```
#### Пасха 11
Это было сложно найти, где на этой супер загруженной и шумной странице я мог бы найти векторы атак для « умерения 
HTML ». Давайте сначала определим этот термин. 

Tempering HTML означает изменение или подмену HTML-кода. Это может включать в себя различные действия, такие как 
вставка, удаление или изменение HTML-элементов, атрибутов или контента на веб-странице. 

Теперь, когда мы знаем, что это значит, где мы можем найти возможные цели, которые являются кандидатами для попыток 
смягчения? 

В сценарии CTF мы обычно ищем скрытые элементы, комментарии или метаданные в исходном коде HTML, которые могут дать 
подсказки для потенциальных областей для вмешательства. Поскольку у нас нет никаких подсказок, следующим лучшим 
решением будет сосредоточиться на областях, где отображается или обрабатывается пользовательский ввод или 
динамический контент. Это может включать формы , поля ввода , функции JavaScript , запросы AJAX или любые другие 
интерактивные элементы , где HTML генерируется или обрабатывается на основе действий или ввода пользователя.    

Одним из элементов, соответствующих этому описанию, является раскрывающееся меню «Ужин» .


Давайте перейдем к нашему доверительному Burp и отправим допустимый выбор, например « салат » или « сэндвич с 
курицей », затем нажмем « Взять! » и посмотрим на запрос/ответ для этого. 


Я попытался изменить значение « dinner= » на несколько пунктов, связанных с едой. Хотя мне повезло с третьим выбором,
я хочу продемонстрировать, как бы вы атаковали это, если бы не смогли угадать правильный пункт «еда». 

зайдите на сайт, где вы можете создать собственный «список слов» или словарь блюд, связанных с едой, желательно 
типичных блюд для завтрака или обеда. 

Я использовал следующий веб-сайт. Обратите внимание, что вам придется отформатировать текст, чтобы все элементы были 
аккуратно в текстовом файле, по одному элементу на строку. Список слов о еде.  

Чтобы запустить атаку методом перебора с использованием Burp, мы отправим один запрос на Intruder's Sniper Attack . 
Убедитесь, что вы выбрали значение ужина и «Добавить». 


Загрузите свой список слов, скопировав и вставив его, или загрузив из файла.


Теперь запустите атаку и проанализируйте разницу в ответах. Обратите внимание, что значение « Длина » отличается для 
полезной нагрузки « яйцо » по сравнению с остальными. 


Проверьте ответ, связанный с этим запросом, и вуаля, мы получили наш флаг!
```commandline
THM{366y_b4k3y}
```
#### Пасха 12
Для этой задачи нам нужно убедиться, что мы включили опцию « Скрипт » на вкладках « Цель > Карта сайта » и « Прокси > История HTTP ». 


В HTTP-ответе JavaScript « jquery-9.1.2.js » вы увидите вызываемую функцию ahem(), содержащую шестнадцатеричную 
строку, которую необходимо преобразовать в код ASCII. 


Функция ahem()просто берет шестнадцатеричную строку в качестве входных данных, декодирует ее в символы ASCII и 
возвращает результирующую строку. Вероятно, она используется для выявления скрытого флага, закодированного в 
шестнадцатеричном формате.  

Шестнадцатеричная строка: « 4561737465722031322069732054484d7b68316464336e5f6c337d »

Эту строку можно преобразовать с помощью RapidTables.com (см. ниже):

Или вы можете сделать это красиво в командной строке, используя xxd инструмент.
```commandline
echo  "4561737465722031322069732054484d7b68316464336e5f6c337d" | xxd -r -p 
```

```commandline
THM{h1dd3n_j5_f1l3}
```
#### Пасха 13
Никаких подсказок для этой задачи не было предоставлено, поскольку это был один из самых простых флагов, которые мы 
могли получить. Прокручивая вниз, пока не встретите гигантскую красную кнопку, практически умоляющую о нажатии, вы 
поддадитесь искушению « нажать красную кнопку », в стиле Джорджа Буша, и наблюдать, как мир горит или, по крайней 
мере, поджигает цифровой мир!   

В конце концов, кто бы не поддался соблазну организовать цифровую переделку? Шутка — давайте сохраним мир, ладно?

Нажмите кнопку, поверьте мне, в этот раз это можно сделать безопасно :)

Вас перенаправят на промежуточную страницу под названием «Готово», прежде чем вы попадете на финальную целевую 
страницу, где мир горит. 

Ты еще здесь? Это значит, что мир не сгорел, и ты заслужил свой постапокалиптический флаг!

```commandline
THM{1_c4n'7_b3l13v3_17}
```
#### Пасха 14
Никаких подсказок для этой задачи не было предоставлено, поскольку это был один из самых простых флагов, которые мы 
могли получить. Прокручивая вниз, пока не встретите гигантскую красную кнопку, практически умоляющую о нажатии, вы 
поддадитесь искушению « нажать красную кнопку », в стиле Джорджа Буша, и наблюдать, как мир горит или, по крайней 
мере, поджигает цифровой мир!   

В конце концов, кто бы не поддался соблазну организовать цифровую переделку? Шутка — давайте сохраним мир, ладно?

Нажмите кнопку, поверьте мне, в этот раз это можно сделать безопасно :)

Вас перенаправят на промежуточную страницу под названием «Готово», прежде чем вы попадете на финальную целевую 
страницу, где мир горит. 

```commandline
THM{d1r3c7_3mb3d}
```
#### Пасха 15
Опять же, при проверке всех веб-папок, которые мы нашли в ходе наших предыдущих попыток перечисления веб-каталогов, 
мы нашли эту игру в « /game1». 

Нам предлагается задача, в которой нам нужно угадать, какая буква алфавита представлена числовым значением хэша. Нам 
были даны следующие числа, которые мы должны преобразовать в буквы: `« 51 89 77 93 126 14 93 10 »` 


Сначала я выполнил обычные проверки, такие как преобразование таблицы ASCII, и попытался преобразовать числа в буквы.
Это не сработало, так как числа, похоже, не совпадали. 

Поэтому нам нужно выяснить это с помощью самой игры. Введя букву, вы получите соответствующее ей значение хэша. 
Давайте попробуем несколько значений, таких как «A», «B», «a» и « Z ». 


Кажется, что числа последовательны. Однако, цифры «не сходятся», каламбур!

Например, рассмотрим буквы «N» и «O», где « N » соответствует 58 , а « O » соответствует 126. Это означает, что 
последовательный подсчет, начинающийся с 99, может быть недействительным. 

У нас есть два варианта обнаружения сопоставлений.

- Вариант 1: Ручной подсчет

Этот подход требует от нас вручную ввести все 26 букв алфавита в текстовое поле и сопоставить их с соответствующими 
значениями, которые мы получаем в ответ. Не слишком болезненно и, безусловно, выполнимо. 

После того, как мы построили таблицу с сопоставлениями, мы можем расшифровать числа, которые нам были даны ранее в 
задании ( подсказки: 51 89 77 93 126 14 93 10). 

- Вариант 2: Автоматизация с помощью Linux-fu

Хотя этот метод может поначалу показаться медленнее ручного ввода, требуя времени на создание HTTP-запроса POST и 
разработку скрипта bash для автоматизации, он обеспечивает масштабируемость и возможность повторного использования 
для будущих задач CTF с минимальными корректировками. Это путь Maverick !

Сначала нам нужно захватить запрос с помощью Burp, затем сохранить его и преобразовать в команду curl. Следующий шаг 
— циклически пройти по буквам (AZ) с помощью цикла for и передать их в « answer= ». 

Конечно, вам нужно отредактировать имя хоста/URL целевого сервера. Вы помните, что я сопоставил IP-адрес с «ctfvol2.thm».

```commandline
# Сохраните bash-скрипт как answer.sh и сделайте файл исполняемым:
chmod +x answer.sh
#  Запустите скрипт и расслабьтесь:
./answer.sh 
```

```commandline
A :  99 
B :  100 
C :  101 
D :  102 
E :  103 
F :  104 
G :  51 
H :  52 
I :  53 
J :  54 
K :  55 
L :  56 
M :  57 
N :  58 
O :  126 
P :  127 
Q :  128 
R :  129 
S :  130 
T :  131 
U :  136 
V :  137 
W :  138 
X :  139 
Y :  140 
Z :  141 
a :  89 
b :  90 
c :  91 
d :  92 
e :  93 
f :  94 
g :  95 
h :  41 
i :  42 
j :  43 
k :  75 
л :  76 
м :  77 
н :  78 
о :  79 
п :  80 
кв :  81 
р :  10 
с :  11 
т :  12 
у :  13 
в :  14 
ш :  15 
х :  16 
у :  17 
з :  18
```

Теперь у нас есть правильные сопоставления, и мы, наконец, можем начать расшифровывать числа, предоставленные нам 
задачей. 
```commandline
51 : G
89 : a
77 : m
93 : e
126 : O
14 : v
93 : e
10 : r
```

Давайте попробуем эту строку в качестве ответа на вызов: GameOver

Game Over действительно! Мы получили флаг :)

```commandline
THM{ju57_4_64m3}
```
#### Пасха 16
Помните /game2 подкаталог, который мы перечислили ранее?

Эта задача представляет нам три кнопки, которые мы должны нажать одновременно, чтобы получить флаг. Это задача, 
которую можно выполнить только с помощью инструмента Burp proxy и манипулирования запросом, поскольку у нас есть 
только одна мышь!  

Давайте рассмотрим типичный запрос, нажав одну из кнопок и перехватив запрос с помощью Burp.

Один из видов атак, который мы можем здесь попробовать, — это смягчить HTML-код, отправив все три кнопки следующим 
образом: 

У нас магическим образом три пальца нажимают на все кнопки одновременно. К счастью, это сработало и вознаградило нас 
флагом! 

У нас есть флаг в ответ на нашу магию из трех кнопок.

```commandline
THM{73mp3r_7h3_h7ml}
```
#### Пасха 17
>Подсказка : bin -> dec -> hex -> ascii

На главном сайте, либо в Burp, либо в «Инспекторе» вашего браузера, просмотрите исходный код веб-страницы. Вы найдете двоично-кодированное сообщение, встроенное в функцию catz().

Давайте скопируем двоичный текст (ниже).
```commandline
1000101011000010111001101110100011001010111001000100000001100010011011100111010001000000101010001001000010011010111101101 101010 0011010101011111011010100011010101011111011010110011001101110000010111110110010000110011011000110011000001100100001100110 1111101
```
Подсказка предполагает, что для его декодирования нам необходимо выполнить следующие операции: Двоичный → Десятичный 
→ Шестнадцатеричный → ASCII-код. 

У нас есть несколько вариантов

- Идентификатор шифра dCode.fr делает это одним махом:

- Онлайн-конвертеры Rapid Tables : Сначала преобразуйте двоичное число в десятичное и шестнадцатеричное:
Затем преобразуйте Hex в ASCII.

- Преобразование Python :
Запустите интерактивную оболочку python3 с помощью python3 или ipython3, затем введите следующее (копирование/вставка 
  также работает). 



Это выполнит преобразование из двоичного в десятичное, из десятичное в шестнадцатеричное, из шестнадцатеричного в 
ASCII. Результатом будет скрытый флаг пасхального яйца 17. 

```commandline
THM{j5_j5_k3p_d3c0d3}
```
#### Пасха 18


```commandline
THM{70ny_r0ll_7h3_366}
```
#### Пасха 19


```commandline
THM{700_5m4ll_3yy}
```
#### Пасха 20


```commandline
THM{17_w45_m3_4ll_4l0n6}
```



[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)