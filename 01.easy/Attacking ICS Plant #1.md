[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Attacking ICS Plant #1](https://tryhackme.com/r/room/attackingics1) 

Всего 5 заданий:
## Задание 1
Операционная технология (OT) относится к системам, используемым для мониторинга и управления промышленными 
операциями. Промышленные системы управления ( ICS ) включают системы, используемые для мониторинга и управления 
промышленными процессами.  

Если у операторов ИТ есть десятки лет опыта в обеспечении безопасности сетей, систем и приложений, то операторы ОТ — 
новички в этой теме. Более того, при разработке ОТ/ ICS доступность всегда предпочтительнее целостности и 
конфиденциальности. Другими словами, программное обеспечение ICS разрабатывается так, чтобы быть быстрым, но часто 
небезопасным.   

Системы диспетчерского управления и сбора данных (SCADA) используются для управления и автоматизации промышленных 
процессов. Системы SCADA включают в себя: 
- Контролирующие компьютеры: серверы, используемые для управления процессом, сбора данных о процессе и связи с полевыми устройствами (ПЛК/RTU). В небольших развертываниях HMI встроен в один компьютер, в более крупных развертываниях HMI устанавливается на выделенном компьютере.
- Программируемые логические контроллеры (ПЛК): цифровые компьютеры, используемые в основном для автоматизации промышленных процессов. Они используются для непрерывного мониторинга датчиков (вход) и принятия решений по управлению устройствами (выход).
- Удаленные терминальные устройства (RTU): в настоящее время функциональные возможности RTU и PLC пересекаются. RTU обычно предпочтительны для более широкой географической телеметрии, тогда как PLC лучше подходят для локального управления.
- Коммуникационная сеть: сеть, соединяющая все компоненты SCADA (Ethernet, последовательный, телефоны, радио, сотовая связь...). Сбои в работе сети не обязательно оказывают негативное влияние на процесс на предприятии. Как RTU, так и PLC должны быть спроектированы для автономной работы с использованием последней инструкции, полученной от системы управления.
- Интерфейс «человек-машина» (HMI): отображает цифровое представление завода. Операторы могут взаимодействовать с заводом, отдавая команды с помощью мыши, клавиатуры или сенсорных экранов. Операторы могут принимать контролирующие решения, корректируя или переопределяя нормальное поведение завода.

Коротко и просто:
- промышленность управляется сложными, критически важными компьютерами (системами SCADA);
- безопасность не является главным приоритетом в ОТ/ ИСК ;
- операторы могут вручную изменять поведение установки с помощью мыши/клавиатуры/сенсорного экрана, локально или удаленно;

Вредоносное программное обеспечение может переопределять поведение установки, как это делает HMI.

Более подробную информацию см. в Руководстве по безопасности промышленных систем управления (ICS) ( NIST 800-82) .

### Ответьте на вопросы ниже
Ответ не требуется
```commandline
Ответ не нужен
```

## Задание 2
Modbus — это промышленный протокол, разработанный компанией Modicon, приобретенной Schneider Electric. Modbus широко используется для подключения промышленных устройств; спецификация протокола доступна и не требует лицензионных отчислений.

Протокол Modbus является протоколом «ведущий/ведомый»: ведущее устройство считывает и записывает регистры ведомых устройств.

Modbus RTU обычно используется через RS-485 (последовательная сеть): один ведущий присутствует с одним или несколькими ведомыми. Каждый ведомый имеет уникальный 8-битный адрес. 

Данные Modbus используются для чтения и записи "регистров", которые имеют длину 16 бит. Наиболее распространенный регистр называется "регистр хранения", который доступен для чтения и записи; тип регистра "входной регистр" доступен только для чтения. Регистры "катушка" и "дискретный вход" имеют длину 1 бит: катушки доступны для чтения и записи, дискретные входы доступны только для чтения.

Типы регистров Modbus:

Дискретный вход (вход состояния): 1 бит, RO

Катушка (дискретный выход): 1 бит, чтение/запись

Входной регистр: 16 бит, RO

Регистр хранения: 16 бит, чтение/запись

Наиболее распространённые функции Modbus:
Запись нескольких регистров хранения

Modbus TCP инкапсулирует пакеты данных запроса и ответа Modbus RTU в пакет TCP , передаваемый по стандартным сетям Ethernet. Стандартный порт TCP Modbus — 502.

Для получения дополнительной информации см. Modbus 101 — Введение в Modbus .

Перед началом загрузите прилагаемый пакет скриптов и установите библиотеку Modbus TCP для Python с помощью следующей команды:

pip3 установить pymodbus==1.5.2

### Ответьте на вопросы ниже
Какая функция используется для чтения регистров хранения в библиотеке pymodbus?
```commandline
read_holding_registers
```
Какая функция используется для записи регистров хранения в библиотеке pymodbus?
```commandline
write_register
```

## Задание 3
Подключитесь к заводу с помощью браузера ( http://MACHINE_IP ) и узнайте, как работает завод по розливу в бутылки.

У нас есть три фазы:

Инициализация: завод запускается с начала. Ролик перемещает первую бутылку под сопло.

Наполнение: как только бутылка оказывается под насадкой, насадка открывается, и вода поступает в бутылку.

Перемещение: как только бутылка заполнена, ролик снова начинает перемещать следующую пустую бутылку под насадку.

По окончании фазы 3 завод снова начинает фазу 2.

Из трех фаз, описанных выше, мы можем наблюдать:

Датчики: используются для считывания состояния растения.

Исполнительные механизмы: используются для изменения состояния установки.

Пример: датчик может определить, находится ли бутылка под насадкой, а привод может открыть или закрыть насадку.

Помните, мы можем нажать кнопку ESC, чтобы запустить установку с самого начала.

VirtuaPlant можно загрузить с GitHub .

### Ответьте на вопросы ниже
Сколько фаз мы можем наблюдать?
```commandline
3
```
Сколько датчиков мы можем наблюдать?
```commandline
2
```
Сколько актуаторов мы можем наблюдать?
```commandline
3
```
Сколько регистров мы можем подсчитать, используя скрипт discovery.py?
```commandline
16
```
Сколько регистров непрерывно изменяют свои значения после запуска завода и загрузки бутылки  ?
```commandline
4
```
Каково минимальное наблюдаемое значение?
```commandline
0
```
Каково максимальное наблюдаемое значение?
```commandline
1
```
Какой реестр хранит его значение?
```commandline
16
```
Какие регистры устанавливаются на 1, когда насадка наполняет бутылку?
```commandline
2 4
```
Какие регистры устанавливаются на 1, когда ролик перемещает бутылки?
```commandline
1 3
```
Какого цвета датчик уровня воды?
```commandline
red
```
Какого цвета датчик бутылки?
```commandline
green
```
Если вы наблюдаете за растением в самом начале, какой регистр связан с роликом?
```commandline
3
```
Исходя из предыдущего ответа, какой реестр связан с датчиком уровня воды?
```commandline
1
```

## Задание 4
В предыдущем задании мы узнали много нового о реестрах:

Завод по розливу бутылок предоставляет 16 регистров, но используются только 5 из них.
Реестр 16 связан с кнопкой «Пуск/Стоп»: 1 означает, что установка включена, 0 означает, что установка выключена.
Регистры 1 и 3 обычно имеют одинаковое значение, за исключением фазы инициализации.
Регистры 2 и 4 всегда имеют одинаковое значение.
Мы наблюдали три фазы и соответствующие им реестры:

Инициализация: [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
Наполнение: как только бутылка оказывается под насадкой, насадка открывается, и вода поступает в бутылку.
Перемещение: как только бутылка заполнена, ролик снова начинает перемещать следующую пустую бутылку под насадку.
Мы также предположили, что на заводе имеется два датчика и три исполнительных механизма. Исполнительные механизмы:

Кнопка «Пуск/Стоп»: реестр 16.
Двигатель ролика: регистр 3.
Сопло: регистр 2 или 4. Нам нужно потратить на это дополнительное время.
Датчики:

Уровень воды: 1 (красный датчик)
Положение бутылки: 2 или 4 (зеленый датчик). Нам нужно потратить на это дополнительное время.
Теперь поиграйтесь со скриптом set_registry.py и выясните, какие реестры связаны с соплом.

### Ответьте на вопросы ниже
Какой реестр связан с форсункой?

```commandline
4
```

## Задание 5
В предыдущих заданиях мы разобрались, как работают реестры:

Реестр 1: связан с датчиком бутылки. Значение 1, если бутылка находится под насадкой.

Реестр 2: связан с датчиком уровня воды. Значение 1, если бутылка заполнена.

Реестр 3: связан с приводами роликов. Значение 1 включает ролик.

Реестр 4: связан с соплом. Значение 1 открывает сопло.

Реестр 16: связан с заводом. Значение 1 запускает завод

Мы можем злоупотреблять реестрами, принудительно задавая пользовательское значение для вышеуказанных реестров. Мы можем делать это многими способами.

Помните, что руководитель завода остановит его в случае обнаружения ненормальных условий.

### Ответьте на вопросы ниже
Остановите завод и не позволяйте директору завода снова его запустить.
```commandline
Ответ не нужен
```

Запустите установку, откройте сопло во время движения бутылок.
```commandline
Ответ не нужен
```

Запустите установку, откройте сопло и остановите валик.
```commandline
Ответ не нужен
```

Повторная атака в вопросе 1 с использованием регистров датчиков.
```commandline
Ответ не нужен
```

Повторная атака по вопросу 2 с использованием регистров датчиков.
```commandline
Ответ не нужен
```

Повторная атака в вопросе 3 с использованием регистров датчиков.

```commandline
Ответ не нужен
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)