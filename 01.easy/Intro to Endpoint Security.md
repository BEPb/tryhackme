[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Intro to Endpoint Security](https://tryhackme.com/r/room/introtoendpointsecurity) 

Всего 5 заданий:
## Задание 1
В этой комнате мы познакомим вас с основами мониторинга безопасности конечных точек, основными инструментами и 
методологией высокого уровня. В этой комнате дается обзор определения вредоносной активности с конечной точки и 
сопоставления связанных с ней событий.  

Для начала мы рассмотрим следующие темы, чтобы заложить основу для работы с мониторингом безопасности конечных точек.
- Основы безопасности конечных точек
- Регистрация и мониторинг конечных точек
- Анализ журнала конечной точки


В конце этой комнаты у нас будет симуляция угрозы, в которой вам нужно будет исследовать и устранить зараженные 
машины. Для этого занятия вам может потребоваться сначала понять основы мониторинга безопасности конечных точек, 
чтобы выполнить его.  

Теперь давайте углубимся в основы Endpoint Security!

### Ответьте на вопросы ниже
Я прочитал вводное задание.
```commandline
Ответ не нужен
```

## Задание 2
Основные процессы Windows

Прежде чем мы начнем изучать, как глубоко погружаться в журналы конечных точек, нам нужно сначала изучить основы 
работы операционной системы Windows. Без предварительных знаний, дифференциация выброса от стога сена событий может 
быть проблематичной.   

Чтобы узнать больше об основных процессах Windows, можно воспользоваться встроенным инструментом Windows под 
названием «Диспетчер задач», который поможет нам понять основные процессы внутри машины Windows.   

Task Manager — это встроенная утилита Windows на основе графического интерфейса , которая позволяет пользователям 
видеть, что запущено в системе Windows. Она также предоставляет информацию об использовании ресурсов, например, 
насколько каждый процесс использует процессор и память. Когда программа не отвечает, Task Manager используется для 
завершения процесса.   

#### Диспетчер задач

Диспетчер задач предоставляет некоторые из основных процессов Windows, работающих в фоновом режиме. Ниже приведена 
сводка запущенных процессов, которые считаются нормальным поведением. 

Примечание: символ ">" обозначает родительско-дочерние отношения. System (Parent) > smss.exe (Child)
```commandline
Система
Система > smss.exe
csrss.exe
wininit.exe
wininit.exe > services.exe
wininit.exe > services.exe > svchost.exe
lsass.exe
winlogon.exe
explorer.exe

```
Кроме того, процессы, не имеющие отношения родитель-потомок, не должны иметь родительского процесса при нормальных 
обстоятельствах, за исключением системного процесса, который должен иметь только  системный процесс бездействия (0) 
в качестве родительского процесса .  

Вы можете обратиться к разделу «Основные процессы Windows», чтобы узнать больше по этой теме.

Sysinternals

Имея предварительные знания об основных процессах Windows, мы теперь можем перейти к обсуждению доступного набора 
инструментов для анализа запущенных артефактов в бэкэнде машины Windows. 

Инструменты Sysinternals представляют собой сборник из более чем 70+ инструментов на базе Windows. Каждый из 
инструментов относится к одной из следующих категорий: 
- Файловые и дисковые утилиты
- Сетевые утилиты
- Технологические утилиты
- Утилиты безопасности
- Системная информация
#### Разнообразный
Мы представим два наиболее часто используемых инструмента Sysinternals для исследования конечных точек при выполнении этой задачи.

TCPView — сетевая утилита.
Process Explorer — инструмент управления процессами.
TCPПросмотр

" TCPView  — это программа Windows, которая покажет вам подробные списки всех  конечных точек TCP  и UDP в вашей 
системе, включая локальные и удаленные адреса и состояние соединений TCP. В Windows Server 2008, Vista и XP TCPView 
также сообщает имя процесса, которому принадлежит конечная точка. TCPView предоставляет более информативное и удобно 
представленное подмножество программы Netstat, которая поставляется с Windows. Загрузка TCPView включает Tcpvcon, 
версию командной строки с той же функциональностью." ( официальное определение )    

TCPПросмотр

Как показано выше, каждое соединение, инициированное процессом, отображается в списке инструмента, что может помочь 
в сопоставлении сетевых событий, выполняемых одновременно.  

Обозреватель процессов

«  Дисплей Process Explorer  состоит из двух подокнов. Верхнее окно всегда показывает список активных в данный 
момент процессов, включая имена их учетных записей, в то время как информация, отображаемая в нижнем окне, зависит 
от режима, в котором находится Process Explorer: если он находится в режиме дескрипторов, вы увидите дескрипторы, 
которые открыл процесс, выбранный в верхнем окне; если Process Explorer находится в  режиме DLL,  вы увидите 
библиотеки DLL и отображенные в память файлы, которые загрузил процесс».  ( официальное определение )    

#### Обозреватель процессов

Process Explorer позволяет вам просматривать подробную информацию о запущенном процессе, например:
- Сопутствующие услуги
- Вызванный сетевой трафик
- Дескрипторы, такие как открытые файлы или каталоги
- Загружены библиотеки DLL и файлы, отображенные в памяти
Чтобы узнать больше о Sysinternals, вы можете посетить Sysinternals Room .

### Ответьте на вопросы ниже
Какой обычный родительский процесс services.exe?
```commandline
wininit.exe
```

Как называется сетевой инструмент, представленный в этом задании?
```commandline
TCPView
```

## Задание 3
Из предыдущего задания мы получили базовые знания об операционной системе Windows с точки зрения базовых процессов и 
основных инструментов для анализа событий и артефактов, запущенных на машине. Однако это ограничивает нас только 
наблюдением за событиями в реальном времени. С этим мы познакомимся с важностью регистрации конечных точек, которая 
позволяет нам проводить аудит значимых событий на разных конечных точках, собирать и объединять их для возможностей 
поиска и лучше автоматизировать обнаружение аномалий.

#### Журналы событий Windows

Журналы событий Windows не являются текстовыми файлами, которые можно просматривать с помощью текстового редактора. 
Однако необработанные данные можно преобразовать в  XML с помощью API  Windows . События в этих файлах журналов 
хранятся в фирменном двоичном формате с расширением .evt или .evtx. Файлы журналов с расширением .evtx обычно 
находятся в  `C:\Windows\System32\winevt\Logs.`

Существует три основных способа доступа к этим журналам событий в системе Windows:
- Просмотр событий  ( приложение с графическим интерфейсом)
- Wevtutil.exe  (инструмент командной строки)
- Get-WinEvent  ( командлет PowerShell )
Ниже приведен пример изображения журналов, просматриваемых с помощью инструмента просмотра событий .

Просмотр событий Windows

Дополнительную информацию о журналах событий Windows можно найти в разделе «Журналы событий Windows» . 

#### Сисмон

Sysmon — инструмент для мониторинга и регистрации событий в Windows — обычно используется предприятиями как часть их 
решений по мониторингу и регистрации. Как часть пакета Windows Sysinternals, Sysmon похож на журналы событий Windows 
с более подробной информацией и гранулярным контролем.

Sysmon собирает подробные и высококачественные журналы, а также трассировку событий, которая помогает выявлять 
аномалии в вашей среде. Обычно используется с системой управления информацией и событиями безопасности ( SIEM ) или 
другими решениями для анализа журналов, которые агрегируют, фильтруют и визуализируют события.

Наконец,  Sysmon включает 27 типов идентификаторов событий, все из которых могут использоваться в требуемом файле 
конфигурации для указания того, как события должны обрабатываться и анализироваться. Отличный пример файла 
конфигурации, проверяющего различные идентификаторы событий, созданные SwiftOnSecurity, можно найти здесь.

На изображении ниже показан пример набора журналов Sysmon , просматриваемых с помощью средства просмотра событий .

Журналы Sysmon
Чтобы узнать больше о Sysmon, вы можете обратиться к Sysmon Room.

#### OSQuery

Osquery — это инструмент с открытым исходным кодом, созданный Facebook. С помощью Osquery аналитики безопасности, 
специалисты по реагированию на инциденты и охотники за угрозами могут отправлять запросы на конечную точку (или 
несколько конечных точек) с использованием синтаксиса SQL. Osquery можно установить на различных платформах: Windows,
Linux , macOS и FreeBSD.   

Для взаимодействия с интерактивной консолью/оболочкой Osquery откройте CMD (или PowerShell ) и запустите  osqueryi.  
Вы узнаете, что успешно вошли в интерактивную оболочку, по новой командной строке. 
```commandline
cmd.exe
C:\Users\Administrator\> osqueryi
Using a virtual database. Need help, type 'help'
osquery> 
```

Примером использования OSQuery является вывод списка важной информации о процессе по его имени. 
```commandline
osqueryi
osquery> select pid,name,path from processes where name='lsass.exe';
+-----+-----------+-------------------------------+
| pid | name      | path                          |
+-----+-----------+-------------------------------+
| 748 | lsass.exe | C:\Windows\System32\lsass.exe |
+-----+-----------+-------------------------------+
osquery> 

```
Osquery позволяет запрашивать только события внутри машины. Но с помощью Kolide Fleet вы можете запрашивать 
несколько конечных точек из пользовательского интерфейса Kolide Fleet  вместо того, чтобы использовать Osquery 
локально для запроса конечной точки . Пример Kolide Fleet в действии ниже показывает результат запроса, 
перечисляющего машины с  lsass запущенным процессом.

Коллид

Чтобы узнать больше об OSQuery, вы можете обратиться к OSQuery Room . 

Вазух

Wazuh — это бесплатное и обширное решение EDR с открытым исходным кодом , которое инженеры по безопасности могут 
развертывать в средах любого масштаба. 

Wazuh работает по модели управления и агентов, где выделенное устройство-менеджер отвечает за управление агентами, 
установленными на устройствах, которые вы хотите отслеживать. 

Как уже упоминалось, Wazuh — это EDR; давайте кратко рассмотрим, что такое EDR .  Endpoint Detection and Response ( 
EDR ) — это инструменты и приложения, которые отслеживают устройства на предмет активности, которая может указывать 
на угрозу или нарушение безопасности. Эти инструменты и приложения обладают следующими функциями:  
- Проверка устройства на наличие распространенных уязвимостей
- Проактивный мониторинг устройства на предмет подозрительной активности, такой как несанкционированный вход в 
  систему, атаки методом подбора или повышение привилегий.
- Визуализация сложных данных и событий в аккуратные и модные графики
- Запись нормального рабочего поведения устройства для выявления аномалий
Ниже показан пример работы Wazuh.

#### Wazuh в действии

Чтобы ощутить Wazuh в действии, вы можете посетить Wazuh Room .

### Ответьте на вопросы ниже
Где обычно находятся журналы событий Windows (файлы .evtx)?
```commandline
C:\Windows\System32\winevt\Logs
```
Укажите команду, используемую для входа в OSQuery CLI.
```commandline
osqueryi
```
Что означает EDR? Укажите ответ строчными буквами.
```commandline
endpoint detection and response
```

## Задание 4
Корреляция событий

Корреляция событий выявляет значимые взаимосвязи из нескольких источников журналов, таких как журналы приложений, 
журналы конечных точек и сетевые журналы. 

Корреляция событий занимается выявлением значимых артефактов, сосуществующих из разных источников журналов, и 
связывает каждый связанный артефакт. Например, журнал сетевых подключений может существовать в различных источниках 
журналов, таких как журналы Sysmon (идентификатор события 3: сетевое подключение) и журналы брандмауэра . Журнал 
брандмауэра может содержать исходный и целевой IP-адрес, исходный и целевой порт, протокол и предпринятое действие. 
Напротив, журналы Sysmon могут содержать процесс, который вызвал сетевое подключение, и пользователя, запустившего 
процесс.

Используя эту информацию, мы можем связать точки каждого артефакта из двух источников данных:
- Исходный и конечный IP-адрес
- Порт источника и назначения
- Принятые меры
- Протокол
- Имя процесса
- Учетная запись пользователя
- Имя машины
Корреляция событий может помочь собрать фрагменты головоломки, необходимые для завершения точного сценария расследования.

### Базовый уровень

Определение базовой линии — это процесс определения того, что, как ожидается, будет нормой. С точки зрения 
мониторинга безопасности конечных точек, требуется огромный объем сбора данных для установления стандартного 
поведения действий пользователей, сетевого трафика в инфраструктуре и процессов, запущенных на всех машинах, 
принадлежащих организации. Используя базовую линию в качестве ориентира, мы можем быстро определить выбросы, которые 
могут угрожать организации.     

Ниже приведен пример списка базовых и необычных видов деятельности, демонстрирующий важность знания того, чего 
ожидать от вашей сети. 

#### Базовый уровень	Необычная активность
- Сотрудники организации находятся в Лондоне, обычные рабочие часы — с 9:00 до 18:00.	Пользователь прошел 
аутентификацию через VPN , подключившись из Сингапура в 3 часа ночи. 
- Каждому сотруднику выделяется отдельное рабочее место.	Пользователь попытался пройти аутентификацию на нескольких 
рабочих станциях. 
- Сотрудники могут получить доступ только к определенным веб-сайтам на своих рабочих станциях, таким как OneDrive, 
  SharePoint и другие приложения O365.	Пользователь загрузил файл размером 3 ГБ на Google Диск.
- На рабочих станциях устанавливаются только избранные приложения, в основном приложения Microsoft, такие как 
  Microsoft Word, Excel, Teams, OneDrive и Google Chrome.	На нескольких рабочих станциях сотрудников был замечен 
  процесс с именем firefox.exe. 
Любое событие может оказаться иголкой в стоге сена без хорошего обзора регулярной деятельности.

Расследовательная деятельность

Мы рассмотрели основы мониторинга безопасности конечных точек из предыдущих задач. Теперь мы наденем нашу синюю 
командную шляпу и применим обсуждавшиеся концепции, расследуя подозрительную активность, обнаруженную на рабочей 
станции, принадлежащей одному из ваших коллег.  

### Ответьте на вопросы ниже
Нажмите зеленую кнопку «Просмотр сайта» в этой задаче, чтобы открыть лабораторию статического сайта и начать 
расследование угрозы, следуя предоставленным инструкциям. 
```commandline
Ответ не нужен
```

Укажите флаг для имитируемой следственной деятельности.
```commandline
THM{3ndp01nt_s3cur1ty!}
```

## Задание 5
Поздравляем! Вы выполнили задание по расследованию. 

В ходе смоделированного расследования угроз мы узнали следующее:
- Наличие базового документа поможет вам отличить вредоносные события от безобидных.
- Корреляция событий обеспечивает более глубокое понимание одновременных событий, вызванных вредоносной активностью.
- При расследовании решающее значение имеет учет каждого значимого артефакта.
- Другие потенциально затронутые активы следует проверить и устранить с помощью собранных вредоносных артефактов. 


В заключение мы рассмотрели основные концепции мониторинга безопасности конечных точек:
- В курсе «Основы безопасности конечных точек»  рассматриваются основные процессы Windows и системные компоненты.
- Endpoint Logging and Monitoring  представила такие функции ведения журнала, как Windows Event Logging и Sysmon , а 
  также инструменты мониторинга/исследования, такие как OSQuery и Wazuh .
- Анализ журнала конечных точек  подчеркнул важность наличия такой методологии, как определение исходных данных и 
  корреляция событий.


Теперь вы готовы к глубокому погружению в модуль мониторинга безопасности конечной точки.  Чтобы продолжить этот 
  путь, вы можете обратиться к списку комнат, упомянутых в предыдущих задачах: 
- Основные процессы Windows
- Sysinternals
- Журналы событий Windows
- Сисмон
- OSQuery
- Вазух


### Ответьте на вопросы ниже
Я завершил изучение курса «Введение в мониторинг безопасности конечных точек».
```commandline
Ответ не нужен
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)