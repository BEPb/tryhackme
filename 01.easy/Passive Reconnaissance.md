[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Passive Reconnaissance](https://tryhackme.com/r/room/passiverecon) 

Всего 7 заданий:
## Задание 1
Добро пожаловать в первую комнату модуля сетевой безопасности. Этот модуль охватывает:

- Пассивная разведка
- Активная разведка
- Nmap Live Host Discovery
- Базовое сканирование портов Nmap
- Расширенное сканирование портов Nmap
- Nmap Post сканирование портов
- Протоколы и серверы
- Протоколы и серверы 2
- Проблема сетевой безопасности



В этой комнате, после того как мы дадим определение пассивной разведке и активной разведке, мы сосредоточимся на 
  основных инструментах, связанных с пассивной разведкой. Мы изучим три инструмента командной строки: 

- `whois` для запроса серверов WHOIS
- `nslookup` для запроса DNS- серверов
- `dig` для запроса DNS- серверов


Мы используем `whois` для запроса записей WHOIS, в то время как мы используем `nslookup` и `dig` для запроса записей базы 
  данных DNS. Все эти записи общедоступны и, следовательно, не оповещают цель.

Мы также изучим использование двух онлайн-сервисов:
- DNSDumpster
- Shodan.io


Эти два онлайн-сервиса позволяют нам собирать информацию о нашей цели без прямого подключения к ней.
Предварительные условия: Эта комната требует базовых знаний о сетях, а также базового знакомства с командной строкой.
Модули Network Fundamentals и Linux Fundamentals предоставляют необходимые знания, если это необходимо. 

> Важное примечание: Обратите внимание, что если вы не подписаны, у AttackBox не будет доступа к Интернету, поэтому 
> вам придется использовать VPN для ответа на вопросы, требующие доступа к Интернету.

### Ответить на вопросы ниже
В этой комнате не используется целевая виртуальная машина (VM) для демонстрации обсуждаемых тем. Вместо этого мы 
будем запрашивать общедоступные серверы WHOIS и DNS-серверы для доменов, принадлежащих TryHackMe. Запустите 
AttackBox и убедитесь, что он готов. Вы будете использовать AttackBox для ответа на вопросы в последующих заданиях, 
особенно в заданиях 3 и 4.   
```commandline
Ответ не нужен
```

## Задание 2
Эта комната предполагает, что пользователь имеет практические знания о компьютерных сетях. Если вы хотите освежить 
знания по этой теме, вам рекомендуется сначала изучить модуль Network Fundamentals. 

До рассвета компьютерных систем и сетей, в «Искусстве войны» Сунь Цзы учил: «Если вы знаете врага и знаете себя, 
ваша победа не будет подвергаться сомнению». Если вы играете роль нападающего, вам нужно собрать информацию о ваших 
целевых системах. Если вы играете роль защитника, вам нужно знать, что ваш противник обнаружит о ваших системах и сетях.

Разведку (recon) можно определить как предварительное обследование для сбора информации о цели. Это первый шаг в The 
Unified Kill Chain для получения первоначального плацдарма в системе. Мы делим разведку на:
- Пассивная разведка
- Активная разведка


В пассивной разведке вы полагаетесь на общедоступные знания. Это знания, к которым вы можете получить доступ из 
общедоступных ресурсов, не вступая напрямую в контакт с целью. Думайте об этом так, как будто вы смотрите на целевую 
территорию издалека, не ступая на эту территорию. 

Пассивная разведывательная деятельность включает в себя множество мероприятий, например:
- Поиск записей DNS домена на публичном DNS- сервере.
- Проверка объявлений о вакансиях, связанных с целевым сайтом.
- Чтение новостных статей о целевой компании.



Активная разведка, с другой стороны, не может быть достигнута столь скрытно. Она требует прямого взаимодействия с 
целью. Думайте об этом так, как будто вы проверяете замки на дверях и окнах, среди других потенциальных точек входа. 
Примеры активной разведывательной деятельности включают в себя:
- Подключение к одному из серверов компании, например HTTP , FTP и SMTP .
- Звонок в компанию с целью получения информации (социальная инженерия).
- Проникновение на территорию компании под видом ремонтника.

Учитывая инвазивный характер активной разведки, можно быстро нарваться на юридические проблемы, если не получить 
надлежащего юридического разрешения. 

### Ответить на вопросы ниже
Вы посещаете страницу целевой компании в Facebook, надеясь узнать имена некоторых ее сотрудников. Что это за 
разведывательная деятельность? (A для активного, P для пассивного) 
```commandline
P
```
Вы пингуете IP-адрес веб-сервера компании, чтобы проверить, заблокирован ли трафик ICMP. Что это за разведывательная 
деятельность? (A для активного, P для пассивного) 
```commandline
A
```
Вы случайно встречаете IT-администратора целевой компании на вечеринке. Вы пытаетесь использовать социальную 
инженерию, чтобы получить больше информации об их системах и сетевой инфраструктуре. Что это за разведывательная 
деятельность? (A для активного, P для пассивного)  
```commandline
A
```

## Задание 3
`WHOIS` — это протокол запросов и ответов, который следует спецификации RFC 3912. Сервер WHOIS прослушивает порт TCP 
43 на предмет входящих запросов. Регистратор доменов несет ответственность за ведение записей WHOIS для доменных 
имен, которые он арендует. Сервер WHOIS отвечает различной информацией, связанной с запрошенным доменом. Особый 
интерес представляет то, что мы можем узнать:   
- Регистратор: Через какого регистратора было зарегистрировано доменное имя?
- Контактная информация регистранта: имя, организация, адрес, телефон и т. д. (если только она не скрыта с помощью 
  сервиса конфиденциальности)
- Даты создания, обновления и истечения срока действия: Когда доменное имя было впервые зарегистрировано? Когда оно 
  было обновлено в последний раз? И когда его необходимо продлевать?
- Сервер имен: какой сервер следует запросить для разрешения доменного имени?
- Чтобы получить эту информацию, нам нужно использовать whois клиент или онлайн-сервис. Многие онлайн-сервисы 
  предоставляют whois информацию; однако, как правило, быстрее и удобнее использовать ваш локальный whois-клиент. 
  Используя AttackBox (или вашу локальную машину Linux , например Parrot или Kali), вы можете легко получить доступ 
  к своему whois-клиенту на терминале. Синтаксис: whois DOMAIN_NAME, где DOMAIN_NAME— домен, о котором вы пытаетесь 
  получить больше информации. Рассмотрим следующий пример выполнения whois tryhackme.com.   

Терминал
```commandline
user@TryHackMe$ whois tryhackme.com
[Querying whois.verisign-grs.com]
[Redirected to whois.namecheap.com]
[Querying whois.namecheap.com]
[whois.namecheap.com]
Domain name: tryhackme.com
Registry Domain ID: 2282723194_DOMAIN_COM-VRSN
Registrar WHOIS Server: whois.namecheap.com
Registrar URL: http://www.namecheap.com
Updated Date: 2021-05-01T19:43:23.31Z
Creation Date: 2018-07-05T19:46:15.00Z
Registrar Registration Expiration Date: 2027-07-05T19:46:15.00Z
Registrar: NAMECHEAP INC
Registrar IANA ID: 1068
Registrar Abuse Contact Email: abuse@namecheap.com
Registrar Abuse Contact Phone: +1.6613102107
Reseller: NAMECHEAP INC
Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited
Registry Registrant ID: 
Registrant Name: Withheld for Privacy Purposes
Registrant Organization: Privacy service provided by Withheld for Privacy ehf
[...]
URL of the ICANN WHOIS Data Problem Reporting System: http://wdprs.internic.net/
>>> Last update of WHOIS database: 2021-08-25T14:58:29.57Z <<<
For more information on Whois status codes, please visit https://icann.org/epp
```

Мы можем видеть много информации; мы проверим их в порядке отображения. Во-первых, мы замечаем, что мы были 
перенаправлены на whois.namecheap.com для получения нашей информации. В этом случае и в настоящее время, namecheap.
com ведет запись WHOIS для этого доменного имени. Кроме того, мы можем видеть дату создания вместе с датой последнего 
обновления и датой истечения срока действия.

Далее мы получаем информацию о регистраторе и регистранте. Мы можем найти имя регистранта и контактную информацию, 
если только он не использует какой-либо сервис конфиденциальности. Хотя это не показано выше, мы получаем 
административные и технические контакты для этого домена. Наконец, мы видим серверы доменных имен, которые мы должны 
запросить, если у нас есть какие-либо записи DNS для поиска.

Собранную информацию можно изучить, чтобы найти новые поверхности атак, такие как социальная инженерия или 
технические атаки. Например, в зависимости от области действия теста на проникновение вы можете рассмотреть атаку на 
почтовый сервер администратора или DNS- серверы, предполагая, что они принадлежат вашему клиенту и попадают в 
область действия теста на проникновение.

Важно отметить, что из-за автоматизированных инструментов, злоупотребляющих запросами WHOIS для сбора адресов 
электронной почты, многие сервисы WHOIS принимают меры против этого. Например, они могут редактировать адреса 
электронной почты. Более того, многие регистраторы подписываются на услуги конфиденциальности, чтобы избежать сбора 
своих адресов электронной почты спамерами и сохранить свою информацию конфиденциальной.

На AttackBox откройте терминал и выполните команду, whois tryhackme.com чтобы получить информацию, необходимую для 
ответа на следующие вопросы. 

### Ответить на вопросы ниже
Когда был зарегистрирован TryHackMe.com?

```commandline
20180705
```
Кто является регистратором TryHackMe.com?
```commandline
namecheap.com
```
Какую компанию использует TryHackMe.com для серверов имен?
```commandline
cloudflare.com
```

## Задание 4
В предыдущей задаче мы использовали протокол WHOIS для получения различной информации о доменном имени, которое мы 
искали. В частности, нам удалось получить DNS- серверы от регистратора. 

Найдите IP-адрес доменного имени с помощью nslookup, что означает Name Server Look Up. Вам нужно ввести команду 
nslookup DOMAIN_NAME, например, nslookup tryhackme.com. Или, в более общем случае, вы можете использовать nslookup 
OPTIONS DOMAIN_NAME SERVER. Вот эти три основных параметра:  

- OPTIONS содержит тип запроса, как показано в таблице ниже. Например, вы можете использовать Aдля адресов IPv4 и 
AAAA для адресов IPv6.
- DOMAIN_NAME — это доменное имя, которое вы ищете.
- SERVER — это DNS- сервер, который вы хотите запросить. Вы можете выбрать любой локальный или публичный DNS- сервер 
  для запроса. Cloudflare предлагает 1.1.1.1и 1.0.0.1, Google предлагает 8.8.8.8и 8.8.4.4, а Quad9 предлагает 9.9.9.
  9и 149.112.112.112. Существует множество других публичных DNS- серверов , из которых вы можете выбрать, если вам 
  нужны альтернативы DNS- серверам вашего интернет-провайдера.

- Тип запроса	Результат
- А	IPv4-адреса
- АААА	IPv6-адреса
- CNAME	Каноническое имя
- МХ	Почтовые серверы
- СОА	Начало полномочий
- ТЕКСТ	TXT-записи`

Например, `nslookup -type=A tryhackme.com 1.1.1.1`(или `nslookup -type=a tryhackme.com 1.1.1.1`, поскольку он 
нечувствителен к регистру) можно использовать для возврата всех адресов IPv4, используемых tryhackme.com. 

Терминал
```commandline
user@TryHackMe$ nslookup -type=A tryhackme.com 1.1.1.1
Server:		1.1.1.1
Address:	1.1.1.1#53

Non-authoritative answer:
Name:	tryhackme.com
Address: 172.67.69.208
Name:	tryhackme.com
Address: 104.26.11.229
Name:	tryhackme.com
Address: 104.26.10.229
```

Записи A и AAAA используются для возврата адресов IPv4 и IPv6 соответственно. Этот поиск полезен с точки зрения 
тестирования на проникновение. В приведенном выше примере мы начали с одного доменного имени и получили три адреса 
IPv4. Каждый из этих IP-адресов можно дополнительно проверить на предмет уязвимостей, предполагая, что они находятся 
в пределах области тестирования на проникновение.   

Допустим, вы хотите узнать о серверах электронной почты и конфигурациях для определенного домена. Вы можете 
выполнить `nslookup -type=MX tryhackme.com`. Вот пример: 

Терминал
```commandline
user@TryHackMe$ nslookup -type=MX tryhackme.com
Server:		127.0.0.53
Address:	127.0.0.53#53

Non-authoritative answer:
tryhackme.com	mail exchanger = 5 alt1.aspmx.l.google.com.
tryhackme.com	mail exchanger = 1 aspmx.l.google.com.
tryhackme.com	mail exchanger = 10 alt4.aspmx.l.google.com.
tryhackme.com	mail exchanger = 10 alt3.aspmx.l.google.com.
tryhackme.com	mail exchanger = 5 alt2.aspmx.l.google.com.
```

Мы видим, что текущая конфигурация электронной почты tryhackme.com использует Google. Поскольку MX ищет серверы Mail 
Exchange, мы замечаем, что когда почтовый сервер пытается доставить почту @tryhackme.com, он пытается подключиться к 
aspmx.l.google.com, который имеет порядок 1. Если он занят или недоступен, почтовый сервер попытается подключиться к 
следующим по порядку серверам почтового обмена, alt1.aspmx.l.google.comили alt2.aspmx.l.google.com.

Google предоставляет перечисленные почтовые серверы; поэтому мы не должны ожидать, что почтовые серверы будут 
работать под управлением уязвимой версии сервера. Однако в других случаях мы можем обнаружить почтовые серверы, 
которые недостаточно защищены или исправлены.  

Такие фрагменты информации могут оказаться ценными, поскольку вы продолжаете пассивную разведку своей цели. Вы 
можете повторить подобные запросы для других доменных имен и попробовать разные типы, например -type=txt. Кто знает, 
какую информацию вы можете обнаружить по пути!  

Для более сложных DNS- запросов и дополнительных функций вы можете использовать dig, аббревиатуру от «Domain 
Information Groper», если вам интересно. Давайте используем digдля поиска записей MX и сравнения их с nslookup. Мы 
можем использовать dig DOMAIN_NAME, но для указания типа записи мы будем использовать dig DOMAIN_NAME TYPE. При 
желании мы можем выбрать сервер, к которому хотим обратиться, используя dig @SERVER DOMAIN_NAME TYPE.   

- SERVER — DNS- сервер, к которому вы хотите отправить запрос.
- DOMAIN_NAME — это доменное имя, которое вы ищете.
- TYPE содержит тип записи DNS , как показано в представленной ранее таблице.


Терминал
```commandline
user@TryHackMe$ dig tryhackme.com MX

; <<>> DiG 9.16.19-RH <<>> tryhackme.com MX
;; global options: +cmd
;; Got answer:
;; ->>HEADER<
```

        
Быстрое сравнение вывода nslookupи dig показывает, что dig вернул больше информации, например, TTL (время жизни) по 
умолчанию. Если вы хотите запросить 1.1.1.1 DNS- сервер, вы можете выполнить `dig @1.1.1.1 tryhackme.com` MX. 

Используя AttackBox, откройте терминал и используйте команду nslookupили dig, чтобы получить информацию, необходимую 
для ответа на следующий вопрос. 

### Ответить на вопросы ниже
Проверьте записи TXT thmlabs.com. Какой там флаг?
```commandline
THM{a5b83929888ed36acb0272971e438d78}
```

## Задание 5
Инструменты поиска DNS, такие как nslookup и dig, не могут самостоятельно находить поддомены. Домен, который вы 
проверяете, может включать другой поддомен, который может раскрыть много информации о цели. Например, если tryhackme.
com имеет поддомены wiki.tryhackme.com и webmail.tryhackme.com, вы хотите узнать больше об этих двух, поскольку они 
могут содержать кладезь информации о вашей цели. Существует вероятность, что один из этих поддоменов был настроен и 
не обновляется регулярно. Отсутствие надлежащих регулярных обновлений обычно приводит к уязвимым службам. Но как мы 
можем узнать, что такие поддомены существуют?     

Мы можем рассмотреть возможность использования нескольких поисковых систем для составления списка публично известных 
поддоменов. Одной поисковой системы будет недостаточно; более того, мы должны ожидать, что нам придется просмотреть 
не менее десятков результатов, чтобы найти интересные данные. В конце концов, вы ищете поддомены, которые явно не 
рекламируются, и, следовательно, нет необходимости попадать на первую страницу результатов поиска. Другой подход к 
обнаружению таких поддоменов — положиться на запросы методом перебора, чтобы найти, какие поддомены имеют записи DNS .    

Чтобы избежать такого трудоемкого поиска, можно воспользоваться онлайн-сервисом, который предлагает подробные ответы 
на DNS-запросы, например DNSDumpster . Если мы выполним поиск в DNSDumpster по запросу tryhackme.com, мы обнаружим 
поддомен blog.tryhackme.com, который не может предоставить обычный DNS- запрос. Кроме того, DNSDumpster вернет 
собранную DNS- информацию в виде простых для чтения таблиц и графика. DNSDumpster также предоставит любую собранную 
информацию о прослушивающих серверах.    

Мы выполним поиск tryhackme.comна DNSDumpster, чтобы дать вам представление об ожидаемом результате. Среди 
результатов мы получили список DNS- серверов для домена, который мы ищем. DNSDumpster также преобразовал доменные 
имена в IP-адреса и даже попытался геолоцировать их. Мы также можем видеть записи MX; DNSDumpster преобразовал все 
пять почтовых серверов в их соответствующие IP-адреса и предоставил больше информации о владельце и местоположении. 
Наконец, мы можем видеть записи TXT. Практически одного запроса было достаточно, чтобы получить всю эту информацию.    

 

DNSDumpster также будет представлять собранную информацию графически. DNSDumpster отобразил данные из таблицы ранее 
в виде графика. Вы можете видеть DNS и MX, разветвляющиеся на соответствующие им серверы, а также показывающие 
IP-адреса.  



В настоящее время существует бета-функция, которая также позволяет экспортировать график. Вы можете манипулировать 
графиком и перемещать блоки, если это необходимо. 



Используйте веб-браузер на AttackBox или в вашей системе, чтобы ответить на следующий вопрос.

### Ответить на вопросы ниже
Найдите tryhackme.com на DNSDumpster. Какой интересный поддомен вы бы обнаружили в дополнение к www и blog?

```commandline
remote
```
## Задание 6
Когда вам поручено провести тест на проникновение против определенных целей, как часть фазы пассивной разведки, 
такой сервис, как Shodan.io , может быть полезен для изучения различных фрагментов информации о сети клиента, без 
активного подключения к ней. Кроме того, с оборонительной стороны вы можете использовать различные сервисы Shodan.io,
чтобы узнать о подключенных и уязвимых устройствах, принадлежащих вашей организации.

Shodan.io пытается подключиться к каждому устройству, доступному онлайн, чтобы создать поисковую систему связанных 
«вещей» в отличие от поисковой системы для веб-страниц. Получив ответ, он собирает всю информацию, связанную с 
сервисом, и сохраняет ее в базе данных, чтобы сделать ее доступной для поиска. Рассмотрим сохраненную запись одного 
из серверов tryhackme.com.

Эта запись показывает веб-сервер; однако, как уже упоминалось, Shodan.io собирает информацию, связанную с любым 
устройством, которое он может найти подключенным в сети. Поиск tryhackme.comна Shodan.io отобразит как минимум 
запись, показанную на снимке экрана выше. С помощью этого результата поиска Shodan.io мы можем узнать несколько 
вещей, связанных с нашим поиском, например:   

- айпи адрес
- хостинговая компания
- географическое положение
- тип и версия сервера
Вы также можете попробовать поискать IP-адреса, которые вы получили из DNS-запросов. Они, конечно, более подвержены 
  изменениям. На их странице помощи вы можете узнать обо всех вариантах поиска, доступных на Shodan.io, и вам 
  предлагается присоединиться к Shodan.io TryHackMe.  

Лучше всего посетить Shodan.io, чтобы ответить на следующие вопросы; однако учтите, что вы можете найти ответы на 
Shodan.io без необходимости иметь премиум-аккаунт.

### Ответить на вопросы ниже
По данным Shodan.io, какая страна занимает второе место в мире по количеству общедоступных серверов Apache?
```commandline
Germany
```
По данным Shodan.io, какой порт является третьим по частоте использования для Apache?
```commandline
8080
```
По данным Shodan.io, какой порт является третьим по частоте использования для nginx?
```commandline
5001
```

## Задание 7
В этой комнате мы сосредоточились на пассивной разведке. В частности, мы рассмотрели инструменты командной строки, 
whois, nslookupи dig. Мы также обсудили два общедоступных сервиса DNSDumpster и Shodan.io . Сила таких инструментов 
в том, что вы можете собирать информацию о своих целях, не подключаясь к ним напрямую. Более того, объем информации, 
которую вы можете найти с помощью таких инструментов, может быть огромным, как только вы освоите параметры поиска и 
привыкнете читать результаты.

- Цель	Пример командной строки
- Поиск записи WHOIS	`whois tryhackme.com`
- Поиск записей DNS A	`nslookup -type=A tryhackme.com`
- Поиск записей DNS MX на DNS- сервере	`nslookup -type=MX tryhackme.com 1.1.1.1`
- Поиск записей DNS TXT	`nslookup -type=TXT tryhackme.com`
- Поиск записей DNS A	`dig tryhackme.com A`
- Поиск записей DNS MX на DNS- сервере	`dig @1.1.1.1 tryhackme.com MX`
- Поиск записей DNS TXT	`dig tryhackme.com TXT`


Узнайте больше о DNS на странице DNS in Detail .

### Ответить на вопросы ниже
Обязательно запомните все моменты, обсуждавшиеся в этой комнате, особенно синтаксис инструментов командной строки.
```commandline
Ответ не нужен
```
[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)