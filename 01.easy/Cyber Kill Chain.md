[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Cyber Kill Chain](https://tryhackme.com/r/room/cyberkillchainzmt) 

Всего 10 заданий:
## Задание 1
Термин kill chain — это военная концепция, связанная со структурой атаки. Она состоит из идентификации цели, 
принятия решения и приказа атаковать цель и, наконец, уничтожения цели. 

Спасибо Lockheed Martin, глобальной компании по безопасности и аэрокосмической отрасли, которая создала фреймворк 
Cyber Kill Chain® для индустрии кибербезопасности в 2011 году на основе военной концепции. Фреймворк определяет шаги,
используемые противниками или злонамеренными субъектами в киберпространстве. Чтобы добиться успеха, противнику 
необходимо пройти все фазы Kill Chain. Мы рассмотрим фазы атаки и поможем вам лучше понять противников и их методы, 
используемые при атаке для защиты себя.    

Итак, почему важно понимать, как работает Cyber Kill Chain? 

Cyber Kill Chain поможет вам понять и защититься от атак программ-вымогателей, нарушений безопасности, а также от 
расширенных постоянных угроз (APT). Вы можете использовать Cyber Kill Chain для оценки безопасности вашей сети и 
системы, выявляя недостающие элементы управления безопасностью и закрывая определенные пробелы в безопасности на 
основе инфраструктуры вашей компании.   

Понимая Kill Chain как аналитик SOC, исследователь безопасности, охотник за угрозами или специалист по реагированию 
на инциденты, вы сможете распознавать попытки вторжения и понимать цели и задачи злоумышленника.  

В этой комнате мы рассмотрим следующие фазы атаки:
- Разведка
- Вооружение
- Доставка
- Эксплуатация
- Монтаж
- Командование и контроль
- Действия по целям 


Цели обучения: В этой комнате вы узнаете о каждом этапе концепции Cyber Kill Chain, преимуществах и недостатках 
традиционной модели Cyber Kill Chain.  

Результат: В результате вы будете готовы распознавать различные фазы или этапы атаки, проводимой противником, и 
сможете разорвать «цепочку убийств».  

### Ответить на вопросы ниже
Прочитайте вышеизложенное.
```commandline
Ответ не нужен
```

## Задание 2
Чтобы понять, что такое разведка с точки зрения нападающего, давайте сначала дадим определение термину «разведка». 

Разведка — это обнаружение и сбор информации о системе и жертве. Фаза разведки — это фаза планирования для противников.

OSINT (Open-Source Intelligence) также относится к разведке. OSINT — это первый шаг, который должен выполнить 
злоумышленник для осуществления дальнейших фаз атаки.  Злоумышленнику необходимо изучить жертву, собрав всю 
доступную информацию о компании и ее сотрудниках, такую как размер компании, адреса электронной почты, номера 
телефонов из общедоступных ресурсов, чтобы определить лучшую цель для атаки.    

Дополнительную информацию об OSINT вы также можете узнать из статьи Varonis «Что такое OSINT?»

Давайте посмотрим на это с точки зрения злоумышленника, который изначально не знает, какую компанию он хочет атаковать. 

Вот сценарий: злоумышленник, называющий себя «Мегатрон», решает провести очень сложную атаку, которую он планировал 
годами; он изучал и исследовал различные инструменты и методы, которые могли бы помочь ему добраться до последней 
фазы Cyber Kill Chain. Но сначала ему нужно начать с фазы разведки.  

Для того, чтобы действовать на этом этапе, злоумышленнику необходимо провести OSINT. Давайте рассмотрим сбор адресов 
электронной почты. 


Сбор адресов электронной почты — это процесс получения адресов электронной почты из общедоступных, платных или 
бесплатных сервисов. Злоумышленник может использовать сбор адресов электронной почты для фишинговой атаки (тип 
атаки социальной инженерии, используемый для кражи конфиденциальных данных, включая учетные данные для входа и 
номера кредитных карт). У злоумышленника будет большой арсенал инструментов, доступных для целей разведки. Вот 
некоторые из них:    

- theHarvester — помимо сбора адресов электронной почты, этот инструмент также способен собирать имена, поддомены, 
IP-адреса и URL-адреса, используя несколько общедоступных источников данных. 
0 Hunter.io — это инструмент для поиска адресов электронной почты, который позволит вам получить контактную 
  информацию, связанную с доменом.
- OSINT Framework  - OSINT Framework предоставляет набор инструментов OSINT на основе различных категорий.
Атакующий также будет использовать сайты социальных сетей, такие как LinkedIn, Facebook, Twitter и Instagram, чтобы 
собирать информацию о конкретной жертве, которую он хотел бы атаковать, или о компании. Информация, найденная в 
социальных сетях, может быть полезна для атакующего для проведения фишинговой атаки.  
### Ответить на вопросы ниже
Как называется инструмент Intel Gathering Tool, представляющий собой веб-интерфейс к общим инструментам и ресурсам 
для разведывательной информации с открытым исходным кодом? 
```commandline
OSINT Framework
```
Каково определение процесса сбора электронной почты на этапе разведки?
```commandline
email harvesting
```

## Задание 3
После успешного этапа разведки «Мегатрон» будет работать над созданием «оружия разрушения». Он предпочтет не 
взаимодействовать с жертвой напрямую, а вместо этого создаст «оружейник», который, по словам Lockheed Martin, 
объединяет вредоносное ПО и эксплойт в готовую полезную нагрузку. Большинство злоумышленников обычно используют 
автоматизированные инструменты для создания вредоносного ПО или обращаются к DarkWeb, чтобы купить вредоносное ПО. 
Более сложные субъекты или спонсируемые государством APT (Advanced Persistent Threat Groups) пишут свое собственное 
вредоносное ПО, чтобы сделать образец вредоносного ПО уникальным и избежать обнаружения на цели.

Давайте сначала определимся с терминологией, прежде чем анализировать фазу вооружения.

Вредоносное ПО — это программа или программное обеспечение, предназначенное для нанесения ущерба компьютеру, 
нарушения его работы или получения несанкционированного доступа к нему. 

Эксплойт — это программа или код, использующий уязвимость или недостаток приложения или системы.

Полезная нагрузка — это вредоносный код, который злоумышленник запускает в системе.

Продолжая тему нашего противника, «Мегатрон» выбирает...

«Мегатрон» решает купить уже написанную полезную нагрузку у кого-то в DarkWeb, чтобы иметь возможность потратить 
больше времени на другие фазы.  

На этапе вооружения злоумышленник должен:
- Создайте зараженный документ Microsoft Office, содержащий вредоносный макрос или скрипты VBA (Visual Basic for 
Applications). Если вы хотите узнать больше о макросах и VBA, обратитесь к статье  "Введение в макросы и VBA для 
  Script Kiddies" от TrustedSec.  
- Злоумышленник может создать вредоносную полезную нагрузку или очень сложного червя, внедрить его на USB-накопители, 
  а затем распространять их в общественных местах. Пример вируса. 
- Атакующий выберет методы Command and Control (C2) для выполнения команд на машине жертвы или доставки большего 
количества полезных нагрузок. Вы можете прочитать больше о методах C2 на MITRE ATT&CK . 
- Злоумышленник выберет внедрение бэкдора (способ доступа к компьютерной системе, включающий обход механизмов 
  безопасности).
### Ответить на вопросы ниже
Этот термин относится к группе команд, которые выполняют определенную задачу. Вы можете думать о них как о 
подпрограммах или функциях, которые содержат код, который большинство пользователей используют для автоматизации 
рутинных задач. Но злоумышленники, как правило, используют их в вредоносных целях и включают их в документы 
Microsoft Office. Можете ли вы дать для этого термин?    

```commandline
Macro
```

## Задание 4
Фаза доставки — это когда «Мегатрон» решает выбрать метод передачи полезной нагрузки или вредоносного ПО. У него 
есть множество вариантов выбора:  

- Фишинговое письмо: после проведения разведки и определения целей атаки злоумышленник создаст вредоносное письмо, 
нацеленное либо на конкретного человека (целевая фишинговая атака), либо на нескольких человек в компании. Письмо 
  будет содержать полезную нагрузку или вредоносное ПО. Например, «Мегатрон» узнает, что Нэнси из отдела продаж 
  компании A постоянно ставит отметки «Нравится» под публикациями в LinkedIn Скотта, менеджера по доставке услуг 
  компании B. Он предположит, что они оба общаются друг с другом по рабочим адресам электронной почты. «Мегатрон» 
  создаст письмо, используя имя и фамилию Скотта, сделав домен похожим на домен компании, в которой работает Скотт. 
  Затем злоумышленник отправит Нэнси поддельное письмо «Счет», содержащее полезную нагрузку.
- Распространение зараженных USB-накопителей в общественных местах, таких как кафе, парковки или на улице. 
  Злоумышленник может решить провести сложную атаку USB Drop Attack, напечатав логотип компании на USB-накопителях и 
  отправив их в компанию, выдавая себя за клиента, отправляющего USB-устройства в качестве подарка. Вы можете 
  прочитать об одной из подобных атак на сайте CSO Online «Киберпреступная группировка отправляет вредоносные 
  USB-ключи целевым компаниям».   
- Атака типа «водопад». Атака типа «водопад» — это целевая атака, направленная на определенную группу людей путем 
взлома веб-сайта, который они обычно посещают, а затем перенаправления их на вредоносный веб-сайт по выбору 
злоумышленника. Злоумышленник будет искать известную уязвимость веб-сайта и пытаться ею воспользоваться. 
Злоумышленник будет побуждать жертв посещать веб-сайт, отправляя «безобидные» электронные письма с указанием 
вредоносного URL-адреса, чтобы сделать атаку более эффективной. После посещения веб-сайта жертва непреднамеренно 
загружала вредоносное ПО или вредоносное приложение на свой компьютер. Этот тип атаки называется drive-by download. 
Примером может служить вредоносное всплывающее окно с просьбой загрузить поддельное расширение для браузера.      

### Ответить на вопросы ниже
Как называется атака, когда она осуществляется против определенной группы людей, и злоумышленник стремится заразить 
веб-сайт, который указанная группа людей постоянно посещает? 

```commandline
Watering hole attack
```

## Задание 5
Чтобы получить доступ к системе, злоумышленнику необходимо воспользоваться уязвимостью. На этом этапе «Мегатрон» 
проявил немного креативности — он создал два фишинговых письма, одно из которых содержало фишинговую ссылку на 
поддельную страницу входа в Office 365, а другое — вложение с макросом, которое запускало бы программу-вымогатель, 
когда жертва его открывает. «Мегатрон» успешно доставил свои эксплойты и заставил двух жертв щелкнуть по вредоносной 
ссылке и открыть вредоносный файл.

Получив доступ к системе, злоумышленник может использовать уязвимости программного обеспечения, системы или сервера 
для повышения привилегий или горизонтального перемещения по сети. Согласно CrowdStrike, горизонтальное перемещение 
относится к методам, которые злоумышленник использует после получения первоначального доступа к машине жертвы, чтобы 
глубже проникнуть в сеть и получить конфиденциальные данные.

Если вы хотите узнать больше об уязвимостях на уровне сервера или веб-сайта, посетите комнату TryHackMe OWASP Top 10.

На этом этапе злоумышленник также может применить «эксплойт нулевого дня». По данным FireEye, «эксплойт нулевого 
дня или уязвимость нулевого дня — это неизвестный в дикой природе эксплойт, который раскрывает уязвимость в 
программном обеспечении или оборудовании и может создать сложные проблемы задолго до того, как кто-то поймет, что 
что-то не так. Эксплойт нулевого дня не оставляет НИКАКИХ возможностей для обнаружения в самом начале».   

Вот примеры того, как злоумышленник осуществляет эксплуатацию:
- Жертва активирует эксплойт, открывая вложение к электронному письму или нажимая на вредоносную ссылку.
- Использование эксплойта нулевого дня.
- Использовать уязвимости программного обеспечения, оборудования и даже человека. 
- Злоумышленник активирует эксплойт для уязвимостей сервера.

### Ответить на вопросы ниже
Можете ли вы назвать кибератаку, нацеленную на уязвимость программного обеспечения, которая неизвестна антивирусам 
или поставщикам программного обеспечения? 

```commandline
Zero-day
```
## Задание 6
Как вы узнали из фазы «Вооружение», бэкдор позволяет злоумышленнику обойти меры безопасности и скрыть доступ.  
Бэкдор также известен как точка доступа.

Как только злоумышленник получит доступ к системе, он захочет получить к ней доступ повторно, если он потеряет 
соединение с ней или если его обнаружат и удалит первоначальный доступ, или если система будет позже исправлена. У 
него больше не будет к ней доступа. Вот тогда злоумышленнику нужно установить постоянный бэкдор. Постоянный бэкдор 
позволит злоумышленнику получить доступ к системе, которую он скомпрометировал в прошлом. Вы можете проверить 
Windows Persistence Room на TryHackMe, чтобы узнать, как злоумышленник может добиться сохранения в Windows.

Устойчивость может быть достигнута посредством:
- Установка веб-оболочки на веб-сервер. Веб-оболочка — это вредоносный скрипт, написанный на языках программирования 
  веб-разработки, таких как ASP, PHP или JSP, который используется злоумышленником для сохранения доступа к 
  скомпрометированной системе. Из-за простоты веб-оболочки и форматирования файлов (.php, .asp, .aspx, .jsp и т. д.) 
  ее может быть трудно обнаружить, и она может быть классифицирована как безвредная. Вы можете ознакомиться с этой 
  замечательной статьей, опубликованной Microsoft, о различных атаках веб-оболочек.
- Установка бэкдора на машину жертвы. Например, злоумышленник может использовать Meterpreter для установки бэкдора на 
  машину жертвы. Meterpreter — это полезная нагрузка Metasploit Framework, которая предоставляет интерактивную 
  оболочку, из которой злоумышленник может удаленно взаимодействовать с машиной жертвы и выполнять вредоносный код.
- C eсmоm или mодификация служб Windows. Эта техника известна как T1543.003 в MITRE ATT&CK (MITRE ATT&CK® — это 
  база знаний о тактиках и методах противника, основанная на реальных сценариях). Злоумышленник может создавать или 
  модифицировать службы Windows для регулярного выполнения вредоносных скриптов или полезных нагрузок как части 
  сохранения. Злоумышленник может использовать такие инструменты, как sc.exe (sc.exe позволяет создавать, запускать,
  останавливать, опрашивать или удалять любые службы Windows) и Reg для изменения конфигураций служб. Злоумышленник 
  также может скрыть вредоносную полезную нагрузку, используя имя службы, которое, как известно, связано с 
  операционной системой или легитимным программным обеспечением.
- Добавление записи в «ключи запуска» для вредоносной нагрузки в реестре или папке автозагрузки. При этом полезная 
  нагрузка будет выполняться каждый раз, когда пользователь входит в систему на компьютере. Согласно MITRE ATT&CK, 
  существует местоположение папки автозагрузки для отдельных учетных записей пользователей и общесистемная папка 
  автозагрузки, которая будет проверяться независимо от того, какая учетная запись пользователя входит в систему.  
Подробнее о сохранении ключей запуска реестра и папок автозагрузки можно прочитать в одном из методов MITRE ATT&CK.

На этом этапе злоумышленник также может использовать технику Timestomping, чтобы избежать обнаружения судебным 
следователем, а также чтобы вредоносная программа выглядела как часть легитимной программы. Техника Timestomping 
позволяет злоумышленнику изменять временные метки файла, включая время изменения, доступа, создания и изменения.   

### Ответить на вопросы ниже
Можете ли вы предоставить методику, используемую для изменения атрибутов времени файла, чтобы скрыть новые или 
изменения в существующих файлах? 
```commandline
Timestomping
```
Можете ли вы назвать вредоносный скрипт, размещенный злоумышленником на веб-сервере для сохранения доступа к 
скомпрометированной системе и позволяющий осуществлять удаленный доступ к веб-серверу? 
```commandline
Web shell
```

## Задание 7
Получив настойчивость и запустив вредоносное ПО на машине жертвы, «Megatron» открывает канал C2 (Command and Control)
через вредоносное ПО для удаленного управления и манипулирования жертвой. Этот термин также известен как C&C или C2 
Beaconing как тип вредоносной коммуникации между сервером C&C и вредоносным ПО на зараженном хосте. Зараженный хост 
будет постоянно общаться с сервером C2 ; отсюда также появился термин beaconing.    

Скомпрометированная конечная точка будет взаимодействовать с внешним сервером, настроенным злоумышленником, чтобы 
установить канал управления и контроля. После установки соединения злоумышленник получает полный контроль над 
машиной жертвы. До недавнего времени IRC (Internet Relay Chat) был традиционным каналом C2, используемым 
злоумышленниками. Теперь это не так, поскольку современные решения безопасности могут легко обнаруживать вредоносный 
трафик IRC.    

Наиболее распространенные каналы C2, используемые злоумышленниками в настоящее время:
- Протоколы HTTP на порту 80 и HTTPS на порту 443 — этот тип маяков смешивает вредоносный трафик с легитимным 
  трафиком и может помочь злоумышленнику обойти межсетевые экраны.   
- DNS (сервер доменных имен). Зараженная машина делает постоянные DNS- запросы к DNS- серверу, принадлежащему 
  злоумышленнику, этот тип C2-связи также известен как DNS- туннелирование.
Важно отметить, что владельцем инфраструктуры C2 может быть злоумышленник или другой скомпрометированный хост.

### Ответить на вопросы ниже
Что такое C2-коммуникация, при которой жертва отправляет регулярные DNS-запросы на DNS-сервер и домен, принадлежащие 
злоумышленнику?  

```commandline
DNS Tunneling
```

## Задание 8
Пройдя шесть фаз атаки, «Мегатрон» наконец может достичь своих целей, что означает принятие мер по первоначальным целям. Имея доступ к клавиатуре, атакующий может добиться следующего: 
- Соберите учетные данные пользователей.
- Выполнить повышение привилегий (получение повышенного доступа, например, доступа администратора домена с рабочей 
станции, используя неправильную конфигурацию). 
- Внутренняя разведка (например, злоумышленник может взаимодействовать с внутренним программным обеспечением, чтобы 
найти его уязвимости). 
- Горизонтальное перемещение по среде компании.
- Собирайте и извлекайте конфиденциальные данные.
- Удаление резервных копий и теневых копий. Shadow Copy — это технология Microsoft, которая позволяет создавать 
резервные копии, моментальные снимки файлов компьютера или томов.  
- Перезаписать или повредить данные.
### Ответить на вопросы ниже
Можете ли вы предоставить технологию, включенную в Microsoft Windows, которая позволяет создавать резервные копии 
или моментальные снимки файлов или томов на компьютере, даже когда они используются?  

```commandline
Shadow Copy
```

## Задание 9
Мы очень надеемся, что вам понравилась эта комната. Чтобы закрепить ваши знания, давайте проведем практический анализ. 

Вот реальный сценарий, с которым вам предстоит разобраться:

Печально известная кибератака Target, которая привела к одной из крупнейших в истории утечек данных, произошла 27 
ноября 2013 года. 

19 декабря 2013 года Target опубликовала заявление , подтверждающее утечку, в котором говорилось, что в период с 27 
ноября по 15 декабря 2013 года были затронуты около 40 миллионов счетов кредитных и дебетовых карт. Target должна 
была выплатить штраф в размере 18,5 миллионов долларов в соответствии с условиями соглашения об урегулировании между 
штатами. Это считается крупнейшим урегулированием утечки данных в истории.   



Как произошла утечка данных? Разверните статический сайт , прикрепленный к этой задаче, и примените свои навыки для 
построения Cyber Kill Chain этого сценария . Вот несколько советов, которые помогут вам выполнить практическое задание: 

1. Добавьте каждый элемент из списка в правильную форму записи Kill Chain в Static Site Lab:
- эксплуатировать публичное приложение
- данные из локальной системы
- powershell
- перехват динамического компоновщика
- вложение для целевого фишинга
- резервные каналы
2. Используйте кнопку «Проверить ответы», чтобы проверить правильность ответов (неправильные ответы будут 
   подчеркнуты красным). 

### Ответить на вопросы ниже
Какой флаг появится после завершения создания статического сайта?

```commandline
THM{7HR347_1N73L_12_4w35om3}
```

## Задание 10
Cyber Kill Chain может стать отличным инструментом для улучшения защиты сети. Является ли он идеальным и может ли он 
быть единственным инструментом, на который можно положиться? Нет.  

Традиционная система Cyber Kill Chain или Lockheed Martin Cyber Kill Chain последний раз модифицировалась в 2011 
году, что, если вы помните, является датой ее создания. Отсутствие обновлений и модификаций создает пробелы в 
безопасности.   

Традиционная система Cyber Kill Chain была разработана для защиты периметра сети и защиты от вредоносных программ. 
Но в наши дни угрозы кибербезопасности значительно развились, и злоумышленники объединяют несколько TTP (тактик, 
методов и процедур) для достижения своей цели. Злоумышленники способны обходить разведданные об угрозах, изменяя 
хэши файлов и IP-адреса. Компании, занимающиеся решениями в области безопасности, разрабатывают такие технологии, 
как ИИ (искусственный интеллект) и различные алгоритмы для обнаружения даже незначительных и подозрительных изменений.     

Поскольку основное внимание в рамках этой структуры уделяется доставке вредоносного ПО и сетевой безопасности, 
традиционная Cyber Kill Chain не сможет идентифицировать внутренние угрозы . Согласно CISA ,  «внутренняя угроза — 
это возможность для внутреннего лица использовать свой авторизованный доступ или понимание организации, чтобы 
нанести вред этой организации».   

Мы рекомендуем не только полагаться на традиционную модель Cyber Kill Chain, но и обращаться к MITRE ATT&CK, а 
также  Unified Kill Chain  , чтобы применить более комплексный подход к вашим методологиям защиты.   

### Ответить на вопросы ниже
Прочитайте вышеизложенное.
```commandline
Ответ не нужен
```
[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)