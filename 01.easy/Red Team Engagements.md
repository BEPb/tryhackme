[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Red Team Engagements](https://tryhackme.com/r/room/redteamengagements) 

Всего 10 заданий:
## Задание 1
Ключ к успешному взаимодействию — хорошо скоординированное планирование и коммуникация между всеми вовлеченными 
сторонами. В этой комнате будут рассмотрены различные компоненты взаимодействия красной команды, а также 
планирование и документирование кампании для взаимодействия красной команды.  

Сражения красной команды бывают разных видов, в том числе:
- Настольные учения 
- Эмуляция противника
- Физическая оценка 
### Цели обучения

- Понимать компоненты и функции взаимодействия красной команды.
- Узнайте, как правильно спланировать взаимодействие с учетом потребностей, доступных ресурсов и ТТП. 
- Понять, как составлять документацию по проекту в соответствии с целями клиента.
Для этого номера не требуется никакой предварительной информации или знаний.

### Ответить на вопросы ниже
Прочитайте вышеизложенное и перейдите к следующему заданию.
```commandline
Ответ не нужен
```

## Задание 2
Взаимодействия могут быть очень сложными и бюрократическими. Ключ к успешному взаимодействию — четко определенные 
цели или задачи клиента. Цели клиента должны обсуждаться между клиентом и красной командой, чтобы создать 
взаимопонимание между обеими сторонами относительно того, что ожидается и предоставляется. Установленные цели 
являются основой для остальной документации и планирования взаимодействия.   

Без четких и конкретных целей и ожиданий вы готовитесь к очень неструктурированной и незапланированной кампании. 
Цели задают тон для остальной части взаимодействия. 

При оценке целей клиента и планировании деталей взаимодействия вам часто придется решать, насколько целенаправленной 
будет оценка. 

Вовлеченности можно разделить на категории между общим внутренним/сетевым тестом на проникновение или 
целенаправленной эмуляцией противника. Целенаправленная эмуляция противника определит конкретную APT или группу для 
эмуляции в рамках вовлеченности. Обычно это будет определяться на основе групп, нацеленных на конкретные отрасли 
компании, т. е. финансовые учреждения и  APT38 . Внутренний или сетевой тест на проникновение будет следовать 
аналогичной структуре, но часто будет менее целенаправленным и будет использовать больше стандартных TTP.     


Конкретные особенности подхода будут зависеть от каждого конкретного случая взаимодействия, определяемого целями клиента.

Цели клиента также повлияют на общие правила взаимодействия и объем работ.

Эти темы будут более подробно рассмотрены в Задании 6.

Цели клиента только устанавливают базовое определение целей клиента в рамках взаимодействия. Конкретные планы 
взаимодействия расширят цели клиента и определят специфику взаимодействия. Планы взаимодействия будут рассмотрены 
позже в этой комнате.  

Следующим краеугольным камнем точного и прозрачного взаимодействия является четко определенная область действия. 
Область действия взаимодействия будет различаться в зависимости от организации и того, как выглядит ее 
инфраструктура и положение. Область действия клиента, как правило, определяет, что вы  не можете делать или на что 
нацеливаться; она также может включать то, что вы  можете  делать или на что нацеливаться. Хотя цели клиента могут 
обсуждаться и определяться вместе с командой, предоставляющей услуги, область действия должен устанавливать только 
клиент. В некоторых случаях красная команда может обсуждать жалобу на область действия, если это влияет на 
взаимодействие. Они должны иметь четкое представление о своей сети и последствиях оценки. Специфика области действия 
и формулировки всегда будут выглядеть по-разному, ниже приведен пример того, как может выглядеть словоблудие в 
области действия клиента.        

Никакой утечки данных.
Производственные серверы недоступны.
10.0.3.8/18 выходит за рамки рассмотрения.
10.0.0.8/20 находится в области действия.
Простой системы не допускается ни при каких обстоятельствах.
Раскрытие персональных данных запрещено.
При анализе целей или объемов клиента с точки зрения красной команды важно понимать более глубокий смысл и 
последствия. При анализе у вас всегда должно быть динамическое понимание того, как ваша команда будет подходить к 
проблемам/целям. При необходимости вы должны написать свои планы взаимодействия или начать их только с чистого 
чтения целей и объема клиента.   

#### Ответить на вопросы ниже
Прочитайте пример целей клиента и ответьте на вопросы ниже.
```commandline
Ответ не нужен
```
Ниже приведен пример целей клиента для зрелой организации с сильной позицией в области безопасности.

Пример 1 — Глобальные предприятия:

Цели:
- Выявите неправильные конфигурации системы и слабые места сети.
- Сосредоточьтесь на внешних системах.
- Определить эффективность систем обнаружения и реагирования на конечные точки.
- Оцените общую ситуацию с безопасностью и меры реагирования.
- SIEM и меры обнаружения.
- Исправление.
- Сегментация DMZ и внутренних серверов.
- Использование белых карточек допускается в зависимости от времени и продолжительности простоя.
Оцените последствия раскрытия и утечки данных.

Объем:
- Простой системы не допускается ни при каких обстоятельствах.
- Любая форма DDoS или DoS запрещена.
- Запрещено использование любого вредоносного ПО, включая программы-вымогатели и другие их разновидности.
- Эксфильтрация PII запрещена. Используйте произвольные данные эксфильтрации.
- Атаки на системы в пределах 10.0.4.0/22 разрешены.
- Атаки на системы в пределах 10.0.12.0/22 запрещены.

Bean Enterprises будет внимательно следить за взаимодействием с DMZ и критически важными/производственными системами.
- Любое взаимодействие с «*.bethechange.xyz» запрещено.
- Любое взаимодействие с «*.globalenterprises.thm» разрешено.
```commandline
Ответ не нужен
```
Какой диапазон CIDR разрешен для атаки?
```commandline
10.0.4.0/22
```
Разрешено ли использование белых карточек? (Да/Нет)
```commandline
Y
```
Разрешен ли вам доступ к "*.bethechange.xyz?" (Да/Нет)
```commandline
N
```

## Задание 3
Правила взаимодействия (RoE) представляют собой юридически обязывающее описание целей и сферы охвата клиента с более 
подробной информацией об ожиданиях взаимодействия между обеими сторонами. Это первый «официальный» документ в 
процессе планирования взаимодействия, требующий надлежащего разрешения между клиентом и красной командой. Этот 
документ часто выступает в качестве общего договора между двумя сторонами; также могут использоваться внешний 
договор или другие NDA ( N on- D isclosure  A agreement).    

Формат и формулировка RoE имеют решающее значение, поскольку это юридически обязывающий договор, устанавливающий 
четкие ожидания. 

Каждая структура RoE будет определяться клиентом и командой red и может различаться по длине контента и общим 
разделам. Ниже приведена краткая таблица стандартных разделов, которые вы можете увидеть в RoE. 


При анализе документа важно помнить, что это всего лишь резюме, и его цель — быть юридическим документом. Для 
расширения RoE и целей клиента требуется дальнейшее и более глубокое планирование. 

Для этой задачи мы будем использовать сокращенный документ, адаптированный из redteam.guide.

### Ответить на вопросы ниже
Загрузите образцы правил ведения боевых действий из файлов заданий.

После загрузки прочитайте образец документа и ответьте на вопросы ниже.
```commandline
Ответ не нужен
```
Сколько явных ограничений указано?
```commandline
3
```
Какой тип доступа упоминается в документе первым?
```commandline
Phishing
```
Разрешено ли красной команде атаковать 192.168.1.0/24? (Да/Нет)
```commandline
N
```

## Задание 4
До этой задачи мы в первую очередь сосредоточились на планировании взаимодействия и документации с точки зрения 
бизнеса. Планирование кампании использует информацию, полученную и запланированную из целей клиента и RoE, и 
применяет ее к различным планам и документам, чтобы определить, как и что будет делать красная команда.  

Каждая внутренняя красная команда будет иметь свою методологию и документацию для планирования кампании. Мы покажем 
один подробный набор планов, который обеспечивает точную коммуникацию и подробную документацию. Краткое изложение 
кампании, которое мы будем использовать, состоит из четырех различных планов, различающихся по глубине и охвату, 
адаптированных из документов военных операций. Каждый план можно найти в таблице ниже с кратким пояснением.   

Другим примером плана кампании является контрольный список вовлеченности redteam.guide. Контрольный список, 
который можно найти здесь, действует как более обобщенный подход к планированию кампании и необходимой информации. 

В предстоящих задачах мы более подробно рассмотрим эти планы, документацию и особенности каждого из них, глубоко 
погрузившись в планирование кампании. 

### Ответить на вопросы ниже
Прочитайте вышеизложенное и переходите к документации по взаимодействию.
```commandline
Ответ не нужен
```

## Задание 5
Документация по вовлечению — это расширение планирования кампании, где идеи и мысли по планированию кампании 
официально документируются. В этом контексте термин «документ» может быть обманчивым, поскольку некоторые планы не 
требуют надлежащей документации и могут быть такими простыми, как электронное письмо; это будет рассмотрено далее в 
этой задаче.   

В этом задании мы рассмотрим технический обзор содержания каждого плана кампании, прежде чем рассматривать сами 
планы и документы в следующих заданиях. 

Как клиент будет устранять нарушения? Это можно включить в отчет или обсудить на встрече клиента и красной команды.
### Ответить на вопросы ниже
Прочитайте вышеизложенное и переходите к предстоящим конкретным задачам по выполнению задания.
```commandline
Ответ не нужен
```
## Задание 6
Концепция операции (CONOPS) является частью плана взаимодействия, в котором подробно описывается общий обзор процесса взаимодействия; мы можем сравнить это с исполнительным резюме отчета о тесте на проникновение. Документ будет служить в качестве справочного материала для бизнеса/клиента и справочного материала для красной ячейки, чтобы строить и расширять дальнейшие планы кампании.

Документ CONOPS должен быть написан с точки зрения полутехнического резюме, предполагая, что целевая аудитория/читатель имеет нулевые или минимальные технические знания. Хотя CONOPS должен быть написан на высоком уровне, вы не должны упускать такие детали, как общий инструментарий, целевая группа и т. д. Как и в большинстве документов красной команды, не существует установленного стандарта документа CONOPS; ниже приведено описание критических компонентов, которые должны быть включены в CONOPS

имя клиента
Поставщик услуг
Временные рамки
Общие цели/этапы
Другие цели обучения (Эфильтрация)
Планируемые к использованию высокоуровневые инструменты/методы
Группа угроз для подражания (если таковая имеется)
Ключ к написанию и пониманию CONOPS — предоставить ровно столько информации, чтобы получить общее представление обо 
всем происходящем. CONOPS должен быть легким для чтения и содержать четкие определения и пункты, которые читатели смогут легко усвоить. 

### Ответить на вопросы ниже
Прочитайте пример CONOPS и ответьте на вопросы ниже.
```commandline
Ответ не нужен
```

Ниже приведен пример CONOPS для зрелой организации с сильной позицией безопасности.

Пример 1 — Holo Enterprises:

КОНОПС:

Holo Enterprises наняла TryHackMe в качестве внешнего подрядчика для проведения месячной оценки сетевой 
инфраструктуры и состояния безопасности. Кампания будет использовать предполагаемую модель нарушения, начиная с 
инфраструктуры уровня 3. Операторы будут постепенно проводить разведку и пытаться достичь целей, которые будут 
определены. Если определенные цели не будут достигнуты, красная ячейка будет перемещаться и повышать привилегии в 
сети в горизонтальном направлении. Операторы также должны выполнять и поддерживать настойчивость в течение трех 
недель. Ожидается, что доверенный агент вмешается, если красная ячейка будет идентифицирована или сожжена синей 
ячейкой на протяжении всего взаимодействия. Последний день взаимодействия зарезервирован для очистки и 
восстановления, а также для консультаций с сине-белой ячейкой.       

Заказчик запросил следующие цели обучения: оценить способность синей команды идентифицировать и защищаться от 
вторжений и атак в реальном времени, определить риск противника во внутренней сети. Красная ячейка выполнит цели, 
используя Cobalt Strike в качестве основного инструмента красной ячейки. Красной ячейке разрешено использовать 
другие стандартные инструменты, идентифицируемые только для целевой угрозы.   

На основе состояния и зрелости безопасности клиента на протяжении всего взаимодействия будет использоваться TTP 
группы угроз: FIN6. 
```commandline
Ответ не нужен
```
Как долго продлится помолвка?
```commandline
1 Month
```
Как долго эритроциты будут сохранять свою активность?
```commandline
3 Weeks
```
Какой основной инструмент используется в ходе взаимодействия?
```commandline
Cobalt Strike
```

## Задание 7
План ресурсов — это второй документ плана взаимодействия, в котором подробно излагается краткий обзор дат, требуемых 
знаний (необязательно), требований к ресурсам. План расширяет CONOPS и включает в себя конкретные детали, такие как 
даты, требуемые знания и т. д.  

В отличие от CONOPS, план ресурсов не должен быть написан как резюме; вместо этого он должен быть написан как 
маркированный список подразделов. Как и в большинстве документов красной команды, не существует стандартного набора 
шаблонов или документов плана ресурсов; ниже приведена схема примеров подразделов плана ресурсов.  

Ключ к написанию и пониманию плана ресурсов — предоставить достаточно информации для сбора необходимого, но не 
перегружать. Документ должен быть прямым и определять необходимое. 

### Ответить на вопросы ниже
Перейдите к кнопке « Просмотр сайта»   и прочитайте предоставленный план ресурсов. После завершения ответьте на вопросы ниже.
```commandline
Ответ не нужен
```
Когда закончится помолвка? (ММ/ДД/ГГГГ)
```commandline
11/14/2021
```
Какой бюджет у красной команды на расходы на облако AWS?
```commandline
$1000
```
Существуют ли какие-либо дополнительные требования для участия? (Да/Нет)
```commandline
N
```

## Задание 8
План операций — это гибкий документ(ы), который содержит конкретные детали взаимодействия и происходящих действий. План расширяет текущий CONOPS и должен включать большую часть конкретной информации о взаимодействии; ROE также может быть размещен здесь в зависимости от глубины и структуры ROE .

План операций должен следовать схеме написания, аналогичной плану ресурсов, с использованием маркированных списков и небольших подразделов. Как и в случае с другими документами красной команды, стандартного набора шаблонов или документов плана операций не существует; ниже приведена схема примеров подразделов в плане операций.

Заголовок
Написание кадров
Даты
Клиент
Условия остановки/прекращения (могут быть помещены в ROE в зависимости от глубины)
Требуемый/назначенный персонал
Конкретные запланированные TTP и атаки
План коммуникаций
Правила ведения боевых действий (необязательно)
Самым заметным дополнением к этому документу является план коммуникаций. План коммуникаций должен суммировать, как красная ячейка будет общаться с другими ячейками и клиентом в целом. У каждой команды будет свой предпочтительный метод общения с клиентами. Ниже приведен список возможных вариантов, которые команда выберет для общения.

vectr.io
Электронная почта
Слак
### Ответить на вопросы ниже
Перейдите к кнопке « Просмотр сайта»   и прочитайте предоставленный план операций. После завершения ответьте на вопросы ниже.
```commandline
Ответ не нужен
```
Какой метод фишинга будет использоваться на этапе первоначального доступа?
```commandline
Spearphishing
```
Какой сайт будет использоваться для связи между клиентом и Red Cell?
```commandline
vectr.io
```
В случае сбоя в работе системы красная ячейка продолжит выполнение задания. (Перед/после)
```commandline
F
```

## Задание 9
План миссии — это документ, специфичный для ячейки, в котором подробно описываются точные действия, которые должны 
быть выполнены операторами. Документ использует информацию из предыдущих планов и назначает им действия. 

То, как документ будет написан и детализирован, будет зависеть от команды; поскольку это документ для внутреннего 
использования, структура и детализация имеют меньшее влияние. Как и во всех документах, изложенных в этой комнате, 
презентация может варьироваться; этот план может быть таким же простым, как отправка электронной почты всем 
операторам. Ниже приведен список минимальной детализации, которую ячейки должны включить в план.   

### Ответить на вопросы ниже
Перейдите к кнопке « Просмотр сайта» и прочитайте предоставленный план миссии. После завершения ответьте на вопросы ниже.
```commandline
Ответ не нужен
```
Когда закончится фишинговая кампания? (мм/дд/гггг)
```commandline
10/23/2021
```
Разрешено ли вам атаковать 10.10.6.78? (Да/Нет)
```commandline
N
```
При возникновении условия остановки вам следует продолжить работу и самостоятельно, без руководителя группы, найти 
решение. (Переходный период) 
```commandline
F
```

## Задание 10
В этой комнате мы рассмотрели, как можно количественно перевести планы кампании в документы и подготовиться к 
успешному взаимодействию с красной командой. Постоянной темой в этой комнате было то, что у каждой красной команды 
будут свои внутренние документы и способ ведения дел. Это важная концепция, которую нужно понять при переходе в 
реальный мир. Эта комната служит только руководством, чтобы вы привыкли к концепциям и идеям, и предоставляет основу 
для использования, а не как окончательное пошаговое руководство. При планировании взаимодействия помните, что ваша 
цель номер 1 — достичь целей клиента.

Планирование и документирование часто упускаются из виду, хотя они имеют решающее значение для успешного взаимодействия.

### Ответить на вопросы ниже
Прочитайте вышеизложенное и продолжайте обучение!

```commandline
Ответ не нужен
```
[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)