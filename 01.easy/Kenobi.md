[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Kenobi](https://tryhackme.com/r/room/kenobi) 

Всего 4 задания:
## Задание 1
В этой комнате мы рассмотрим доступ к общему ресурсу Samba, манипулирование уязвимой версией proftpd для получения 
начального доступа и повышения ваших привилегий до уровня root с помощью двоичного файла SUID.

### Ответить на вопросы ниже
Убедитесь, что вы подключены к нашей сети, и разверните машину.
```commandline
Ответ не требуется
```
Просканируйте машину с помощью nmap, сколько портов открыто?
```commandline
7
```

## Задание 2
Samba — это стандартный набор программ для взаимодействия Windows с Linux и Unix. Он позволяет конечным 
пользователям получать доступ и использовать файлы, принтеры и другие общие ресурсы в интрасети компании или 
Интернете. Его часто называют сетевой файловой системой.  

Samba основана на общем клиент-серверном протоколе Server Message Block (SMB). SMB разработан только для Windows, 
без Samba другие компьютерные платформы были бы изолированы от машин Windows, даже если бы они были частью той же сети. 

### Ответить на вопросы ниже
Используя nmap, мы можем получить доступ к машинам по SMB-ресурсам.

Nmap имеет возможность запуска для автоматизации широкого спектра сетевых задач. Есть скрипт для перечисления общих 
ресурсов! 
```commandline
nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse КОМПЬЮТЕРНЫЙ_IP
```
SMB имеет два порта: 445 и 139.


Сколько общих ресурсов было найдено с помощью команды nmap, указанной выше?
```commandline
3
```
В большинстве дистрибутивов Linux smbclient уже установлен. Давайте проверим один из ресурсов.
```commandline
smbclient // MACHINE_IP /анонимный
```
Используя свой компьютер, подключитесь к его сетевому ресурсу.
После подключения выведите список файлов на общем ресурсе. Какой файл вы видите?
```commandline
log.txt
```
Вы также можете рекурсивно загрузить общий ресурс SMB. Введите имя пользователя и пароль как nothing.
```commandline
smbget -R smb:// МАШИННЫЙ_IP /anonymous
```

Откройте файл на общем ресурсе. Найдено несколько интересных вещей.

Информация, сгенерированная для Кеноби при генерации ключа SSH для пользователя
Информация о сервере ProFTPD.
На каком порту работает FTP?
```commandline
21
```
Предыдущее сканирование портов nmap показало, что порт 111 работает со службой rpcbind. Это просто сервер, который 
преобразует номер программы удаленного вызова процедур (RPC) в универсальные адреса. Когда запускается служба RPC, 
она сообщает rpcbind адрес, по которому она слушает, и номер программы RPC, которую она готова обслуживать.

В нашем случае порт 111 — это доступ к сетевой файловой системе. Давайте используем nmap для перечисления этого.
```commandline
nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount КОМПЬЮТЕР_IP
```

Какую гору мы можем увидеть?
```commandline
/var
```

## Задание 3
ProFtpd — это бесплатный FTP- сервер с открытым исходным кодом, совместимый с системами Unix и Windows. Он также был 
уязвим в прошлых версиях программного обеспечения. 

### Ответить на вопросы ниже
Давайте получим версию ProFtpd. Используйте netcat для подключения к машине на порту FTP.

Какая версия?

1.3.5
```commandline
Ответ не нужен
```
Мы можем использовать searchsploit для поиска эксплойтов для определенной версии программного обеспечения.

Searchsploit — это по сути просто инструмент командной строки для поиска по Exploit-db.com.

Сколько существует эксплойтов для работы ProFTPd?


```commandline
4
```
Вы должны были найти эксплойт из модуля mod_copy ProFtpd . 
Модуль mod_copy реализует команды SITE CPFR и SITE CPTO, которые можно использовать для копирования 
файлов/каталогов из одного места в другое на сервере. Любой неаутентифицированный клиент может использовать эти 
команды для копирования файлов из любой части файловой системы в выбранное место назначения.

Мы знаем, что служба FTP запущена от имени пользователя Kenobi (из файла на общем ресурсе), и для этого пользователя 
сгенерирован ключ SSH.
```commandline
Ответ не нужен
```
Теперь мы скопируем закрытый ключ Кеноби с помощью команд SITE CPFR и SITE CPTO.
Мы знали, что каталог /var был монтированием, которое мы могли видеть (задача 2, вопрос 4). Поэтому теперь мы 
переместили закрытый ключ Кеноби в каталог /var/tmp.
```commandline
Ответ не нужен
```
Давайте смонтируем каталог /var/tmp на нашу машину.
```commandline
mkdir /mnt/kenobiNFS
mount МАШИНА_IP:/var /mnt/kenobiNFS
ls -la /mnt/kenobiNFS
```
Теперь у нас есть сетевое монтирование на нашей развернутой машине! Мы можем перейти в /var/tmp и получить закрытый 
ключ, а затем войти в учетную запись Кеноби.

Что такое пользовательский флаг Кеноби (/home/kenobi/user.txt)?
```commandline
d0b0f3f53b6caa532a83915e19224899
```

## Задание 4
Давайте сначала разберемся, что такое SUID, SGID и Sticky Bits.

- Разрешение	В файлах	О каталогах
- Бит SUID	Пользователь запускает файл с разрешения владельца файла .	-
- Бит SGID	Пользователь запускает файл с разрешения владельца группы .

- Липкий бит	Нет смысла	Пользователям запрещено удалять файлы других пользователей.

### Ответить на вопросы ниже
Биты SUID могут быть опасными, некоторые двоичные файлы, такие как passwd, необходимо запускать с повышенными 
привилегиями (так как они сбрасывают ваш пароль в системе), однако другие пользовательские файлы, которые могут 
иметь бит SUID, могут привести к разного рода проблемам.

Для поиска в системе файлов такого типа выполните следующую команду: `find / -perm -u=s -type f 2>/dev/null`

Какой файл выглядит особенно необычно? 


```commandline
/usr/bin/menu
```
Запустите двоичный файл, сколько вариантов появится?

```commandline
3
```
Strings — это команда в Linux, которая ищет в двоичном файле строки, понятные человеку.

Это показывает, что исполняемый файл запущен без полного пути (например, не использует /usr/bin/curl или /usr/bin/uname).

Поскольку этот файл запускается с привилегиями пользователя root, мы можем манипулировать нашим путем, чтобы 
получить оболочку root. 

Мы скопировали оболочку /bin/sh, назвали ее curl, дали ей правильные разрешения и затем указали ее местоположение в 
нашем пути. Это означало, что когда исполняемый файл /usr/bin/menu был запущен, он использовал нашу переменную пути, 
чтобы найти исполняемый файл "curl".. Который на самом деле является версией /usr/sh, а также этот файл, запущенный 
от имени root, запускает нашу оболочку от имени root!
```commandline
Ответ не нужен
```
Что такое корневой флаг (/root/root.txt)?


```commandline
177b3cd8562289f37382721c28381f02
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)