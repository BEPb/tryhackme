[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [MAL: Researching](https://tryhackme.com/r/room/malresearching) 

Всего 7 заданий:
## Задание 1
Добро пожаловать в  раздел 2. MP: Исследования  моей  серии анализов вредоносных программ . 

Хотя мы рассмотрим некоторую теорию криптографии, я сохранил ее актуальность и визуализировал ее как можно лучше. Я 
предоставил некоторые ресурсы в конце комнаты в задании «Дополнительное чтение» для каждой из затронутых тем.

Вы можете ожидать, что узнаете о контрольных суммах файлов, почему эти значения важны не только в повседневной жизни,
но и как мы можем использовать их в анализе вредоносных программ. Первые несколько заданий будут теоретизированы, 
так что потерпите меня. Однако ближе к концу комнаты вы будете генерировать свои собственные контрольные суммы, 
изучать, как использовать онлайн-песочницу, и анализировать отчеты, созданные с их помощью.

.:.

Как всегда, любые отзывы относительно контента, охваченного в серии до сих пор, очень ценятся. Я всегда приветствую 
идеи тем, инструментов и методов, которые можно было бы охватить.

.:.

~ CMNatic

### Ответьте на вопросы ниже
Пойдем!
```commandline
Ответ не нужен
```

## Задание 2
Разверните экземпляр, прикрепленный к этой задаче, щелкнув левой кнопкой мыши зеленую кнопку «Развернуть» в правом 
верхнем углу этой задачи!

Пока что вам не нужно взаимодействовать с экземпляром — учетные данные будут предоставлены позже в комнате. Но, 
пожалуйста, убедитесь, что вы подключены к  TryHackMe OpenVPN,  прежде чем продолжить.

### Ответьте на вопросы ниже
Я развернул свой экземпляр и убедился, что подключен к THM VPN!

```commandline
Ответ не нужен
```

## Задание 3
Что такое контрольные суммы?

Контрольные суммы являются важным атрибутом в сообществе аналитиков вредоносных программ. Но, более того, в более 
широкой индустрии информационных технологий (ИТ). Проще говоря, эти контрольные суммы являются результатом 
математических операций над входными данными, где выходными данными является последовательность символов.

В конечном счете, разметка данных в компьютерной системе является двоичной, просто единицы и нули, где каждое 
значение является «битом». Криптографическая контрольная сумма использует эти «биты» в качестве входных данных для 
этих математических операций; чем выше сложность применяемых математических операций, тем более безопасной считается 
контрольная сумма. Эти контрольные суммы также обычно называют «хэшами».

Из-за того, как работают криптографические алгоритмы, независимо от размера входных данных, например файла, длина 
выходных данных останется прежней. Например, возьмите алгоритм и примените эти математические операции к двум файлам,
перечисленным ниже:

- Имя файла	Размер файла
- Мое_Видео.mp4	4ГБ
- Мое_селфи.png	10 МБ

Хотя размер файла сильно отличается, длина вычисленного вывода будет такой же, хотя его содержимое будет другим. 
Например, в этом алгоритме, который я привел в качестве примера, длина вывода составляет 12 символов:


- Имя файла Размер файла	Вывод алгоритма
- Мое_Видео.mp4	4ГБ	3DEFAD92D23AD
- Мое_селфи.png	10 МБ	FFDE312DAEFF


Хотя значения, вычисленные алгоритмом, отличаются от каждого файла, они остаются одинаковой длины - независимо от 
размера файла. Поскольку два файла имеют разное содержимое, в этом случае каждый вывод уникален для файла.

Повышенная сложность математических операций значительно снижает вероятность того, что два файла с разным содержимым 
дадут одинаковый результат. Если это произойдет, это известно как « хэш-коллизия ». Объяснение математики, стоящей 
за тем, как это происходит, выходит за рамки данной статьи, однако это случается крайне редко. Для сравнения, 
алгоритм хэширования MD5 , который является известным недавним примером,  потребует хэширования 6 миллиардов файлов 
в секунду — в среднем в течение 100 лет . ( Kornel. , 2008)

Хотя можно с уверенностью сказать, что вероятность возникновения коллизии хешей довольно низка, математически это 
возможно. Например, исследователи (Stevens et al., 2017) сообщают о Shattered.io , где им удалось продемонстрировать 
коллизию хеша SHA1 на практике. Я настоятельно рекомендую уделить время прочтению отчета, чтобы понять, как эти 
коллизии можно превратить в доказательство концепций, а также оценить, почему такие открытия важны в мире 
информационной безопасности.


Можно с уверенностью сказать, что эта ошибка случается довольно редко, хотя математически она возможна. Ниже мы это 
наглядно продемонстрируем.

Контрольные суммы Продолжение:

Давайте немного более подробно рассмотрим контрольные суммы. В сфере ИТ контрольные суммы используются для проверки 
целостности данных. Вы когда-нибудь копировали файл на USB-накопитель, а Windows жаловалась, что файл теперь 
поврежден? Это повреждение данных; двоичные данные были где-то утеряны в процессе передачи из-за программной или 
аппаратной ошибки.

Из-за того, как работают эти криптографические алгоритмы, а именно, они выдают результат после обработки фрагмента 
данных в каждом отдельном бите, контрольные суммы отлично подходят для проверки того, полностью ли данные 
скопированы в новое место. Люди не могут сравнивать двоичные данные (которые могут быть миллионами сравниваемых 
значений) двух файлов, чтобы убедиться в их правильности. Однако они могут сравнивать два фиксированных значения 
длины — например, выходную длину алгоритма, указанного выше, в 12 символов. В реальном мире некоторые популярные 
алгоритмы — это SHA1, SHA-256 и, в некоторых случаях, SHA-512, где выходная длина каждого алгоритма варьируется в 
зависимости от его безопасности.

Ниже мы наглядно продемонстрируем, как работают алгоритмы хеширования:

Посмотрите, как содержимое первых двух файлов совпадает с " TryHackMe ". При использовании одного и того же 
алгоритма сгенерированная контрольная сумма одинакова. Это происходит потому, что двоичные данные этих двух файлов 
идентичны, поэтому один и тот же алгоритм выдаст один и тот же результат. Это не коллизия хэшей.

Обратите внимание, что третий файл с тем же содержимым " TryHackMe ", дающий те же двоичные данные, имеет другую 
контрольную сумму. Это связано с тем, что алгоритм, в данном случае  SHA256  вместо предыдущего  MD5 , использует 
другие математические операции. Математика, лежащая в основе этого алгоритма, сложнее по сравнению с MD5 , поэтому 
длина выходной строки больше.

Наконец, обратите внимание на скриншот ниже (последний файл на скриншоте выше, просто обрезан для ясности), что 
содержимое файла теперь « TryHack eM », а не « TryHackMe »:

Хотя тот же алгоритм, который использовался в первых двух файлах, используется и в этом файле ( MD5 ), поскольку 
содержимое теперь отличается (хотя и очень похоже), вывод теперь отличается при сравнении.

 Визуализация коллизии хешей:

Ладно, потерпите меня. Я понимаю, что это было довольно теоретически тяжело... Мы почти у цели, я обещаю! Примеры 
скриншотов ниже показывают, как будут отличаться различные выходные данные в зависимости от используемого алгоритма 
или содержимого файла. Здесь мы рассмотрим пример коллизии хэшей:

Содержимое двух файлов выше очень разное. В реальном мире различия могли бы заключаться в простом добавлении или 
удалении персонажа, но я сделал этот пример драматизированным, чтобы лучше визуализировать вещи.

Коллизия хешей — это когда два файла с разным содержимым (например, два вышеприведенных) имеют одинаковый вывод. С 
точки зрения математики эти файлы идентичны. Однако по содержимому мы знаем, что это совсем не так.

### Ответьте на вопросы ниже
Назовите термин для отдельной части двоичного кода.
```commandline
Bit
```
Как еще называют контрольные суммы?
```commandline
Hashes
```
Назовите алгоритм, который следует в серии после SHA-256.
```commandline
SHA-512
```
Согласно этой задаче, сколько времени вам понадобится для хеширования 6 миллионов файлов, прежде чем произойдет коллизия хэшей MD5?
```commandline
100 Years
```
Кто разработал алгоритм MD5?
```commandline
Ronald Rivest
```

## Задание 4
Что такое онлайн-песочница?

 Иногда лучше доверить все экспертам. Это особенно верно в случае анализа вредоносных программ. Однако хосты 
 онлайн-песочниц используют более широкую аудиторию, чем просто любители. 

В контексте информационной безопасности песочница — это метод, используемый для изоляции процессов с целью 
предотвращения прямого взаимодействия друг с другом. Примеров тому множество. Например, использование Virtualbox в 
качестве гипервизора для виртуального параллельного запуска операционной системы Kali Linux на вашем основном 
компьютере. Процессы в Kali Linux взаимодействуют только посредством Virtualbox и не мешают процессам в вашей 
основной операционной системе, такой как Windows.

В контексте анализа вредоносного ПО аналитики используют виртуальные среды, такие как TryHackMe, чтобы облегчить 
анализ потенциально вредоносного кода и сделать его более безопасным.

Теперь, с учетом сказанного, вредоносное ПО известно и может легко проникнуть из этой виртуальной среды в 
хост-систему аналитика. Хотя этот риск несколько ограничен сложным вредоносным ПО, он вполне достижим. Например,  
CVE -2018-2689  — это CVE для Virtualbox, где вредоносное ПО способно покидать эту ограниченную виртуальную среду. 
Такие CVE чрезвычайно ценны и редко раскрываются из-за субъектов, которые их обнаруживают, и их намерений, а именно 
авторов вредоносного ПО.

Я написал больше о том, как вредоносное ПО обнаруживает себя в виртуальной среде и возможных путях его побега в 
своем блоге.  Из этой задачи следует вынести, что виртуальная среда сама по себе не защитит вас от вредоносного ПО. 
Проще говоря, виртуальные среды просто предоставляют удобную платформу для анализа кода.

Проще говоря, онлайн-песочница — это виртуальная среда, размещенная в сети такими сервисами, как:

- любой.запуск
- гибридный анализ

Эти сервисы великолепны, поскольку они позволяют любителям начать понимать, как ведет себя вредоносное ПО, без 
ущерба или риска для себя. Более того, онлайн-платформы песочниц очень сложны и, скорее всего, сообщат о поведении, 
которое аналитик мог пропустить.

 
При этом автоматизированный анализ не может заменить мастерство и глубину, которые может продемонстрировать и пройти 
аналитик. Например, обратная разработка. Эти платформы способны только выполнять вредоносное ПО и генерировать 
отчеты на основе взаимодействий с операционной системой, любых попыток связи и любых оставленных сигнатур. Например: 

 
- Обращение к доменному имени ( DNS- поиск и т. д.)
- Создание ключей реестра
- Чтение/запись файлов
- Создание системных процессов
- Поддержание постоянного состояния посредством записи автозагрузки системы
Все это может быть обнаружено аналитиком через некоторое время. Поэтому онлайн-песочницы полезны для предварительной 
  проверки файла.

 
Взаимодействие с онлайн-сервисом «песочницы»:

На скриншотах ниже этот образец был запущен через  службу гибридного анализа. Образец занял в общей сложности 10 
минут и был бесплатным. Отчет детализировал большое количество поведений, таких как сетевой трафик и цепочка 
выполнения, на это у аналитика ушло бы значительное количество времени.

Обратите внимание, что файл по-прежнему идентифицируется только по его «контрольным суммам»:

Если аналитик теперь выполнит поиск в Google с любой из этих контрольных сумм, отчет, сформированный этим механизмом 
изоляции, теперь будет предоставлен в виде списка для будущих аналитиков.

Продолжая читать отчет, можно выделить интересные примеры поведения, например, следующие:

Чтобы ответить на следующие вопросы,  прочитайте этот проанализированный пример  и решите следующие вопросы:

### Ответьте на вопросы ниже
Назовите ключевой термин для типа вредоносного ПО, к которому относится Emotet.
```commandline
Trojan
```
Время для исследований! Какие типы писем использует Emotet в качестве полезной нагрузки?
```commandline
spam emails
```
Начните анализировать отчет. Какова временная метка, когда был сделан анализ?
```commandline
9/16/2019, 13:54:48
```
Назовите файл, который обнаружен как «сетевой троян»
```commandline
easywindow.exe
```
Каков PID первого HTTP-запроса GET?
```commandline
2748
```
Какой единственный DNS-запрос выполняется после выполнения образца?
```commandline
blockchainjoblist.com
```

## Задание 5
Расчет контрольных сумм MD5 предоставленного материала:

Вы сможете взаимодействовать со своим экземпляром, используя встроенные функции браузера, однако вы можете 
подключиться через RDP, используя указанные ниже данные, предварительно убедившись, что вы подключены к TryHackMe VPN.

IP-адрес: MACHINE_IP

Имя пользователя:  Администратор

Пароль:  Tryhackme123!

Я предоставил вам инструменты и материалы по этому экземпляру для ответа на вопросы. Я рассмотрю получение 
контрольной суммы MD5 файла двумя методами — вы примените эти методы, чтобы ответить на вопросы для этого задания.

Необходимый материал находится на  рабочем столе пользователя «Администратор».

Использование стороннего приложения «HashTab»:

1.  Щелкните правой кнопкой мыши  файл, контрольную сумму которого вы хотите получить. В этом примере я буду 
    использовать  «ComplexCalculatorv2».
2.  Щелкните левой кнопкой мыши заголовок  « Свойства » в раскрывающемся списке.
3. В появившемся окне перейдите на вкладку « File Hashes », где вы увидите снимок экрана, похожий на тот, что 
   показан ниже.  Обратите внимание, что эта вкладка отсутствует в установке Windows по умолчанию:

Теперь вы можете ответить на вопрос 1.

Использование «Powershell» Windows:

1. Для начала нам нужно открыть "Powershell". Это можно сделать, открыв панель поиска Windows.
2. Далее измените каталог рабочего стола пользователя, используя cd Desktop 
3. Убедитесь, что вы находитесь в правильном каталоге, используя  dir для просмотра списка файлов в каталоге. Вы 
   должны увидеть три файла ниже: 
Powershell имеет обе  команды CertUtil и ,  которые позволяют нам извлекать различные контрольные суммы файлов, 
   включая MD5 , SHA1, SHA2 и SHA-256 . Ниже я подробно опишу синтаксис обеих команд, вычисляя  контрольную сумму 
   MD5 файла.File-Hash
Использование CertUtil:

`CertUtil -hashfile ComplexCalculatorv2.exe MD5|SHA256|SHA512` или  `«CertUtil -hashfile <имя_файла> <алгоритм>»`,  как 
в примере ниже: 

Использование FileHash:
`Get-FileHash file_name -Algorithm MD5|SHA256|SHA512`

Теперь вы можете перейти к ответам на оставшиеся вопросы!

### Ответьте на вопросы ниже
Используя инструмент HashTab, какова контрольная сумма MD5 для «LoginForm.exe»?
```commandline
FF395A6D528DC5724BCDE9C844A0EE89
```
Используя Get-FileHash в Powershell, извлеките SHA256 для «TryHackMe.exe»
```commandline
6F870C80361062E8631282D31A16872835F7962222457730BC55676A61AD1EE0
```
Какой синтаксис используется для получения контрольной суммы SHA256 «TryHackMe.exe» с помощью CertUtil в Powershell?
```commandline
CertUtil -hashfile TryHackMe.exe SHA256
```

## Задание 6
Еще один онлайн-сервис, использующий эти контрольные суммы, — Virustotal. Virustotal действует как индексатор и 
агрегатор для различных антивирусных ( AV ) движков. Когда контрольная сумма отправляется в Virsutotal, 
коллеги-аналитики вредоносных программ могут просматривать отчеты AV , приписываемые этому файлу.

Подобно поисковой системе, вы можете искать отчеты по нескольким характеристикам, например:

- IP-адреса, с которыми взаимодействуют образцы
- Контрольные суммы
- Сам файл
 
На скриншоте ниже я загрузил исполняемый файл "TryHackMe.exe" на VirusTotal. Если бы вы зашли на VirusTotal, вы бы 
смогли найти этот отчет, введя контрольную сумму файлов. Я предоставил вам отчет здесь.

Участник THM ,  Darkstar7471,  имеет фантастическую  комнату по использованию Volatility, фреймворка анализа памяти 
и VirusTotal.  Я настоятельно рекомендую проверить это, когда вы извлекаете файлы и взаимодействуете с VirusTotal, 
чтобы определить их вредоносность по агрегированным рейтингам AV.

Прочитайте предоставленный отчет ( здесь ), чтобы ответить на поставленные вопросы.

### Ответьте на вопросы ниже
Перейдите на вкладку «Подробности». Какое еще имя файла и расширение указано в отчете как присутствующее?
```commandline
HxD.exe
```
На той же вкладке «Подробности» какая указана временная метка компиляции?
```commandline
2020-02-28 11:16:36
```
Что означает флаг форматирования THM{} в отчете?
```commandline
THM{TryHackMe_Malware_Series_Research_Flag}
```

## Задание 7
Криптография и контрольные суммы:

Значимая атака с коллизией хэшей MD5  - (Нараяна Д. Кашьяп., 2008)
Криптография и сетевая безопасность  - (Бехруз А. Форозуан, 2007)

Первое столкновение для полного SHA-1  - (Stevens et al., 2017) / (Shattered.io)

Блог (Бескорыстное продвижение)

Итак, вы хотите проанализировать вредоносное ПО?

Движки песочницы:

- любой.запуск
- гибридный анализ

### Ответьте на вопросы ниже
Спасибо! Буду ждать продолжения.
```commandline
Ответ не нужен
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)