[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [OWASP Juice Shop](https://tryhackme.com/r/room/owaspjuiceshop) 

Всего 8 заданий:
## Задание 1
В этой комнате мы рассмотрим 10 основных уязвимостей веб-приложений по версии OWASP. Вы найдете их во всех типах 
веб-приложений. Но сегодня мы рассмотрим собственное творение OWASP — Juice Shop! 



Перед прохождением этой комнаты рекомендуется пройти БЕСПЛАТНЫЕ комнаты Burpsuite « Burpsuite Basics » и « Burpsuite 
Repeater »! ~

- Juice Shop — большое приложение, поэтому мы не будем рассматривать все темы из первой десятки.

- Однако мы рассмотрим следующие темы, на которые мы рекомендуем вам обратить внимание по мере продвижения по этой 
комнате.

<----------------------------------------------------------------->

- Инъекция
- Сломанная аутентификация
- Раскрытие конфиденциальных данных
- Неисправный контроль доступа
- Межсайтовый скриптинг XSS

<----------------------------------------------------------------->

### ПОЖАЛУЙСТА, ОБРАТИ ВНИМАНИЕ!
[Задание 3] и далее потребует флага, который будет отображаться по завершении задания.

#### Поиск неисправностей

- Загрузка веб-приложения занимает около 2–5 минут, поэтому, пожалуйста, наберитесь терпения!
- Временно отключите burp в настройках прокси для текущего браузера. Обновите страницу, и флаг будет показан. 
(Это проблема не с приложением, а с burp, из-за которого флаг не отображается. )
- Если вы выполняете XSS- задачи и они не работают. Очистите файлы cookie и данные сайта, так как иногда это может 
  быть проблемой.  
- Если вы уверены, что выполнили задачу, но она все еще не работает. Перейдите к [Задаче 8], так как это позволит 
  вам проверить ее выполнение. 



Благодарности  OWASP  и  Бьорну Кимминиху

### Ответить на вопросы ниже
Разверните виртуальную машину, прикрепленную к этой задаче, чтобы начать! Вы можете получить доступ к этой машине, 
используя браузерную машину, или если вы подключены через OpenVPN. 
```commandline
Ответ не нужен
```
После загрузки машины получите к ней доступ, скопировав и вставив ее IP-адрес в адресную строку браузера; если вы 
используете машину с браузером, вставьте IP-адрес машины в адресную строку браузера на этой машине. 
```commandline
Ответ не нужен
```

## Задание 2
Прежде чем мы приступим к фактическому взлому, неплохо бы осмотреться. В Burp отключите режим Intercept и 
просмотрите сайт. Это позволит Burp регистрировать различные запросы с сервера, которые могут быть полезны позже.  
Это называется обходом приложения, что также является формой разведки !

### Ответить на вопросы ниже
#### Вопрос №1: Какой адрес электронной почты у администратора?
В отзывах отображается адрес электронной почты каждого пользователя. Который, нажав на продукт Apple Juice, 
показывает нам адрес электронной почты администратора!

```commandline
admin@juice-sh.op
```
#### Вопрос №2: Какой параметр используется для поиска? 
Нажмите на увеличительное стекло в правом верхнем углу приложения, чтобы открыть строку поиска.
Затем мы можем ввести какой-либо текст и, нажав Enter , выполнить поиск текста, который был только что введен.
Теперь обратите внимание на URL-адрес, который теперь обновится с использованием только что введенного нами текста.
Теперь мы можем видеть параметр поиска после /#/search? букву q

```commandline
q
```
#### Вопрос №3: Какое шоу Джим упоминает в своем обзоре? 
Джим сделал обзор продукта Green Smoothie. Мы видим, что он упоминает репликатор. 
Если мы введём в Google «репликатор», то получим результаты, указывающие на то, что это из телешоу под названием 
«Звёздный путь». 

```commandline
Star Trek
```

## Задание 3
Эта задача будет сосредоточена на уязвимостях инъекций. Уязвимости инъекций довольно опасны для компании, поскольку 
они могут потенциально привести к простою и/или потере данных. Определение точек инъекций в веб-приложении обычно 
довольно просто, так как большинство из них вернут ошибку. Существует много типов атак инъекций, вот некоторые из них:

#### SQL- инъекция
SQL- инъекция — это когда злоумышленник вводит вредоносный или неправильно сформированный запрос, чтобы получить или 
подделать данные из базы данных. А в некоторых случаях — войти в учетные записи. 

#### Ввод команды
Command Injection — это когда веб-приложения берут входные или контролируемые пользователем данные и запускают их 
как системные команды. Злоумышленник может подделать эти данные, чтобы выполнить свои собственные системные команды. 
Это можно увидеть в приложениях, которые выполняют неправильно настроенные ping-тесты.   
#### Впрыскивание электронной почты
Email injection — это уязвимость безопасности, которая позволяет злоумышленникам отправлять сообщения электронной 
почты без предварительного разрешения почтового сервера. Это происходит, когда злоумышленник добавляет 
дополнительные данные в поля, которые сервер интерпретирует неправильно.   


Но в нашем случае мы будем использовать SQL- инъекцию.
Для получения дополнительной информации:  Инъекция

### Ответить на вопросы ниже
#### Вопрос №1: Войдите в учетную запись администратора!
После перехода на страницу входа введите некоторые данные в поля адреса электронной почты и пароля.
Прежде чем  нажать «Отправить», убедитесь, что  режим перехвата  включен .
Это позволит нам увидеть данные, отправленные на сервер!
Теперь мы изменим « a » рядом с адресом электронной почты на:  ' или 1=1--  и перешлем его на сервер.
Почему это работает?

Символ ' закроет скобки в SQL-запросе.
' OR ' в операторе SQL вернет true, если хотя бы одна из его сторон истинна. Поскольку  1=1 всегда истинно , весь 
оператор истинен. Таким образом, он сообщит серверу, что адрес электронной почты действителен, и позволит нам войти 
в систему  с идентификатором пользователя 0 , который является учетной записью администратора.  
Символ  --  используется в SQL для комментирования данных, любые ограничения на вход в систему больше не будут 
работать, поскольку они интерпретируются как комментарий. Это похоже на  комментарии #  и  //  в python и javascript 
соответственно.  

```commandline
32a5e0f21372bcc1000a6088b93b458e41f0e02a
```
#### Вопрос №2: Войдите в учетную запись Бендера!
Подобно тому, что мы делали в  вопросе № 1 , теперь мы войдем в учетную запись Бендера! Снова захватим запрос на 
вход, но на этот раз мы укажем:  bencher@juice-sh.op'--  в качестве адреса электронной почты.  
Теперь перешлите это на сервер!
Но почему бы нам не положить  1=1 ?

Ну, поскольку адрес электронной почты действителен (который вернет  true ), нам не нужно принудительно делать его  
true. Таким образом, мы можем использовать '-- для обхода системы входа. Обратите внимание, что 1=1 можно 
использовать, когда адрес электронной почты или имя пользователя неизвестны или недействительны.  

```commandline
fb364762a3c102b2db932069c0e6b78e738d4066
```

## Задание 4
В этой задаче мы рассмотрим использование аутентификации с помощью различных недостатков. Когда мы говорим о недостатках аутентификации, мы включаем механизмы, которые уязвимы для манипуляций. Эти механизмы, перечисленные ниже, мы и будем использовать. 

Слабые пароли в высокопривилегированных учетных записях

Страницы забытых паролей

 Дополнительная информация:  Неверная аутентификация
### Ответить на вопросы ниже
#### Вопрос №1: Подберите пароль учетной записи администратора!
Мы использовали SQL Injection для входа в учетную запись администратора, но мы все еще не знаем пароль. Давайте 
попробуем атаку методом подбора! Мы снова захватим запрос на вход, но вместо того, чтобы отправить его через прокси, 
мы отправим его Intruder.  
Перейдите в Positions и нажмите  кнопку Clear §  . В поле пароля поместите два § внутри кавычек. Для ясности,  § § — 
это не два отдельных ввода, а реализация кавычек Burp, например "" .  Запрос должен выглядеть как на изображении ниже.   

Для полезной нагрузки мы будем использовать  best1050.txt из Seclists . (Который можно установить с помощью: apt-get 
install seclists ) 

Вы можете загрузить список отсюда:  `/usr/share/wordlists/SecLists/Passwords/Common-Credentials/best1050.txt`

После загрузки файла в Burp начните атаку. Вам нужно будет отфильтровать запрос по статусу. Неудачный запрос 
получит 401 Unauthorized. В то время как успешный запрос вернет 200 OK. После завершения войдите в учетную запись, 
используя пароль.


```commandline
c2110d06dc6f81c67cd8099ff0ba601241f1ac0e
```
#### Вопрос №2:  Сбросьте пароль Джима!
Хотите верьте, хотите нет, но механизм сброса пароля также может быть использован! При вводе в поле адреса 
электронной почты на странице «Забыли пароль?» контрольный вопрос Джима установлен на  «Второе имя вашего старшего 
брата или сестры?» .  
В задании 2 мы обнаружили, что Джим может иметь какое-то отношение к  Star Trek . Поиск в Google "Jim Star Trek" 
дает нам вики-страницу для  Джейма Т. Кирка  из Star Trek.  Просматривая страницу вики, мы обнаруживаем, что у него есть брат.
Похоже, второе имя его брата — Сэмюэл.
Ввод этого на странице «Забыли пароль?» позволит вам успешно изменить его пароль.
Вы можете изменить его на любой другой!

```commandline
094fbc9b48e525150ba97d05b942bbf114987257
```

## Задание 5
Веб-приложение должно безопасно и надежно хранить и передавать конфиденциальные данные. Но в некоторых случаях разработчик может неправильно защитить свои конфиденциальные данные, что делает их уязвимыми.

В большинстве случаев защита данных не применяется последовательно по всему веб-приложению, делая определенные страницы доступными для общественности. В других случаях информация становится общедоступной без ведома разработчика, что делает веб-приложение уязвимым для атаки. 

Дополнительная информация:  Раскрытие конфиденциальных данных

### Ответить на вопросы ниже
#### Вопрос №1:  Получите доступ к конфиденциальному документу!
Перейдите на  страницу «О нас»  и наведите курсор на ссылку «Ознакомьтесь с нашими условиями использования». Вы 
увидите, что он ссылается на  http://MACHINE_IP /ftp/legal.md. Переход в этот каталог /ftp/ показывает, что он 
доступен для общественности! Мы скачаем acquires.md и сохраним его. Похоже, здесь есть и другие файлы, 
представляющие интерес. После загрузки перейдите на домашнюю страницу, чтобы получить флаг!

```commandline
edf9281222395a1c5fee9b89e32175f1ccf50c5b
```
#### Вопрос №2:  Войдите в учетную запись MC SafeSearch!
Посмотрев видео, можно выделить некоторые части песни. Он отмечает, что его пароль — « Мистер Лапша », но он заменил некоторые « гласные на нули », то есть он просто заменил «о» на «0».
Теперь мы знаем, что пароль к  учетной записи mc.safesearch@juice-sh.op  — « Mr. N00dles ».
```commandline
66bdcffad9e698fd534003fbb3cc7e2b7b55d7f0
```
#### Вопрос №3: Загрузите файл резервной копии!
Теперь вернемся в папку http://MACHINE_IP /ftp/ и попробуем загрузить  package.json.bak. Но, похоже, мы 
сталкиваемся с ошибкой 403, которая говорит, что можно загрузить только файлы .md и .pdf.
Чтобы обойти это, мы будем использовать обход символа, называемый " Poison Null Byte ".  Poison Null Byte выглядит 
так:  %00 .  
>Примечание: поскольку мы можем загрузить его с помощью URL-адреса , нам потребуется закодировать его в формат, 
> закодированный в URL-адресе.
Poison  Null Byte теперь будет выглядеть так:  %2500 .  Добавление этого и затем .md  в конец позволит обойти ошибку 403!

Почему это работает? 
Poison  Null Byte на самом деле является  NULL-терминатором . Помещая символ NULL в строку в определенном байте, 
строка сообщает серверу о необходимости завершиться в этой точке, обнуляя остальную часть строки.  

```commandline
bfc1e6b4a16579e85e06fee4c36ff8c02fb13795
```
## Задание 6
Современные системы позволяют нескольким пользователям иметь доступ к разным страницам. Администраторы чаще всего 
используют страницу администрирования для редактирования, добавления и удаления различных элементов веб-сайта.  Вы 
можете использовать их при создании веб-сайта с помощью таких программ, как Weebly или Wix.    

При обнаружении уязвимостей или ошибок взлома контроля доступа они будут отнесены к одному из двух типов :
- Горизонтальное повышение привилегий
- Происходит, когда пользователь может выполнить действие или получить доступ к данным другого пользователя с тем же 
  уровнем разрешений.
- Вертикальное повышение привилегий
Происходит, когда пользователь может выполнить действие или получить доступ к данным другого пользователя с  более высоким уровнем разрешений.


Кредиты: Packetlabs.net
Дополнительная информация:  Неисправный контроль доступа

### Ответить на вопросы ниже
#### Вопрос №1: Зайдите на страницу администрирования!
Сначала мы откроем отладчик в  Firefox. 
(Или Источники в Chrome.)
Это можно сделать, перейдя к нему в меню «Веб-разработчики». 
Затем мы обновим страницу и найдем файл javascript для main-es2015.js.
Затем мы перейдем на эту страницу по адресу: http://MACHINE_IP / main-es2015.js
Чтобы преобразовать это в формат, который мы можем прочитать, нажмите кнопку { } внизу.  
Теперь найдите термин «администратор» 
Вы встретите несколько разных слов, содержащих «admin», но то, что мы ищем, — это «path: administration».
Это намекает на страницу под названием « /#/administration », как можно увидеть по пути about несколькими строками ниже, но перейти туда, не войдя в систему, не получится. 
Поскольку это страница администратора, вполне логично, что для ее просмотра нам необходимо войти в учетную запись администратора.
Хороший способ запретить пользователям доступ к этому — загружать только те части приложения, которые им нужны. Это предотвращает утечку или просмотр конфиденциальной информации, такой как страница администратора.
```commandline
946a799363226a24822008503f5d1324536629a0
```


#### Вопрос №2: Посмотрите корзину другого пользователя!
Войдите в учетную запись администратора и нажмите «Ваша корзина». Убедитесь, что Burp запущен, чтобы вы могли захватить запрос!
Пересылайте каждый запрос, пока не увидите:  GET /rest/basket/1 HTTP/1.1
Теперь мы изменим цифру 1 после /basket/ на 2.
Теперь он покажет вам корзину UserID 2. Вы можете сделать это и для других UserID, при условии, что у них она есть!
```commandline
41b997a36cc33fbe4f0ba018474e19ae5ce52121
```

#### Вопрос №3: Удалите все 5-звездочные отзывы!

Снова перейдите на страницу http://MACHINE_IP /#/administration и  нажмите на значок корзины рядом с отзывом с 5 звездами! 
```commandline
50c97bcce0b895e446d61c83a21df371ac2266ef
```
## Задание 7
XSS или Cross-site scripting — это уязвимость, которая позволяет злоумышленникам запускать javascript в 
веб-приложениях. Это одни из наиболее часто встречающихся ошибок в веб-приложениях. Их сложность варьируется от 
легкой до чрезвычайно сложной, поскольку каждое веб-приложение анализирует запросы по-разному.   

Существует три основных типа XSS- атак:

### ДОМ (Специальный)
- DOM XSS  (Document Object Model-based Cross-site Scripting)  использует среду HTML для выполнения вредоносного 
javascript. Этот тип атаки обычно использует  HTML-тег <script></script>  .
#### Постоянный (на стороне сервера)
Постоянный XSS  — это javascript, который запускается, когда сервер загружает страницу, содержащую его. Это может 
произойти, когда сервер не очищает пользовательские данные при загрузке на страницу. Это обычно встречается в 
сообщениях блогов.   
#### Отражено (на стороне клиента)
Отраженный XSS  — это javascript, который выполняется на стороне клиента веб-приложения. Чаще всего они встречаются, 
когда сервер не очищает данные поиска .  

#### Дополнительная информация:  Межсайтовый скриптинг XSS

### Ответить на вопросы ниже
#### Вопрос №1:  Выполните DOM XSS!
Мы будем использовать элемент iframe с тегом оповещения JavaScript: 
```commandline
<iframe src="javascript:alert(`xss`)">
```
Ввод этого запроса в строку поиска вызовет оповещение.
Обратите внимание, что мы используем iframe , который является распространенным элементом HTML, встречающимся во многих веб-приложениях. Существуют и другие элементы, которые дают тот же результат. 
Этот тип XSS также называется XFS (Cross-Frame Scripting) и является одной из наиболее распространенных форм обнаружения XSS в веб-приложениях.
Веб-сайты, которые позволяют пользователю изменять iframe или другие элементы DOM, скорее всего, будут уязвимы для XSS.   
Почему это работает?
Обычной практикой является то, что поисковая строка отправляет запрос на сервер, в котором затем отправляет обратно связанную информацию, но именно здесь и кроется изъян. Без правильной очистки ввода мы можем выполнить атаку XSS на поисковую строку. 
```commandline
9aaf4bbea5c30d00a1f5bbcfce4db6d4b0efe0bf
```
#### Вопрос №2:  Выполните постоянную XSS-атаку!
Сначала войдите в учетную запись администратора.
Мы перейдем на страницу « Последний IP-адрес входа » для этой атаки.
Он должен показать, что последний IP-адрес — 0.0.0.0 или 10.xxx. 
Поскольку он регистрирует «последний» IP-адрес входа, мы сейчас выйдем из системы, чтобы он регистрировал «новый» IP-адрес.
Убедитесь, что перехват Burp включен , чтобы он перехватил запрос на выход из системы.
Затем перейдем на вкладку «Заголовки», где добавим новый заголовок:
```commandline
True-Client-IP
<iframe src="javascript:alert(`xss`)">
```
Затем перенаправьте запрос на сервер!
При повторном входе в учетную запись администратора и повторном переходе на страницу последнего IP-адреса входа мы увидим предупреждение XSS!
Почему мы должны отправлять этот заголовок?
Заголовок  True-Client-IP   похож на  заголовок X-Forwarded-For  , оба сообщают серверу или прокси-серверу, какой IP-адрес у клиента. Из-за отсутствия санитарии в заголовке мы можем выполнить атаку XSS. 
```commandline
149aa8ce13d7a4a8a931472308e269c94dc5f156
```
#### Вопрос №3:  Выполните отраженный XSS!
Во-первых, нам нужно оказаться на нужной странице, чтобы выполнить отраженную XSS!
Войдите в учетную запись администратора и перейдите на страницу « История заказов ». 
Оттуда вы увидите значок " Грузовик ", нажав на который, вы попадете на страницу результатов отслеживания. Вы также увидите, что есть идентификатор, связанный с заказом.   
Мы будем использовать iframe XSS,  <iframe src="javascript:alert(`xss`)">,  вместо  5267-f73dcd000abcc353
После отправки URL-адреса обновите страницу, и вы получите предупреждение о XSS!
Почему это работает?
На сервере будет таблица поиска или база данных (в зависимости от типа сервера) для каждого идентификатора 
отслеживания. Поскольку параметр 'id' не очищается перед отправкой на сервер, мы можем выполнить атаку XSS.   

```commandline
23cefee1527bde039295b2616eeb29e1edc660a0
```
## Задание 8
Если вы хотите взяться за более сложные задачи, которые не были рассмотрены в этой комнате, ознакомьтесь с разделом 
/#/score-board/ на Juice-shop. Здесь вы можете увидеть выполненные вами задания, а также другие задания различной 
сложности.
### Ответить на вопросы ниже
Доступ к странице `/#/score-board/`
```commandline
7efd3174f9dd5baa03a7882027f2824d2f72d86e
```
[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)