[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Introduction to SIEM](https://tryhackme.com/r/room/introtosiem) 

Всего 7 заданий:
## Задание 1
#### Что такое SIEM

SIEM означает Security Information and Event Management system (система управления информацией и событиями 
безопасности) . Это инструмент, который собирает данные с различных конечных точек/сетевых устройств по всей сети, 
хранит их в централизованном месте и выполняет их корреляцию. В этой комнате будут рассмотрены основные концепции, 
необходимые для понимания SIEM и того, как он работает.   

#### Цель обучения
Вот некоторые из целей обучения, рассматриваемых в этой аудитории:
- Что такое SIEM и как он работает?
- Зачем нужна SIEM ?
- Что такое видимость сети?
- Что такое источники журналов и как осуществляется прием журналов?
- Какие возможности предоставляет SIEM ?
### Ответьте на вопросы ниже
Что означает SIEM?
```commandline
Security Information and Event Management system
```

## Задание 2
Прежде чем объяснять важность SIEM, давайте сначала разберемся, почему так важно иметь лучшую видимость всех 
действий в сети. На рисунке ниже показан пример простой сети, которая включает несколько конечных точек на базе 
Linux /Windows, один сервер данных и один веб-сайт. Каждый компонент взаимодействует с другим или получает доступ к 
Интернету через маршрутизатор.   

Как мы знаем, каждый сетевой компонент может иметь один или несколько источников журналов, генерирующих разные 
журналы. Одним из примеров может быть настройка Sysmon вместе с журналами событий Windows для лучшей видимости 
конечной точки Windows. Мы можем разделить наши сетевые источники журналов на две логические части:  

1) Источники журналов, ориентированные на хост

Это источники журналов, которые фиксируют события, произошедшие внутри хоста или связанные с ним. Некоторые 
источники журналов, которые генерируют журналы, ориентированные на хост, — это журналы событий Windows, Sysmon , 
Osquery и т. д. Вот некоторые примеры журналов, ориентированных на хост:   
- Пользователь, получающий доступ к файлу
- Пользователь пытается пройти аутентификацию.
- Процесс Исполнения Действия
- Процесс добавления/редактирования/удаления ключа или значения реестра.
- Выполнение PowerShell

2) Сетевые источники журналов

Сетевые журналы генерируются, когда хосты взаимодействуют друг с другом или получают доступ к Интернету для 
посещения веб-сайта. Некоторые сетевые протоколы — это SSH, VPN, HTTP /s, FTP и т. д. Примеры таких событий: 

- SSH- соединение
- Файл, доступ к которому осуществляется через FTP
- Веб-трафик
- Пользователь получает доступ к ресурсам компании через VPN .
- Активность сетевого обмена файлами
#### Важность SIEM

Теперь, когда мы рассмотрели различные типы журналов, пришло время понять важность SIEM.  Поскольку все эти 
устройства генерируют сотни событий в секунду, проверка imglog на каждом устройстве по одному в 
случае любого инцидента может быть утомительной задачей. Это одно из преимуществ наличия решения SIEM. Оно не 
только берет журналы из различных источников в режиме реального времени, но и предоставляет возможность сопоставлять 
события, выполнять поиск по журналам, расследовать инциденты и оперативно реагировать. Некоторые ключевые функции, 
предоставляемые SIEM :     
- Прием журналов в реальном времени
- Предупреждение о ненормальной активности
- Круглосуточный мониторинг и видимость
- Защита от новейших угроз за счет раннего обнаружения
- Анализ данных и визуализация
- Умение расследовать прошлые инциденты.

### Ответьте на вопросы ниже
Является ли деятельность, связанная с реестром, ориентированной на хост или сеть?
```commandline
host-centric
```
Является ли активность, связанная с VPN, ориентированной на хост или сеть?
```commandline
network-centric
```

## Задание 3
Каждое устройство в сети генерирует какой-либо журнал всякий раз, когда на нем выполняется какая-либо активность, 
например, когда пользователь посещает веб-сайт, подключается к SSH , входит в свою рабочую станцию и т. д. Ниже 
рассматриваются некоторые распространенные устройства, которые можно найти в сетевой среде:  

Машина Windows

Windows записывает каждое событие, которое можно просмотреть с помощью утилиты Event Viewer. Она назначает 
уникальный идентификатор каждому типу активности журнала, что упрощает аналитику его изучение и отслеживание. Чтобы 
просмотреть события в среде Windows, введите  Event Viewer в строке поиска, и он перенаправит вас к инструменту, где 
хранятся и могут быть просмотрены различные журналы, как показано ниже. Эти журналы со всех конечных точек Windows 
пересылаются в решение SIEM для мониторинга и лучшей видимости.    

Показывает события в интерфейсе просмотра событий

Рабочая станция Linux

ОС Linux хранит все соответствующие журналы, такие как события, ошибки, предупреждения и т. д., которые затем 
поступают в SIEM для непрерывного мониторинга. Некоторые из распространенных мест, где Linux хранит журналы: 
```commandline
/var/log/httpd  : Содержит журналы HTTP- запросов/ответов и ошибок.
/var/log/cron    : В этом месте хранятся события, связанные с заданиями cron.
/var/log/auth.log и /var/log/secure  : хранит журналы, связанные с аутентификацией.
/var/log/kern  : В этом файле хранятся события, связанные с ядром.
```

Вот пример журнала cron:
```commandline
28 мая 13:04:20 ebr crond[2843]: /usr/sbin/crond 4.4 cron daemon от dillon, запущен с уведомлением loglevel 
28 мая 13:04:20 ebr crond[2843]: не найдено временной метки (пользовательское задание root sys-hourly) 
28 мая 13:04:20 ebr crond[2843]: не найдено временной метки (пользовательское задание root sys-daily) 
28 мая 13:04:20 ebr crond[2843]: не найдено временной метки (пользовательское задание root sys-weekly) 
28 мая 13:04:20 ebr crond[2843]: не найдено временной метки (пользовательское задание root sys-monthly) 
13 июня 07:46:22 ebr crond[3592]: невозможно выполнить /usr/sbin/sendmail: вывод cron для задания root пользователя sys-daily в /dev/null
```

Веб-сервер

Важно следить за всеми запросами/ответами, входящими и исходящими с веб-сервера, на предмет потенциальной попытки 
веб-атаки. В Linux обычными местами для записи всех журналов, связанных с Apache, являются /var/log/apache или  
/var/log/httpd.  

Вот пример логов Apache :
```commandline
192.168.21.200 - - [21/Март/2022:10:17:10 -0300] "GET /cgi-bin/try/ HTTP/1.0" 200 3395 
127.0.0.1 - - [21/Март/2022:10:22:04 -0300] "GET / HTTP/1.0" 200 2216
```

Прием журналаДемонстрирует прием журналов в SIEM

Все эти журналы предоставляют массу информации и могут помочь в выявлении проблем безопасности. Каждое решение SIEM 
имеет свой собственный способ приема журналов. Некоторые общие методы, используемые этими решениями SIEM, описаны ниже: 

1) Агент/Пересылатель:  эти решения SIEM предоставляют легкий инструмент, называемый агентом (пересылатель от Splunk)
   , который устанавливается в конечной точке. Он настроен на захват всех важных журналов и отправку их на сервер SIEM. 
2) Syslog:  Syslog — широко используемый протокол для сбора данных из различных систем, таких как веб-серверы, базы 
   данных и т. д., которые отправляются в режиме реального времени в централизованное место назначения. 
3) Ручная загрузка: некоторые решения SIEM, такие как Splunk, ELK и т. д., позволяют пользователям принимать 
   офлайн-данные для быстрого анализа. После приема данных они нормализуются и становятся доступными для анализа. 
4) Переадресация портов: решения SIEM также можно настроить на прослушивание определенного порта, а затем конечные 
   точки будут пересылать данные в экземпляр SIEM на прослушивающем порту. 

Ниже показан пример того, как Splunk предоставляет различные методы для приема журналов:

Показывает параметры приема данных в Splunk SIEM

### Ответьте на вопросы ниже
В каком месте в среде Linux хранятся журналы HTTP?

```commandline
/var/log/httpd
```

## Задание 4
SIEM используется для обеспечения корреляции собранных данных для обнаружения угроз. После обнаружения угрозы или 
превышения определенного порога выдается оповещение. Это оповещение позволяет аналитикам предпринимать 
соответствующие действия на основе расследования. SIEM играет важную роль в области кибербезопасности и помогает 
своевременно обнаруживать и защищаться от новейших угроз. Он обеспечивает хорошую видимость того, что происходит в 
сетевой инфраструктуре.    

### Возможности SIEM
SIEM является одним из основных компонентов экосистемы Security Operations Center ( SOC ), как показано ниже. SIEM 
начинается со сбора журналов и проверки того, соответствует ли какое-либо событие/поток условию, установленному в 
правиле, или пересекло определенный порог  

Некоторые из общих возможностей SIEM :
- Корреляция между событиями из разных источников журналов.
- Обеспечить прозрачность как хост-ориентированных, так и сетевых активностей.
- Позвольте аналитикам расследовать последние угрозы и своевременно реагировать.
- Выявите угрозы, которые не определяются действующими правилами.

### Обязанности аналитика SOC

Аналитики SOC используют решения SIEM для лучшего обзора того, что происходит в сети. Некоторые из их обязанностей 
включают: 
- Мониторинг и расследование.
- Выявление ложных срабатываний.
- Правила настройки, вызывающие шум или ложные срабатывания.
- Отчетность и соблюдение требований.
- Выявление слепых зон в видимости сети и их устранение.
### Ответьте на вопросы ниже
Прочитайте задание выше.
```commandline
Ответ не нужен
```

## Задание 5
Инструмент SIEM получает все журналы, связанные с безопасностью, через агентов, переадресацию портов и т. д. После 
того, как журналы получены, SIEM ищет нежелательное поведение или подозрительные шаблоны в журналах с помощью 
условий, установленных аналитиками в правилах. Если условие выполняется, срабатывает правило, и инцидент расследуется.

#### Панель инструментов

Панели мониторинга являются наиболее важными компонентами любой SIEM. SIEM представляет данные для анализа после их 
нормализации и приема. Сводка этих анализов представлена в виде действенных идей с помощью нескольких панелей 
мониторинга. Каждое решение SIEM поставляется с некоторыми панелями мониторинга по умолчанию и предоставляет 
возможность создания пользовательских панелей мониторинга. Вот некоторые сведения, которые можно найти на панели 
мониторинга:    
- Основные моменты оповещений
- Системное уведомление
- Предупреждение о здоровье
- Список неудачных попыток входа
- Количество принятых событий
- Правила сработали
- Самые посещаемые домены

Пример панели мониторинга по умолчанию в Qradar SIEM показан ниже:

#### Правила корреляции

Правила корреляции играют важную роль в своевременном обнаружении угроз, позволяя аналитикам вовремя принимать меры. 
Правила корреляции — это в значительной степени логические выражения, настроенные на срабатывание. Вот несколько 
примеров правил корреляции:  
- Если пользователь совершает 5 неудачных попыток входа в систему в течение 10 секунд — подайте оповещение Multiple 
  Failed Login Attempts 
- Если вход в систему прошел успешно после нескольких неудачных попыток входа в систему — подайте 
  оповещение Successful Login After multiple Login Attempts
- Правило настроено на оповещение каждый раз, когда пользователь подключает USB-накопитель (полезно, если 
  использование USB-накопителя ограничено политикой компании)
- Если исходящий трафик > 25 МБ — оповещайте о потенциальной попытке утечки данных (обычно это зависит от политики 
  компании)

#### Как создается правило корреляции

Чтобы объяснить, как работает правило, рассмотрим следующие варианты использования Eventlog:

#### Вариант использования 1:

Злоумышленники, как правило, удаляют журналы на этапе после эксплуатации, чтобы скрыть свои следы. Уникальный 
идентификатор события 104 регистрируется каждый раз, когда пользователь пытается удалить или очистить журналы 
событий. Чтобы создать правило на основе этой активности, мы можем задать условие следующим образом:  

Правило: Если источником журнала является WinEventLog И EventID равен 104 — активировать оповещениеEvent Log Cleared

Вариант использования 2: Злоумышленники используют команды типа whoami после фазы эксплуатации/эскалации привилегий. 
Следующие поля будут полезны для включения в правило. 

Источник журнала: Определите источник журнала, фиксирующий журналы событий.
Идентификатор события: какой идентификатор события связан с действием Process Execution? В этом случае идентификатор 
события 4688 будет полезен. 
NewProcessName: какое имя процесса будет полезно включить в правило?
Правило: если Log Source — WinEventLog И EventCode — 4688, а NewProcessName содержит whoami, то активировать 
ALERTWHOAMI command Execution DETECTED 

В предыдущей задаче обсуждалась важность пар поле-значение. Правила корреляции следят за значениями определенных 
полей, чтобы сработать. Вот почему важно иметь нормализованные журналы.

#### Расследование оповещения

При мониторинге SIEM аналитики проводят большую часть времени на панелях мониторинга, поскольку они отображают 
различные ключевые сведения о сети в очень обобщенном виде. После срабатывания оповещения проверяются события/потоки,
связанные с оповещением, и проверяется правило, чтобы увидеть, какие условия выполняются. На основе расследования 
аналитик определяет, является ли это истинным или ложным положительным результатом. Вот некоторые действия, которые 
выполняются после анализа:
- Оповещение — ложная тревога. Может потребоваться настройка правила, чтобы избежать повторения подобных ложных 
срабатываний. 
- Оповещение истинно положительное. Проведите дальнейшее расследование.
- Обратитесь к владельцу актива, чтобы узнать подробности этой деятельности.
- Подозрительная активность подтверждена. Изолируйте зараженного хозяина.
- Заблокируйте подозрительный IP.


Давайте перейдем к следующей задаче и рассмотрим, как работает SIEM.

### Ответьте на вопросы ниже
Какой идентификатор события генерируется при удалении журналов событий?
```commandline
104
```
Какой тип оповещения может потребовать настройки?
```commandline
False Alarm
```

## Задание 6
Лабораторная работа

Нажмите кнопку «Просмотр сайта», и лаборатория отобразится в правой части экрана.

В статической лабораторной работе, прикрепленной к статье, отображаются пример панели мониторинга и событий. Когда 
происходит подозрительная активность, срабатывает оповещение, что означает, что некоторые события соответствуют 
условию некоторого уже настроенного правила. Выполните лабораторную работу и ответьте на следующие вопросы.  

### Ответьте на вопросы ниже
Нажмите «Начать подозрительную активность». Какой процесс вызвал оповещение?
```commandline
cudominer.exe
```
Найдите событие, вызвавшее оповещение, какой пользователь был ответственен за выполнение процесса?
```commandline
chris.fort
```
Каково имя хоста подозреваемого пользователя?
```commandline
HR_02
```
Изучите правило и подозрительный процесс. Какой термин соответствует правилу, вызвавшему оповещение?
```commandline
miner
```
Какой вариант лучше всего представляет событие? Выберите из следующих:
- Ложноположительный
- Истинно-положительный
```commandline
True-Positive
```
Выбор правильного ДЕЙСТВИЯ отобразит ФЛАГ. Что такое ФЛАГ?
```commandline
THM{000_SIEM_INTRO}
```

## Задание 7
В этой комнате мы рассмотрели, что такое SIEM , ее возможности и какую видимость она обеспечивает. Чтобы узнать 
подробнее о том, как расследуются инциденты, изучите следующие комнаты и проблемы.
- Младший аналитик SOC
- Сплункер101
- Splunk201
- Доброкачественный
- Расследование со Splunk
- InvestgatingwithELK
- ItsyBitsy
### Ответьте на вопросы ниже
Завершите эту комнату.
```commandline
Ответ не нужен
```
[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)