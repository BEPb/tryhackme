[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Phishing Analysis Fundamentals](https://tryhackme.com/r/room/phishingemails1tryoe) 

Всего 7 заданий:
## Задание 1
Спам  и  фишинг  — это распространенные атаки социальной инженерии.  В социальной инженерии векторами фишинговых 
атак могут быть телефонный звонок, текстовое сообщение или электронная почта.  Как вы уже должны были догадаться, мы 
сосредоточимся на электронной почте как векторе атаки.   

Мы все должны быть немного знакомы с тем, что такое спам. Несмотря ни на что, эти письма каким-то образом попадают 
в наши почтовые ящики.  

Первое электронное письмо, классифицированное как спам, датируется 1978 годом , и оно процветает и по сей день. 

Фишинг — это серьезный вектор атаки, от которого вам, как защитнику, придется защищаться.

Организация может следовать всем рекомендуемым рекомендациям, когда дело доходит до построения многоуровневой 
стратегии защиты. Тем не менее, все, что нужно, это неопытному и ничего не подозревающему пользователю в вашей 
корпоративной среде щелкнуть ссылку или загрузить и запустить вредоносное вложение, которое может предоставить 
злоумышленнику точку опоры в сети.    

Многие продукты помогают бороться со спамом и фишингом, но на самом деле эти письма все равно могут пройти. Когда 
это происходит, вам, как аналитику по безопасности, нужно знать, как анализировать эти письма, чтобы определить, 
являются ли они вредоносными или безвредными.  

Кроме того, вам необходимо будет собрать информацию об электронной почте, чтобы обновить свои продукты безопасности 
и предотвратить повторное попадание вредоносных писем в почтовый ящик пользователя.  

В этом зале мы рассмотрим все компоненты, участвующие в отправке электронных писем через Интернет, и способы анализа 
заголовков электронных писем.  

Разверните машину, прикрепленную к этой задаче; она будет видна в режиме разделенного экрана, как только будет готова.

Если вы не видите загрузку виртуальной машины, нажмите кнопку «Показать разделенный вид».

### Ответить на вопросы ниже
Прочитайте вышеизложенное и запустите подключенную виртуальную машину.

```commandline
Ответ не нужен
```

## Задание 2
Уместно начать эту комнату с упоминания человека, который изобрел концепцию электронной почты и сделал  символ @  
знаменитым.  Человеком, ответственным за вклад в то, как мы общаемся, был  Рэй Томлинсон.  

Изобретение электронной почты относится к 1970-м годам для  ARPANET .  Да, вероятно, до того, как вы родились. 
Определенно, до того, как я родился. :) 

Итак, что же представляет собой адрес электронной почты?

Почтовый ящик пользователя (или имя пользователя)
@
Домен
Давайте рассмотрим следующий адрес электронной почты: billy@johndoe.com.

Почтовый ящик пользователя — Билли.
@ (спасибо Рэй)
Домен — johndoe.com
Чтобы еще больше упростить задачу, подумайте об улице, на которой вы живете.

Вы можете думать о своей улице как о домене . 
 В этом сценарии  имя/фамилия получателя, а также номер дома представляют почтовый ящик пользователя. 
Обладая этой информацией, почтовый работник, доставляющий почту, знает, в какой почтовый ящик положить письмо(а). 

Далее давайте рассмотрим сетевые протоколы, используемые для отправки электронного письма от отправителя получателю.

### Ответить на вопросы ниже
Какой временной промежуток был использован для отправки электронного письма?

```commandline
1970s
```

## Задание 3
В «магии», происходящей, когда вы нажимаете кнопку ОТПРАВИТЬ в почтовом клиенте,  задействовано несколько протоколов.

К настоящему моменту вы уже должны знать, что определенные протоколы были созданы для решения определенных сетевых 
задач, таких как электронная почта.  

Для обработки исходящих и входящих сообщений электронной почты используются  три  специальных протокола, которые 
кратко перечислены ниже. 
- SMTP ( простой протокол передачи почты) — используется для обработки отправки электронных писем. 
- POP3 (почтовый протокол) — отвечает за передачу электронной почты между клиентом и почтовым сервером. 
- IMAP (протокол доступа к интернет-сообщениям) — отвечает за передачу электронной почты между клиентом и почтовым 
  сервером. 
Вы должны были заметить, что POP3 и IMAP имеют одинаковое определение. Но между ними есть различия.

Разница между ними приведена ниже: (кредит AOL -- Вам письмо! )

### POP3

Электронные письма загружаются и хранятся на одном устройстве.
Отправленные сообщения хранятся на том же устройстве, с которого было отправлено электронное письмо.
Доступ к электронным письмам возможен только с того устройства, на которое они были загружены.
Если вы хотите сохранять сообщения на сервере, убедитесь, что параметр «Сохранять электронную почту на сервере» 
включен, иначе все сообщения будут удаляться с сервера после загрузки в приложение или программное обеспечение 
одного устройства.  

### IMAP
- Электронные письма хранятся на сервере и могут быть загружены на несколько устройств.
- Отправленные сообщения хранятся на сервере.
- Сообщения можно синхронизировать и просматривать на нескольких устройствах.
- Теперь давайте поговорим о том, как электронное письмо передается от отправителя к получателю.

Чтобы лучше проиллюстрировать это, посмотрите на упрощенное изображение ниже:

Ниже приведено объяснение каждой пронумерованной точки из приведенной выше диаграммы:
- Алекса пишет письмо Билли ( billy@johndoe.com) в своем любимом почтовом клиенте. Закончив, она нажимает кнопку 
  «Отправить». 
- SMTP - сервер должен определить, куда отправлять электронную почту Alexa. Он запрашивает у DNS информацию, 
  связанную с johndoe.com. 
- DNS - сервер получает информацию  johndoe.comи отправляет ее на SMTP- сервер. 
- SMTP - сервер отправляет электронную почту Алексы через Интернет на почтовый ящик Билли по адресу johndoe.com.
На этом этапе электронная почта Alexa проходит через различные SMTP- серверы и, наконец, ретранслируется на целевой 
  SMTP- сервер.  
- Письмо Алексы наконец достигло целевого SMTP- сервера.
- Письмо Алексы переслано и теперь находится на локальном сервере POP3/ IMAP , ожидая Билли. 
- Билли входит в свой почтовый клиент, который запрашивает у локального сервера POP3/ IMAP новые письма в его 
  почтовом ящике.
- Электронная почта Алексы копируется ( IMAP ) или загружается ( POP3 ) в почтовый клиент Билли. 
- Наконец, каждый протокол имеет свои связанные порты по умолчанию и рекомендуемые порты. Например, SMTP — это порт 25.

Прочитайте следующую статью, чтобы понять разницу между  ними .

### Ответить на вопросы ниже
Какой порт классифицируется как безопасный транспорт для SMTP?
```commandline
465
```
Какой порт классифицируется как безопасный транспорт для IMAP?
```commandline
993
```
Какой порт классифицируется как безопасный транспорт для POP3?
```commandline
995
```

## Задание 4
Отлично! Мы знаем, как электронное письмо перемещается из пункта А в пункт Б, и все протоколы, задействованные в этом процессе. 

Эта задача заключается в том, чтобы понять компоненты, из которых состоит сообщение электронной почты, поступающее в почтовый ящик.

Это понимание необходимо, если вы хотите вручную анализировать потенциально вредоносные электронные письма. 

Прежде чем начать, нам нужно понять, что электронное письмо состоит из двух частей:

заголовок электронного письма  (информация об электронном письме, например, почтовые серверы, которые его передали)
тело письма (текст и/или текст в формате HTML)
Синтаксис сообщений электронной почты известен как формат интернет-сообщений ( IMF ).

Давайте сначала рассмотрим заголовки электронных писем. 

На что вы обращаете внимание при анализе потенциально вредоносного электронного письма?

Начнем со следующих полей заголовка электронного письма:

От  - адрес электронной почты отправителя
Тема  — тема письма.
Дата  - дата отправки электронного письма.
Кому  - адрес электронной почты получателя
Обычно это хорошо видно в любом почтовом клиенте. Давайте рассмотрим пример этих полей на изображении ниже.

Предупреждение : Это фрагмент из реального электронного письма. Электронное письмо на изображении ниже — это адрес 
электронной почты Yahoo honeypot.  Не взаимодействуйте с адресами электронной почты или IP-адресами, указанными в 
этой комнате.  



Примечание : Цифры на изображении выше соответствуют полям заголовка электронного письма, перечисленным выше.

Другой способ получить ту же информацию из заголовка электронного письма и даже больше — просмотреть « сырые » 
данные электронного письма. 

Поначалу при детальном рассмотрении заголовка электронного письма может возникнуть страх, но все не так уж и плохо, 
если знать, на что обращать внимание.  

Примечание : в зависимости от вашего почтового клиента (веб-клиента или настольного приложения) шаги по просмотру 
полей заголовка электронного письма будут различаться, но концепция одна и та же.  

Ознакомьтесь со статьей Базы знаний (KB) от Media Temple о просмотре необработанных/полных заголовков электронных 
писем в различных почтовых клиентах  здесь .  

На изображении ниже вы можете увидеть, как просмотреть эту информацию в Yahoo.



Ниже приведен фрагмент необработанного сообщения для образца электронного письма.



Примечание : на изображении выше показана лишь часть  информации,  содержащейся в заголовке электронного письма. 

Вы можете просмотреть это письмо в Email Samplesкаталоге на рабочем столе в прикрепленной виртуальной машине. Письмо 
называется  email1.eml.  

На изображении выше видны и другие поля заголовка электронного письма, представляющие интерес. 

- X-Originating-IP — IP-адрес, с которого было отправлено электронное письмо (это называется X-заголовком ).
- Smtp.mailfrom / header.from — домен, с которого было отправлено электронное письмо (эти заголовки находятся в 
разделе Authentication-Results ) 
- Reply-To  — это адрес электронной почты, на который будет отправлено ответное письмо вместо адреса электронной 
  почты From.

Для ясности: в приведенном выше примере письма отправителем является  newsletters@ant.anki-tech.com , но если 
получатель ответит на письмо, ответ будет отправлен на reply@ant.anki-tech.com , что является полем Reply-To ,  а НЕ 
на  newsletters@ant.anki-tech.com .   

Ниже приведен дополнительный ресурс от  Media Template  о том, как анализировать заголовки электронных писем:

 https://web.archive.org/web/20221219232959/https://mediatemple.net/community/products/all/204643950/understanding-an-email-header
Примечание :  вопросы ниже основаны на статье «Шаблон медиа»  .

### Ответить на вопросы ниже
Какой заголовок электронного письма совпадает с «Ответить»?
```commandline
Return-Path
```
Где можно получить более подробную информацию об IP-адресе отправителя электронного письма, узнав его IP?
```commandline
http://www.arin.net
```

## Задание 5
Тело письма — это часть письма, содержащая текст (обычный или в формате HTML), который отправитель хочет, чтобы вы увидели. 

Ниже приведен пример текстового электронного письма.



Ниже приведен пример письма в формате HTML .



Приведенное выше электронное письмо содержит изображение (которое было заблокировано почтовым клиентом) и встроенные гиперссылки.

HTML — это то, что позволяет добавлять эти элементы в электронное письмо.

Для просмотра HTML-кода электронного письма используется тот же подход, что показан ниже, но он может отличаться в зависимости от клиента веб-почты. 

В примере ниже представлен снимок экрана Protonmail . 



Фрагмент HTML-кода показан ниже.



В этом конкретном почтовом веб-клиенте Protonmail возможность вернуться к HTML называется « Просмотреть отрисованный HTML ».



Опять же, для других клиентов веб-почты все будет иначе.

Наконец, электронные письма могут содержать вложения.  Применяется то же самое предположение; вы можете просмотреть вложение в электронном письме из HTML-формата электронного письма или просмотрев исходный код. 

Давайте рассмотрим несколько примеров ниже.

Следующий пример — это электронное письмо в формате HTML от «Netflix» с вложением. Веб-клиент — Yahoo!



В тексте письма есть изображение.
Вложение к электронному письму представляет собой PDF-документ.
Теперь давайте рассмотрим это вложение в исходном коде.



В приведенном выше примере мы видим заголовки, связанные с этим вложением:

Тип содержимого — application/pdf . 
Content-Disposition указывает, что это вложение . 
Content-Transfer-Encoding сообщает нам, что данные закодированы в формате base64 . 
Используя данные, закодированные в формате base64, вы можете декодировать их и сохранить на своем компьютере.

Предупреждение : При работе с вложениями соблюдайте осторожность и будьте осторожны, чтобы случайно не щелкнуть дважды по вложению в электронное письмо. 

Примечание : Заголовки, относящиеся к «контенту», можно найти в разных местах исходного кода сообщения электронной почты, и они связаны не только с вложениями. Например, Content-Type может быть text/html, а Content-Transfer-Encoding может иметь другие значения, например 8bit . 

### Ответить на вопросы ниже
Каков URI заблокированного изображения на скриншотах выше?
```commandline
https://i.imgur.com/LSWOtDI.png
```
 Каково название PDF-вложения на скриншотах выше ?
```commandline
Payment-updateid.pdf
```
В присоединенной виртуальной машине просмотрите информацию в email2.txt и восстановите PDF с использованием данных base64. Какой текст находится в PDF?
```commandline
THM{BENIGN_PDF_ATTACHMENT}
```

## Задание 6
Теперь, когда мы рассмотрели общие понятия, касающиеся электронных писем и того, как они передаются от отправителя к получателю, мы можем поговорить о том, как этот метод коммуникации используется в гнусных целях. 

Различные типы вредоносных писем можно классифицировать следующим образом:

Спам - нежелательная почта, рассылаемая оптом большому количеству получателей. Более вредоносный вариант спама известен как MalSpam .
Фишинг —  электронные письма, отправляемые целевой аудитории якобы от имени доверенной организации с целью заставить людей предоставить конфиденциальную информацию. 
Целевой фишинг  —  это более продвинутый вариант фишинга, нацеленный на конкретных лиц или организации, которые ищут конфиденциальную информацию.  
Уэйлинг  — похож на целевой фишинг, но нацелен конкретно на лиц, занимающих высокие должности (генеральный директор, финансовый директор и т. д.), и цель та же. 
Smishing — переносит фишинг на мобильные устройства, рассылая пользователям мобильных устройств специально созданные текстовые сообщения. 
Вишинг  — похож на смишинг, но вместо использования текстовых сообщений для атаки методом социальной инженерии атаки основаны на голосовых вызовах. 
Когда дело доходит до фишинга, методы его совершения обычно одинаковы и зависят от цели электронного письма.

Например, целью может быть сбор учетных данных, а другой — получение доступа к компьютеру. 

Ниже приведены типичные характеристики фишинговых писем:

Имя/адрес электронной почты отправителя будет  маскироваться под доверенный объект ( подмена электронной почты )
Тема письма и/или его текст (текст) написаны с чувством срочности или используют определенные ключевые слова, такие как «Счет» , «Приостановлено» и т. д. 
Текст электронного письма (HTML) разработан таким образом, чтобы соответствовать доверенному лицу (например, Amazon).
Текст электронного письма (HTML) плохо отформатирован или написан (вопреки предыдущему пункту)
В тексте письма используется общий контент, например «Уважаемый господин/госпожа». 
Гиперссылки  (часто используют сервисы сокращения URL-адресов, чтобы скрыть свое истинное происхождение)
Вредоносное  вложение , выдающее себя за законный документ
Мы рассмотрим каждый из этих методов (характеристик) более подробно в следующей комнате модуля «Фишинг» .

Напоминание : при работе с гиперссылками и вложениями необходимо соблюдать осторожность, чтобы случайно не нажать на гиперссылку или вложение. 

Гиперссылки и IP-адреса должны быть « обезврежены ». Обезвреживание — это способ сделать URL/домен или адрес 
электронной почты некликабельным, чтобы избежать случайных щелчков, которые могут привести к серьезному нарушению 
безопасности. Он заменяет специальные символы, такие как «@» в адресе электронной почты или «.» в URL, другими 
символами. Например, крайне подозрительный домен http://www.suspiciousdomain.com будет изменен на hxxp[://]www[.]
suspiciousdomain[.]com перед его отправкой в ​​команду SOC для обнаружения.    

Проанализируйте электронное письмо, озаглавленное email3.emlна виртуальной машине, и ответьте на вопросы ниже.

Примечание : Алекса — жертва, а Билли — аналитик, назначенный на это дело. Алекса переслала письмо Билли для анализа. 

### Ответить на вопросы ниже
Под какую доверенную организацию маскируется это электронное письмо?
```commandline
Home Depot
```
Какой адрес электронной почты отправителя?
```commandline
support@teckbe.com
```
Какова тема письма? 
```commandline
Order Placed : Your Order ID OD2321657089291 Placed Successfully
```
Для чего нужна ссылка URL - КЛИКНИТЕ ЗДЕСЬ ? (Введите очищенный URL)
```commandline
hxxp[://]t[.]teckbe[.]com/p/?j3=EOowFcEwFHl6EOAyFcoUFV=TVEchwFHlUFOo6lVTTDcATE7oUE7AUET==
```

## Задание 7
Прежде чем закончить эту статью, вы должны знать, что означает BEC (компрометация деловой электронной почты).

BEC-атака происходит, когда злоумышленник получает контроль над учетной записью внутреннего сотрудника, а затем 
использует взломанную учетную запись электронной почты, чтобы убедить других внутренних сотрудников выполнить 
несанкционированные или мошеннические действия.   

Совет : Вы должны быть знакомы с этим термином. Я уже слышал этот вопрос на собеседовании при приеме на работу. 

В этой комнате мы рассмотрели следующее:
- Из чего состоит адрес электронной почты?
- Как электронное письмо передается от отправителя к получателю.
- Как просмотреть исходный код заголовка электронного письма.
- Как просмотреть исходный код текста письма. 
- Понять, какую важную информацию мы должны получить из анализируемого нами электронного письма.
- Некоторые распространенные приемы, используемые злоумышленниками в спам- и фишинговых кампаниях по электронной почте.
В предстоящей серии статей «Анализ фишинга» мы рассмотрим примеры различных распространенных методов, используемых в 
  фишинговых кампаниях по электронной почте, а также инструменты, которые помогут нам анализировать заголовки и 
  тексты электронных писем.

Следующая комната в этом модуле: Фишинговые письма 2

### Ответить на вопросы ниже
Что такое БЭК?


```commandline
Business Email Compromise
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)