[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Advent of Cyber 3 (2021)](https://tryhackme.com/r/room/adventofcyber3) 

Всего 30 заданий:
## Задание 1
Добро пожаловать в Advent of Cyber 2021

Начните изучать кибербезопасность за 25 дней, изучив основы и выполняя новые упражнения по безопасности для новичков 
каждый день вплоть до Рождества; рождественский календарь, но с заданиями по безопасности и без шоколада.

### Призы и сертификаты
У нас есть призы на сумму более 19 000 долларов! В этом событии очки не имеют значения, а вот количество вопросов, 
на которые вы ответили, имеет значение. За каждое правильное задание вы получаете лотерейный билет, и 26 декабря мы 
случайным образом выберем победителей, используя лотерейные билеты всех участников; чем больше вопросов вы ответите, 
тем больше у вас шансов на победу. Вот призы, которые можно выиграть:   

- 5 курсов PWK + 30-дневный доступ к лаборатории + сертификация по экзамену OSCP (4995 долл. США)
- 4 ноутбука ASUS ZenBook 14 8 ГБ ОЗУ , 512 ГБ SSD, Intel i5 (4000 долл. США)
- 35 ваучеров на экзамен сертифицированного специалиста Burp Suite (3225 долл. США)
- 20 ваучеров на испытательные полигоны (380 долл. США)
- 5 курсов Attacking Windows AD Throwback (425 долл. США)
- 2 компьютера Raspberry Pi 400 (244 долл. США)
- 2 кабеля HAK5 O.MG (240 долл. США)

- 2x Расширенная эмуляция угроз: Red Teams BCSecurity ($3798)
- 4x Ваучера на экзамен CompTIA Security+ ($1164)
- 5x Ваучеров TryHackMe Swag номиналом $30 ($150)
- 2x HAK5 Wifi Pineapple ($200)
- 2x HAK5 Rubber Ducky ($100)
- 15x Подписок TryHackMe ($150)

Общая стоимость призового фонда: $19,121

Кроме того, каждый день, когда вы выполняете задание, вы участвуете в другом розыгрыше призов, чтобы получить шанс 
выиграть мини-приз. «Ежедневные призы» разыгрываются в конце недели.  Выполните все задания в событии и получите 
сертификат о завершении! Убедитесь, что ваше имя указано в настройках.  

### Посмотреть образец сертификата

Наши спонсоры
В преддверии Рождества мы собрали вместе несколько крупнейших имен в сфере кибербезопасности и очень рады, что они 
поддерживают мероприятие, предоставляя призы! 

CompTIA — это глобальная некоммерческая ассоциация ИТ-торговли и создатель нейтральных ИТ-сертификаций. Сертификации 
CompTIA разрабатываются при поддержке ведущих технологических компаний и проверяются отраслевыми экспертами по всему 
миру.  


Offensive Security предлагает определяющее отрасль обучение информационной безопасности. В дополнение к курсам и 
сертификациям студенты могут получить практическую практику пентестинга в наших лабораториях Proving Grounds. 
Повышайте уровень своих навыков и изучайте мышление Try Harder с командой, стоящей за сертификацией OSCP.  

PortSwigger — создатели Burp Suite, ведущего в мире инструментария для тестирования безопасности веб-приложений. Их 
центр передового опыта — исследовательская группа PortSwigger, где они находят и эксплуатируют уязвимости, а затем 
вносят свои выводы обратно в продукты Burp Suite.

Безопасность Британской Колумбии
Компания BC Security проводит оценку кибербезопасности по широкому спектру дисциплин и обладает не только 
техническими знаниями, но и глубоким пониманием правил соответствия и мер по снижению рисков, которые имеют решающее 
значение для ведения бизнеса в современном мире.  


Видеоролики с описанием. Каждое выпущенное задание сопровождается видеоруководством от ряда замечательных и 
талантливых создателей, в том числе: 
CyberSecMeg, Джон Хаммонд, Tib3rius, Нил Бриджес, HuskyHacks, InsiderPhD и NahamSec!



### темы, которые будут рассмотрены на мероприятии:

- Эксплуатация Интернета 
- Эксплуатация сети OSINT 
- Взлом облака 
- Защитная синяя команда
### Ответить на вопросы ниже
Прочитайте вышеизложенное и ознакомьтесь со спонсорами.

```commandline
Ответ не нужен
```

## Задание 2
### Ответить на вопросы ниже
Подпишитесь на нас в LinkedIn !
```commandline
Ответ не нужен
```
Присоединяйтесь к нашему Discord и поздоровайтесь!
```commandline
Ответ не нужен
```
Следуйте за нами на Twitter !
```commandline
Ответ не нужен
```
Загляните на сабреддит !
```commandline
Ответ не нужен
```

## Задание 3
Подписка
Событие Advent of Cyber полностью бесплатное! Однако ознакомьтесь с некоторыми причинами, по которым стоит подписаться: 
Если вы хотите подарить VIP-подписку TryHackMe, вы можете приобрести ваучеры.

В честь Advent of Cyber вы можете получить скидку 20% на годовую подписку, используя код скидки AOC2021 при 
оформлении заказа. Эта скидка действительна только до 7 декабря, то есть в:  


Завершение Advent of Cyber как организации

Advent of Cyber — это идеальное мероприятие для знакомства и повышения квалификации множества различных команд в 
вашей компании в области кибербезопасности в рамках этого увлекательного 25-дневного мероприятия!

С помощью панели управления TryHackMe для бизнеса команды вашей компании могут совместно решать ежедневные задачи, а 
вы сможете отслеживать их прогресс и предоставлять им первоклассный опыт обучения.

### Рождественские сувениры

Хотите представить сувениры от вашей любимой платформы обучения кибербезопасности?
У нас есть специальный выпуск футболок Christmas Advent of Cyber. Купите в нашем магазине сувениров.

### Ответить на вопросы ниже
Прочитайте вышеизложенное.
```commandline
Ответ не нужен
```

## Задание 4
### Краткое руководство

Для доступа к целевым машинам, которые вы разворачиваете на TryHackMe, вам нужно будет либо использовать клиент 
OpenVPN, либо развернуть собственный веб-ориентированный AttackBox ( вы можете сделать это, нажав синюю кнопку 
«Запустить AttackBox» в верхней части этой страницы ).  Мы настоятельно рекомендуем вам пройти обучающую  комнату, 
чтобы узнать больше о подключении.   

Используя веб-ориентированный AttackBox, вы можете выполнить все эти упражнения через браузер. Если вы постоянный 
пользователь, вы можете развернуть AttackBox бесплатно на 1 час в день, если вы подписаны, вы можете развернуть его 
на неограниченное количество времени!   


###  Правила
Нарушение любого из следующих правил приведет к исключению из соревнования.
- *.tryhackme.com и сервер OpenVPN недоступны для зондирования, сканирования или эксплуатации.
- Пользователям разрешено взламывать только те машины, которые установлены в комнатах, к которым у них есть доступ.
- Пользователи не должны нападать на других пользователей или преследовать их.
- Пользователи должны войти в мероприятие только один раз, используя одну учетную запись.
- Ответы на вопросы не подлежат разглашению, за исключением случаев, когда они показаны на видео/трансляциях.
### Ответить на вопросы ниже
Потренируйтесь подключаться к нашей сети!
```commandline
Ответ не нужен
```

## Задание 5
[Рождественская история]

Все упражнения в Advent of Cyber следуют веселой рождественской истории. В этом году эльфу МакСкиди нужна ваша 
помощь, чтобы взломать и отменить вредоносные действия Гринча.                                                                 

Наступил канун 30 ноября — МакСкиди сидит в своем большом офисе с чашкой горячего какао, вспоминая напряженные 
времена в Best Festival Company. С тех пор, как она возглавила кибератаки Christmas Monster в декабре прошлого года, 
ее повысили до начальника отдела информационной безопасности (CISO), и ей удалось создать команду безопасности 
мирового класса. Она дала обещание никогда не позволять Рождеству быть затронутым киберинцидентами и сделала все 
возможное, чтобы подготовить лучшую фестивальную компанию к любым инцидентам и помочь Санте доставлять подарки по 
всему миру без сбоев!     

Пока она усмехается про себя: «После всего, что мы сделали, что может пойти не так?», Эльф МакАссистент вбегает в ее 
кабинет и ахает: «Все наши аналитики по безопасности пропустили свою последнюю смену, и в здании нет ни одного 
сотрудника службы безопасности». МакСкиди вскакивает со своего стула и проливает на себя горячий какао: «ЧТО?»  

Она быстро направляется в Центр безопасности Elf, где размещается персонал службы безопасности, и осматривает 
большую зону, заполненную пустыми столами. Куда все подевались накануне самого важного времени для Лучшей 
Фестивальной Компании? Она спешит к столу руководителя своей команды аналитиков по безопасности, Elf McLeader, и 
замечает, что стол на удивление чист. Как может быть, что у кого-то настолько грязного, его рабочее место совершенно 
пусто? Когда она начала рассуждать в голове, она заметила небольшой листок бумаги, спрятанный в задней части стола 
за экраном. Когда она поняла, что было на бумаге, ее глаза расширились — почему McProfessional забронировала билет в 
один конец именно в этот день!      

Прежде чем она успела сделать какие-либо предположения, громкий, сварливый голос разнесся по центру безопасности из 
внутренних систем оповещения: «Grinch Enterprises никогда не допустит успеха Рождества. Было бы обидно, если бы ваша 
первоклассная команда по безопасности просто внезапно исчезла».  

« ВСЕ ЭТО БЫЛО СПЛАНИРОВАНО — КАК ОНИ ПОЛУЧИЛИ ДОСТУП К НАШИМ ВНУТРЕННИМ СИСТЕМАМ?» — воскликнул Макскиди. Их 
разведывательная группа подготовилась именно к такому сценарию, но не помогло то, что центр безопасности был 
совершенно пуст!  

«Этому нужно положить конец», — вздохнула МакСкиди и поплелась в офис, чтобы спасти Рождество.

Обратите внимание, что задания появляются ежедневно и будут различаться по сложности  (хотя всегда будут нацелены на 
начальный уровень). 

### Ответить на вопросы ниже
В некоторых заданиях используется рождественская история, поэтому обязательно прочтите вышеизложенное.


```commandline
Ответ не нужен
```

## Задание 6
Посмотрите видео Джона Хаммонда, открывающее Advent of Cyber 3 , здесь

### История

Системы управления запасами, используемые для создания подарков, были взломаны, чтобы разозлить эльфов. Это ночная 
смена, и Макстокер приходит к Макскиди в панике из-за того, что все подарки сделаны неправильно. Поскольку рядом нет 
менеджеров, которые могли бы исправить проблему, Макскиди нужно как-то получить доступ и исправить систему, а также 
держать все в порядке, чтобы быть готовым к Рождеству!   

Цели обучения
- Что такое уязвимость IDOR ?
- Как найти и использовать уязвимости IDOR ?
- Прохождение задания.
### Что такое уязвимость IDOR ?
IDOR означает Insecure Direct Object Reference и является типом уязвимости контроля доступа. Уязвимость контроля 
доступа возникает, когда злоумышленник может получить доступ к информации или действиям, не предназначенным для него.
Уязвимость IDOR может возникнуть, когда веб-сервер получает предоставленные пользователем входные данные для 
извлечения объектов (файлов, данных, документов), и слишком большое доверие было оказано этим входным данным, и 
веб-приложение не проверяет, должен ли пользователь на самом деле иметь доступ к запрошенному объекту.

### Как найти и использовать уязвимости IDOR?
Как упоминалось ранее, уязвимость IDOR основана на изменении данных, предоставленных пользователем. Эти данные, 
предоставленные пользователем, в основном можно найти в следующих трех местах: 

Компонент запроса: Данные компонента запроса передаются в URL при выполнении запроса к веб-сайту. Возьмем, к 
примеру, следующий снимок экрана URL.

Мы можем разбить этот URL на следующие части:
- Протокол:  https://
- Домен:  website.thm
- Страница:  /профиль
- Компонент запроса:  id=23

Здесь мы видим, что запрашивается страница /profile, а параметр  id  со значением 23 передается в компоненте запроса.
Эта страница потенциально может показывать нам персональную информацию пользователя, и, изменив параметр id на 
другое значение, мы могли бы просматривать данные других пользователей.  

Переменные сообщения: Изучение содержимого форм на веб-сайте иногда может выявить поля, которые могут быть уязвимы для эксплуатации IDOR. Возьмем, к примеру, следующий HTML-код для формы, которая обновляет пароль пользователя.
```commandline
<form method="POST" action="/update-password">
    <input type="hidden" name"user_id" value="123">
    <div>New Password:</div>
    <div><input type="password" name="new_password"></div>
    <div><input type="submit" value="Change Password">
</form>
```


Из выделенной строки видно, что идентификатор пользователя передается на веб-сервер в скрытом поле. Изменение 
значения этого поля с 123 на другой user_id может привести к изменению пароля для учетной записи другого пользователя. 

Печенье:

Чтобы оставаться авторизованным на таком веб-сайте, как этот, используются файлы cookie для запоминания сеанса. 
Обычно это включает отправку идентификатора сеанса, который представляет собой длинную строку случайного, трудно 
угадываемого текста, например,  5db28452c4161cf88c6f33e57b62a357,  который веб-сервер безопасно использует для 
извлечения вашей пользовательской информации и проверки сеанса. Однако иногда менее опытные разработчики могут 
хранить пользовательскую информацию в самом файле cookie, например идентификатор пользователя. Изменение значения 
этого файла cookie может привести к отображению информации другого пользователя. Ниже приведен пример того, как это 
может выглядеть.      
```commandline
GET /user-information HTTP/1.1
Host: website.thm
Cookie: user_id=9
User-Agent: Mozilla/5.0 (Ubuntu;Linux) Firefox/94.0

Hello Jon!


GET /user-information HTTP/1.1
Host: website.thm
Cookie: user_id=5
User-Agent: Mozilla/5.0 (Ubuntu;Linux) Firefox/94.0

Hello Martin!
```

IDOR в дикой природе Увидеть идентификатор продукта, пользователя или услуги в URL или иным образом — это 
обязательно для тестирования. Уязвимости IDOR могут раскрыть конфиденциальную информацию, а также потенциально 
предоставить вам доступ к обычно ограниченным функциональным возможностям сайта. Для исследователей безопасности 
уязвимости IDOR могут иметь последствия, и сообщение о них может принести хорошую премию за ошибку; см. эту  статью ,
где отчет об уязвимости IDOR в PayPal принес выплату в размере 10 500 долларов США.

### Прохождение задания

Нажмите зеленую кнопку «Просмотр сайта» в правом верхнем углу этой задачи, чтобы открыть систему управления запасами.

Здесь вы найдете макет браузера на  странице выполненных заказов  , показывающий изображения игрушек, которые были 
сделаны неправильно из-за вмешательства Гринча! 

На панели навигации также есть три другие страницы: «Сборки», «Инвентарь» и «Ваша активность».
- На странице сборки показаны   различные игрушки и детали, из которых они состоят (как вы видите, из-за подделки все 
они неверны).
- На странице «Инвентарь» перечислены   отдельные товары с соответствующими им кодами SKU.
- На странице « Ваша  активность»  отображается информация о пользователе McSkidy, фотография и его последние 
  действия в системе.
Как мы узнали выше, уязвимость IDOR требует изменения какого-либо пользовательского ввода. Из всех страниц, на 
  которые мы можем перейти, единственная страница, на которой есть ввод, который можно изменить, находится на 
  странице «  Ваша активность»  . В URL вы увидите параметр компонента запроса с именем  user_id,  который 
  установлен на значение  11  (McSkidy's User Id).   

Попробуйте изменить  значение user_id  в адресной строке, и вы увидите, что веб-приложение пытается загрузить 
информацию другого пользователя. Попробуйте разные числа в диапазоне от 1 до 20, пока не найдете пользователя, 
который мог быть ответственным за взлом системы.  

Нажатие  кнопки «Вернуть»  в действиях пользователя откатит изменения и позволит машине для изготовления игрушек 
снова производить правильно построенные игрушки. После того, как все изменения будут отменены, вы будете 
вознаграждены флагом, который можно ввести ниже.  

### Ответить на вопросы ниже
После того, как вы нашли счет Санты, какова его должность в компании?
```commandline
The Boss!
```
После того, как вы нашли счет Макстокера, какова его должность в компании?

```commandline
Build Manager
```
Какую должность в компании вы занимаете после обнаружения аккаунта, ответственного за несанкционированный доступ?

```commandline
Mischief Manager
```
Какой флаг выдается, когда McSkidy исправляет систему управления запасами?

```commandline
THM{AOC_IDOR_2B34BHI3}
```
Если вы хотите узнать больше об уязвимостях IDOR, предлагаем вам посетить эту комнату https://tryhackme.com/room/idor
```commandline
Ответ не нужен
```
Задания, которые выпускаются каждый день, постепенно усложняются (но все еще сопровождаются видео-руководствами). 
Возвращайтесь завтра за заданием 2-го дня! 
```commandline
Ответ не нужен
```

## Задание 7
Посмотрите видеообзор Джона Хаммонда на второй день  здесь

История

McSkidy нужно проверить, не ушли ли другие эльфы-сотрудники/не пострадали ли они от атаки Grinch Industries, но 
системы, в которых хранится информация о сотрудниках, были взломаны. Можете ли вы взломать их обратно, чтобы 
определить, пострадали ли другие команды в Best Festival Company?  

### Цели обучения
- Понимание базовой технологии веб-серверов и принципов взаимодействия в сети.
- Узнайте, что такое файлы cookie и каково их назначение.
- Узнайте, как манипулировать файлами cookie и управлять ими в вредоносных целях.
### HTTP (С)
Для связи вашего компьютера и веб-сервера друг с другом требуется промежуточный протокол. Вот тут-то и появляется 
HTTP (протокол передачи гипертекста)! Протокол HTTP — это клиент-серверный протокол, обеспечивающий связь между 
клиентом и веб-сервером. Запросы HTTP похожи на стандартный сетевой запрос TCP; однако HTTP добавляет к запросу 
специальные заголовки для идентификации протокола и другой информации.

При создании  HTTP- запроса всегда будут включены заголовок метода  и  цели  . Заголовок цели будет указывать, что 
именно нужно получить с сервера, а заголовок метода будет указывать, как это сделать. 

При получении информации с веб-сервера обычно используется  метод GET  , например, для загрузки изображения.

При отправке данных на веб-сервер обычно используется метод  POST  , например, для отправки данных для входа в систему.

Пример запроса
```commandline
GET / HTTP/1.1
Host: tryhackme.com
User-Agent: Mozilla/5.0 Firefox/87.0
Referer: https://tryhackme.com/
```

Получив запрос, сервер отправит ответ, включая запрошенный контент в случае успеха и код статуса. Код статуса 
используется для того, чтобы сообщить браузеру клиента, как веб-сервер интерпретировал запрос. Наиболее 
распространенным «успешным» кодом статуса является HTTP 200 OK.  

Пример ответа
```commandline
HTTP/1.1 200 OK
Server: nginx/1.15.8
Date: Wednesday, 24 Nov 2021 13:34:03 GMT
Content-Type: text/html
Content-Length: 98

<html>
<head>
    <title>Advent of Cyber</title>
</head>
<body>
    Welcome To Advent of Cyber!
</body>
</html>
```

Сам протокол — это лишь малая часть головоломки; как только содержимое извлечено с веб-сервера, вашему браузеру 
нужен способ интерпретировать и отображать отправленную информацию. Веб-приложения обычно форматируются в HTML (язык 
гипертекстовой разметки), визуализируются и стилизуются в CSS (каскадные таблицы стилей). JavaScript также часто 
используется для предоставления дополнительных функций.   

В современной веб-среде использование веб-фреймворков значительно возросло в популярности. Большинство современных 
веб-приложений используют множество веб-фреймворков и других веб-решений, которые конечный пользователь не видит и с 
которыми не взаимодействует.  

Более подробную информацию о HTTP-запросах, методах и заголовках можно найти в  разделе «Основы веб-технологий»!

### Печенье
HTTP — это протокол без сохранения состояния. Когда вы отправляете запросы на веб-сервер, сервер не может отличить 
ваш запрос от запроса кого-либо другого. Чтобы решить проблему отсутствия состояния и определить разных 
пользователей и уровни доступа, веб-сервер назначит файлы cookie для создания и управления сеансом с сохранением 
состояния между клиентом и сервером.   

Файлы cookie — это небольшие фрагменты данных (метаданные) или информации, которые локально хранятся на вашем 
компьютере и отправляются на сервер при отправке запроса. 

Файлам cookie можно присвоить любое имя и любое значение, что позволяет веб-серверу хранить любую информацию, 
которую он захочет. Сегодня мы сосредоточимся на файлах cookie аутентификации, также известных как файлы cookie 
сеанса. Файлы cookie аутентификации или сеанса используются для идентификации вас и того, какой уровень доступа 
прикреплен к вашему сеансу.   

Ниже представлена схема, описывающая назначение и использование cookie-файла от первоначального запроса до запроса 
сеанса. 



Чтобы начать процесс, когда вы отправляете запрос, такой как запрос на вход, ваш браузер обычно отправляет эту 
информацию в виде запроса POST на веб-сервер. Веб-сервер проверяет, что он получил данные, и устанавливает 
уникальный файл cookie; как упоминалось ранее, файлы cookie являются произвольными, а значения определяются 
передовой практикой или веб-разработчиком. После назначения файла cookie, пока файл cookie хранится локально в вашем 
браузере, все будущие запросы GET будут автоматически отправляться с этим файлом cookie для идентификации вас и 
вашего уровня доступа. Как только сервер получит ваш запрос GET и файл cookie, он обнаружит и десериализует ваш 
сеанс. Десериализация — это процесс взятия формата данных, такого как JSON , и его перестроения в виде объекта. В 
случае успеха веб-сервер ответит на ваш запрос ответом 200.       

Теперь, когда мы понимаем, что такое файлы cookie и как они используются, давайте углубимся в их содержание.

Компоненты файлов cookie

Файлы cookie состоят из 11 различных компонентов; описание каждого компонента можно найти в таблице ниже.


Компоненты cookie всегда готовятся парами. Основная пара — это name-value; она определит имя cookie и значение имени.
Вторая пара — это attribute-valueпара ; она определит атрибут cookie и значение атрибута. Ниже приведен пример того, 
как Set-Cookie выглядит синтаксис.  

Set-Cookie: <cookie-name>=<cookie-value>; Domain=<domain-value>; Secure; HttpOnly

### Манипуляции с файлами cookie
Манипулирование файлами cookie заключается в том, что файл cookie берется и изменяется для получения 
непреднамеренного поведения, определенного веб-разработчиком. Манипулирование файлами cookie возможно, поскольку 
файлы cookie хранятся локально на вашей хост-системе, что означает, что вы имеете полный контроль над ними и можете 
изменять их по своему усмотрению.

Чтобы начать изменять и манипулировать файлами cookie, нам нужно открыть наши инструменты разработчика. В Google 
Chrome инструменты разработчика называются  «Инструменты разработчика Chrome»,  а в Mozilla Firefox —  «Инструменты 
разработчика Firefox».  

Доступ к инструментам разработчика можно получить, нажав F12или Ctrl+Shift+I. После открытия инструментов 
разработчика, чтобы получить доступ к файлам cookie, перейдите на Storageвкладку в Firefox или Applicationвкладку в 
Chrome/Edge; выберите Cookiesраскрывающийся список в левой части консоли.  



Значения файлов cookie на первый взгляд могут показаться случайными; однако зачастую они имеют закодированное 
значение или смысл, который можно декодировать в непроизвольное значение, например, объект Javascript. 

С точки зрения злоумышленника вы можете декодировать значение cookie, чтобы идентифицировать базовые объекты. После 
того, как вы идентифицировали базовые объекты, вы можете изменить их так, как вам нужно. Чтобы использовать cookie, 
вам нужно будет закодировать его обратно в исходную кодировку и заменить значение cookie. Ниже приведен пример 
декодированного значения cookie.   

`{firstName:"John", lastName:"Doe", age:50, eyeColor:"blue"`

Теперь, когда у нас есть все части cookie-файлов и способы их обработки, мы можем собрать их все вместе, чтобы 
получить непреднамеренный доступ. 

Ниже приведено краткое описание того, как можно манипулировать значениями cookie-файлов.
- Получите значение cookie-файла при регистрации или создании учетной записи.
- Расшифруйте значение cookie-файла.
- Определите нотацию объекта или структуру файла cookie.
- Измените параметры внутри объекта на другие параметры с более высоким уровнем привилегий, например, admin или 
  administrator.
- Перекодируйте файл cookie и вставьте его в область значений; это можно сделать, дважды щелкнув поле значения.
- Действие с файлом cookie; это можно сделать, обновив страницу или войдя в систему.
### Дополнительные ресурсы

Для получения дополнительной информации о HTTP (s) и файлах cookie посетите другие комнаты TryHackMe.

HTTP-протокол:https://tryhackme.com/jr/httpindetail
Аутентификация: https://tryhackme.com/jr/authenticationbypass
Если вы застряли в решении этой задачи, посмотрите видео-обучение здесь

### Ответить на вопросы ниже
Откройте статический сайт в новой вкладке  здесь .
```commandline
Ответ не нужен
```
Зарегистрируйте учетную запись и проверьте файлы cookie с помощью инструментов разработчика в вашем браузере.
Как называется новый файл cookie, созданный для вашей учетной записи?
```commandline
user-auth
```
Какой тип кодировки использовался для значения cookie?
```commandline
hexadecimal
```
В каком формате объекта хранятся данные cookie-файла?
```commandline
JSON
```
Манипулируйте файлами cookie и обходите портал входа.
Каково значение cookie-файла администратора? (имя пользователя = admin)
```commandline
7b636f6d70616e793a2022546865204265737420466573746976616c20436f6d70616e79222c206973726567697374657265643a2254727565222c20757365726e616d653a2261646d696e227d
```
Какая командная среда не отвечает требованиям?
```commandline
HR
```
В какой командной среде есть сетевое предупреждение?
```commandline
Application
```
Если вы хотите узнать больше об обходах аутентификации, предлагаем вам посетить эту комнату https://tryhackme.com/jr/authenticationbypass  
```commandline
Ответ не нужен
```
Задания, которые выпускаются каждый день, становятся все сложнее (но все еще сопровождаются видео-прохождениями). 
Возвращайтесь завтра для задания 3-го дня, где InsiderPHD запишет видео-прохождение! 
```commandline
Ответ не нужен
```

## Задание 8
Grinch Enterprises также попытались заблокировать общение между кем-либо в компании. Они заблокировали всех из своих 
систем электронной почты, а McSysAdmin также потерял доступ к своей панели администратора. Можете ли вы найти панель 
администратора и помочь восстановить общение для Best Festival Company.  

Посмотрите видео-обзор InsiderPHD на третий день  здесь

### Цели обучения
В сегодняшнем задании мы будем использовать наши навыки и методы расследования, чтобы обнаружить неучтенный контент, 
а также попытаемся провести простую аутентификацию, используя имеющиеся вокруг нас подсказки. 



#### Что такое Content Discovery и почему это полезно?
Прежде чем начать искать контент, давайте определим, что такое «контент». Контент — это активы и внутренняя работа 
приложения, которое мы тестируем. Контент может быть файлами, папками или путями, которые не обязательно 
предназначены для доступа широкой публики.  

Например, у вас может быть блог, в котором вы публикуете посты о своих вкусняшках! Вы хотите, чтобы все видели все 
ваши вкусняшки, но не хотите, чтобы все могли управлять тем, какие вкусняшки выставлены на обзор - вы можете скрыть 
панель администратора от публики!  



Давайте остановимся на этом подробнее. Веб-серверы, если не настроены иначе, предназначены для обслуживания этих 
файлов и папок, если вы знаете их имена. 



Обнаружение контента — это полезный метод, который стоит иметь в своем арсенале, поскольку он позволяет нам находить 
то, что мы не должны видеть. Например, мы можем найти: 
- Файлы конфигурации
- Пароли и секреты
- Резервные копии
- Системы управления контентом
- Панели управления или порталы администратора
Это лишь некоторые примеры типов информации, которые мы можем раскрыть, обнаруживая контент. Мы можем найти эти 
фрагменты информации, поскольку они хранятся либо в папке (у которой будет имя), либо в файле (у которого будет и 
имя, и расширение). Это означает, что мы можем искать файлы по их расширению, например, обнаруживая текстовые файлы 
с расширением .txt.   

Вы можете сделать это вручную, придумав несколько имен, например « admin » или « passwords.txt » и перейдя к ним в 
браузере. Однако мы можем использовать инструменты, которые сделают этот процесс за нас значительно быстрее. Введите 
Dirbuster. Dirbuster — это инструмент, который мы можем использовать для автоматизации этого процесса. Инструмент 
работает, принимая список слов, который представляет собой файл, содержащий все, что мы хотим искать, а затем 
несколько других аргументов. Давайте продемонстрируем это в приведенных ниже фрагментах:    

Мой список слов
```commandline
cmnatic@thm$ cat wordlist.txt

admin/
docs/
config/
install/
install-en/
```
Dirbuster просканирует веб-сайт "santascookies.thm" на наличие папок, перечисленных в этом списке слов. Чтобы 
использовать Dirbuster для обнаружения контента на этом сайте, мы используем команду dirbи предоставим некоторую 
информацию, такую ​​как URL-адрес веб-сайта и местоположение списка слов. Наша окончательная команда будет выглядеть 
примерно так, как показано ниже::   



Пример команды Dirbuster
`cmnatic@thm$ dirb http://santascookies.thm/ /usr/share/wordlists/mywordlist.txt`
Выше мы предоставили Dirbuster следующие команды:

URL-адрес веб-сайта
Расположение (полный путь) на нашей атакующей машине нашего списка слов. Если вы не знакомы с этим, ознакомьтесь с 
Linux Fundamentals. 
Теперь, как только мы выполним эту команду, Dirbuster выполнит поиск каталога на веб-сайте, используя каждое 
значение в созданном нами списке слов.  

Примеры списков слов для использования с Dirbuster
```commandline
cmnatic@thm:/usr/share/wordlists/dirb# ls 

big.txt     euskera.txt            mutations_common.txt  spanish.txt
catala.txt  extensions_common.txt  others                stress
common.txt  indexes.txt            small.txt             vulns
```



Ваша способность обнаруживать контент настолько хороша, насколько хорош ваш список слов. Вы найдете еще одну 
коллекцию списков слов с открытым исходным кодом, например SecLists , где вы можете использовать комбинацию 
контекста и списка слов для обнаружения контента.  



### Учетные данные по умолчанию
Веб-приложения и сервисы часто поставляются с парой учетных данных по умолчанию. Разработчики оставляют эти учетные 
данные на месте, чтобы вы могли быстро начать работу с платформой (в надежде, что вы их измените). Однако, как вы 
обнаружите, не все так делают, или, по сути, приложения часто включают другие учетные записи, которые не очень 
хорошо документированы. SecLists также предоставляют список слов для учетных данных по умолчанию, который вы можете 
найти здесь .    

Например, попробуйте использовать некоторые общие комбинации имен пользователей и паролей для привилегированных 
пользователей. Это может включать: 


Иногда эти учетные данные хранятся в файлах конфигурации веб-приложений или в общедоступной документации. Например, 
это приложение, "BikeIT", является приложением с открытым исходным кодом для регистрации вашего велосипеда на 
странице сообщества. Администратор включен по умолчанию, учетные данные указаны как в документации, так и в исходном 
коде.   

  

На фотографии выше показана документация «Read Me» (или инструкции) для веб-приложения.

$username="Administrator";

$password="letmein123"; //change this

Исходный код также содержит эти учетные данные по умолчанию.

Если администратор, устанавливающий это приложение, не изменит учетные данные, любой сможет войти в систему, 
используя их, если он знает, что эти данные следует искать в опубликованных данных (как это обычно бывает в проектах 
с открытым исходным кодом), или способен угадать их.  



Для выполнения сегодняшнего задания вам необходимо будет развернуть уязвимую машину, прикрепленную к этому заданию, 
нажав зеленую кнопку «Запустить машину» в правом верхнем углу этого задания , а также TryHackMe AttackBox, который 
можно развернуть, нажав кнопку «Запустить AttackBox», расположенную в правом верхнем углу комнаты.  

### Дополнительные ресурсы
Если вы заинтересованы в получении дополнительной информации (или хотите применить свои знания) об обнаружении 
контента и обходе аутентификации, посетите следующие разделы на TryHackMe: 

Контент-дискаут
Обход аутентификации  
### Ответить на вопросы ниже
Используя общий список слов для обнаружения контента, перечислите http://MACHINE_IP, чтобы найти местоположение 
панели администратора. Каково имя папки? 

```commandline
admin
```
В вашем веб-браузере попробуйте ввести  некоторые учетные данные по умолчанию в недавно обнаруженной форме входа для 
пользователя " administrator ". Какой пароль? 
```commandline
administrator
```
Зайдите в админ-панель. Каково значение флага?
```commandline
THM{ADM1N_AC3SS}
```

## Задание 9
McSysAdmin удалось сбросить доступ всех, кроме Санты! Санта ожидал какой-то срочный маршрут поездки на Рождество. Ходят слухи, что Санта никогда не следовал рекомендациям по безопасности паролей. Можно ли использовать перебор паролей, чтобы помочь ему получить доступ к своим аккаунтам?

Посмотрите видео-обучение Нахамсека на 4-й день  здесь
### Цели обучения
В сегодняшнем задании мы узнаем следующее.
- Понимание аутентификации и ее применения
- Понимание того, что такое фаззинг
- Понимание того, что такое Burp Suite и как мы можем использовать его для фаззинга формы входа в систему с целью 
  получения доступа
Примените эти знания, чтобы восстановить маршрут путешествия Санты. 

#### Что такое аутентификация и где она используется?
Аутентификация — это процесс проверки личности пользователя, устанавливающий, что он тот, за кого себя выдает. 
Аутентификация может быть подтверждена с помощью различных средств аутентификации, включая: 

Известный набор учетных данных для сервера и пользователя, такой как имя пользователя и пароль.
Аутентификация токенов (это уникальные фрагменты зашифрованного текста)
Биометрическая аутентификация (отпечатки пальцев, данные сетчатки глаза и т. д.)


Аутентификация часто используется взаимозаменяемо с авторизацией, но это совсем другое. Авторизация — это термин для 
правил, определяющих, к чему  аутентифицированный  пользователь может и не может получить доступ. Например, стандарт,
аутентифицированный пользователь будет иметь доступ только к некоторым аспектам веб-сайта. Аутентифицированный 
администратор сможет получить доступ ко всему — его уровень авторизации определяет это.   

Аутентификация используется, когда необходимо знать, кто получает доступ к данным или информации, чтобы создать 
подотчетность — защищая   элемент Конфиденциальности триады ЦРУ . Если вы хотите узнать больше об этом, я рекомендую 
ознакомиться с  Principles of Security room на TryHackMe . Вы можете найти примеры аутентификации в реальном мире, 
например, значок или ключ-карта для доступа к закрытым местам в здании.   

 

### Что такое фаззинг?
Проще говоря, фаззинг — это автоматизированный способ тестирования элемента веб-приложения до тех пор, пока 
приложение не выдаст уязвимость или ценную информацию. Когда мы фаззинг, мы предоставляем информацию так же, как мы 
обычно это делаем при взаимодействии с ней, просто с гораздо большей скоростью. Это означает, что мы можем 
использовать обширные списки, известные как списки слов, для тестирования реакции веб-приложения на различную 
информацию.    

Например, вместо того, чтобы поочередно проверять форму входа на наличие допустимого набора учетных данных (что 
отнимает исключительно много времени), мы можем использовать инструмент для фаззинга этой формы входа, чтобы гораздо 
быстрее и надежнее проверить сотни учетных данных.   

Фаззинг с помощью Burp Suite
Обратите внимание, что эта задача предполагает, что вы используете TryHackMe AttackBox. AttackBox имеет необходимое 
программное обеспечение, инструменты и списки слов, установленные для выполнения сегодняшней задачи, поэтому 
настоятельно рекомендуется использовать его (чтобы запустить его, прокрутите страницу вверх и нажмите синюю кнопку 
«Запустить AttackBox», затем следуйте инструкциям ниже).   

1. Запустим FireFox, перейдя в « Приложения  ->  Интернет ->  Firefox ».
2. Перейдите к форме входа в веб-браузере, используя уязвимый IP-адрес ( http://MACHINE_IP ) (обратите внимание, что 
   IP-адрес на снимках экрана является всего лишь примером, вам нужно будет заменить его на MACHINE_IP) 
3. Запустим Burp Suite, перейдя в « Приложения  ->  Другие  ->  Burp Suite ».
4. Перейдите на вкладку « Прокси »:
5. И нажмите « Перехват Вкл » в « Прокси -> Перехват ».
6.  Теперь нам нужно вернуться в наш браузер Firefox и включить расширение FoxyProxy в Firefox. Вы можете сделать 
    это, нажав на расширение « FoxyProxy » и нажав « Burp » следующим образом: 
7. Отправьте некоторые фиктивные данные в форме входа, например, как показано ниже. Обратите внимание, что 
   веб-браузер зависнет: 
8. Нам нужно будет вернуться в Burp Suite, где мы увидим, что некоторые данные теперь были возвращены нам. Щелкните 
   правой кнопкой мыши окно, содержащее данные, и нажмите « Отправить нарушителю » 
9. Перейдите на вкладку « Нарушитель » и выберите следующее:

10.1. Нажмите вкладку « Позиции»  и очистите предварительно выбранные позиции, нажав «Очистить $ ».

10.2 . Добавьте значение параметра " username " в качестве первой позиции, иногда мы уже знаем имя пользователя, 
   иногда нет. Мы можем указать Burp использовать список слов имен пользователей для этой позиции. Однако, поскольку 
   имя пользователя уже известно (т. е.  cmnatic ), мы просто перебираем пароль. (это можно сделать, выделив 
   параметр пароля и нажав " Add $ ")   

10.3 . Добавьте значение « пароля » в качестве позиции (например, password123) (это можно сделать, выделив 
   значение в параметре пароля и нажав «Добавить $ »). 

10.4. Выберите « Кассетная бомба » в раскрывающемся меню в типе атаки.

10.5. Теперь нам нужно будет предоставить некоторые значения для Burp Suite , чтобы заполнить форму входа паролями. 
   Мы можем предоставить список вручную или предоставить список слов. Я предоставлю список слов. 
11. Теперь, после выбора нашего списка слов, мы видим, что некоторые пароли заполнили окно «Параметры полезной нагрузки»:
12. Теперь давайте нажмем кнопку « Начать атаку », это начнет фаззинг формы входа. Посмотрите на результаты и 
    отсортируйте по «Длине». Неудачные пароли вернут определенную длину, а успешные пароли вернут другую длину. Вам 
    нужно будет проверить результаты с разной длиной, чтобы определить правильный пароль в сегодняшнем задании.  

Перейдите к уязвимой форме входа по адресу  http://MACHINE_IP/  и примените материал для сегодняшнего задания, чтобы 
войти в маршрут Санты , используя  имя пользователя «santa» и список паролей, расположенный на 
/root/Rooms/AoC3/Day4/passwords.txt  TryHackMe AttackBox (или загрузите его отсюда  для  своей полезной нагрузки).  


Дополнительные ресурсы
Если вам интересно узнать больше о Burp Suite, ознакомьтесь с модулем Burp Suite на TryHackMe.

### Ответить на вопросы ниже
Доступ к форме входа по адресу http://MACHINE_IP
```commandline
Ответ не нужен
```
Настройте Burp Suite и Firefox, отправьте некоторые фиктивные учетные данные и перехватите запрос. Используйте 
злоумышленника для атаки на форму входа. 
```commandline
Ответ не нужен
```
Какой действительный пароль можно использовать для доступа к учетной записи «santa»?
```commandline
cookie
```
Какой флаг есть в маршруте Санты?
```commandline
THM{SANTA_DELIVERS}
```

## Задание 10
История

Форум эльфов — это место, где все эльфы выражают свою радость и волнение по поводу Рождества, но у Grinch Enterprises есть одна плохая учетная запись администратора, и они установили плагин, который меняет все упоминания Рождества на Buttmas!! Макскиди нужно найти эту учетную запись администратора и отключить плагин.

### Цели обучения
- Что такое XSS- уязвимость?
- Какие типы XSS- уязвимостей существуют?
- Прохождение задания.
- Посмотрите видео-обучение Нахамсека на 5-й день  здесь
### Что такое XSS- уязвимость?

Межсайтовый скриптинг, более известный в сообществе специалистов по кибербезопасности как XSS , классифицируется как 
инъекционная атака, при которой вредоносный код JavaScript внедряется в веб-приложение с целью его выполнения 
другими пользователями.  

Если вы можете заставить JavaScript работать на компьютере жертвы, вы можете достичь многого. Это может 
варьироваться от кражи файлов cookie жертвы для захвата ее сеанса, запуска кейлоггера, который будет регистрировать 
каждую клавишу, нажимаемую пользователем на клавиатуре во время посещения веб-сайта, перенаправления пользователя на 
совершенно другой веб-сайт или выполнения какого-либо действия на веб-сайте, например, размещения заказа или сброса 
пароля и т. д.



Какие типы XSS- уязвимостей существуют?

Уязвимости XSS делятся на четыре типа: DOM, Reflected, Stored и Blind. Каждый тип — это довольно сложная тема, 
которую мы попытаемся кратко осветить здесь, но чтобы получить более глубокое понимание, вы можете попробовать эту 
комнату после завершения испытания  https://tryhackme.com/room/xssgi  

### ДОМ:

DOM означает  Document Object Model  и  является программным интерфейсом для документов HTML и XML . Он представляет 
страницу, чтобы программы могли изменять структуру документа, его стиль и содержимое. Веб-страница — это документ, 
и этот документ может быть отображен в окне браузера или как исходный HTML-код.  

DOM Based XSS — это когда выполнение JavaScript происходит непосредственно в браузере без загрузки новых страниц или 
отправки данных в код бэкенда. Выполнение происходит, когда код JavaScript веб-сайта реагирует на ввод или 
взаимодействие с пользователем. Примером этого может быть код JavaScript веб-сайта, получающий содержимое из 
параметра  window.location.hash, а затем записывающий его на страницу в просматриваемом в данный момент разделе. 
Содержимое хеша не проверяется на наличие вредоносного кода, что позволяет злоумышленнику внедрить JavaScript по 
своему выбору на веб-страницу.     

### Отражено:
Отраженный XSS происходит, когда пользовательские данные в  HTTP-  запросе включаются в исходный код веб-страницы 
без какой-либо проверки. Примером этого может быть сообщение об ошибке в строке запроса URL, который отражается на 
веб-странице. URL может выглядеть примерно так:  

https://website.thm/login?error=Имя пользователя%20%20Неверно

Сообщение об ошибке можно заменить кодом JavaScript, который выполняется, когда пользователь посещает страницу.

### Сохранено:
Как следует из названия, полезная нагрузка XSS хранится в веб-приложении (например, в базе данных), а затем 
запускается, когда другие пользователи посещают сайт или веб-страницу. Этот тип XSS может быть особенно 
разрушительным из-за количества жертв, которые могут быть затронуты. Примером этого может быть блог, который 
позволяет посетителям оставлять комментарии. Если сообщение посетителя не проверено должным образом и не имеет 
полезных нагрузок XSS , то каждое последующее посещение страницы блога будет запускать вредоносный код JavaScript.    

### Слепой:
Blind XSS похож на сохраненный XSS в том, что ваша полезная нагрузка сохраняется на веб-сайте для просмотра другим 
пользователем, но в этом случае вы не можете увидеть, как работает полезная нагрузка, или протестировать ее на себе. 
Примером этого может быть контактная форма. В контактной форме ваше сообщение может содержать полезную нагрузку XSS, 
которая выполняется, когда сотрудник просматривает сообщение.   

### Прохождение задания

Нажмите зеленую кнопку «Запустить машину» в правом верхнем углу этой задачи. После загрузки машины нажмите следующую 
ссылку: 
https://LAB_WEB_URL.p.thmlabs.com  (если вы получили сообщение об ошибке, подождите 30 секунд и попробуйте обновить 
страницу) 

Здесь вы найдете форум эльфов, где они говорят о Рождестве и распространяют радость! Когда вы исследуете форум и 
нажимаете на различные темы и ветки, вы заметите, что каждое упоминание Рождества было изменено на Buttmas! Это 
потому, что у Гринча есть учетная запись администратора и он установил плагин, который меняет каждое упоминание 
Рождества на Buttmas! Вам нужно будет захватить учетную запись Гринча и отключить плагин, чтобы восстановить 
рождественскую радость!    

Сначала нажмите ссылку входа в верхней части страницы и войдите в систему, используя следующие учетные данные:


Имя пользователя:  McSkidy
Пароль:  пароль

Теперь, когда вы вошли в систему, вы заметите, что панель навигации изменилась с «Вход» на «Настройки» и «Выход».

Нажмите на ссылку «Настройки», и вы увидите функцию для изменения пароля входа McSkidy. Попробуйте изменить свой 
пароль на  pass123 . Когда вы это сделаете, вы заметите, что ваша адресная строка изменится и будет выглядеть так, 
как на скриншоте ниже (вместо этого у вас будет IP-адрес MACHINE_IP). Если вам удастся каким-то образом обмануть 
Гринча, заставив его посетить этот URL, он изменит свой пароль на  pass123 .   

Давайте теперь вернемся на форум и посетим одну из тем. Если вы прокрутите страницу вниз, то увидите, что можете 
оставить комментарий. Попробуйте оставить следующий комментарий: 

`hello <u>world</u>`

После публикации комментария вы увидите, что слово «мир» подчеркнуто.



Это означает, что комментарий отображается так, как вы его написали, без удаления подчеркивания HTML-тегов. 
Поскольку это не удаляется, вы можете попробовать HTML-теги скриптов вместо этого, чтобы увидеть, будет ли веб-сайт 
выполнять любой введенный JavaScript.  

Используя URL-адрес, который вы нашли ранее для изменения пароля пользователя, вы можете попробовать следующую 
полезную нагрузку: 

`<script>fetch('/settings?new_password=pass123');</script>`

Тег  <script> сообщает браузеру, что мы хотим запустить некий JavaScript, и  fetch команда отправляет сетевой запрос 
на указанный URL. 

После публикации вышеизложенного в качестве комментария вы можете просмотреть исходный код веб-страницы, чтобы 
убедиться, что он отображается правильно. Скриншот ниже показывает нам, что теги скрипта не удаляются и не 
отключаются и, по сути, работают:  



Теперь, когда на форуме запущен этот XSS, это означает, что любой вошедший в систему пользователь, просматривающий 
ветку, автоматически сменит свой пароль на pass123. Итак, давайте выйдем из системы и посмотрим, посетил ли Гринч 
ветку, попытавшись войти под ним (может пройти около минуты, прежде чем Гринч посетит страницу и его пароль изменится).  

Имя пользователя:  Гринч
Пароль:  pass123

После входа в систему снова перейдите на страницу настроек, и на этот раз вы обнаружите еще одну функцию с 
возможностью отключения плагина Christmas to Buttmas. 

Отключите плагин, и вы получите флаг, который можно ввести ниже.

### Ответить на вопросы ниже
Какой флаг вы получили, когда отключили плагин?
```commandline
THM{NO_MORE_BUTTMAS}
```
## Задание 11
Во время планового аудита безопасности перед инцидентом Макскиди обнаружила некоторые пароли восстановления на 
старом сервере. Она создала тикет для вывода этого сервера из эксплуатации, чтобы уменьшить эту уязвимость 
безопасности. Эльф, назначенный для исправления этой уязвимости, продолжал откладывать задачу, и это так и не было 
сделано. К счастью, некоторые из этих ключей восстановления можно использовать для спасения некоторых систем.

К сожалению, единственный способ доступа к серверу — через старое веб-приложение. Попробуйте вытащить эти ключи восстановления, чтобы помочь Макскиди в ее стремлении спасти Рождество.

Посмотрите видео-обучение HuskyHacks на 6-й день  здесь
В этом задании мы рассмотрим основы уязвимости локального включения файлов ( LFI ), включая то, как идентифицировать и тестировать LFI . Мы также покажем влияние уязвимости LFI , эксплуатируя ее.

Давайте начнем с запуска машины, подключенной к этой задаче,


Что такое уязвимость локального включения файлов ( LFI )?

Уязвимость  LFI обнаружена в различных веб-приложениях. Например, в PHP  следующие функции  вызывают такую ​​уязвимость: 

включать
требовать
включить_один раз 
требуется_один раз 
Это уязвимость веб-приложения, которая позволяет злоумышленнику включать и читать локальные файлы на сервере. Эти файлы могут содержать конфиденциальные данные, такие как криптографические ключи, базы данных, содержащие пароли, и другие личные данные.  Уязвимость LFI   возникает  из-за отсутствия у разработчика знаний о безопасности.  В некоторых случаях разработчикам необходимо включить содержимое других локальных файлов на определенную страницу. Предположим, что разработчик включает файлы без надлежащей проверки ввода. В этом случае уязвимость LFI будет существовать, поскольку разработчик никогда не должен доверять пользовательскому вводу и фильтровать и очищать все вводимые пользователем данные.  Основная проблема этих уязвимостей заключается в отсутствии проверки ввода, при которой вводимые пользователем данные не очищаются и не проверяются, а пользователь контролирует их.

Каков риск LFI ?

После обнаружения  уязвимости LFI  можно прочитать конфиденциальные данные, если у вас есть разрешения на чтение файлов. Таким образом, одним из самых существенных рисков является утечка конфиденциальных данных, к которым имеет доступ обычный пользователь. Кроме того, в некоторых случаях  уязвимость LFI  может быть связана с выполнением  RCE удаленного выполнения кода  на сервере. Если мы можем внедрить или записать файл в системе, мы используем LFI для получения RCE. В этой задаче мы подготовили веб-приложение с уязвимостью  LFI  и возможным способом получения  RCE . Мы рассмотрим это веб-приложение позже.

Выявление и тестирование LFI

Обычно злоумышленники интересуются параметрами HTTP для манипулирования входными данными и внедрения полезных нагрузок атаки, чтобы увидеть, как ведет себя веб-приложение. В общем, если вы ищете  точку входа  для тестирования  типов атак веб-приложений , то важно использовать веб-приложение и проверить его функциональность. Точкой входа могут быть параметры HTTP  GET  или  POST  , которые передают аргумент или данные в веб-приложение для выполнения определенной операции.   

Параметры  — это строки параметров запроса, прикрепленные к URL, которые могут использоваться для извлечения данных 
или выполнения действий на основе ввода пользователя.  Следующий график объясняет и разбивает основные части URL. 



Например, параметры используются в поиске Google, где  запросы GET  передают пользовательский ввод в поисковую 
систему.  https://www.google.com/search?q=TryHackMe . Если вы не знакомы с темой, вы можете просмотреть  модуль «Как 
работает Интернет»,  чтобы понять концепцию.    

Как только вы найдете точку входа, нам нужно понять, как эти данные могут быть обработаны в приложении. После этого 
момента вы можете начать тестирование на определенные типы уязвимостей с помощью ручных или автоматизированных 
инструментов. Ниже приведен пример PHP- кода, уязвимого для LFI .   


<?PHP 
	include($_GET["file"]);
?>
PHP  -  код выше использует  запрос GET через файл  параметров URL   для включения файла на страницу.  Запрос можно 
сделать, отправив следующий HTTP- запрос:  http://example.thm.labs/index.php?file=welcome.txt для загрузки 
содержимого  файла welcome.txt , который находится в том же каталоге.     

Кроме того, в зависимости от веб-приложения могут использоваться и другие точки входа, где можно учитывать 
User-Agent, файлы cookie, сеанс и другие заголовки HTTP . 

Теперь, когда мы нашли точку входа, давайте начнем тестирование чтения локальных файлов, связанных с операционной 
системой. Ниже приведены некоторые системные файлы Linux , которые содержат конфиденциальную информацию. 

/etc/проблема
/etc/пароль
/etc/тень
/etc/группа
/etc/хосты
/etc/motd
/etc/mysql/my.cnf
/proc/[0-9]*/fd/[0-9]* (первая цифра — это PID , вторая — дескриптор файла)
/proc/self/окружение
/proc/версия
/proc/командная_строка

Давайте начнем с базового тестирования LFI. Как только мы определим точку входа или параметр HTTP, мы можем начать 
тестирование и включить файлы ОС, чтобы увидеть, как отреагирует веб-приложение. В качестве тестового случая мы 
всегда можем попробовать /etc/passwd против ОС Linux , поскольку он наверняка доступен для чтения. Мы также можем 
попробовать включить, используя различные методы, такие как   

Прямое включение файла, которое начинается с  /etc/passwd
при использовании  ..  для выхода из текущего каталога количество  ..  зависит от каталога веб-приложения. 
Обход фильтров с помощью  ....// .
Методы кодирования URL  (например, двойное кодирование)
 Более подробную информацию об этих методах можно найти в  разделе «Включение файлов» .

  http://example.thm.labs/page.php?file=/etc/passwd http://example.thm.labs/page.php?file=../../../../../../etc/passwd 
http://example.thm.labs/page.php?file=../../../../../../etc/passwd%00 
http://example.thm.labs/page.php?file=....//....//....//....//etc/passwd 
http://example.thm.labs/page.php?file=%252e%252e%252fetc%252fpasswd
После успешного просмотра содержимого файла  /etc/passwd можно приступить к проверке других файлов. 

Теперь запустите присоединенную машину, используя зеленую кнопку Start Machine в этой задаче, и примените то, что мы 
обсуждали до сих пор, и ответьте на вопросы ниже.  Чтобы получить доступ к веб-сайту, вы можете либо развернуть 
AttackBox, либо посетить следующую ссылку веб-сайта: https://LAB_WEB_URL.p.thmlabs.com.  

### Использование LFI

Использование LFI иногда ограничено и зависит от конфигурации сервера веб-приложений. Помимо чтения конфиденциальных 
данных, часто мы можем получить удаленное выполнение кода.  Если мы имеем дело с веб-приложением PHP , то мы можем 
использовать поддерживаемую PHP оболочку . Для получения дополнительной информации посетите  страницу руководства 
PHP . PHP предоставляет различные методы передачи данных (поток ввода/вывода), чтобы позволить PHP читать. Это 
позволит читать данные через различные каналы типов данных.    

### PHP- фильтр

Обертка фильтра PHP используется в LFI для чтения фактического содержимого страницы PHP. В типичных случаях 
невозможно прочитать содержимое файла PHP через LFI, поскольку файлы PHP выполняются и никогда не показывают 
существующий код. Однако мы можем использовать фильтр PHP для отображения содержимого файлов PHP в других форматах 
кодировки, таких как  base64  или  ROT13 .    

Давайте сначала попробуем прочитать  файл /etc/passwd  с помощью PHP- оболочки фильтра.

  http://example.thm.labs/page.php?file=php://filter/resource=/etc/passwd
Теперь попробуйте прочитать  файл index.php  с помощью фильтра PHP; мы получим ошибки, потому что веб-сервер 
  попытается выполнить код PHP. Чтобы избежать этого, мы можем использовать фильтр PHP,  кодируя вывод base64 или  
  ROT13  следующим образом:    

http://example.thm.labs/page.php?file=php://filter/read=string.rot13/resource=/etc/passwd 
http://example.thm.labs/page.php?file=php://filter/convert.base64-encode/resource=/etc/passwd
Мы попробуем использовать base64 для нашего сценария. В результате мы получим   следующий вывод в кодировке base64 :

cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDox******Deleted
Чтобы прочитать этот текст как обычный текст, вы можете использовать терминал Linux или один из веб-сайтов, которые 
выполняют декодирование онлайн, например,  www.base64decode.org . 

Теперь попробуйте извлечь  содержимое index.php  и ответить на вопрос №3 ниже .

ДАННЫЕ PHP

Обертка PHP используется для включения необработанного простого текста или данных в кодировке base64. Она 
используется для включения изображений на текущей странице. Она используется в эксплойте  LFI . 

Давайте попробуем закодировать текст «AoC3 is fun!» в формате base64, чтобы включить его в страницу с помощью 
данных-оболочки: 
Терминал
```user@machine$ echo "AoC3 is fun!" | base64 QW9DMyBpcyBmdW4hCg==```
Также мы могли бы декодировать base64 следующим образом:

Терминал
`user@machine$ echo "QW9DMyBpcyBmdW4hCg==" | base64 --decode AoC3 is fun!`
 
Теперь мы можем включить наши данные base64 в уязвимую страницу следующим образом:
http://example.thm.labs/page.php?file=data://text/plain;base64,QW9DMyBpcyBmdW4hCg==
В результате страница покажет наше прекрасное сообщение, которое  AoC3 is fun! . Используя эту технику, мы можем 
включить PHP- код в страницу, кодируя требуемый PHP- код и включая его в PHP- оболочку данных.  Вы можете провести 
небольшое исследование, чтобы проверить их!  

Другие PHP- обертки могут использоваться в уязвимости LFI . Вы можете провести исследование, чтобы проверить их!

Как мы уже упоминали, мы можем получить удаленное выполнение команд, если у нас есть возможность записать в файл или 
связать его с другими типами уязвимостей. В этой задаче мы будем использовать уязвимое веб-приложение, которое мы 
предоставили для выполнения RCE через LFI .  

### LFI в RCE через файлы журналов

Это также называется атакой отравления журнала. Это метод, используемый для получения удаленного выполнения команд 
на веб-сервере. Злоумышленнику необходимо включить вредоносную полезную нагрузку в файлы журналов служб, таких как 
Apache, SSH и т. д. Затем уязвимость LFI используется для запроса страницы, которая включает вредоносную полезную 
нагрузку.  Эксплуатация этого вида атаки зависит от различных факторов, включая дизайн веб-приложения и конфигурации 
сервера. Таким образом, это требует перечислений, анализа и понимания того, как работает веб-приложение.  Например, 
пользователь может включить вредоносную полезную нагрузку в файл журнала Apache через User-Agent или другие 
заголовки HTTP . В SSH пользователь может внедрить вредоносную полезную нагрузку в раздел имени пользователя.       

В этой задаче мы предоставили уязвимое веб-приложение, которое регистрирует запросы пользователей в файле журнала, к 
которому пользователь веб-сервера имеет доступ.  После входа в веб-приложение мы можем посетить страницу журнала по 
адресу  https://LAB_WEB_URL.p.thmlabs.com/logs.php .  



Мы видим, что страница журнала хранит четыре разных заголовка, включая имя пользователя, IP-адрес,  User-Agent и 
посещенную страницу.  User  -Agent — это заголовок HTTP, который включает информацию о браузере пользователя, чтобы 
серверы могли идентифицировать тип операционной системы, поставщика и версию.  User  -Agent — это один из заголовков 
HTTP , который может контролировать пользователь.  Поэтому,  чтобы получить RCE, вам нужно включить PHP- код в  
User-Agent  и отправить запрос в файл журнала с помощью LFI для выполнения в браузере. Теперь давайте проверим, 
можем ли мы включить значение User-Agent в файл журнала веб-приложения, и посмотрим, будет ли записана наша запись!        


Терминал
`user@machine$ curl -A "This is testing" http://LAB_WEB_URL.p.thmlabs.com/login.php`
После отправки HTTP- запроса с помощью curl (теперь уже с использованием зарегистрированного пользователя) мы можем 
проверить страницу журнала, чтобы увидеть, можем ли мы добавить отправленный нами User-Agent. 




Отлично! мы смогли включить нужное нам значение User-Agent. Теперь давайте  внедрим PHP- код в User-Agent с помощью 
браузера, терминалов или веб-прокси, таких как Burp Suite . В этой задаче мы покажем, как включить наш код в журнал 
веб-приложения с помощью терминала следующим образом:  
Терминал
`user@machine$ curl -A "<?php phpinfo();?>" http://LAB_WEB_URL.p.thmlabs.com/login.php`
Теперь, используя LFI, загрузите файл журнала, чтобы получить выполнение кода PHP. Обратите внимание, что важно 
посетить файл журнала через LFI. После вызова файла журнала мы увидим страницу информации PHP. 



Теперь время практики. Мы должны применить то, что мы обсуждали, чтобы получить RCE. Мы должны включить PHP- код в 
User-Agent, а затем использовать уязвимость LFI, называемую файлом журнала, чтобы ваш PHP- код был выполнен, затем 
ответить на вопрос ниже.  

### LFI в RCE через PHP- сессии

LFI to RCE через сеансы PHP следует той же концепции техники отравления журнала. Сеансы PHP — это файлы в 
операционной системе, которые хранят временную информацию. После выхода пользователя из веб-приложения информация 
сеанса PHP будет удалена.  

Этот метод требует перечисления для чтения файла конфигурации PHP , а затем мы узнаем, где находятся файлы сессий 
PHP . Затем мы включаем код PHP в сессию и, наконец, вызываем файл через LFI .  PHP хранит данные сессии в файлах в 
системе в разных местах в зависимости от конфигурации. Ниже приведены некоторые из распространенных мест, в которых 
хранится PHP :   

c:\Windows\Temp
/тмп/
/var/lib/php5
/var/lib/php/сессия

Как только злоумышленник обнаружит, где PHP хранит файл сеанса, и сможет контролировать значение своего сеанса, он 
сможет использовать его для цепной атаки с LFI , чтобы получить удаленное выполнение команд.  

Если мы перечислим и прочитаем конфигурацию PHP уязвимого веб-приложения, которое мы предоставили, мы увидим, что 
оно сохраняет сеансы PHP в каталоге  /tmp  . Оно также сохраняет значение имени пользователя в сеансе, даже если вы 
не вошли в систему, поскольку это значение необходимо разработчику для использования его в функции журналов. Мы 
внедряем код PHP в раздел пользователя на следующем рисунке, сохраненный в файле сеанса PHP .



Чтобы найти имя файла сеанса PHP, PHP по умолчанию использует следующую схему именования:  sess_<SESSION_ID>  , где 
мы можем найти  SESSION_ID  с помощью браузера и проверки файлов cookie, отправленных с сервера. 

Чтобы найти идентификатор сеанса в браузере, вы можете открыть инструменты разработчика (SHIFT+CTRL+I), затем 
вкладку Приложение. В левом меню выберите Файлы cookie и выберите целевой веб-сайт. Есть PHPSESSID  и   значение. В 
моем случае значение равно  vc4567al6pq7usm2cufmilkm45. Следовательно, файл будет иметь вид  
sess_vc4567al6pq7usm2cufmilkm45. Наконец, мы знаем, что он хранится в  /tmp.  Теперь мы можем использовать LFI для 
вызова файла сеанса.



https://LAB_WEB_URL.p.thmlabs.com/login.php?err=/tmp/sess_vc4567al6pq7usm2cufmilkm45
В результате у нас будет PHP- код, который мы вставили в файл имени пользователя, показанный на странице. Теперь 
примените то, что мы обсуждали, чтобы получить RCE на веб-сервере, используя LFI для RCE через сеансы PHP. Теперь 
ваша очередь попытаться получить RCE через сеанс PHP.  


Дополнительные ресурсы
Если вам интересно узнать больше об уязвимостях включения файлов, посетите  раздел, посвященный включению файлов,  
на TryHackMe. 

### Ответить на вопросы ниже
Разверните присоединенную виртуальную машину и осмотритесь. Какова точка входа для нашего веб-приложения?

```commandline
err
```
Используйте точку входа для выполнения  LFI для чтения  файла /etc/flag . Что такое флаг?  


```commandline
THM{d29e08941cf7fe41df55f1a7da6c4c06}
```
Используйте технику фильтра PHP для чтения исходного кода index.php  . Каково  значение  переменной  $flag ?


```commandline
THM{791d43d46018a0d89361dbf60d5d9eb8}
```
McSkidy забыл свои учетные данные для входа. Можете ли вы помочь ему войти, чтобы восстановить один из паролей сервера?

Теперь, когда вы прочитали  index.php , есть путь к файлу PHP для входа в систему. Используйте технику фильтрации 
PHP, чтобы прочитать его содержимое. Каковы имя пользователя и пароль? 


```commandline
McSkidy:A0C315Aw3s0m
```
Используйте учетные данные для входа в веб-приложение. Помогите McSkidy восстановить пароль сервера. Какой пароль у  
сервера flag.thm.aoc  ?  


```commandline
THM{552f313b52e3c3dbf5257d8c6db7f6f1}
```
Веб-приложение регистрирует все запросы пользователей, и только авторизованные пользователи могут читать файл 
журнала. Используйте LFI для получения RCE через страницу файла журнала. Каково имя хоста веб-сервера? Расположение 
файла журнала:  ./includes/logs/app_access.log .  


```commandline
lfi-aoc-awesome-59aedca683fff9261263bb084880c965
```
Бонус: Текущая конфигурация PHP хранит файлы сеанса PHP в  /tmp . Используйте LFI для вызова файла сеанса PHP, чтобы 
выполнить ваш код PHP.  
```commandline
Ответ не нужен
```

## Задание 12

```commandline
Ответ не нужен
```

## Задание 13

```commandline
Ответ не нужен
```

## Задание 14

```commandline
Ответ не нужен
```

## Задание 15

```commandline
Ответ не нужен
```
## Задание 16

```commandline
Ответ не нужен
```

## Задание 17

```commandline
Ответ не нужен
```

## Задание 18

```commandline
Ответ не нужен
```

## Задание 19

```commandline
Ответ не нужен
```

## Задание 20

```commandline
Ответ не нужен
```
## Задание 21

```commandline
Ответ не нужен
```

## Задание 22

```commandline
Ответ не нужен
```

## Задание 23

```commandline
Ответ не нужен
```

## Задание 24

```commandline
Ответ не нужен
```

## Задание 25

```commandline
Ответ не нужен
```

## Задание 26

```commandline
Ответ не нужен
```

## Задание 27

```commandline
Ответ не нужен
```

## Задание 28

```commandline
Ответ не нужен
```

## Задание 29

```commandline
Ответ не нужен
```

## Задание 30

```commandline
Ответ не нужен
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)